<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Working with Data in R | Statistics for Soil Survey - Part 1</title>
  <meta name="description" content="Web-based course content for Statistics for Soil Survey - Part 1 made with bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Working with Data in R | Statistics for Soil Survey - Part 1" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Web-based course content for Statistics for Soil Survey - Part 1 made with bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Working with Data in R | Statistics for Soil Survey - Part 1" />
  
  <meta name="twitter:description" content="Web-based course content for Statistics for Soil Survey - Part 1 made with bookdown::gitbook." />
  

<meta name="author" content="Soil Survey Staff" />


<meta name="date" content="2021-01-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-data-we-use.html"/>
<link rel="next" href="exploratory-data-analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistics for Soil Survey - Part 1</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html"><i class="fa fa-check"></i><b>2</b> Pre-course Assignment</a><ul>
<li class="chapter" data-level="2.1" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#create-workspace"><i class="fa fa-check"></i><b>2.1</b> Create Workspace</a></li>
<li class="chapter" data-level="2.2" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#configure-rstudio"><i class="fa fa-check"></i><b>2.2</b> Configure RStudio</a></li>
<li class="chapter" data-level="2.3" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#essentials"><i class="fa fa-check"></i><b>2.3</b> Essentials</a></li>
<li class="chapter" data-level="2.4" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#personalization"><i class="fa fa-check"></i><b>2.4</b> Personalization</a></li>
<li class="chapter" data-level="2.5" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#install-.rprofile"><i class="fa fa-check"></i><b>2.5</b> Install .RProfile</a></li>
<li class="chapter" data-level="2.6" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#install-required-packages"><i class="fa fa-check"></i><b>2.6</b> Install Required Packages</a></li>
<li class="chapter" data-level="2.7" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#common-errors"><i class="fa fa-check"></i><b>2.7</b> Common Errors</a><ul>
<li class="chapter" data-level="2.7.1" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#no-output-is-produced-after-pasting-into-console"><i class="fa fa-check"></i><b>2.7.1</b> No output is produced after pasting into console</a></li>
<li class="chapter" data-level="2.7.2" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#somepackage-is-not-available-for-r-version-x.y.z"><i class="fa fa-check"></i><b>2.7.2</b> <code>‘SOMEPACKAGE’ is not available (for R version X.Y.Z)</code></a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#packages-not-on-cran"><i class="fa fa-check"></i><b>2.8</b> Packages not on CRAN</a></li>
<li class="chapter" data-level="2.9" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#connect-local-nasis"><i class="fa fa-check"></i><b>2.9</b> Connect Local NASIS</a></li>
<li class="chapter" data-level="2.10" data-path="pre-course-assignment.html"><a href="pre-course-assignment.html#proof"><i class="fa fa-check"></i><b>2.10</b> Proof</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>3</b> Introduction to R and RStudio</a><ul>
<li class="chapter" data-level="3.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>3.1</b> Outline</a></li>
<li class="chapter" data-level="3.2" data-path="intro.html"><a href="intro.html#course-overview"><i class="fa fa-check"></i><b>3.2</b> Course Overview</a><ul>
<li class="chapter" data-level="3.2.1" data-path="intro.html"><a href="intro.html#course-objectives"><i class="fa fa-check"></i><b>3.2.1</b> Course Objectives</a></li>
<li class="chapter" data-level="3.2.2" data-path="intro.html"><a href="intro.html#why-is-this-training-needed"><i class="fa fa-check"></i><b>3.2.2</b> Why is this training needed?</a></li>
<li class="chapter" data-level="3.2.3" data-path="intro.html"><a href="intro.html#why-is-course-organized-this-way"><i class="fa fa-check"></i><b>3.2.3</b> Why is course organized this way?</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="intro.html"><a href="intro.html#what-is-r"><i class="fa fa-check"></i><b>3.3</b> What is R?</a><ul>
<li class="chapter" data-level="3.3.1" data-path="intro.html"><a href="intro.html#why-should-i-learn-r"><i class="fa fa-check"></i><b>3.3.1</b> Why Should I Learn R?</a></li>
<li class="chapter" data-level="3.3.2" data-path="intro.html"><a href="intro.html#what-can-r-do"><i class="fa fa-check"></i><b>3.3.2</b> What can R do?</a></li>
<li class="chapter" data-level="3.3.3" data-path="intro.html"><a href="intro.html#packages"><i class="fa fa-check"></i><b>3.3.3</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="intro.html"><a href="intro.html#rstudio-an-integrated-development-environment-ide-for-r"><i class="fa fa-check"></i><b>3.4</b> RStudio: An Integrated Development Environment (IDE) for R</a><ul>
<li class="chapter" data-level="3.4.1" data-path="intro.html"><a href="intro.html#usda-computer-setup"><i class="fa fa-check"></i><b>3.4.1</b> USDA Computer Setup</a></li>
<li class="chapter" data-level="3.4.2" data-path="intro.html"><a href="intro.html#basic-tips-for-using-r"><i class="fa fa-check"></i><b>3.4.2</b> Basic Tips for using R</a></li>
<li class="chapter" data-level="3.4.3" data-path="intro.html"><a href="intro.html#working-directories"><i class="fa fa-check"></i><b>3.4.3</b> Working Directories</a></li>
<li class="chapter" data-level="3.4.4" data-path="intro.html"><a href="intro.html#data-management-in-rstudio"><i class="fa fa-check"></i><b>3.4.4</b> Data Management in RStudio</a></li>
<li class="chapter" data-level="3.4.5" data-path="intro.html"><a href="intro.html#getting-help"><i class="fa fa-check"></i><b>3.4.5</b> Getting Help</a></li>
<li class="chapter" data-level="3.4.6" data-path="intro.html"><a href="intro.html#packages-1"><i class="fa fa-check"></i><b>3.4.6</b> Packages</a></li>
<li class="chapter" data-level="3.4.7" data-path="intro.html"><a href="intro.html#writing-scripts"><i class="fa fa-check"></i><b>3.4.7</b> Writing Scripts</a></li>
<li class="chapter" data-level="3.4.8" data-path="intro.html"><a href="intro.html#saving-r-files"><i class="fa fa-check"></i><b>3.4.8</b> Saving R Files</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="intro.html"><a href="intro.html#review"><i class="fa fa-check"></i><b>3.5</b> Review</a></li>
<li class="chapter" data-level="3.6" data-path="intro.html"><a href="intro.html#additional-readings"><i class="fa fa-check"></i><b>3.6</b> Additional Readings</a></li>
<li class="chapter" data-level="3.7" data-path="intro.html"><a href="intro.html#references"><i class="fa fa-check"></i><b>3.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="the-data-we-use.html"><a href="the-data-we-use.html"><i class="fa fa-check"></i><b>4</b> The Data We Use</a><ul>
<li class="chapter" data-level="4.1" data-path="the-data-we-use.html"><a href="the-data-we-use.html#objectives"><i class="fa fa-check"></i><b>4.1</b> Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="the-data-we-use.html"><a href="the-data-we-use.html#the-structure-of-our-data"><i class="fa fa-check"></i><b>4.2</b> The Structure of Our Data</a><ul>
<li class="chapter" data-level="4.2.1" data-path="the-data-we-use.html"><a href="the-data-we-use.html#package-references"><i class="fa fa-check"></i><b>4.2.1</b> Package References</a></li>
<li class="chapter" data-level="4.2.2" data-path="the-data-we-use.html"><a href="the-data-we-use.html#soildb-functions"><i class="fa fa-check"></i><b>4.2.2</b> soilDB Functions</a></li>
<li class="chapter" data-level="4.2.3" data-path="the-data-we-use.html"><a href="the-data-we-use.html#importance-of-pedon-data"><i class="fa fa-check"></i><b>4.2.3</b> Importance of Pedon Data</a></li>
<li class="chapter" data-level="4.2.4" data-path="the-data-we-use.html"><a href="the-data-we-use.html#some-issues-with-pedon-data"><i class="fa fa-check"></i><b>4.2.4</b> Some Issues With Pedon Data</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="the-data-we-use.html"><a href="the-data-we-use.html#common-challenges-working-with-pedon-data"><i class="fa fa-check"></i><b>4.3</b> Common Challenges Working with Pedon Data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="the-data-we-use.html"><a href="the-data-we-use.html#meeting-the-challenges"><i class="fa fa-check"></i><b>4.3.1</b> Meeting the Challenges</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="the-data-we-use.html"><a href="the-data-we-use.html#the-soilprofilecollection"><i class="fa fa-check"></i><b>4.4</b> The <code>SoilProfileCollection</code></a></li>
<li class="chapter" data-level="4.5" data-path="the-data-we-use.html"><a href="the-data-we-use.html#using-the-soildb-package"><i class="fa fa-check"></i><b>4.5</b> Using the soilDB Package</a><ul>
<li class="chapter" data-level="4.5.1" data-path="the-data-we-use.html"><a href="the-data-we-use.html#fetchnasis"><i class="fa fa-check"></i><b>4.5.1</b> <code>fetchNASIS()</code></a></li>
<li class="chapter" data-level="4.5.2" data-path="the-data-we-use.html"><a href="the-data-we-use.html#fetchnasis-arguments"><i class="fa fa-check"></i><b>4.5.2</b> fetchNASIS arguments</a></li>
<li class="chapter" data-level="4.5.3" data-path="the-data-we-use.html"><a href="the-data-we-use.html#open-database-connectivity-odbc-connection-to-nasis"><i class="fa fa-check"></i><b>4.5.3</b> Open Database Connectivity (ODBC) Connection to NASIS</a></li>
<li class="chapter" data-level="4.5.4" data-path="the-data-we-use.html"><a href="the-data-we-use.html#prepare-example-data"><i class="fa fa-check"></i><b>4.5.4</b> Prepare Example Data</a></li>
<li class="chapter" data-level="4.5.5" data-path="the-data-we-use.html"><a href="the-data-we-use.html#the-gopheridge-soildb-dataset"><i class="fa fa-check"></i><b>4.5.5</b> The <code>gopheridge</code> soilDB Dataset</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="the-data-we-use.html"><a href="the-data-we-use.html#viewing-pedon-locations"><i class="fa fa-check"></i><b>4.6</b> Viewing Pedon Locations</a><ul>
<li class="chapter" data-level="4.6.1" data-path="the-data-we-use.html"><a href="the-data-we-use.html#plotting-geographic-data-directly-in-r"><i class="fa fa-check"></i><b>4.6.1</b> Plotting Geographic Data Directly in R</a></li>
<li class="chapter" data-level="4.6.2" data-path="the-data-we-use.html"><a href="the-data-we-use.html#displaying-pedon-data-in-google-earth"><i class="fa fa-check"></i><b>4.6.2</b> Displaying Pedon Data in Google Earth</a></li>
<li class="chapter" data-level="4.6.3" data-path="the-data-we-use.html"><a href="the-data-we-use.html#exporting-pedon-data-to-an-esri-shapefile"><i class="fa fa-check"></i><b>4.6.3</b> Exporting Pedon Data to an ESRI Shapefile</a></li>
<li class="chapter" data-level="4.6.4" data-path="the-data-we-use.html"><a href="the-data-we-use.html#follow-along-with-your-own-data-1"><i class="fa fa-check"></i><b>4.6.4</b> Follow along with your own data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html"><i class="fa fa-check"></i><b>5</b> Working with Data in R</a><ul>
<li class="chapter" data-level="5.1" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#summarizing-data"><i class="fa fa-check"></i><b>5.1</b> Summarizing Data</a><ul>
<li class="chapter" data-level="5.1.1" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#missing-values"><i class="fa fa-check"></i><b>5.1.1</b> Missing Values</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#filtering"><i class="fa fa-check"></i><b>5.2</b> Filtering</a><ul>
<li class="chapter" data-level="5.2.1" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#logical-operators"><i class="fa fa-check"></i><b>5.2.1</b> Logical Operators</a></li>
<li class="chapter" data-level="5.2.2" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#pattern-matching"><i class="fa fa-check"></i><b>5.2.2</b> Pattern Matching</a></li>
<li class="chapter" data-level="5.2.3" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#filtering-data-by-logical-criteria-with-aqpsubset"><i class="fa fa-check"></i><b>5.2.3</b> Filtering Data by Logical Criteria with <code>aqp::subset</code></a></li>
<li class="chapter" data-level="5.2.4" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#extracting-site-and-horizon-data"><i class="fa fa-check"></i><b>5.2.4</b> Extracting Site and Horizon Data</a></li>
<li class="chapter" data-level="5.2.5" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#review-of-data-checks-run-by-fetchnasis"><i class="fa fa-check"></i><b>5.2.5</b> Review of Data Checks Run by <code>fetchNASIS()</code></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#getting-additional-data-extended-data-functions"><i class="fa fa-check"></i><b>5.3</b> Getting Additional Data: Extended Data Functions</a><ul>
<li class="chapter" data-level="5.3.1" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#deriving-thicknesses-of-diagnostic-features"><i class="fa fa-check"></i><b>5.3.1</b> Deriving Thicknesses of Diagnostic Features</a></li>
<li class="chapter" data-level="5.3.2" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#diagnostic-feature-diagrams"><i class="fa fa-check"></i><b>5.3.2</b> Diagnostic Feature Diagrams</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#soil-reports"><i class="fa fa-check"></i><b>5.4</b> Soil Reports</a><ul>
<li class="chapter" data-level="5.4.1" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#requirements"><i class="fa fa-check"></i><b>5.4.1</b> Requirements</a></li>
<li class="chapter" data-level="5.4.2" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#instructions"><i class="fa fa-check"></i><b>5.4.2</b> Instructions</a></li>
<li class="chapter" data-level="5.4.3" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#exercise-run-the-region11lab_summary_by_taxonname"><i class="fa fa-check"></i><b>5.4.3</b> Exercise: run the region11/lab_summary_by_taxonname</a></li>
<li class="chapter" data-level="5.4.4" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#exercise-run-mapunit-comparison"><i class="fa fa-check"></i><b>5.4.4</b> Exercise: Run Mapunit Comparison</a></li>
<li class="chapter" data-level="5.4.5" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#exercise-run-shiny-pedon-summary"><i class="fa fa-check"></i><b>5.4.5</b> Exercise: Run Shiny Pedon Summary</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#customized-queries-to-local-nasis-database"><i class="fa fa-check"></i><b>5.5</b> Customized Queries to Local NASIS Database</a><ul>
<li class="chapter" data-level="5.5.1" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#rodbc-package"><i class="fa fa-check"></i><b>5.5.1</b> <code>RODBC</code> package</a></li>
<li class="chapter" data-level="5.5.2" data-path="working-with-data-in-r.html"><a href="working-with-data-in-r.html#dbi"><i class="fa fa-check"></i><b>5.5.2</b> <code>DBI</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>6</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="the-data-we-use.html"><a href="the-data-we-use.html#objectives"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#statistics"><i class="fa fa-check"></i><b>6.2</b> Statistics</a></li>
<li class="chapter" data-level="6.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-inspection"><i class="fa fa-check"></i><b>6.3</b> Data Inspection</a><ul>
<li class="chapter" data-level="6.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercise-fetch-and-inspect"><i class="fa fa-check"></i><b>6.3.1</b> Exercise: fetch and inspect</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#descriptive-statistics"><i class="fa fa-check"></i><b>6.4</b> Descriptive Statistics</a><ul>
<li class="chapter" data-level="6.4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#measures-of-central-tendency"><i class="fa fa-check"></i><b>6.4.1</b> Measures of Central Tendency</a></li>
<li class="chapter" data-level="6.4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#measures-of-dispersion"><i class="fa fa-check"></i><b>6.4.2</b> Measures of Dispersion</a></li>
<li class="chapter" data-level="6.4.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#correlation"><i class="fa fa-check"></i><b>6.4.3</b> Correlation</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#graphical-methods"><i class="fa fa-check"></i><b>6.5</b> Graphical Methods</a><ul>
<li class="chapter" data-level="6.5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#distributions"><i class="fa fa-check"></i><b>6.5.1</b> Distributions</a></li>
<li class="chapter" data-level="6.5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#bar-plot"><i class="fa fa-check"></i><b>6.5.2</b> Bar Plot</a></li>
<li class="chapter" data-level="6.5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#histogram"><i class="fa fa-check"></i><b>6.5.3</b> Histogram</a></li>
<li class="chapter" data-level="6.5.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#density-curve"><i class="fa fa-check"></i><b>6.5.4</b> Density Curve</a></li>
<li class="chapter" data-level="6.5.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#box-plots"><i class="fa fa-check"></i><b>6.5.5</b> Box plots</a></li>
<li class="chapter" data-level="6.5.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#quantile-comparison-plots-qqplot"><i class="fa fa-check"></i><b>6.5.6</b> Quantile comparison plots (QQplot)</a></li>
<li class="chapter" data-level="6.5.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#the-normal-distribution"><i class="fa fa-check"></i><b>6.5.7</b> The ‘Normal’ distribution</a></li>
<li class="chapter" data-level="6.5.8" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#scatterplots-and-line-plots"><i class="fa fa-check"></i><b>6.5.8</b> Scatterplots and Line Plots</a></li>
<li class="chapter" data-level="6.5.9" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#rd-dimension---color-shape-size-layers-etc"><i class="fa fa-check"></i><b>6.5.9</b> 3rd Dimension - Color, Shape, Size, Layers, etc…</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#transformations"><i class="fa fa-check"></i><b>6.6</b> Transformations</a><ul>
<li class="chapter" data-level="6.6.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#ph"><i class="fa fa-check"></i><b>6.6.1</b> pH</a></li>
<li class="chapter" data-level="6.6.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#circular-data"><i class="fa fa-check"></i><b>6.6.2</b> Circular data</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="intro.html"><a href="intro.html#references"><i class="fa fa-check"></i><b>6.7</b> References</a></li>
<li class="chapter" data-level="6.8" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#additional-reading"><i class="fa fa-check"></i><b>6.8</b> Additional Reading</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html"><i class="fa fa-check"></i><b>7</b> Spatial Data in R</a><ul>
<li class="chapter" data-level="7.1" data-path="the-data-we-use.html"><a href="the-data-we-use.html#objectives"><i class="fa fa-check"></i><b>7.1</b> Objectives</a></li>
<li class="chapter" data-level="7.2" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#spatial-data-sources"><i class="fa fa-check"></i><b>7.2</b> Spatial Data Sources</a></li>
<li class="chapter" data-level="7.3" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#many-packages-many-spatial-representations"><i class="fa fa-check"></i><b>7.3</b> Many Packages, Many Spatial Representations</a><ul>
<li class="chapter" data-level="7.3.1" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#the-sf-package"><i class="fa fa-check"></i><b>7.3.1</b> The <code>sf</code> package</a></li>
<li class="chapter" data-level="7.3.2" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#the-sp-package"><i class="fa fa-check"></i><b>7.3.2</b> The <code>sp</code> Package</a></li>
<li class="chapter" data-level="7.3.3" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#converting-sp-and-sf"><i class="fa fa-check"></i><b>7.3.3</b> Converting <code>sp</code> and <code>sf</code></a></li>
<li class="chapter" data-level="7.3.4" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#importing-exporting-vector-data"><i class="fa fa-check"></i><b>7.3.4</b> Importing / Exporting Vector Data</a></li>
<li class="chapter" data-level="7.3.5" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#interactive-mapping-with-mapview-and-leaflet"><i class="fa fa-check"></i><b>7.3.5</b> Interactive mapping with <code>mapview</code> and <code>leaflet</code></a></li>
<li class="chapter" data-level="7.3.6" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#the-raster-package"><i class="fa fa-check"></i><b>7.3.6</b> The <code>raster</code> Package</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#coordinate-reference-systems"><i class="fa fa-check"></i><b>7.4</b> Coordinate Reference Systems</a><ul>
<li class="chapter" data-level="7.4.1" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#assigning-and-transforming-coordinate-systems"><i class="fa fa-check"></i><b>7.4.1</b> Assigning and Transforming Coordinate Systems</a></li>
<li class="chapter" data-level="7.4.2" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#spatial-overlay-operations"><i class="fa fa-check"></i><b>7.4.2</b> Spatial Overlay Operations</a></li>
<li class="chapter" data-level="7.4.3" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#raster-data-sampling"><i class="fa fa-check"></i><b>7.4.3</b> Raster Data Sampling</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#exercises"><i class="fa fa-check"></i><b>7.5</b> Exercises</a><ul>
<li class="chapter" data-level="7.5.1" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#example-data"><i class="fa fa-check"></i><b>7.5.1</b> Example Data</a></li>
<li class="chapter" data-level="7.5.2" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#load-the-data"><i class="fa fa-check"></i><b>7.5.2</b> Load the data</a></li>
<li class="chapter" data-level="7.5.3" data-path="spatial-data-in-r.html"><a href="spatial-data-in-r.html#basic-sampling-and-extraction"><i class="fa fa-check"></i><b>7.5.3</b> Basic sampling and extraction</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#additional-reading"><i class="fa fa-check"></i><b>7.6</b> Additional Reading</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sampling.html"><a href="sampling.html"><i class="fa fa-check"></i><b>8</b> Sampling</a><ul>
<li class="chapter" data-level="8.1" data-path="sampling.html"><a href="sampling.html#introduction"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="sampling.html"><a href="sampling.html#sampling-strategies"><i class="fa fa-check"></i><b>8.2</b> Sampling Strategies</a><ul>
<li class="chapter" data-level="8.2.1" data-path="sampling.html"><a href="sampling.html#simple-random"><i class="fa fa-check"></i><b>8.2.1</b> Simple Random</a></li>
<li class="chapter" data-level="8.2.2" data-path="sampling.html"><a href="sampling.html#stratified-random"><i class="fa fa-check"></i><b>8.2.2</b> Stratified Random</a></li>
<li class="chapter" data-level="8.2.3" data-path="sampling.html"><a href="sampling.html#multistage-stratified-random"><i class="fa fa-check"></i><b>8.2.3</b> Multistage Stratified Random</a></li>
<li class="chapter" data-level="8.2.4" data-path="sampling.html"><a href="sampling.html#systematic"><i class="fa fa-check"></i><b>8.2.4</b> Systematic</a></li>
<li class="chapter" data-level="8.2.5" data-path="sampling.html"><a href="sampling.html#cluster"><i class="fa fa-check"></i><b>8.2.5</b> Cluster</a></li>
<li class="chapter" data-level="8.2.6" data-path="sampling.html"><a href="sampling.html#conditioned-latin-hypercube-clhs"><i class="fa fa-check"></i><b>8.2.6</b> Conditioned Latin Hypercube (cLHS)</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="sampling.html"><a href="sampling.html#evaluating-a-sampling-strategy"><i class="fa fa-check"></i><b>8.3</b> Evaluating a Sampling Strategy</a><ul>
<li class="chapter" data-level="8.3.1" data-path="sampling.html"><a href="sampling.html#exercise-design-a-sampling-strategy"><i class="fa fa-check"></i><b>8.3.1</b> Exercise: Design a Sampling Strategy</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="sampling.html"><a href="sampling.html#other-tools-for-selecting-random-features"><i class="fa fa-check"></i><b>8.4</b> Other Tools for Selecting Random Features</a><ul>
<li class="chapter" data-level="8.4.1" data-path="sampling.html"><a href="sampling.html#clhs-using-teui"><i class="fa fa-check"></i><b>8.4.1</b> cLHS Using TEUI</a></li>
<li class="chapter" data-level="8.4.2" data-path="sampling.html"><a href="sampling.html#two-stage-stratified-random-sample-design-using-arcgis"><i class="fa fa-check"></i><b>8.4.2</b> Two-Stage Stratified Random Sample Design Using ArcGIS</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="intro.html"><a href="intro.html#references"><i class="fa fa-check"></i><b>8.5</b> References</a></li>
<li class="chapter" data-level="8.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#additional-reading"><i class="fa fa-check"></i><b>8.6</b> Additional Reading</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistics for Soil Survey - Part 1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-data-in-r" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Working with Data in R</h1>
<div id="summarizing-data" class="section level2">
<h2><span class="header-section-number">5.1</span> Summarizing Data</h2>
<p>Now that you’ve loaded some data, you can look at additional ways to summarize data elements and filter the SPC to specific sites of interest.</p>
<p>The base R <code>table()</code> function is very useful for quick summary operations. This function can be combined with other functions, such as <code>sort()</code> and <code>is.na()</code> or <code>!is.na()</code> (is not NA). Follow along with your own data.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="working-with-data-in-r.html#cb40-1"></a><span class="co"># load required packages</span></span>
<span id="cb40-2"><a href="working-with-data-in-r.html#cb40-2"></a><span class="kw">library</span>(aqp)</span>
<span id="cb40-3"><a href="working-with-data-in-r.html#cb40-3"></a><span class="kw">library</span>(soilDB)</span>
<span id="cb40-4"><a href="working-with-data-in-r.html#cb40-4"></a></span>
<span id="cb40-5"><a href="working-with-data-in-r.html#cb40-5"></a><span class="kw">data</span>(<span class="st">&quot;gopheridge&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;soilDB&quot;</span>)</span>
<span id="cb40-6"><a href="working-with-data-in-r.html#cb40-6"></a></span>
<span id="cb40-7"><a href="working-with-data-in-r.html#cb40-7"></a><span class="co"># for these examples, we use the gopheridge dataset as our &quot;selected set&quot;</span></span>
<span id="cb40-8"><a href="working-with-data-in-r.html#cb40-8"></a>pedons &lt;-<span class="st"> </span>gopheridge <span class="co"># fetchNASIS() # you can use fetchNASIS</span></span>
<span id="cb40-9"><a href="working-with-data-in-r.html#cb40-9"></a></span>
<span id="cb40-10"><a href="working-with-data-in-r.html#cb40-10"></a><span class="co"># summarize which soil taxa we have loaded</span></span>
<span id="cb40-11"><a href="working-with-data-in-r.html#cb40-11"></a><span class="kw">table</span>(pedons<span class="op">$</span>taxonname)</span>
<span id="cb40-12"><a href="working-with-data-in-r.html#cb40-12"></a></span>
<span id="cb40-13"><a href="working-with-data-in-r.html#cb40-13"></a><span class="co"># sort results in descending order</span></span>
<span id="cb40-14"><a href="working-with-data-in-r.html#cb40-14"></a><span class="kw">sort</span>(<span class="kw">table</span>(pedons<span class="op">$</span>taxonname), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</span>
<span id="cb40-15"><a href="working-with-data-in-r.html#cb40-15"></a></span>
<span id="cb40-16"><a href="working-with-data-in-r.html#cb40-16"></a><span class="co"># could do the same thing for taxonomic subgroups or any column of the SPC at the site or horizon levels</span></span>
<span id="cb40-17"><a href="working-with-data-in-r.html#cb40-17"></a><span class="kw">table</span>(pedons<span class="op">$</span>taxsubgrp)</span>
<span id="cb40-18"><a href="working-with-data-in-r.html#cb40-18"></a><span class="kw">sort</span>(<span class="kw">table</span>(pedons<span class="op">$</span>taxsubgrp), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div id="missing-values" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Missing Values</h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="working-with-data-in-r.html#cb41-1"></a><span class="kw">table</span>(pedons<span class="op">$</span>taxsubgrp, <span class="dt">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span>
<span id="cb41-2"><a href="working-with-data-in-r.html#cb41-2"></a></span>
<span id="cb41-3"><a href="working-with-data-in-r.html#cb41-3"></a><span class="co"># missing values:</span></span>
<span id="cb41-4"><a href="working-with-data-in-r.html#cb41-4"></a></span>
<span id="cb41-5"><a href="working-with-data-in-r.html#cb41-5"></a><span class="co">#  is.na(...) </span></span>
<span id="cb41-6"><a href="working-with-data-in-r.html#cb41-6"></a><span class="kw">table</span>(<span class="kw">is.na</span>(pedons<span class="op">$</span>taxsubgrp))</span>
<span id="cb41-7"><a href="working-with-data-in-r.html#cb41-7"></a></span>
<span id="cb41-8"><a href="working-with-data-in-r.html#cb41-8"></a><span class="co">#  is NOT NA !is.na(...)</span></span>
<span id="cb41-9"><a href="working-with-data-in-r.html#cb41-9"></a><span class="kw">table</span>(<span class="op">!</span><span class="kw">is.na</span>(pedons<span class="op">$</span>taxsubgrp))</span>
<span id="cb41-10"><a href="working-with-data-in-r.html#cb41-10"></a></span>
<span id="cb41-11"><a href="working-with-data-in-r.html#cb41-11"></a><span class="co"># it can also be applied to horizon level columns in the SPC</span></span>
<span id="cb41-12"><a href="working-with-data-in-r.html#cb41-12"></a><span class="kw">sort</span>(<span class="kw">table</span>(pedons<span class="op">$</span>texture), <span class="dt">decreasing=</span><span class="ot">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="filtering" class="section level2">
<h2><span class="header-section-number">5.2</span> Filtering</h2>
<p>A variety of methods are available to subset or filter data sets, be they simple data.frames or vectors, or something more complex like a spatial object or a <code>SoilProfileCollection</code>.</p>
<p>STUB: expand</p>
<div id="logical-operators" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Logical Operators</h3>
<ul>
<li><code>%in%</code> Equivalent to <code>IN ()</code> in SQL. Can use <code>c()</code> to concatenate lists of vectors.
<ul>
<li>Example: <code>pedons$taxpartsize %in% c('loamy-skeletal', 'sandy-skeletal')</code></li>
</ul></li>
<li><code>!=</code> Not-equal-to character “string.”</li>
<li><code>==</code> Note in the example above that R uses a double equal sign as “equal to.”</li>
<li><code>&lt;, &gt;, &lt;=, &gt;=</code> Less than, greater than, less than or equal to, and greater than or equal to.</li>
</ul>
</div>
<div id="pattern-matching" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Pattern Matching</h3>
<p>The following examples use the <code>grep()</code> function to pattern match within the data, create an index of the <code>SoilProfileCollection</code> for records that match the specified pattern within that column, and then use that index to filter to specific sites and their corresponding profiles.</p>
<p>Patterns are specified using <a href="http://regexr.com/">regular expression</a> (REGEX) syntax.</p>
<p>This process can be applied to many different columns in the SPC based on how you need to filter the data. This example pattern matches on the <code>tax_subgroup</code> column, but another useful application might be to pattern match on geomorphology or parent material.</p>
<p>Note that the <code>grep()</code> below also has an <strong><em>invert option</em></strong>, which is specified as either TRUE or FALSE (default false). This option is very useful for excluding the results of the pattern matching process by inverting the selection.</p>
<p>Say we want to see what the variation of particle size classes are within a specific subgroup? We can use <code>grep()</code> to create a row index, then apply that index to the <code>SoilProfileCollection</code>.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="working-with-data-in-r.html#cb42-1"></a><span class="co"># create a numeric index for pedons with taxsubgroup containing &#39;typic&#39;</span></span>
<span id="cb42-2"><a href="working-with-data-in-r.html#cb42-2"></a>idx &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&#39;typic&#39;</span>, pedons<span class="op">$</span>taxsubgrp, <span class="dt">invert =</span> <span class="ot">FALSE</span>, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)</span>
<span id="cb42-3"><a href="working-with-data-in-r.html#cb42-3"></a>idx</span>
<span id="cb42-4"><a href="working-with-data-in-r.html#cb42-4"></a></span>
<span id="cb42-5"><a href="working-with-data-in-r.html#cb42-5"></a><span class="co"># use square bracket notation to subset &#39;typic&#39; soils in `subset1` object  </span></span>
<span id="cb42-6"><a href="working-with-data-in-r.html#cb42-6"></a>subset1 &lt;-<span class="st"> </span>pedons[idx, ]</span>
<span id="cb42-7"><a href="working-with-data-in-r.html#cb42-7"></a>subset1</span>
<span id="cb42-8"><a href="working-with-data-in-r.html#cb42-8"></a></span>
<span id="cb42-9"><a href="working-with-data-in-r.html#cb42-9"></a><span class="co"># or use the index directly to summarize taxpartsize for &#39;typic&#39; soils</span></span>
<span id="cb42-10"><a href="working-with-data-in-r.html#cb42-10"></a><span class="kw">sort</span>(<span class="kw">table</span>(pedons<span class="op">$</span>taxpartsize[idx]), <span class="dt">decreasing=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p>Another method is to specify a criteria using the <code>which()</code> function, where you pass any logical vector or expression. <code>grepl()</code> is the logical (<code>TRUE</code>/<code>FALSE</code>) version of grep, that always returns a vector of equal length to input, instead of the numeric index of <code>TRUE</code>. <code>which(grepl('lithic', pedons$taxsubgrp))</code> is the same as <code>grep('lithic', pedons$taxsubgrp)</code>.</p>
<p>Do a quick graphical check to ensure that the “typic” profiles are selected.</p>
<p>Plot them in R using the <code>SoilProfileCollection</code> “plot” method (e.g., specialized version of the generic <code>plot()</code> function).</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="working-with-data-in-r.html#cb43-1"></a><span class="co"># adjust margins</span></span>
<span id="cb43-2"><a href="working-with-data-in-r.html#cb43-2"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb43-3"><a href="working-with-data-in-r.html#cb43-3"></a></span>
<span id="cb43-4"><a href="working-with-data-in-r.html#cb43-4"></a><span class="co"># plot the first 10 profiles of subset1</span></span>
<span id="cb43-5"><a href="working-with-data-in-r.html#cb43-5"></a><span class="co"># limit plotting to a depth of about 60cm</span></span>
<span id="cb43-6"><a href="working-with-data-in-r.html#cb43-6"></a><span class="kw">plot</span>(subset1[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ], <span class="dt">label =</span> <span class="st">&#39;site_id&#39;</span>, <span class="dt">max.depth =</span> <span class="dv">60</span>)</span>
<span id="cb43-7"><a href="working-with-data-in-r.html#cb43-7"></a><span class="kw">title</span>(<span class="st">&#39;Pedons with the word &quot;typic&quot; at subgroup-level of Soil Taxonomy&#39;</span>, <span class="dt">line=</span><span class="op">-</span><span class="dv">2</span>)</span></code></pre></div>
<p>For more information on using regular expressions in <code>grep()</code> for pattern matching operations, see: <a href="https://www.gnu.org/software/findutils/manual/html_node/find_html/grep-regular-expression-syntax.html">Regular-expression-syntax</a>.</p>
<div id="additional-syntax-options-for-regex-pattern-matching" class="section level4">
<h4><span class="header-section-number">5.2.2.1</span> Additional syntax options for REGEX pattern matching</h4>
<ul>
<li><code>|</code> Equivalent to “or” in SQL.
<ul>
<li>Example: <code>grep('loamy | sandy', pedons$taxpartsize)</code></li>
</ul></li>
<li><code>^</code> Anchors to the left side of the string.
<ul>
<li>Example: <code>grep('^sandy', pedons$taxpartsize)</code>.</li>
</ul></li>
<li><code>$</code> Anchors to the right side of the string.
<ul>
<li>Example: <code>grep('skeletal$', pedons$taxpartsize)</code>.</li>
</ul></li>
</ul>
</div>
<div id="resources-for-learning-about-regular-expressions" class="section level4">
<h4><span class="header-section-number">5.2.2.2</span> Resources for learning about regular expressions</h4>
<ul>
<li><a href="https://regex101.com/" class="uri">https://regex101.com/</a> &amp; <a href="https://regexr.com/" class="uri">https://regexr.com/</a> - Online regular expression testers</li>
<li><a href="http://www.regular-expressions.info/quickstart.html" class="uri">http://www.regular-expressions.info/quickstart.html</a> - One-page regular expression quick start guide</li>
</ul>
</div>
</div>
<div id="filtering-data-by-logical-criteria-with-aqpsubset" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Filtering Data by Logical Criteria with <code>aqp::subset</code></h3>
<p>You can index many R objects using numeric or logical expressions as above. There are also methods that make this process a little easier.</p>
<p>Here, we supply two logical expressions to find “Alfisols” and <code>obsdate</code> before 2010. Larger size of the POSIXlt internal value is equivalent to later in time. We use the <code>subset</code> method, where we specify a data (<code>pedons</code>) object, in this case a <code>SoilProfileCollection</code>,then we can write expressions for the columns in that object.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="working-with-data-in-r.html#cb44-1"></a>subset2 &lt;-<span class="st"> </span><span class="kw">subset</span>(pedons, <span class="kw">grepl</span>(<span class="st">&quot;alfs&quot;</span>, taxsubgrp) <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb44-2"><a href="working-with-data-in-r.html#cb44-2"></a><span class="st">                          </span>obs_date <span class="op">&lt;</span><span class="st"> </span><span class="kw">as.POSIXlt</span>(<span class="st">&quot;2010-01-01&quot;</span>))</span>
<span id="cb44-3"><a href="working-with-data-in-r.html#cb44-3"></a></span>
<span id="cb44-4"><a href="working-with-data-in-r.html#cb44-4"></a><span class="co"># check taxonomic range of particle size classes in the data</span></span>
<span id="cb44-5"><a href="working-with-data-in-r.html#cb44-5"></a><span class="co"># overwhelmingly these are described as loamy-skeletal ultic haploxeralfs</span></span>
<span id="cb44-6"><a href="working-with-data-in-r.html#cb44-6"></a><span class="kw">sort</span>(<span class="kw">table</span>(subset2<span class="op">$</span>taxsubgrp), <span class="dt">decreasing=</span><span class="ot">TRUE</span>)</span>
<span id="cb44-7"><a href="working-with-data-in-r.html#cb44-7"></a><span class="kw">sort</span>(<span class="kw">table</span>(subset2<span class="op">$</span>taxpartsize), <span class="dt">decreasing=</span><span class="ot">TRUE</span>)</span>
<span id="cb44-8"><a href="working-with-data-in-r.html#cb44-8"></a></span>
<span id="cb44-9"><a href="working-with-data-in-r.html#cb44-9"></a><span class="co"># a double equal sign &#39;==&#39; is used for exact character or numeric criteria</span></span>
<span id="cb44-10"><a href="working-with-data-in-r.html#cb44-10"></a>subset3 &lt;-<span class="st"> </span><span class="kw">subset</span>(subset2, taxpartsize <span class="op">==</span><span class="st"> &#39;loamy-skeletal&#39;</span>)</span>
<span id="cb44-11"><a href="working-with-data-in-r.html#cb44-11"></a></span>
<span id="cb44-12"><a href="working-with-data-in-r.html#cb44-12"></a><span class="kw">table</span>(subset3<span class="op">$</span>taxpartsize)</span>
<span id="cb44-13"><a href="working-with-data-in-r.html#cb44-13"></a></span>
<span id="cb44-14"><a href="working-with-data-in-r.html#cb44-14"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb44-15"><a href="working-with-data-in-r.html#cb44-15"></a></span>
<span id="cb44-16"><a href="working-with-data-in-r.html#cb44-16"></a><span class="kw">plotSPC</span>(subset3[<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>,], <span class="dt">print.id =</span> <span class="ot">FALSE</span>)</span>
<span id="cb44-17"><a href="working-with-data-in-r.html#cb44-17"></a></span>
<span id="cb44-18"><a href="working-with-data-in-r.html#cb44-18"></a><span class="kw">title</span>(<span class="st">&#39;Loamy-skeletal Ultic Haploxeralfs&#39;</span>)</span></code></pre></div>
</div>
<div id="extracting-site-and-horizon-data" class="section level3">
<h3><span class="header-section-number">5.2.4</span> Extracting Site and Horizon Data</h3>
<p><code>SoilProfileCollections</code> are designed to be dismantled so they can work more easily with either site or horizon data.</p>
<p>The <code>SoilProfileCollection</code> has a slot for site-level data and a slot for horizon-level data.</p>
<p>You can reference these slots using the <code>site()</code> and <code>horizons()</code> functions within the AQP package.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="working-with-data-in-r.html#cb45-1"></a><span class="co"># extract site data from SPC into dataframe &#39;s&#39;</span></span>
<span id="cb45-2"><a href="working-with-data-in-r.html#cb45-2"></a>s &lt;-<span class="st"> </span><span class="kw">site</span>(pedons)</span>
<span id="cb45-3"><a href="working-with-data-in-r.html#cb45-3"></a><span class="kw">names</span>(s)</span>
<span id="cb45-4"><a href="working-with-data-in-r.html#cb45-4"></a></span>
<span id="cb45-5"><a href="working-with-data-in-r.html#cb45-5"></a><span class="co"># extract horizon data from SPC into dataframe &#39;h&#39;</span></span>
<span id="cb45-6"><a href="working-with-data-in-r.html#cb45-6"></a>h &lt;-<span class="st"> </span><span class="kw">horizons</span>(pedons)</span>
<span id="cb45-7"><a href="working-with-data-in-r.html#cb45-7"></a><span class="kw">names</span>(h)</span></code></pre></div>
<p>You can also use these functions when referencing the data within an SPC to specify that you want to look specifically in the site or horizon data.</p>
<!-- insert section labels for references via URL -->
<p><a id="fetchNASIS-data-checks-your-turn"></a></p>
</div>
<div id="review-of-data-checks-run-by-fetchnasis" class="section level3">
<h3><span class="header-section-number">5.2.5</span> Review of Data Checks Run by <code>fetchNASIS()</code></h3>
<p>Now that you’ve loaded some data and learned a little about how to filter data in the SPC, you can quickly review some of the <code>get()</code> functions used to track data issues detected in the process of loading data back to the NASIS records in your selected set.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="working-with-data-in-r.html#cb46-1"></a><span class="kw">get</span>(<span class="st">&#39;sites.missing.pedons&#39;</span>, <span class="dt">envir=</span>soilDB.env)</span>
<span id="cb46-2"><a href="working-with-data-in-r.html#cb46-2"></a><span class="kw">get</span>(<span class="st">&#39;dup.pedon.ids&#39;</span>, <span class="dt">envir=</span>soilDB.env)</span>
<span id="cb46-3"><a href="working-with-data-in-r.html#cb46-3"></a><span class="kw">get</span>(<span class="st">&#39;bad.pedon.ids&#39;</span>, <span class="dt">envir=</span>soilDB.env)</span>
<span id="cb46-4"><a href="working-with-data-in-r.html#cb46-4"></a><span class="kw">get</span>(<span class="st">&#39;bad.horizons&#39;</span>, <span class="dt">envir=</span>soilDB.env)</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="working-with-data-in-r.html#cb47-1"></a><span class="co"># example of pedon_id returned</span></span>
<span id="cb47-2"><a href="working-with-data-in-r.html#cb47-2"></a><span class="co">#[1] &quot;2011MT0810001&quot; &quot;2011MT0810009&quot; &quot;2011MT0810015&quot; &quot;2011MT0810027&quot; &quot;2011MT0810034&quot;</span></span>
<span id="cb47-3"><a href="working-with-data-in-r.html#cb47-3"></a></span>
<span id="cb47-4"><a href="working-with-data-in-r.html#cb47-4"></a>idx &lt;-<span class="st"> </span><span class="kw">subset</span>((<span class="op">!</span><span class="st"> </span>pedons<span class="op">$</span>pedon_id <span class="op">%in%</span><span class="st"> </span><span class="kw">get</span>(<span class="st">&#39;bad.pedon.ids&#39;</span>, <span class="dt">envir=</span>soilDB.env))</span>
<span id="cb47-5"><a href="working-with-data-in-r.html#cb47-5"></a>pedons &lt;-<span class="st"> </span>pedons[idx, ]</span></code></pre></div>
<p>Another useful function is <code>dput()</code>, which concatenates a variable. It converts something like this:</p>
<p><code>"2011MT0810001" "2011MT0810009" "2011MT0810015" "2011MT0810027" "2011MT0810034"</code></p>
<p>into a string like this that can be used again as R code, :</p>
<p><code>c("2011MT0810001", "2011MT0810009", "2011MT0810015", "2011MT0810027", "2011MT0810034").</code></p>
<p>Such a string can be copied and then pasted as a comma-delimited string or could be used as string for NASIS list queries. The <code>dput()</code> function is also helpful when sending questions or examples to colleagues via email.</p>
<!-- insert section labels for references via URL -->
<p><a id="nasis-pedon-extended-data"></a></p>
</div>
</div>
<div id="getting-additional-data-extended-data-functions" class="section level2">
<h2><span class="header-section-number">5.3</span> Getting Additional Data: Extended Data Functions</h2>
<p>Additional data related to both site and horizon information can be fetched using the <code>get_extended_data_from_NASIS()</code> function.</p>
<p>This data is not automatically brought into a <code>SoilProfileCollection</code> because these data elements are typically related to the site or horizon data in one-to-many relationships.</p>
<p>For example, multiple diagnostic features could exist within one pedon. Below is a summary of additional information that can be readily brought into R from your NASIS selected set via the <code>get_extended_data_from_NASIS()</code> function.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="working-with-data-in-r.html#cb48-1"></a><span class="co"># fetch extended site and horizon data</span></span>
<span id="cb48-2"><a href="working-with-data-in-r.html#cb48-2"></a>e &lt;-<span class="st"> </span><span class="kw">get_extended_data_from_NASIS_db</span>()</span>
<span id="cb48-3"><a href="working-with-data-in-r.html#cb48-3"></a></span>
<span id="cb48-4"><a href="working-with-data-in-r.html#cb48-4"></a><span class="co">### site and pedon related extended data</span></span>
<span id="cb48-5"><a href="working-with-data-in-r.html#cb48-5"></a><span class="co"># vegetation data summary</span></span>
<span id="cb48-6"><a href="working-with-data-in-r.html#cb48-6"></a><span class="kw">colnames</span>(e<span class="op">$</span>ecositehistory) </span>
<span id="cb48-7"><a href="working-with-data-in-r.html#cb48-7"></a></span>
<span id="cb48-8"><a href="working-with-data-in-r.html#cb48-8"></a><span class="co"># diagnostic features</span></span>
<span id="cb48-9"><a href="working-with-data-in-r.html#cb48-9"></a><span class="kw">colnames</span>(e<span class="op">$</span>diagnostic) </span>
<span id="cb48-10"><a href="working-with-data-in-r.html#cb48-10"></a></span>
<span id="cb48-11"><a href="working-with-data-in-r.html#cb48-11"></a><span class="co"># surface rock fragments</span></span>
<span id="cb48-12"><a href="working-with-data-in-r.html#cb48-12"></a><span class="kw">colnames</span>(e<span class="op">$</span>surf_frag_summary)</span>
<span id="cb48-13"><a href="working-with-data-in-r.html#cb48-13"></a></span>
<span id="cb48-14"><a href="working-with-data-in-r.html#cb48-14"></a><span class="co"># geomorphic description</span></span>
<span id="cb48-15"><a href="working-with-data-in-r.html#cb48-15"></a><span class="kw">colnames</span>(e<span class="op">$</span>geomorph)</span>
<span id="cb48-16"><a href="working-with-data-in-r.html#cb48-16"></a></span>
<span id="cb48-17"><a href="working-with-data-in-r.html#cb48-17"></a><span class="co"># taxonomic history data</span></span>
<span id="cb48-18"><a href="working-with-data-in-r.html#cb48-18"></a><span class="kw">colnames</span>(e<span class="op">$</span>taxhistory)</span>
<span id="cb48-19"><a href="working-with-data-in-r.html#cb48-19"></a></span>
<span id="cb48-20"><a href="working-with-data-in-r.html#cb48-20"></a><span class="co"># linked photo stored in site textnotes</span></span>
<span id="cb48-21"><a href="working-with-data-in-r.html#cb48-21"></a><span class="kw">colnames</span>(e<span class="op">$</span>photo) </span>
<span id="cb48-22"><a href="working-with-data-in-r.html#cb48-22"></a></span>
<span id="cb48-23"><a href="working-with-data-in-r.html#cb48-23"></a><span class="co"># site parent materials</span></span>
<span id="cb48-24"><a href="working-with-data-in-r.html#cb48-24"></a><span class="kw">colnames</span>(e<span class="op">$</span>pm)</span>
<span id="cb48-25"><a href="working-with-data-in-r.html#cb48-25"></a></span>
<span id="cb48-26"><a href="working-with-data-in-r.html#cb48-26"></a><span class="co">### horizon related extended data</span></span>
<span id="cb48-27"><a href="working-with-data-in-r.html#cb48-27"></a><span class="co"># rock fragments </span></span>
<span id="cb48-28"><a href="working-with-data-in-r.html#cb48-28"></a><span class="kw">colnames</span>(e<span class="op">$</span>frag_summary) </span>
<span id="cb48-29"><a href="working-with-data-in-r.html#cb48-29"></a></span>
<span id="cb48-30"><a href="working-with-data-in-r.html#cb48-30"></a><span class="co"># soil texture modifers</span></span>
<span id="cb48-31"><a href="working-with-data-in-r.html#cb48-31"></a><span class="kw">colnames</span>(e<span class="op">$</span>texmodifier)</span>
<span id="cb48-32"><a href="working-with-data-in-r.html#cb48-32"></a></span>
<span id="cb48-33"><a href="working-with-data-in-r.html#cb48-33"></a><span class="co"># soil structure data</span></span>
<span id="cb48-34"><a href="working-with-data-in-r.html#cb48-34"></a><span class="kw">colnames</span>(e<span class="op">$</span>struct) </span></code></pre></div>
<p>The “Geomorphic description” and “parent materials” attributes are important soil data.</p>
<p>They can be useful handles for exploring other data. The soilDB package flattens the nested table structure of parent material and geomorphic description within NASIS into single strings for each site-level record. The pattern matching concepts demonstrated above select profiles based on parts of these strings.</p>
<!--
The following code generates a simple graphical summary of the 10 most commonly occurring landforms in `fetchNASIS()` data so you can see their frequency of occurrence. 


```r
# graphically tabulate the occurrence of landforms
# load required libraries
library(soilDB)

# required for dotchart2()
library(Hmisc)

# load data from a NASIS selected set
pedons <- gopheridge#fetchNASIS(from = 'pedons')

# create 'lf' object of landform factors sorted in descending order
lf <- sort(table(pedons$landform_string), decreasing = TRUE)

# plot top 10 or length, whichever is shorter
dotchart2(lf[1:pmin(10, length(lf))], col='black', xlim = c(0, max(lf)), cex.labels = 0.75)
```
-->
<div id="deriving-thicknesses-of-diagnostic-features" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Deriving Thicknesses of Diagnostic Features</h3>
<div id="boolean-diagnostic-feature-columns-in-the-site-data" class="section level4">
<h4><span class="header-section-number">5.3.1.1</span> Boolean diagnostic feature columns in the site data</h4>
<p>If diagnostic features are populated in the pedon diagnostic features table in NASIS, then Boolean (<code>TRUE</code> or <code>FALSE</code>) fields are created for each diagnostic feature in the data brought in by soilDB. These fields can be readily used to model the presence or absence of a diagnostic soil feature by extracting the site data.</p>
<p>The following is an example of how you could use the diagnostic features (if populated!) from the extended data to determine the thickness of a diagnostic feature of interest.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="working-with-data-in-r.html#cb49-1"></a><span class="co"># rename gopheridge data</span></span>
<span id="cb49-2"><a href="working-with-data-in-r.html#cb49-2"></a><span class="kw">data</span>(<span class="st">&quot;gopheridge&quot;</span>)</span>
<span id="cb49-3"><a href="working-with-data-in-r.html#cb49-3"></a>f &lt;-<span class="st"> </span>gopheridge</span>
<span id="cb49-4"><a href="working-with-data-in-r.html#cb49-4"></a></span>
<span id="cb49-5"><a href="working-with-data-in-r.html#cb49-5"></a><span class="co"># get diagnostic features associated with pedons loaded from selected set</span></span>
<span id="cb49-6"><a href="working-with-data-in-r.html#cb49-6"></a>d &lt;-<span class="st"> </span><span class="kw">diagnostic_hz</span>(f)</span>
<span id="cb49-7"><a href="working-with-data-in-r.html#cb49-7"></a></span>
<span id="cb49-8"><a href="working-with-data-in-r.html#cb49-8"></a><span class="co"># summary of the diagnostic features in your data!</span></span>
<span id="cb49-9"><a href="working-with-data-in-r.html#cb49-9"></a><span class="kw">unique</span>(d<span class="op">$</span>featkind)</span>
<span id="cb49-10"><a href="working-with-data-in-r.html#cb49-10"></a><span class="kw">sort</span>(<span class="kw">table</span>(<span class="kw">droplevels</span>(<span class="kw">factor</span>(d<span class="op">$</span>featkind))), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)</span>
<span id="cb49-11"><a href="working-with-data-in-r.html#cb49-11"></a></span>
<span id="cb49-12"><a href="working-with-data-in-r.html#cb49-12"></a><span class="co"># subset argillic horizons</span></span>
<span id="cb49-13"><a href="working-with-data-in-r.html#cb49-13"></a>d &lt;-<span class="st"> </span>d[d<span class="op">$</span>featkind <span class="op">==</span><span class="st"> &#39;argillic horizon&#39;</span>, ]</span>
<span id="cb49-14"><a href="working-with-data-in-r.html#cb49-14"></a></span>
<span id="cb49-15"><a href="working-with-data-in-r.html#cb49-15"></a><span class="co"># create a new column and subtract the upper from the lower depth</span></span>
<span id="cb49-16"><a href="working-with-data-in-r.html#cb49-16"></a>d<span class="op">$</span>argillic_thickness_cm &lt;-<span class="st"> </span>d<span class="op">$</span>featdepb <span class="op">-</span><span class="st"> </span>d<span class="op">$</span>featdept</span>
<span id="cb49-17"><a href="working-with-data-in-r.html#cb49-17"></a></span>
<span id="cb49-18"><a href="working-with-data-in-r.html#cb49-18"></a><span class="co"># create another new column with the upper depth to the diagnostic feature</span></span>
<span id="cb49-19"><a href="working-with-data-in-r.html#cb49-19"></a>d<span class="op">$</span>depth_to_argillic_cm &lt;-<span class="st"> </span>d<span class="op">$</span>featdept</span>
<span id="cb49-20"><a href="working-with-data-in-r.html#cb49-20"></a></span>
<span id="cb49-21"><a href="working-with-data-in-r.html#cb49-21"></a><span class="co"># omit NA values</span></span>
<span id="cb49-22"><a href="working-with-data-in-r.html#cb49-22"></a>d &lt;-<span class="st"> </span><span class="kw">na.omit</span>(d)</span>
<span id="cb49-23"><a href="working-with-data-in-r.html#cb49-23"></a></span>
<span id="cb49-24"><a href="working-with-data-in-r.html#cb49-24"></a><span class="co"># subset to pedon records IDs and calculated thickness</span></span>
<span id="cb49-25"><a href="working-with-data-in-r.html#cb49-25"></a>d &lt;-<span class="st"> </span>d[, <span class="kw">c</span>(<span class="st">&#39;peiid&#39;</span>, <span class="st">&#39;argillic_thickness_cm&#39;</span>, <span class="st">&#39;depth_to_argillic_cm&#39;</span>)]</span>
<span id="cb49-26"><a href="working-with-data-in-r.html#cb49-26"></a><span class="kw">head</span>(d)</span>
<span id="cb49-27"><a href="working-with-data-in-r.html#cb49-27"></a></span>
<span id="cb49-28"><a href="working-with-data-in-r.html#cb49-28"></a><span class="co"># join these data with existing site data</span></span>
<span id="cb49-29"><a href="working-with-data-in-r.html#cb49-29"></a><span class="kw">site</span>(f) &lt;-<span class="st"> </span>d</span>
<span id="cb49-30"><a href="working-with-data-in-r.html#cb49-30"></a></span>
<span id="cb49-31"><a href="working-with-data-in-r.html#cb49-31"></a><span class="co"># plot as histogram</span></span>
<span id="cb49-32"><a href="working-with-data-in-r.html#cb49-32"></a><span class="co"># reset figure margins</span></span>
<span id="cb49-33"><a href="working-with-data-in-r.html#cb49-33"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">4.5</span>,<span class="fl">4.5</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb49-34"><a href="working-with-data-in-r.html#cb49-34"></a><span class="kw">hist</span>(f<span class="op">$</span>argillic_thickness_cm, <span class="dt">xlab =</span> <span class="st">&#39;Thickness of argillic diagnostic (cm)&#39;</span>, <span class="dt">main=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb49-35"><a href="working-with-data-in-r.html#cb49-35"></a><span class="kw">hist</span>(f<span class="op">$</span>depth_to_argillic_cm, <span class="dt">xlab =</span> <span class="st">&#39;Depth to argillic diagnostic (cm)&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;&#39;</span>)</span></code></pre></div>
</div>
<div id="follow-along-with-your-own-data-2" class="section level4">
<h4><span class="header-section-number">5.3.1.2</span> Follow along with your own data</h4>
<p>You could use the following code to pull the upper depth to calcium carbonates using the “calcic horizon” and/or the “secondary carbonates” diagnostic features. However, data consistency is critical.</p>
<p>You can only use those fields if they are consistently populated for all pedons that you are working with – this may mean trial and error, or inspection by some of the above methods we have shown.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="working-with-data-in-r.html#cb50-1"></a><span class="co"># start fresh with your own data</span></span>
<span id="cb50-2"><a href="working-with-data-in-r.html#cb50-2"></a>f &lt;-<span class="st"> </span><span class="kw">fetchNASIS</span>(<span class="dt">from =</span> <span class="st">&#39;pedons&#39;</span>)</span>
<span id="cb50-3"><a href="working-with-data-in-r.html#cb50-3"></a></span>
<span id="cb50-4"><a href="working-with-data-in-r.html#cb50-4"></a><span class="co"># get diagnostic features associated with pedons loaded in selected set</span></span>
<span id="cb50-5"><a href="working-with-data-in-r.html#cb50-5"></a>d &lt;-<span class="st"> </span><span class="kw">diagnostic_hz</span>(f)</span>
<span id="cb50-6"><a href="working-with-data-in-r.html#cb50-6"></a></span>
<span id="cb50-7"><a href="working-with-data-in-r.html#cb50-7"></a><span class="co"># summary of the diagnostic features in your data!</span></span>
<span id="cb50-8"><a href="working-with-data-in-r.html#cb50-8"></a><span class="kw">unique</span>(d<span class="op">$</span>featkind)</span>
<span id="cb50-9"><a href="working-with-data-in-r.html#cb50-9"></a></span>
<span id="cb50-10"><a href="working-with-data-in-r.html#cb50-10"></a><span class="co"># top 5 most frequent</span></span>
<span id="cb50-11"><a href="working-with-data-in-r.html#cb50-11"></a><span class="kw">sort</span>(<span class="kw">table</span>(d<span class="op">$</span>featkind), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb50-12"><a href="working-with-data-in-r.html#cb50-12"></a></span>
<span id="cb50-13"><a href="working-with-data-in-r.html#cb50-13"></a><span class="co"># subset argillic horizons - or your own diagnostic feature!</span></span>
<span id="cb50-14"><a href="working-with-data-in-r.html#cb50-14"></a></span>
<span id="cb50-15"><a href="working-with-data-in-r.html#cb50-15"></a><span class="co">#idx &lt;- which(d$diag_kind == &#39;your_diagnostic&#39;)</span></span>
<span id="cb50-16"><a href="working-with-data-in-r.html#cb50-16"></a><span class="co">#d &lt;- d[idx, ]</span></span>
<span id="cb50-17"><a href="working-with-data-in-r.html#cb50-17"></a></span>
<span id="cb50-18"><a href="working-with-data-in-r.html#cb50-18"></a><span class="co"># how would you do the rest.....see if you can work it out!</span></span></code></pre></div>
<p>What can you do with the boolean diagnostic feature data?</p>
</div>
</div>
<div id="diagnostic-feature-diagrams" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Diagnostic Feature Diagrams</h3>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="working-with-data-in-r.html#cb51-1"></a><span class="co">## work up diagnostic plot based on gopheridge dataset</span></span>
<span id="cb51-2"><a href="working-with-data-in-r.html#cb51-2"></a><span class="kw">library</span>(aqp)</span>
<span id="cb51-3"><a href="working-with-data-in-r.html#cb51-3"></a><span class="kw">library</span>(soilDB)</span>
<span id="cb51-4"><a href="working-with-data-in-r.html#cb51-4"></a><span class="kw">library</span>(sharpshootR)</span>
<span id="cb51-5"><a href="working-with-data-in-r.html#cb51-5"></a></span>
<span id="cb51-6"><a href="working-with-data-in-r.html#cb51-6"></a><span class="co"># load data</span></span>
<span id="cb51-7"><a href="working-with-data-in-r.html#cb51-7"></a><span class="kw">data</span>(gopheridge)</span>
<span id="cb51-8"><a href="working-with-data-in-r.html#cb51-8"></a></span>
<span id="cb51-9"><a href="working-with-data-in-r.html#cb51-9"></a><span class="co"># can limit which diagnostic features to show by setting &#39;v&#39; manually</span></span>
<span id="cb51-10"><a href="working-with-data-in-r.html#cb51-10"></a>v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;ochric.epipedon&#39;</span>, <span class="st">&#39;cambic.horizon&#39;</span>, </span>
<span id="cb51-11"><a href="working-with-data-in-r.html#cb51-11"></a>       <span class="st">&#39;argillic.horizon&#39;</span>, <span class="st">&#39;paralithic.contact&#39;</span>, </span>
<span id="cb51-12"><a href="working-with-data-in-r.html#cb51-12"></a>       <span class="st">&#39;lithic.contact&#39;</span>)</span>
<span id="cb51-13"><a href="working-with-data-in-r.html#cb51-13"></a></span>
<span id="cb51-14"><a href="working-with-data-in-r.html#cb51-14"></a><span class="co"># generate diagnostic property diagram</span></span>
<span id="cb51-15"><a href="working-with-data-in-r.html#cb51-15"></a><span class="kw">diagnosticPropertyPlot</span>(gopheridge, v, <span class="dt">k =</span> <span class="dv">5</span>, </span>
<span id="cb51-16"><a href="working-with-data-in-r.html#cb51-16"></a>                       <span class="dt">grid.label =</span> <span class="st">&#39;site_id&#39;</span>, </span>
<span id="cb51-17"><a href="working-with-data-in-r.html#cb51-17"></a>                       <span class="dt">dend.label =</span> <span class="st">&#39;taxonname&#39;</span>, </span>
<span id="cb51-18"><a href="working-with-data-in-r.html#cb51-18"></a>                       <span class="dt">sort.vars =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="newbook_files/figure-html/owndata_k-1.png" width="672" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="working-with-data-in-r.html#cb52-1"></a><span class="co"># plot with diagnostic features ordered according to co-occurrence</span></span>
<span id="cb52-2"><a href="working-with-data-in-r.html#cb52-2"></a><span class="kw">diagnosticPropertyPlot</span>(gopheridge, v, <span class="dt">k =</span> <span class="dv">5</span>, </span>
<span id="cb52-3"><a href="working-with-data-in-r.html#cb52-3"></a>                       <span class="dt">grid.label =</span> <span class="st">&#39;site_id&#39;</span>, </span>
<span id="cb52-4"><a href="working-with-data-in-r.html#cb52-4"></a>                       <span class="dt">dend.label =</span> <span class="st">&#39;taxonname&#39;</span>, </span>
<span id="cb52-5"><a href="working-with-data-in-r.html#cb52-5"></a>                       <span class="dt">sort.vars =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="newbook_files/figure-html/owndata_k-2.png" width="672" /></p>
<div id="follow-along-with-your-own-data-3" class="section level4">
<h4><span class="header-section-number">5.3.2.1</span> Follow along with your own data</h4>
<p>Use the following script to generate a diagnostic-feature diagram for the pedon data you’ve loaded from your NASIS selected set.
Note: If the data includes more than about 20 pedons, the script might generate figures that are very hard to read. You also need to be certain that pedon diagnostic feature were populated in your data.</p>
<p>Select a series of diagnostic properties or automatically pull diagnostic feature columns.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="working-with-data-in-r.html#cb53-1"></a><span class="kw">library</span>(aqp)</span>
<span id="cb53-2"><a href="working-with-data-in-r.html#cb53-2"></a><span class="kw">library</span>(soilDB)</span>
<span id="cb53-3"><a href="working-with-data-in-r.html#cb53-3"></a><span class="kw">library</span>(sharpshootR)</span>
<span id="cb53-4"><a href="working-with-data-in-r.html#cb53-4"></a></span>
<span id="cb53-5"><a href="working-with-data-in-r.html#cb53-5"></a><span class="co"># Load data</span></span>
<span id="cb53-6"><a href="working-with-data-in-r.html#cb53-6"></a>f &lt;-<span class="st"> </span><span class="kw">fetchNASIS</span>(<span class="dt">from =</span> <span class="st">&#39;pedons&#39;</span>)</span>
<span id="cb53-7"><a href="working-with-data-in-r.html#cb53-7"></a></span>
<span id="cb53-8"><a href="working-with-data-in-r.html#cb53-8"></a><span class="co"># May need to subset to a particular series or taxon here...</span></span>
<span id="cb53-9"><a href="working-with-data-in-r.html#cb53-9"></a><span class="co">#  to reduce the number of pedons!</span></span>
<span id="cb53-10"><a href="working-with-data-in-r.html#cb53-10"></a></span>
<span id="cb53-11"><a href="working-with-data-in-r.html#cb53-11"></a><span class="co"># get all diagnostic feature columns from site data by pattern matching on &#39;[.]&#39; in the colnames</span></span>
<span id="cb53-12"><a href="working-with-data-in-r.html#cb53-12"></a>idx &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&#39;[.]&#39;</span>, <span class="kw">colnames</span>(<span class="kw">site</span>(f)))</span>
<span id="cb53-13"><a href="working-with-data-in-r.html#cb53-13"></a>v &lt;-<span class="st"> </span><span class="kw">colnames</span>(<span class="kw">site</span>(f))[idx]</span>
<span id="cb53-14"><a href="working-with-data-in-r.html#cb53-14"></a>v</span>
<span id="cb53-15"><a href="working-with-data-in-r.html#cb53-15"></a></span>
<span id="cb53-16"><a href="working-with-data-in-r.html#cb53-16"></a><span class="co"># or insert diagnostics of interest </span></span>
<span id="cb53-17"><a href="working-with-data-in-r.html#cb53-17"></a><span class="co"># from the list of possible diagnostics in &#39;v&#39;</span></span>
<span id="cb53-18"><a href="working-with-data-in-r.html#cb53-18"></a>v &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;ochric.epipedon&#39;</span>, <span class="st">&#39;cambic.horizon&#39;</span>, </span>
<span id="cb53-19"><a href="working-with-data-in-r.html#cb53-19"></a>       <span class="st">&#39;argillic.horizon&#39;</span>, <span class="st">&#39;paralithic.contact&#39;</span>,</span>
<span id="cb53-20"><a href="working-with-data-in-r.html#cb53-20"></a>       <span class="st">&#39;lithic.contact&#39;</span>)</span>
<span id="cb53-21"><a href="working-with-data-in-r.html#cb53-21"></a></span>
<span id="cb53-22"><a href="working-with-data-in-r.html#cb53-22"></a><span class="co"># generate diagnostic property diagram</span></span>
<span id="cb53-23"><a href="working-with-data-in-r.html#cb53-23"></a><span class="kw">diagnosticPropertyPlot</span>(f, v, <span class="dt">k =</span> <span class="dv">5</span>, </span>
<span id="cb53-24"><a href="working-with-data-in-r.html#cb53-24"></a>                       <span class="dt">grid.label =</span> <span class="st">&#39;site_id&#39;</span>, </span>
<span id="cb53-25"><a href="working-with-data-in-r.html#cb53-25"></a>                       <span class="dt">dend.label =</span> <span class="st">&#39;taxonname&#39;</span>)</span></code></pre></div>
<p>For more information on generating diagnostic feature diagrams, see the following tutorial:
<a href="http://ncss-tech.github.io/AQP/sharpshootR/diagnostic-property-plot.html"><strong>Diagnostic Feature Property Plots</strong></a>.</p>
</div>
</div>
</div>
<div id="soil-reports" class="section level2">
<h2><span class="header-section-number">5.4</span> Soil Reports</h2>
<p>One of the strengths of NASIS is that it that has many queries and reports to access the complex data. This makes it easy for the average user to load their data, process it and run numerous reports.</p>
<p><code>soilReports</code> contains a small collection of reports mostly designed to summarize data into consistent report formats. This collection of reports automates many methods we have reviewed so far, but are no substitute for interacting with your data and asking questions.</p>
<p>Example report output can be found at the following link: <a href="https://github.com/ncss-tech/soilReports#example-output">https://github.com/ncss-tech/soilReports#example-output</a>.</p>
<p>Detailed instructions are provided for each report: <a href="https://github.com/ncss-tech/soilReports#choose-an-available-report">https://github.com/ncss-tech/soilReports#choose-an-available-report</a></p>
<p>Running and interpreting one of these reports would be a fine class project.</p>
<p>You can convert any of your R-based analyses to the <code>soilReports</code> format. The <code>soilReports</code> R package is essentially just a collection of R Markdown (<em>.Rmd</em>) reports, each with a “manifest” that describes any required dependencies, configuration files or inputs.</p>
<p>R Markdown is a markup format for creating reproducible, dynamic reports with R. It allows R code and text to be mingled in the same document and executed like an R script. This allows R to generate reports similar to, and even more powerful than, NASIS.</p>
<p>Let’s demonstrate how to run an existing <em>.Rmd</em> to summarize laboratory data for a soil series.</p>
<div id="requirements" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Requirements</h3>
<ul>
<li>Data are properly populated, otherwise the report may fail. Common examples include:
- Horizon depths don’t lineup
- Either the Pedon or Site tables isn’t loaded</li>
<li>ODBC connection to NASIS is setup</li>
<li>Beware each report has a unique configuration file that may need to be edited.</li>
</ul>
</div>
<div id="instructions" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Instructions</h3>
<ol style="list-style-type: decimal">
<li><p><strong>Load</strong> your NASIS selected set. <strong>Run</strong> a query such as “POINT - Pedon/Site/NCSSlabdata by upedonid and Taxon Name” from the Region 11 report folder to load your selected set. Be sure to target both the site, pedon and lab layer tables. <strong>Remove</strong> from your selected set the pedons and sites you wish to exclude from the report.</p></li>
<li><p><strong>Install/re-install</strong> the <code>soilReports</code> package. This package is updated regularly (e.g. weekly), and should be installed from GitHub regularly.</p></li>
</ol>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="working-with-data-in-r.html#cb54-1"></a><span class="co"># Install the soilReports package from GitHub</span></span>
<span id="cb54-2"><a href="working-with-data-in-r.html#cb54-2"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;ncss-tech/soilReports&quot;</span>, <span class="dt">dependencies=</span><span class="ot">FALSE</span>, <span class="dt">build=</span><span class="ot">FALSE</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><strong>View</strong> the list of available reports.</li>
</ol>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="working-with-data-in-r.html#cb55-1"></a><span class="co"># Load the soilReports and rmarkdown package</span></span>
<span id="cb55-2"><a href="working-with-data-in-r.html#cb55-2"></a><span class="kw">library</span>(soilReports)</span>
<span id="cb55-3"><a href="working-with-data-in-r.html#cb55-3"></a><span class="kw">library</span>(rmarkdown)</span>
<span id="cb55-4"><a href="working-with-data-in-r.html#cb55-4"></a></span>
<span id="cb55-5"><a href="working-with-data-in-r.html#cb55-5"></a><span class="co"># List reports</span></span>
<span id="cb55-6"><a href="working-with-data-in-r.html#cb55-6"></a><span class="kw">listReports</span>()</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><strong>Copy</strong> the lab summary to your working directory.</li>
</ol>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="working-with-data-in-r.html#cb56-1"></a><span class="co"># Copy report to your directory</span></span>
<span id="cb56-2"><a href="working-with-data-in-r.html#cb56-2"></a><span class="kw">copyReport</span>(<span class="dt">reportName =</span> <span class="st">&quot;region11/lab_summary_by_taxonname&quot;</span>, <span class="dt">outputDir =</span> <span class="st">&quot;C:/workspace2/lab_sum&quot;</span>)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li><strong>Examine</strong> the report folder contents. The reported is titled <code>report.Rmd</code>. Notice there are several other support files. The parameters for the report are contained in the <code>config.R</code> file.</li>
</ol>
<p><img src="static-figures/report_folder.png" /></p>
<ol start="6" style="list-style-type: decimal">
<li><strong>Check</strong> or <strong>create</strong> a genhz_rules file for a soil series. In order to aggregate the pedons by horizon designation, a genhz_rules file (e.g., Miami_rules.R) is needed. See above.</li>
</ol>
<p>If none exists see the following job aid on how to create one, <a href="http://ncss-tech.github.io/AQP/aqp/gen-hz-assignment.html">Assigning Generalized Horizon Labels</a>.</p>
<p><img src="static-figures/miamian_rules.png" /></p>
<p>Pay special attention to how caret <code>^</code> and dollar <code>$</code> symbols are used in REGEX. They function as <em>anchors</em> for the beginning and end of the string, respectively.</p>
<ul>
<li><p>A <code>^</code> placed before an A horizon, <code>^A</code>, will match any horizon designation that starts with A, such as Ap, Ap1, but <em>not</em> something merely containing A, such as BA.</p></li>
<li><p>Placing a <code>$</code> after a Bt horizon, <code>Bt$</code>, will match any horizon designation that ends with Bt, such as 2Bt or 3Bt, but <em>not</em> something with a vertical subdivision, such as Bt2.</p></li>
<li><p>Wrapping pattern with both <code>^</code> and <code>$</code> symbols will result only in exact matches – i.e. that start and end with the contents between <code>^</code> and <code>$</code>. For example <code>^[AC]$</code>, will only match A or C, <em>not</em> Ap, Ap2, or Cg.</p></li>
</ul>
<ol start="6" style="list-style-type: decimal">
<li><strong>Execute</strong> the report.</li>
</ol>
<p><strong>Command-line approach</strong></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="working-with-data-in-r.html#cb57-1"></a><span class="co"># Set report parameters</span></span>
<span id="cb57-2"><a href="working-with-data-in-r.html#cb57-2"></a>series &lt;-<span class="st"> &quot;Miami&quot;</span></span>
<span id="cb57-3"><a href="working-with-data-in-r.html#cb57-3"></a>genhz_rules &lt;-<span class="st"> &quot;C:/workspace2/lab_sum/Miami_rules.R&quot;</span></span>
<span id="cb57-4"><a href="working-with-data-in-r.html#cb57-4"></a></span>
<span id="cb57-5"><a href="working-with-data-in-r.html#cb57-5"></a><span class="co"># report file path</span></span>
<span id="cb57-6"><a href="working-with-data-in-r.html#cb57-6"></a>report_path &lt;-<span class="st"> &quot;C:/workspace2/lab_sum/report.Rmd&quot;</span></span>
<span id="cb57-7"><a href="working-with-data-in-r.html#cb57-7"></a></span>
<span id="cb57-8"><a href="working-with-data-in-r.html#cb57-8"></a><span class="co"># Run the report</span></span>
<span id="cb57-9"><a href="working-with-data-in-r.html#cb57-9"></a><span class="kw">render</span>(<span class="dt">input =</span> report_path, </span>
<span id="cb57-10"><a href="working-with-data-in-r.html#cb57-10"></a>       <span class="dt">output_dir =</span> <span class="st">&quot;C:/workspace2&quot;</span>, </span>
<span id="cb57-11"><a href="working-with-data-in-r.html#cb57-11"></a>       <span class="dt">output_file =</span> <span class="st">&quot;C:/workspace2/lab_sum.html&quot;</span>, </span>
<span id="cb57-12"><a href="working-with-data-in-r.html#cb57-12"></a>       <span class="dt">envir =</span> <span class="kw">new.env</span>(), </span>
<span id="cb57-13"><a href="working-with-data-in-r.html#cb57-13"></a>       <span class="dt">params =</span> <span class="kw">list</span>(<span class="dt">series =</span> series,</span>
<span id="cb57-14"><a href="working-with-data-in-r.html#cb57-14"></a>                     <span class="dt">genhz_rules =</span> genhz_rules</span>
<span id="cb57-15"><a href="working-with-data-in-r.html#cb57-15"></a>                     )</span>
<span id="cb57-16"><a href="working-with-data-in-r.html#cb57-16"></a>       )</span></code></pre></div>
<p><strong>Manual approach</strong></p>
<p><strong>Open</strong> the report.Rmd, <strong>hit</strong> the Knit drop down arrow, and select <strong>Knit with Parameters</strong>.</p>
<p><img src="static-figures/knit_button.png" /></p>
<ol start="7" style="list-style-type: decimal">
<li><strong>Save</strong> the report. The report is automatically saved upon creation in the same folder as the R report. However, it is given the same generic name as the R report (i.e., “C:/workspace/lab_sum/report.html”), and will be overwritten the next time the report is run. Therefore, if you wish to save the report, rename the .html file to a name of your choosing and/or convert it to a PDF.</li>
</ol>
<p>Also, beware when opening the .html file with Internet Explorer – be sure to click on “Allow blocked content” if prompted. Otherwise, Internet Explorer will alter the formatting of tables etc. within the document.</p>
<p><strong>Sample pedon report</strong></p>
<p><img src="static-figures/rmd_sample.png" /></p>
</div>
<div id="exercise-run-the-region11lab_summary_by_taxonname" class="section level3">
<h3><span class="header-section-number">5.4.3</span> Exercise: run the region11/lab_summary_by_taxonname</h3>
<ul>
<li>Load your selected set with the pedon and site table for an existing GHL file, or make your own (highly encouraged)</li>
<li>Run the <code>lab_summary_by_taxonname.Rmd</code> report on a soil series of your choice.</li>
<li>Show your work and submit the results to your mentor.</li>
</ul>
</div>
<div id="exercise-run-mapunit-comparison" class="section level3">
<h3><span class="header-section-number">5.4.4</span> Exercise: Run Mapunit Comparison</h3>
<p>Another popular report in <code>soilReports</code> is the <code>region2/mu-comparison</code> report.</p>
<p>This report uses constant density sampling (<code>sharpshootR::constantDensitySampling()</code>) to extract numeric and categorical values from multiple raster data sources that overlap a set of user-supplied polygons.</p>
<p>In this example, we clip a small portion of SSURGO polygons from the CA630 soil survey area extent. We then select a small set of mapunit symbols (5012, 3046, 7083, 7085, 7088) that occur within the clipping extent. These mapunits have soil forming factors we expect to contrast with one another in several ways. You can inspect other mapunit symbols by changing <code>mu.set</code> in <code>config.R</code>.</p>
<ol style="list-style-type: decimal">
<li><strong>Download</strong> the demo data:</li>
</ol>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="working-with-data-in-r.html#cb58-1"></a><span class="co"># set up ch4 path and path for report</span></span>
<span id="cb58-2"><a href="working-with-data-in-r.html#cb58-2"></a>ch4.data.path &lt;-<span class="st"> &quot;C:/workspace2/chapter4&quot;</span></span>
<span id="cb58-3"><a href="working-with-data-in-r.html#cb58-3"></a>ch4.mucomp.path &lt;-<span class="st"> </span><span class="kw">paste0</span>(ch4.data.path,<span class="st">&quot;/mucomp&quot;</span>)</span>
<span id="cb58-4"><a href="working-with-data-in-r.html#cb58-4"></a></span>
<span id="cb58-5"><a href="working-with-data-in-r.html#cb58-5"></a><span class="co"># create any directories that may be missing</span></span>
<span id="cb58-6"><a href="working-with-data-in-r.html#cb58-6"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(ch4.mucomp.path)) {</span>
<span id="cb58-7"><a href="working-with-data-in-r.html#cb58-7"></a>  <span class="kw">dir.create</span>(ch4.mucomp.path, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</span>
<span id="cb58-8"><a href="working-with-data-in-r.html#cb58-8"></a>}</span>
<span id="cb58-9"><a href="working-with-data-in-r.html#cb58-9"></a></span>
<span id="cb58-10"><a href="working-with-data-in-r.html#cb58-10"></a><span class="co"># download raster data, SSURGO clip from CA630, and sample script for clipping your own raster data </span></span>
<span id="cb58-11"><a href="working-with-data-in-r.html#cb58-11"></a><span class="kw">download.file</span>(<span class="st">&#39;https://github.com/ncss-tech/stats_for_soil_survey/raw/master/data/chapter_4-mucomp-data/ch4_mucomp-data.zip&#39;</span>, <span class="kw">paste0</span>(ch4.mucomp.path, <span class="st">&#39;/chapter_4-mucomp-data.zip&#39;</span>))</span>
<span id="cb58-12"><a href="working-with-data-in-r.html#cb58-12"></a></span>
<span id="cb58-13"><a href="working-with-data-in-r.html#cb58-13"></a><span class="kw">unzip</span>(<span class="kw">paste0</span>(ch4.mucomp.path, <span class="st">&#39;/chapter_4-mucomp-data.zip&#39;</span>), <span class="dt">exdir =</span> ch4.mucomp.path, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Create an instance</strong> of the <code>region2/mu-comparison</code> report with <code>soilReports</code>:</li>
</ol>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="working-with-data-in-r.html#cb59-1"></a><span class="co"># create new instance of reports </span></span>
<span id="cb59-2"><a href="working-with-data-in-r.html#cb59-2"></a><span class="kw">library</span>(soilReports)</span>
<span id="cb59-3"><a href="working-with-data-in-r.html#cb59-3"></a></span>
<span id="cb59-4"><a href="working-with-data-in-r.html#cb59-4"></a><span class="co"># get report dependencies</span></span>
<span id="cb59-5"><a href="working-with-data-in-r.html#cb59-5"></a><span class="kw">reportSetup</span>(<span class="st">&#39;region2/mu-comparison&#39;</span>)</span>
<span id="cb59-6"><a href="working-with-data-in-r.html#cb59-6"></a></span>
<span id="cb59-7"><a href="working-with-data-in-r.html#cb59-7"></a><span class="co"># create report instance</span></span>
<span id="cb59-8"><a href="working-with-data-in-r.html#cb59-8"></a><span class="kw">copyReport</span>(<span class="st">&#39;region2/mu-comparison&#39;</span>, <span class="dt">outputDir =</span> ch4.mucomp.path, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>If you want, you can now set up the default <code>config.R</code> that is created by <code>copyReport()</code> to work with your own data. OR you can use the “sample” <code>config.R</code> file (called <code>new_config.R</code>) in the ZIP file downloaded above.</p>
<ol start="3" style="list-style-type: decimal">
<li>Run the code below to <strong>replace the default</strong> <code>config.R</code> with the sample <code>config.R</code>:</li>
</ol>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="working-with-data-in-r.html#cb60-1"></a><span class="co"># copy config file containing relative paths to rasters downloaded above</span></span>
<span id="cb60-2"><a href="working-with-data-in-r.html#cb60-2"></a><span class="kw">file.copy</span>(<span class="kw">paste0</span>(ch4.mucomp.path, <span class="st">&quot;/new_config.R&quot;</span>), <span class="kw">paste0</span>(ch4.mucomp.path,<span class="st">&quot;/config.R&quot;</span>), <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li><p><strong>Open</strong> <code>report.Rmd</code> in the <code>C:/workspace2/chapter4/mucomp</code> folder and click the “Knit” button at the top of the RStudio source pane to run the report.</p></li>
<li><p>Inspect the report output HTML file, as well as the spatial and tabular data output in the <code>output</code> folder.</p></li>
</ol>
<p><em>Question: What are the major differences that you can see, based on the report, between the five different mapunit symbols that were analysed?</em></p>
</div>
<div id="exercise-run-shiny-pedon-summary" class="section level3">
<h3><span class="header-section-number">5.4.5</span> Exercise: Run Shiny Pedon Summary</h3>
<p>The <code>region2/shiny-pedon-summary</code> report is an interactive Shiny-based report that uses <code>flexdashboard</code> to help the user subset and summarize NASIS pedons from a graphical interface. This allows one to rapidly generate reports from a large set of pedons in their NASIS selected set.</p>
<p>The left INPUT sidebar has numerous options for subsetting pedon data. Specifically, you can change REGEX patterns for <em>mapunit symbol</em>, <em>taxon name</em>, <em>local phase</em>, and <em>User Pedon ID</em>. Also, you can use the drop down boxes to filter on <em>taxon kind</em> or compare different “modal”/RV pedons.</p>
<div class="figure">
<img src="https://ncss-tech.github.io/soilReports/docs/shiny-pedon-summary/shiny-pedon_loafercreek-taxadjuncts.PNG" alt="" />
<p class="caption">Example: Analyzing the Loafercreek Taxadjuncts</p>
</div>
<ol style="list-style-type: decimal">
<li><strong>Create an instance</strong> of the <code>region2/shiny-pedon-summary</code> report with <code>soilReports</code>:</li>
</ol>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="working-with-data-in-r.html#cb61-1"></a><span class="co"># create new instance of reports </span></span>
<span id="cb61-2"><a href="working-with-data-in-r.html#cb61-2"></a><span class="kw">library</span>(soilReports)</span>
<span id="cb61-3"><a href="working-with-data-in-r.html#cb61-3"></a></span>
<span id="cb61-4"><a href="working-with-data-in-r.html#cb61-4"></a><span class="co"># set path for shiny-pedon-summary report instance</span></span>
<span id="cb61-5"><a href="working-with-data-in-r.html#cb61-5"></a>ch4.shinyped.path &lt;-<span class="st"> &quot;C:/workspace2/chapter4/shiny-pedon&quot;</span></span>
<span id="cb61-6"><a href="working-with-data-in-r.html#cb61-6"></a></span>
<span id="cb61-7"><a href="working-with-data-in-r.html#cb61-7"></a><span class="co"># create directories (if needed)</span></span>
<span id="cb61-8"><a href="working-with-data-in-r.html#cb61-8"></a><span class="cf">if</span>(<span class="op">!</span><span class="kw">dir.exists</span>(ch4.shinyped.path))</span>
<span id="cb61-9"><a href="working-with-data-in-r.html#cb61-9"></a>  <span class="kw">dir.create</span>(ch4.shinyped.path, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</span>
<span id="cb61-10"><a href="working-with-data-in-r.html#cb61-10"></a></span>
<span id="cb61-11"><a href="working-with-data-in-r.html#cb61-11"></a><span class="co"># get report dependencies</span></span>
<span id="cb61-12"><a href="working-with-data-in-r.html#cb61-12"></a><span class="kw">reportSetup</span>(<span class="st">&#39;region2/shiny-pedon-summary&#39;</span>)</span>
<span id="cb61-13"><a href="working-with-data-in-r.html#cb61-13"></a></span>
<span id="cb61-14"><a href="working-with-data-in-r.html#cb61-14"></a><span class="co"># copy report contents to target path</span></span>
<span id="cb61-15"><a href="working-with-data-in-r.html#cb61-15"></a><span class="kw">copyReport</span>(<span class="st">&#39;region2/shiny-pedon-summary&#39;</span>, <span class="dt">outputDir =</span> ch4.shinyped.path, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Update the <code>config.R</code> file</li>
</ol>
<p>You can update the <code>config.R</code> file in “C:/workspace2/chapter4/shiny-pedon” (or wherever you installed the report) to use the <code>soilDB</code> datasets <code>loafercreek</code> and <code>gopheridge</code> by setting <code>demo_mode &lt;- TRUE</code>. This is the <em>simplest</em> way to demonstrate how this report works. Alternately, when <code>demo_mode &lt;- FALSE</code>, pedons will be loaded from your NASIS selected set.</p>
<p><code>config.R</code> also allows you to specify a shapefile for overlaying the points on – to determine mapunit symbol – as well as several raster data sources whose values will be extracted at point locations and summarized. The demo dataset does not use either of these by default, due to large file sizes.</p>
<p>Furthermore, a default (very general) set of REGEX generalized horizon patterns is provided to assign generalized horizon labels for provisional grouping. These provided patterns are unlikely to cover ALL cases, and essentially <em>always</em> need to be modified for final correlation. That said, they do a decent job of making a first-pass correlation for diverse types of soils.</p>
<p>The default <code>config.R</code> settings use the general patterns: <code>use_regex_ghz &lt;- TRUE</code>. You are welcome to modify the defaults. If you want to use the values you have populated in NASIS <em>Pedon Horizon Component Layer ID</em>, set <code>use_regex_ghz &lt;- FALSE</code>.</p>
<ol start="3" style="list-style-type: decimal">
<li>Run the report via <code>shiny.Rmd</code></li>
</ol>
<p>This report uses the Shiny <code>flexdashboard</code> interface. Open up <code>shiny.Rmd</code> and click the “Run Document” button to start the report. This will load the pedon and spatial data specified in <code>config.R</code>.</p>
<p><strong>NOTE:</strong> <em>If a Viewer Window does not pop-up right away, click the gear icon to the right of the “Run Document” button. Be sure the option “Preview in Window” is checked, then click “Run Document” again.</em></p>
<ol start="4" style="list-style-type: decimal">
<li><p>All of the subsetting parameters are in the left-hand sidebar. Play around with all of these options – the graphs and plots in the tabs to the right will automatically update as you make changes.</p></li>
<li><p>When you like what you have, you can export a non-interactive HTML file for your records. To do this, first, set the “Report name:” box to something informative – this will be your report output file name. Then, scroll down to the bottom of the INPUT sidebar and click “Export Report” button. Check the “output” folder (subdirectory of where you installed the report) for your results.</p></li>
</ol>
</div>
</div>
<div id="customized-queries-to-local-nasis-database" class="section level2">
<h2><span class="header-section-number">5.5</span> Customized Queries to Local NASIS Database</h2>
<p>Queries against the NASIS local database can be written in <a href="https://en.wikipedia.org/wiki/Transact-SQL">T-SQL</a> which is the dialect of <a href="https://en.wikipedia.org/wiki/SQL">SQL</a> used to communicate with Microsoft SQL Server that you set up a connection to for the pre-course.</p>
<p>The <code>fetchNASIS</code> and related convenience functions are essentially wrappers around commonly used chunks of SQL.</p>
<p>The following example will return all records from the <code>sitesoiltemp</code> table, along with a couple of fields from the <code>site</code>, <code>siteobs</code>, and <code>pedon</code> tables. This is a convenient way to collect all of the field-based soil temperature data associated with the pedons in your selected set for further analysis.</p>
<div id="rodbc-package" class="section level3">
<h3><span class="header-section-number">5.5.1</span> <code>RODBC</code> package</h3>
<p>This example uses <code>RODBC</code>.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="working-with-data-in-r.html#cb62-1"></a><span class="kw">library</span>(soilDB)</span>
<span id="cb62-2"><a href="working-with-data-in-r.html#cb62-2"></a><span class="kw">library</span>(RODBC) </span>
<span id="cb62-3"><a href="working-with-data-in-r.html#cb62-3"></a></span>
<span id="cb62-4"><a href="working-with-data-in-r.html#cb62-4"></a><span class="co"># write query as a character string</span></span>
<span id="cb62-5"><a href="working-with-data-in-r.html#cb62-5"></a>q &lt;-<span class="st"> &quot;SELECT siteiid as siteiid, peiid, usiteid as site_id, </span></span>
<span id="cb62-6"><a href="working-with-data-in-r.html#cb62-6"></a><span class="st">             upedonid as pedon_id, obsdate as obs_date,</span></span>
<span id="cb62-7"><a href="working-with-data-in-r.html#cb62-7"></a><span class="st">             soitemp, soitempdep FROM site_View_1</span></span>
<span id="cb62-8"><a href="working-with-data-in-r.html#cb62-8"></a><span class="st">       INNER JOIN siteobs_View_1 ON site_View_1.siteiid = siteobs_View_1.siteiidref</span></span>
<span id="cb62-9"><a href="working-with-data-in-r.html#cb62-9"></a><span class="st">       LEFT OUTER JOIN sitesoiltemp_View_1 ON siteobs_View_1.siteobsiid = sitesoiltemp_View_1.siteobsiidref</span></span>
<span id="cb62-10"><a href="working-with-data-in-r.html#cb62-10"></a><span class="st">       LEFT OUTER JOIN pedon_View_1 ON siteobs_View_1.siteobsiid = pedon_View_1.siteobsiidref</span></span>
<span id="cb62-11"><a href="working-with-data-in-r.html#cb62-11"></a><span class="st">      ORDER BY obs_date, siteiid;&quot;</span></span>
<span id="cb62-12"><a href="working-with-data-in-r.html#cb62-12"></a></span>
<span id="cb62-13"><a href="working-with-data-in-r.html#cb62-13"></a><span class="co"># setup connection local NASIS</span></span>
<span id="cb62-14"><a href="working-with-data-in-r.html#cb62-14"></a>channel &lt;-<span class="st"> </span><span class="kw">odbcDriverConnect</span>(<span class="dt">connection =</span> <span class="kw">getOption</span>(<span class="st">&quot;soilDB.NASIS.credentials&quot;</span>))</span>
<span id="cb62-15"><a href="working-with-data-in-r.html#cb62-15"></a></span>
<span id="cb62-16"><a href="working-with-data-in-r.html#cb62-16"></a><span class="co"># exec query</span></span>
<span id="cb62-17"><a href="working-with-data-in-r.html#cb62-17"></a>d &lt;-<span class="st"> </span><span class="kw">sqlQuery</span>(channel, q, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</span>
<span id="cb62-18"><a href="working-with-data-in-r.html#cb62-18"></a></span>
<span id="cb62-19"><a href="working-with-data-in-r.html#cb62-19"></a><span class="co"># close connection</span></span>
<span id="cb62-20"><a href="working-with-data-in-r.html#cb62-20"></a><span class="kw">odbcClose</span>(channel)</span>
<span id="cb62-21"><a href="working-with-data-in-r.html#cb62-21"></a></span>
<span id="cb62-22"><a href="working-with-data-in-r.html#cb62-22"></a><span class="co"># check results</span></span>
<span id="cb62-23"><a href="working-with-data-in-r.html#cb62-23"></a><span class="kw">str</span>(d)</span>
<span id="cb62-24"><a href="working-with-data-in-r.html#cb62-24"></a></span>
<span id="cb62-25"><a href="working-with-data-in-r.html#cb62-25"></a><span class="co"># remove records missing values</span></span>
<span id="cb62-26"><a href="working-with-data-in-r.html#cb62-26"></a>d &lt;-<span class="st"> </span><span class="kw">na.omit</span>(d)</span>
<span id="cb62-27"><a href="working-with-data-in-r.html#cb62-27"></a></span>
<span id="cb62-28"><a href="working-with-data-in-r.html#cb62-28"></a><span class="co"># tabulate unique soil depths</span></span>
<span id="cb62-29"><a href="working-with-data-in-r.html#cb62-29"></a><span class="kw">table</span>(d<span class="op">$</span>soitempdep)</span>
<span id="cb62-30"><a href="working-with-data-in-r.html#cb62-30"></a></span>
<span id="cb62-31"><a href="working-with-data-in-r.html#cb62-31"></a><span class="co"># extract doy of year</span></span>
<span id="cb62-32"><a href="working-with-data-in-r.html#cb62-32"></a>d<span class="op">$</span>doy &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">format</span>(d<span class="op">$</span>obs_date, <span class="st">&quot;%j&quot;</span>))</span>
<span id="cb62-33"><a href="working-with-data-in-r.html#cb62-33"></a></span>
<span id="cb62-34"><a href="working-with-data-in-r.html#cb62-34"></a><span class="co"># when where measurements collected?</span></span>
<span id="cb62-35"><a href="working-with-data-in-r.html#cb62-35"></a><span class="kw">hist</span>(</span>
<span id="cb62-36"><a href="working-with-data-in-r.html#cb62-36"></a>  d<span class="op">$</span>doy,</span>
<span id="cb62-37"><a href="working-with-data-in-r.html#cb62-37"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">366</span>),</span>
<span id="cb62-38"><a href="working-with-data-in-r.html#cb62-38"></a>  <span class="dt">breaks =</span> <span class="dv">30</span>,</span>
<span id="cb62-39"><a href="working-with-data-in-r.html#cb62-39"></a>  <span class="dt">las =</span> <span class="dv">1</span>,</span>
<span id="cb62-40"><a href="working-with-data-in-r.html#cb62-40"></a>  <span class="dt">main =</span> <span class="st">&#39;Soil Temperature Measurements&#39;</span>,</span>
<span id="cb62-41"><a href="working-with-data-in-r.html#cb62-41"></a>  <span class="dt">xlab =</span> <span class="st">&#39;Day of Year&#39;</span></span>
<span id="cb62-42"><a href="working-with-data-in-r.html#cb62-42"></a>)</span>
<span id="cb62-43"><a href="working-with-data-in-r.html#cb62-43"></a></span>
<span id="cb62-44"><a href="working-with-data-in-r.html#cb62-44"></a><span class="co"># soil temperature by day of year</span></span>
<span id="cb62-45"><a href="working-with-data-in-r.html#cb62-45"></a><span class="kw">plot</span>(</span>
<span id="cb62-46"><a href="working-with-data-in-r.html#cb62-46"></a>  soitemp <span class="op">~</span><span class="st"> </span>doy,</span>
<span id="cb62-47"><a href="working-with-data-in-r.html#cb62-47"></a>  <span class="dt">data =</span> d,</span>
<span id="cb62-48"><a href="working-with-data-in-r.html#cb62-48"></a>  <span class="dt">type =</span> <span class="st">&#39;p&#39;</span>,</span>
<span id="cb62-49"><a href="working-with-data-in-r.html#cb62-49"></a>  <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">366</span>),</span>
<span id="cb62-50"><a href="working-with-data-in-r.html#cb62-50"></a>  <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">25</span>),</span>
<span id="cb62-51"><a href="working-with-data-in-r.html#cb62-51"></a>  <span class="dt">xlab =</span> <span class="st">&#39;Day of Year&#39;</span>,</span>
<span id="cb62-52"><a href="working-with-data-in-r.html#cb62-52"></a>  <span class="dt">ylab =</span> <span class="st">&#39;Soil Temperature at 50cm (deg C)&#39;</span>,</span>
<span id="cb62-53"><a href="working-with-data-in-r.html#cb62-53"></a>  <span class="dt">las =</span> <span class="dv">1</span></span>
<span id="cb62-54"><a href="working-with-data-in-r.html#cb62-54"></a>)</span></code></pre></div>
</div>
<div id="dbi" class="section level3">
<h3><span class="header-section-number">5.5.2</span> <code>DBI</code></h3>
<p>You should know that the <code>DBI</code> and <code>odbc</code> packages provide same functions as <code>RODBC</code> via a more generic interface.</p>
<p>There are many other drivers available for <code>DBI</code>, for example <code>RSQLite</code> for SQLite databases. This will soon be the database framework used in <code>soilDB</code> for NASIS access.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-data-we-use.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploratory-data-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["newbook.pdf", "newbook.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
