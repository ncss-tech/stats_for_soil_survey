<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 The Data We Use | Statistics for Soil Survey - Part 1</title>
  <meta name="description" content="Web-based course content for Statistics for Soil Survey - Part 1 made with bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 The Data We Use | Statistics for Soil Survey - Part 1" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Web-based course content for Statistics for Soil Survey - Part 1 made with bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 The Data We Use | Statistics for Soil Survey - Part 1" />
  
  <meta name="twitter:description" content="Web-based course content for Statistics for Soil Survey - Part 1 made with bookdown::gitbook." />
  

<meta name="author" content="Soil Survey Staff" />


<meta name="date" content="2025-01-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="eda.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html">Statistics for Soil Survey - Part 1</a></li>
<li><a href="../book2/index.html">Statistics for Soil Survey - Part 2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Pre-course Assignment</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#create-workspace"><i class="fa fa-check"></i><b>0.1</b> Create Workspace</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#configure-rstudio"><i class="fa fa-check"></i><b>0.2</b> Configure RStudio</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#essentials"><i class="fa fa-check"></i><b>0.3</b> Essentials</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#personalization"><i class="fa fa-check"></i><b>0.4</b> Personalization</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#install-required-packages"><i class="fa fa-check"></i><b>0.5</b> Install Required Packages</a></li>
<li class="chapter" data-level="0.6" data-path="index.html"><a href="index.html#dealing-with-errors"><i class="fa fa-check"></i><b>0.6</b> Dealing With Errors</a>
<ul>
<li class="chapter" data-level="0.6.1" data-path="index.html"><a href="index.html#no-output-is-produced-after-pasting-into-console"><i class="fa fa-check"></i><b>0.6.1</b> No output is produced after pasting into console</a></li>
<li class="chapter" data-level="0.6.2" data-path="index.html"><a href="index.html#somepackage-is-not-available-for-r-version-x.y.z"><i class="fa fa-check"></i><b>0.6.2</b> <code>‘SOMEPACKAGE’ is not available (for R version X.Y.Z)</code></a></li>
</ul></li>
<li class="chapter" data-level="0.7" data-path="index.html"><a href="index.html#packages-not-on-cran"><i class="fa fa-check"></i><b>0.7</b> Packages not on CRAN</a></li>
<li class="chapter" data-level="0.8" data-path="index.html"><a href="index.html#connect-local-nasis"><i class="fa fa-check"></i><b>0.8</b> Connect Local NASIS</a></li>
<li class="chapter" data-level="0.9" data-path="index.html"><a href="index.html#proof"><i class="fa fa-check"></i><b>0.9</b> Proof</a></li>
<li class="chapter" data-level="0.10" data-path="index.html"><a href="index.html#additional-soil-data-and-r-references"><i class="fa fa-check"></i><b>0.10</b> Additional Soil Data and R References</a>
<ul>
<li class="chapter" data-level="0.10.1" data-path="index.html"><a href="index.html#soil-data-videos"><i class="fa fa-check"></i><b>0.10.1</b> Soil Data Videos</a></li>
<li class="chapter" data-level="0.10.2" data-path="index.html"><a href="index.html#r-books-and-manuals"><i class="fa fa-check"></i><b>0.10.2</b> R Books and Manuals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>1.1</b> Outline</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#course-overview"><i class="fa fa-check"></i><b>1.2</b> Course Overview</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#course-objectives"><i class="fa fa-check"></i><b>1.2.1</b> Course Objectives</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#why-is-this-training-needed"><i class="fa fa-check"></i><b>1.2.2</b> Why is this training needed?</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#why-is-course-organized-this-way"><i class="fa fa-check"></i><b>1.2.3</b> Why is course organized this way?</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#what-is-r"><i class="fa fa-check"></i><b>1.3</b> What is R?</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#why-should-i-learn-r"><i class="fa fa-check"></i><b>1.3.1</b> Why Should I Learn R?</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#what-can-r-do"><i class="fa fa-check"></i><b>1.3.2</b> What can R do?</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#packages"><i class="fa fa-check"></i><b>1.3.3</b> Packages</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#rstudio-an-integrated-development-environment-ide-for-r"><i class="fa fa-check"></i><b>1.4</b> RStudio: An Integrated Development Environment (IDE) for R</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#r-basics"><i class="fa fa-check"></i><b>1.5</b> R basics</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#managing-packages"><i class="fa fa-check"></i><b>1.6</b> Managing Packages</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="intro.html"><a href="intro.html#installing-packages"><i class="fa fa-check"></i><b>1.6.1</b> Installing Packages</a></li>
<li class="chapter" data-level="1.6.2" data-path="intro.html"><a href="intro.html#loading-packages"><i class="fa fa-check"></i><b>1.6.2</b> Loading Packages</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#getting-help"><i class="fa fa-check"></i><b>1.7</b> Getting Help</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#documenting-your-work"><i class="fa fa-check"></i><b>1.8</b> Documenting your work</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="intro.html"><a href="intro.html#basic-tips-for-scripting"><i class="fa fa-check"></i><b>1.8.1</b> Basic Tips for Scripting</a></li>
<li class="chapter" data-level="1.8.2" data-path="intro.html"><a href="intro.html#comments"><i class="fa fa-check"></i><b>1.8.2</b> Comments</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="intro.html"><a href="intro.html#organizing-your-work"><i class="fa fa-check"></i><b>1.9</b> Organizing your work</a>
<ul>
<li class="chapter" data-level="1.9.1" data-path="intro.html"><a href="intro.html#setting-the-working-directory"><i class="fa fa-check"></i><b>1.9.1</b> Setting the Working Directory</a></li>
<li class="chapter" data-level="1.9.2" data-path="intro.html"><a href="intro.html#rstudio-projects-.rproj-files"><i class="fa fa-check"></i><b>1.9.2</b> RStudio Projects (.Rproj files)</a></li>
</ul></li>
<li class="chapter" data-level="1.10" data-path="intro.html"><a href="intro.html#saving-your-work"><i class="fa fa-check"></i><b>1.10</b> Saving your work</a></li>
<li class="chapter" data-level="1.11" data-path="intro.html"><a href="intro.html#exercise-1-r-packages-and-functions"><i class="fa fa-check"></i><b>1.11</b> Exercise 1: R packages and Functions</a></li>
<li class="chapter" data-level="1.12" data-path="intro.html"><a href="intro.html#loading-data"><i class="fa fa-check"></i><b>1.12</b> Loading Data</a></li>
<li class="chapter" data-level="1.13" data-path="intro.html"><a href="intro.html#data-manipulation"><i class="fa fa-check"></i><b>1.13</b> Data manipulation</a>
<ul>
<li class="chapter" data-level="1.13.1" data-path="intro.html"><a href="intro.html#viewing-and-removing-data"><i class="fa fa-check"></i><b>1.13.1</b> Viewing and Removing Data</a></li>
<li class="chapter" data-level="1.13.2" data-path="intro.html"><a href="intro.html#filtering-or-subsetting-data"><i class="fa fa-check"></i><b>1.13.2</b> Filtering or Subsetting Data</a></li>
<li class="chapter" data-level="1.13.3" data-path="intro.html"><a href="intro.html#transforming-data"><i class="fa fa-check"></i><b>1.13.3</b> Transforming Data</a></li>
<li class="chapter" data-level="1.13.4" data-path="intro.html"><a href="intro.html#sorting-data"><i class="fa fa-check"></i><b>1.13.4</b> Sorting Data</a></li>
<li class="chapter" data-level="1.13.5" data-path="intro.html"><a href="intro.html#piping-data"><i class="fa fa-check"></i><b>1.13.5</b> Piping Data</a></li>
<li class="chapter" data-level="1.13.6" data-path="intro.html"><a href="intro.html#mergingjoining-or-combining-data"><i class="fa fa-check"></i><b>1.13.6</b> Merging/Joining or Combining Data</a></li>
<li class="chapter" data-level="1.13.7" data-path="intro.html"><a href="intro.html#aggregating-or-grouping-data"><i class="fa fa-check"></i><b>1.13.7</b> Aggregating or Grouping Data</a></li>
<li class="chapter" data-level="1.13.8" data-path="intro.html"><a href="intro.html#reshaping-data"><i class="fa fa-check"></i><b>1.13.8</b> Reshaping Data</a></li>
<li class="chapter" data-level="1.13.9" data-path="intro.html"><a href="intro.html#exporting-data"><i class="fa fa-check"></i><b>1.13.9</b> Exporting Data</a></li>
</ul></li>
<li class="chapter" data-level="1.14" data-path="intro.html"><a href="intro.html#exercise-2-data-manipulation"><i class="fa fa-check"></i><b>1.14</b> Exercise 2: Data Manipulation</a></li>
<li class="chapter" data-level="1.15" data-path="intro.html"><a href="intro.html#review"><i class="fa fa-check"></i><b>1.15</b> Review</a></li>
<li class="chapter" data-level="1.16" data-path="intro.html"><a href="intro.html#additional-reading-introduction"><i class="fa fa-check"></i><b>1.16</b> Additional Reading (Introduction)</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2</b> The Data We Use</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data.html"><a href="data.html#objectives-the-data-we-use"><i class="fa fa-check"></i><b>2.1</b> Objectives (The Data We Use)</a></li>
<li class="chapter" data-level="2.2" data-path="data.html"><a href="data.html#the-structure-of-soil-data"><i class="fa fa-check"></i><b>2.2</b> The Structure of Soil Data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data.html"><a href="data.html#package-references"><i class="fa fa-check"></i><b>2.2.1</b> Package References</a></li>
<li class="chapter" data-level="2.2.2" data-path="data.html"><a href="data.html#importance-of-pedon-data"><i class="fa fa-check"></i><b>2.2.2</b> Importance of Pedon Data</a></li>
<li class="chapter" data-level="2.2.3" data-path="data.html"><a href="data.html#some-issues-with-pedon-data"><i class="fa fa-check"></i><b>2.2.3</b> Some Issues With Pedon Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data.html"><a href="data.html#challenges-with-pedon-data"><i class="fa fa-check"></i><b>2.3</b> Challenges with Pedon Data</a></li>
<li class="chapter" data-level="2.4" data-path="data.html"><a href="data.html#the-soilprofilecollection"><i class="fa fa-check"></i><b>2.4</b> The <em>SoilProfileCollection</em></a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data.html"><a href="data.html#soilprofilecollection-methods"><i class="fa fa-check"></i><b>2.4.1</b> <em>SoilProfileCollection</em> methods</a></li>
<li class="chapter" data-level="2.4.2" data-path="data.html"><a href="data.html#promoting-to-spatial-soilprofilecollection"><i class="fa fa-check"></i><b>2.4.2</b> Promoting to “Spatial” <em>SoilProfileCollection</em></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="data.html"><a href="data.html#exercise-1-assemble-a-soilprofilecollection-from-several-csv-files"><i class="fa fa-check"></i><b>2.5</b> Exercise 1: Assemble a <em>SoilProfileCollection</em> from several CSV files</a></li>
<li class="chapter" data-level="2.6" data-path="data.html"><a href="data.html#using-the-soildb-package"><i class="fa fa-check"></i><b>2.6</b> Using the <code>soilDB</code> Package</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="data.html"><a href="data.html#soildb-functions-for-tabular-data"><i class="fa fa-check"></i><b>2.6.1</b> soilDB functions for tabular data</a></li>
<li class="chapter" data-level="2.6.2" data-path="data.html"><a href="data.html#open-database-connectivity-odbc-connection-to-nasis"><i class="fa fa-check"></i><b>2.6.2</b> Open Database Connectivity (ODBC) Connection to NASIS</a></li>
<li class="chapter" data-level="2.6.3" data-path="data.html"><a href="data.html#fetchnasis"><i class="fa fa-check"></i><b>2.6.3</b> <code>fetchNASIS()</code></a></li>
<li class="chapter" data-level="2.6.4" data-path="data.html"><a href="data.html#the-gopheridge-dataset"><i class="fa fa-check"></i><b>2.6.4</b> The <code>gopheridge</code> Dataset</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="data.html"><a href="data.html#basic-data-inspection"><i class="fa fa-check"></i><b>2.7</b> Basic Data Inspection</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="data.html"><a href="data.html#table-tabulation-and-cross-tabulation"><i class="fa fa-check"></i><b>2.7.1</b> <code>table()</code>: Tabulation and Cross Tabulation</a></li>
<li class="chapter" data-level="2.7.2" data-path="data.html"><a href="data.html#missing-values"><i class="fa fa-check"></i><b>2.7.2</b> Missing Values</a></li>
<li class="chapter" data-level="2.7.3" data-path="data.html"><a href="data.html#logical-operators"><i class="fa fa-check"></i><b>2.7.3</b> Logical Operators</a></li>
<li class="chapter" data-level="2.7.4" data-path="data.html"><a href="data.html#pattern-matching"><i class="fa fa-check"></i><b>2.7.4</b> Pattern Matching</a></li>
<li class="chapter" data-level="2.7.5" data-path="data.html"><a href="data.html#filtering"><i class="fa fa-check"></i><b>2.7.5</b> Filtering</a></li>
<li class="chapter" data-level="2.7.6" data-path="data.html"><a href="data.html#dates-and-times"><i class="fa fa-check"></i><b>2.7.6</b> Dates and Times</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="data.html"><a href="data.html#exercise-2-o-horizon-thickness"><i class="fa fa-check"></i><b>2.8</b> Exercise 2: O Horizon Thickness</a></li>
<li class="chapter" data-level="2.9" data-path="data.html"><a href="data.html#generalized-horizon-labels"><i class="fa fa-check"></i><b>2.9</b> Generalized Horizon Labels</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="data.html"><a href="data.html#formal-approach"><i class="fa fa-check"></i><b>2.9.1</b> Formal Approach</a></li>
<li class="chapter" data-level="2.9.2" data-path="data.html"><a href="data.html#functions-for-handling-generalized-horizon-labels"><i class="fa fa-check"></i><b>2.9.2</b> Functions for Handling Generalized Horizon Labels</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="data.html"><a href="data.html#fetchnasis-data-checks"><i class="fa fa-check"></i><b>2.10</b> <code>fetchNASIS()</code> data checks</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="data.html"><a href="data.html#inspecting-results"><i class="fa fa-check"></i><b>2.10.1</b> Inspecting Results</a></li>
<li class="chapter" data-level="2.10.2" data-path="data.html"><a href="data.html#select-pedons-with-andic-soil-properties"><i class="fa fa-check"></i><b>2.10.2</b> Select Pedons with Andic Soil Properties</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="data.html"><a href="data.html#extended-data-functions"><i class="fa fa-check"></i><b>2.11</b> Extended Data Functions</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="data.html"><a href="data.html#elements-of-get_extended_data_from_nasis"><i class="fa fa-check"></i><b>2.11.1</b> Elements of <code>get_extended_data_from_NASIS()</code></a></li>
<li class="chapter" data-level="2.11.2" data-path="data.html"><a href="data.html#load-example-data-1"><i class="fa fa-check"></i><b>2.11.2</b> Load Example Data</a></li>
<li class="chapter" data-level="2.11.3" data-path="data.html"><a href="data.html#visualizing-common-landforms"><i class="fa fa-check"></i><b>2.11.3</b> Visualizing Common Landforms</a></li>
<li class="chapter" data-level="2.11.4" data-path="data.html"><a href="data.html#diagnostic-features"><i class="fa fa-check"></i><b>2.11.4</b> Diagnostic Features</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="data.html"><a href="data.html#exercise-3-diagnostic-horizons-in-your-own-data"><i class="fa fa-check"></i><b>2.12</b> Exercise 3: Diagnostic Horizons in Your Own Data</a></li>
<li class="chapter" data-level="2.13" data-path="data.html"><a href="data.html#custom-queries-to-local-nasis-database"><i class="fa fa-check"></i><b>2.13</b> Custom Queries to Local NASIS Database</a>
<ul>
<li class="chapter" data-level="2.13.1" data-path="data.html"><a href="data.html#example-site-soil-temperature-data-from-ca792-sequoia-kings-canyon-national-park"><i class="fa fa-check"></i><b>2.13.1</b> Example: Site Soil Temperature Data from CA792 (Sequoia-Kings Canyon National Park)</a></li>
</ul></li>
<li class="chapter" data-level="2.14" data-path="data.html"><a href="data.html#exercise-4-generalized-horizons-with-loafercreek"><i class="fa fa-check"></i><b>2.14</b> Exercise 4: Generalized Horizons with Loafercreek</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="eda.html"><a href="eda.html"><i class="fa fa-check"></i><b>3</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="eda.html"><a href="eda.html#objectives-exploratory-data-analysis"><i class="fa fa-check"></i><b>3.1</b> Objectives (Exploratory Data Analysis)</a></li>
<li class="chapter" data-level="3.2" data-path="eda.html"><a href="eda.html#statistics"><i class="fa fa-check"></i><b>3.2</b> Statistics</a></li>
<li class="chapter" data-level="3.3" data-path="eda.html"><a href="eda.html#data-inspection"><i class="fa fa-check"></i><b>3.3</b> Data Inspection</a></li>
<li class="chapter" data-level="3.4" data-path="eda.html"><a href="eda.html#exercise-1-fetch-and-inspect-data"><i class="fa fa-check"></i><b>3.4</b> Exercise 1: Fetch and Inspect Data</a></li>
<li class="chapter" data-level="3.5" data-path="eda.html"><a href="eda.html#descriptive-statistics"><i class="fa fa-check"></i><b>3.5</b> Descriptive Statistics</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="eda.html"><a href="eda.html#measures-of-central-tendency"><i class="fa fa-check"></i><b>3.5.1</b> Measures of Central Tendency</a></li>
<li class="chapter" data-level="3.5.2" data-path="eda.html"><a href="eda.html#measures-of-dispersion"><i class="fa fa-check"></i><b>3.5.2</b> Measures of Dispersion</a></li>
<li class="chapter" data-level="3.5.3" data-path="eda.html"><a href="eda.html#weighted-summaries"><i class="fa fa-check"></i><b>3.5.3</b> Weighted Summaries</a></li>
<li class="chapter" data-level="3.5.4" data-path="eda.html"><a href="eda.html#correlation"><i class="fa fa-check"></i><b>3.5.4</b> Correlation</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="eda.html"><a href="eda.html#exercise-2-compute-descriptive-statistics"><i class="fa fa-check"></i><b>3.6</b> Exercise 2: Compute Descriptive Statistics</a></li>
<li class="chapter" data-level="3.7" data-path="eda.html"><a href="eda.html#graphical-methods"><i class="fa fa-check"></i><b>3.7</b> Graphical Methods</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="eda.html"><a href="eda.html#distributions"><i class="fa fa-check"></i><b>3.7.1</b> Distributions</a></li>
<li class="chapter" data-level="3.7.2" data-path="eda.html"><a href="eda.html#bar-plot"><i class="fa fa-check"></i><b>3.7.2</b> Bar Plot</a></li>
<li class="chapter" data-level="3.7.3" data-path="eda.html"><a href="eda.html#histogram"><i class="fa fa-check"></i><b>3.7.3</b> Histogram</a></li>
<li class="chapter" data-level="3.7.4" data-path="eda.html"><a href="eda.html#density-curve"><i class="fa fa-check"></i><b>3.7.4</b> Density Curve</a></li>
<li class="chapter" data-level="3.7.5" data-path="eda.html"><a href="eda.html#box-plots"><i class="fa fa-check"></i><b>3.7.5</b> Box plots</a></li>
<li class="chapter" data-level="3.7.6" data-path="eda.html"><a href="eda.html#quantile-comparison-plots-qqplot"><i class="fa fa-check"></i><b>3.7.6</b> Quantile comparison plots (QQplot)</a></li>
<li class="chapter" data-level="3.7.7" data-path="eda.html"><a href="eda.html#the-normal-distribution"><i class="fa fa-check"></i><b>3.7.7</b> The ‘Normal’ distribution</a></li>
<li class="chapter" data-level="3.7.8" data-path="eda.html"><a href="eda.html#scatterplots-and-line-plots"><i class="fa fa-check"></i><b>3.7.8</b> Scatterplots and Line Plots</a></li>
<li class="chapter" data-level="3.7.9" data-path="eda.html"><a href="eda.html#rd-dimension---color-shape-size-layers-etc"><i class="fa fa-check"></i><b>3.7.9</b> 3rd Dimension - Color, Shape, Size, Layers, etc…</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="eda.html"><a href="eda.html#exercise-3-graphical-methods"><i class="fa fa-check"></i><b>3.8</b> Exercise 3: Graphical Methods</a></li>
<li class="chapter" data-level="3.9" data-path="eda.html"><a href="eda.html#transformations"><i class="fa fa-check"></i><b>3.9</b> Transformations</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="eda.html"><a href="eda.html#ph"><i class="fa fa-check"></i><b>3.9.1</b> pH</a></li>
<li class="chapter" data-level="3.9.2" data-path="eda.html"><a href="eda.html#circular-data"><i class="fa fa-check"></i><b>3.9.2</b> Circular data</a></li>
<li class="chapter" data-level="3.9.3" data-path="eda.html"><a href="eda.html#texture-class-and-fine-earth-separates"><i class="fa fa-check"></i><b>3.9.3</b> Texture Class and Fine-earth Separates</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="eda.html"><a href="eda.html#the-shiny-package"><i class="fa fa-check"></i><b>3.10</b> The Shiny Package</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="eda.html"><a href="eda.html#online"><i class="fa fa-check"></i><b>3.10.1</b> Online</a></li>
<li class="chapter" data-level="3.10.2" data-path="eda.html"><a href="eda.html#locally"><i class="fa fa-check"></i><b>3.10.2</b> Locally</a></li>
<li class="chapter" data-level="3.10.3" data-path="eda.html"><a href="eda.html#web-app-demonstration"><i class="fa fa-check"></i><b>3.10.3</b> Web App Demonstration</a></li>
<li class="chapter" data-level="3.10.4" data-path="eda.html"><a href="eda.html#troubleshooting-errors"><i class="fa fa-check"></i><b>3.10.4</b> Troubleshooting Errors</a></li>
<li class="chapter" data-level="3.10.5" data-path="eda.html"><a href="eda.html#shiny-app-embedding"><i class="fa fa-check"></i><b>3.10.5</b> Shiny App Embedding</a></li>
<li class="chapter" data-level="3.10.6" data-path="eda.html"><a href="eda.html#questions"><i class="fa fa-check"></i><b>3.10.6</b> Questions</a></li>
<li class="chapter" data-level="3.10.7" data-path="eda.html"><a href="eda.html#examples"><i class="fa fa-check"></i><b>3.10.7</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="eda.html"><a href="eda.html#exercise-4-using-the-north-central-region-web-app"><i class="fa fa-check"></i><b>3.11</b> Exercise 4: Using the North Central Region Web App</a></li>
<li class="chapter" data-level="3.12" data-path="eda.html"><a href="eda.html#soilreports"><i class="fa fa-check"></i><b>3.12</b> soilReports</a>
<ul>
<li class="chapter" data-level="3.12.1" data-path="eda.html"><a href="eda.html#extending-soilreports"><i class="fa fa-check"></i><b>3.12.1</b> Extending <code>soilReports</code></a></li>
</ul></li>
<li class="chapter" data-level="3.13" data-path="eda.html"><a href="eda.html#exercise-5-run-lab-summary-by-taxon-name-soil-report"><i class="fa fa-check"></i><b>3.13</b> Exercise 5: Run Lab Summary By Taxon Name Soil Report</a>
<ul>
<li class="chapter" data-level="3.13.1" data-path="eda.html"><a href="eda.html#requirements"><i class="fa fa-check"></i><b>3.13.1</b> Requirements</a></li>
<li class="chapter" data-level="3.13.2" data-path="eda.html"><a href="eda.html#instructions"><i class="fa fa-check"></i><b>3.13.2</b> Instructions</a></li>
</ul></li>
<li class="chapter" data-level="3.14" data-path="eda.html"><a href="eda.html#exercise-6-run-shiny-pedon-summary"><i class="fa fa-check"></i><b>3.14</b> Exercise 6: Run Shiny Pedon Summary</a></li>
<li class="chapter" data-level="3.15" data-path="eda.html"><a href="eda.html#exercise-7-run-mapunit-comparison"><i class="fa fa-check"></i><b>3.15</b> Exercise 7: Run Mapunit Comparison</a></li>
<li class="chapter" data-level="3.16" data-path="eda.html"><a href="eda.html#additional-reading-exploratory-data-analysis"><i class="fa fa-check"></i><b>3.16</b> Additional Reading (Exploratory Data Analysis)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>4</b> Spatial Data in R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="spatial.html"><a href="spatial.html#objectives-spatial-data"><i class="fa fa-check"></i><b>4.1</b> Objectives (Spatial Data)</a></li>
<li class="chapter" data-level="4.2" data-path="spatial.html"><a href="spatial.html#making-maps-with-r"><i class="fa fa-check"></i><b>4.2</b> Making Maps with R</a></li>
<li class="chapter" data-level="4.3" data-path="spatial.html"><a href="spatial.html#spatial-data-sources"><i class="fa fa-check"></i><b>4.3</b> Spatial Data Sources</a></li>
<li class="chapter" data-level="4.4" data-path="spatial.html"><a href="spatial.html#viewing-pedon-locations"><i class="fa fa-check"></i><b>4.4</b> Viewing Pedon Locations</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="spatial.html"><a href="spatial.html#plotting-geographic-data"><i class="fa fa-check"></i><b>4.4.1</b> Plotting Geographic Data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="spatial.html"><a href="spatial.html#exercise-1-pedon-locations"><i class="fa fa-check"></i><b>4.5</b> Exercise 1: Pedon Locations</a></li>
<li class="chapter" data-level="4.6" data-path="spatial.html"><a href="spatial.html#packages-for-vector-data"><i class="fa fa-check"></i><b>4.6</b> Packages for Vector Data</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="spatial.html"><a href="spatial.html#the-sf-package"><i class="fa fa-check"></i><b>4.6.1</b> The <code>sf</code> package</a></li>
<li class="chapter" data-level="4.6.2" data-path="spatial.html"><a href="spatial.html#the-sp-package"><i class="fa fa-check"></i><b>4.6.2</b> The <code>sp</code> Package</a></li>
<li class="chapter" data-level="4.6.3" data-path="spatial.html"><a href="spatial.html#converting-sp-and-sf"><i class="fa fa-check"></i><b>4.6.3</b> Converting <code>sp</code> and <code>sf</code></a></li>
<li class="chapter" data-level="4.6.4" data-path="spatial.html"><a href="spatial.html#importing-exporting-vector-data"><i class="fa fa-check"></i><b>4.6.4</b> Importing / Exporting Vector Data</a></li>
<li class="chapter" data-level="4.6.5" data-path="spatial.html"><a href="spatial.html#interactive-mapping-with-mapview-and-leaflet"><i class="fa fa-check"></i><b>4.6.5</b> Interactive mapping with <code>mapview</code> and <code>leaflet</code></a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="spatial.html"><a href="spatial.html#exercise-2-map-your-favorite-soil-series-extents"><i class="fa fa-check"></i><b>4.7</b> Exercise 2: Map your favorite soil series extents</a></li>
<li class="chapter" data-level="4.8" data-path="spatial.html"><a href="spatial.html#packages-for-raster-data"><i class="fa fa-check"></i><b>4.8</b> Packages for Raster Data</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="spatial.html"><a href="spatial.html#the-terra-package"><i class="fa fa-check"></i><b>4.8.1</b> The <code>terra</code> Package</a></li>
<li class="chapter" data-level="4.8.2" data-path="spatial.html"><a href="spatial.html#converting-vector-to-raster"><i class="fa fa-check"></i><b>4.8.2</b> Converting Vector to Raster</a></li>
<li class="chapter" data-level="4.8.3" data-path="spatial.html"><a href="spatial.html#converting-raster-to-vector"><i class="fa fa-check"></i><b>4.8.3</b> Converting Raster to Vector</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="spatial.html"><a href="spatial.html#coordinate-reference-systems-crs"><i class="fa fa-check"></i><b>4.9</b> Coordinate Reference Systems (CRS)</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="spatial.html"><a href="spatial.html#assigning-and-transforming-coordinate-systems"><i class="fa fa-check"></i><b>4.9.1</b> Assigning and Transforming Coordinate Systems</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="spatial.html"><a href="spatial.html#load-required-packages"><i class="fa fa-check"></i><b>4.10</b> Load Required Packages</a></li>
<li class="chapter" data-level="4.11" data-path="spatial.html"><a href="spatial.html#download-example-data"><i class="fa fa-check"></i><b>4.11</b> Download Example Data</a></li>
<li class="chapter" data-level="4.12" data-path="spatial.html"><a href="spatial.html#load-example-mlra-data"><i class="fa fa-check"></i><b>4.12</b> Load Example MLRA Data</a></li>
<li class="chapter" data-level="4.13" data-path="spatial.html"><a href="spatial.html#vector-data"><i class="fa fa-check"></i><b>4.13</b> Vector Data</a>
<ul>
<li class="chapter" data-level="4.13.1" data-path="spatial.html"><a href="spatial.html#sf-2"><i class="fa fa-check"></i><b>4.13.1</b> <code>sf</code></a></li>
<li class="chapter" data-level="4.13.2" data-path="spatial.html"><a href="spatial.html#terra"><i class="fa fa-check"></i><b>4.13.2</b> <code>terra</code></a></li>
<li class="chapter" data-level="4.13.3" data-path="spatial.html"><a href="spatial.html#sp-2"><i class="fa fa-check"></i><b>4.13.3</b> <code>sp</code></a></li>
</ul></li>
<li class="chapter" data-level="4.14" data-path="spatial.html"><a href="spatial.html#raster-data"><i class="fa fa-check"></i><b>4.14</b> Raster Data</a>
<ul>
<li class="chapter" data-level="4.14.1" data-path="spatial.html"><a href="spatial.html#object-properties"><i class="fa fa-check"></i><b>4.14.1</b> Object Properties</a></li>
<li class="chapter" data-level="4.14.2" data-path="spatial.html"><a href="spatial.html#rasters-in-memory-vs.-file-based"><i class="fa fa-check"></i><b>4.14.2</b> Rasters “In Memory” vs. “File-Based”</a></li>
<li class="chapter" data-level="4.14.3" data-path="spatial.html"><a href="spatial.html#rasters-continuous-vs.-categorical"><i class="fa fa-check"></i><b>4.14.3</b> Rasters “Continuous” vs. “Categorical”</a></li>
<li class="chapter" data-level="4.14.4" data-path="spatial.html"><a href="spatial.html#writing-rasters-to-file"><i class="fa fa-check"></i><b>4.14.4</b> Writing Rasters to File</a></li>
<li class="chapter" data-level="4.14.5" data-path="spatial.html"><a href="spatial.html#data-types"><i class="fa fa-check"></i><b>4.14.5</b> Data Types</a></li>
</ul></li>
<li class="chapter" data-level="4.15" data-path="spatial.html"><a href="spatial.html#exercise-3-creating-a-slope-map"><i class="fa fa-check"></i><b>4.15</b> Exercise 3: Creating a Slope Map</a>
<ul>
<li class="chapter" data-level="4.15.1" data-path="spatial.html"><a href="spatial.html#working-with-vector-and-raster-data"><i class="fa fa-check"></i><b>4.15.1</b> Working with Vector and Raster Data</a></li>
</ul></li>
<li class="chapter" data-level="4.16" data-path="spatial.html"><a href="spatial.html#exercise-4-extracting-raster-data"><i class="fa fa-check"></i><b>4.16</b> Exercise 4: Extracting Raster Data</a>
<ul>
<li class="chapter" data-level="4.16.1" data-path="spatial.html"><a href="spatial.html#raster-summary-by-point-nasis-pedon-locations"><i class="fa fa-check"></i><b>4.16.1</b> Raster Summary By Point: NASIS Pedon Locations</a></li>
<li class="chapter" data-level="4.16.2" data-path="spatial.html"><a href="spatial.html#raster-summary-by-polygon-series-extent"><i class="fa fa-check"></i><b>4.16.2</b> Raster Summary By Polygon: Series Extent</a></li>
<li class="chapter" data-level="4.16.3" data-path="spatial.html"><a href="spatial.html#raster-summary-by-polygon-mlra"><i class="fa fa-check"></i><b>4.16.3</b> Raster Summary By Polygon: MLRA</a></li>
<li class="chapter" data-level="4.16.4" data-path="spatial.html"><a href="spatial.html#zonal-statistics-with-exactextractr"><i class="fa fa-check"></i><b>4.16.4</b> Zonal Statistics with <code>exactextractr</code></a></li>
<li class="chapter" data-level="4.16.5" data-path="spatial.html"><a href="spatial.html#example-summarizing-mlra-raster-data-with-lattice-graphics"><i class="fa fa-check"></i><b>4.16.5</b> Example: Summarizing MLRA Raster Data with <code>lattice</code> graphics</a></li>
</ul></li>
<li class="chapter" data-level="4.17" data-path="spatial.html"><a href="spatial.html#additional-reading-spatial"><i class="fa fa-check"></i><b>4.17</b> Additional Reading (Spatial)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sampling.html"><a href="sampling.html"><i class="fa fa-check"></i><b>5</b> Sampling</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sampling.html"><a href="sampling.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="sampling.html"><a href="sampling.html#dsm-classes"><i class="fa fa-check"></i><b>5.1.1</b> DSM classes</a></li>
<li class="chapter" data-level="5.1.2" data-path="sampling.html"><a href="sampling.html#rules-of-thumb"><i class="fa fa-check"></i><b>5.1.2</b> Rules of thumb</a></li>
<li class="chapter" data-level="5.1.3" data-path="sampling.html"><a href="sampling.html#nssh-627.8"><i class="fa fa-check"></i><b>5.1.3</b> NSSH 627.8</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="sampling.html"><a href="sampling.html#sampling-strategies"><i class="fa fa-check"></i><b>5.2</b> Sampling Strategies</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="sampling.html"><a href="sampling.html#simple-random"><i class="fa fa-check"></i><b>5.2.1</b> Simple Random</a></li>
<li class="chapter" data-level="5.2.2" data-path="sampling.html"><a href="sampling.html#systematic"><i class="fa fa-check"></i><b>5.2.2</b> Systematic</a></li>
<li class="chapter" data-level="5.2.3" data-path="sampling.html"><a href="sampling.html#stratified-random"><i class="fa fa-check"></i><b>5.2.3</b> Stratified Random</a></li>
<li class="chapter" data-level="5.2.4" data-path="sampling.html"><a href="sampling.html#multistage-stratified-random"><i class="fa fa-check"></i><b>5.2.4</b> Multistage Stratified Random</a></li>
<li class="chapter" data-level="5.2.5" data-path="sampling.html"><a href="sampling.html#spatial-coverage-sampling-e.g.-k-means-clustering"><i class="fa fa-check"></i><b>5.2.5</b> Spatial Coverage Sampling (e.g. k-means clustering)</a></li>
<li class="chapter" data-level="5.2.6" data-path="sampling.html"><a href="sampling.html#covariate-space-coverage-sampling-e.g.-k-means-clustering"><i class="fa fa-check"></i><b>5.2.6</b> Covariate space coverage sampling (e.g. k-means clustering)</a></li>
<li class="chapter" data-level="5.2.7" data-path="sampling.html"><a href="sampling.html#conditioned-latin-hypercube-clhs"><i class="fa fa-check"></i><b>5.2.7</b> Conditioned Latin Hypercube (cLHS)</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="sampling.html"><a href="sampling.html#evaluating-a-sampling-strategy"><i class="fa fa-check"></i><b>5.3</b> Evaluating a Sampling Strategy</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="sampling.html"><a href="sampling.html#exercise-design-a-sampling-strategy"><i class="fa fa-check"></i><b>5.3.1</b> Exercise: Design a Sampling Strategy</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="sampling.html"><a href="sampling.html#additional-reading-sampling"><i class="fa fa-check"></i><b>5.4</b> Additional Reading (Sampling)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistics for Soil Survey - Part 1</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> The Data We Use<a href="data.html#data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><img src="static-figures/logo.jpg" /></p>
<div id="objectives-the-data-we-use" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Objectives (The Data We Use)<a href="data.html#objectives-the-data-we-use" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Expand on basic <strong>R</strong> skills from Chapter 1
<ul>
<li>Inspect and work with different data types</li>
<li>Perform operations on data such as filtering and aggregation</li>
<li>Begin to explore regular expression (regex) patterns for text data</li>
</ul></li>
<li>Work with Soil Data Sources and Structures
<ul>
<li>Use the soilDB package to load data into R</li>
<li>Understand the <em>SoilProfileCollection</em> (SPC) object</li>
<li>Learn about the data checks in the <code>fetchNASIS()</code> function</li>
</ul></li>
</ul>
</div>
<div id="the-structure-of-soil-data" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> The Structure of Soil Data<a href="data.html#the-structure-of-soil-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>What if you could extract, organize, and visualize data from NASIS and many other commonly used soil database sources with a couple of lines of code?</p>
<p><img src="static-figures/soilDB_figure.png" /></p>
<p>The aqp (Algorithms for Quantitative Pedology) and soilDB packages enable data to be fetched from various sources and cast into a SoilProfileCollection (SPC) object. Tabular and spatial data objects fetched via soilDB and processed using aqp methods can simplify the process of working with commonly used soil data.</p>
<div id="package-references" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Package References<a href="data.html#package-references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p><a href="http://ncss-tech.github.io/aqp/"><strong>Package ‘aqp’ manual</strong></a></p></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/"><strong>Package ‘soilDB’ manual</strong></a></p></li>
<li><p><a href="http://ncss-tech.github.io/sharpshootR/"><strong>Package ‘sharpshootR’ manual</strong></a></p></li>
<li><p><a href="http://ncss-tech.github.io/aqp/articles/Introduction-to-SoilProfileCollection-Objects.html"><strong>SoilProfileCollection Object Introduction</strong></a></p></li>
<li><p><a href="http://ncss-tech.github.io/AQP/"><strong>Tutorials on the AQP website</strong></a></p></li>
</ul>
<p>We load aqp and soilDB packages using the <code>library()</code> command.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb35-1"><a href="data.html#cb35-1" tabindex="-1"></a><span class="co"># load the libraries</span></span>
<span id="cb35-2"><a href="data.html#cb35-2" tabindex="-1"></a><span class="fu">library</span>(aqp)</span>
<span id="cb35-3"><a href="data.html#cb35-3" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span></code></pre></div>
<p>The manual pages for <code>soilDB</code> and <code>aqp</code> are accessible online and from the <strong>Help</strong> tab in RStudio.</p>
</div>
<div id="importance-of-pedon-data" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Importance of Pedon Data<a href="data.html#importance-of-pedon-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The importance of pedon data for present and future work cannot be overstated. These data represent decades of on-the-ground observations of the soil resource for a given area.</p>
<p>As difficult as it may be to take the time to enter legacy pedon data, it is vitally important that we capture this resource and get these data into NASIS as an archive of point observations.</p>
<p><img src="static-figures/sites_nat.png" /></p>
</div>
<div id="some-issues-with-pedon-data" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Some Issues With Pedon Data<a href="data.html#some-issues-with-pedon-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Making and documenting observations of soil requires hard work. Digging is difficult, and writing soil descriptions is time consuming!</p></li>
<li><p>Our confidence in observations typically weakens with the depth of the material described.</p>
<ul>
<li>If we acknowledge this, which we must, then how do we deal with it in pedon data?
<ul>
<li>Use a cutoff depth, for example 100 cm, can be used to truncate observations to a zone of greater confidence.</li>
<li>Show the relative confidence of the data with depth.</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="challenges-with-pedon-data" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Challenges with Pedon Data<a href="data.html#challenges-with-pedon-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Consistency
<ul>
<li>Missing data</li>
</ul></li>
<li>Confidence in the observations
<ul>
<li>Uncertainty with depth</li>
</ul></li>
<li>Description style differences
<ul>
<li>Depth described, horizonation usage styles</li>
</ul></li>
<li>Legacy data vintage
<ul>
<li>Decadal span of data</li>
<li>Taxonomy updates, horizon nomenclature changes</li>
</ul></li>
<li>Location confidence
<ul>
<li>Origin of the location information</li>
<li>Datum used for data collection</li>
<li>Accuracy for GPS values at the time of data collection</li>
</ul></li>
</ul>
</div>
<div id="the-soilprofilecollection" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> The <em>SoilProfileCollection</em><a href="data.html#the-soilprofilecollection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <a href="http://ncss-tech.github.io/aqp/articles/Introduction-to-SoilProfileCollection-Objects.html"><em>SoilProfileCollection</em></a> class (SPC) provided by the <code>aqp</code> package is a specialized structure for soil data analysis. It simplifies the process of working with collections of data associated with soil profiles, e.g., site-level, horizon-level, spatial, diagnostic horizons, and other metadata.</p>
<p>A <em>SoilProfileCollection</em> is similar to the NASIS Site/Pedon “object” in that it provides generalizations, specific routines and rules about data tables and their relationships.</p>
<p>The <em>SoilProfileCollection</em> is an S4 R object. S4 objects have <a href="https://stat.ethz.ch/R-manual/R-patched/library/methods/html/slot.html">slots</a>. Of primary importance, are the slots for site-level and horizon-level data.</p>
<p>In many ways the SPC is more adaptable than the NASIS “Pedon” concept because it is more general. However, the SPC is not as expressive as the complex hierarchy of objects in NASIS, which are more aligned with data archival vs. analysis.</p>
<div id="soilprofilecollection-methods" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> <em>SoilProfileCollection</em> methods<a href="data.html#soilprofilecollection-methods" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Many “familiar” methods are defined for the <em>SoilProfileCollection</em> object. Some are unique, and others operate like more common functions of vector and <code>data.frame</code> objects, such as <code>nrow()</code> (<em>“how many horizons?”</em>) or <code>length()</code> (<em>“how many sites/pedons?”</em>).</p>
<p>Perhaps most importantly, when you access the site data (with <code>site(&lt;object&gt;)</code>) or the horizon data (with <code>horizons(&lt;object&gt;)</code>) of a <em>SoilProfileCollection</em>, you get a <code>data.frame</code> object that you can use like any other you might use or make in R.</p>
<div id="promoting-a-data.frame-to-soilprofilecollection" class="section level4 hasAnchor" number="2.4.1.1">
<h4><span class="header-section-number">2.4.1.1</span> Promoting a <code>data.frame</code> to <em>SoilProfileCollection</em><a href="data.html#promoting-a-data.frame-to-soilprofilecollection" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <em>SoilProfileCollection</em> object is a collection of 1-dimensional profile descriptions, of the type conventionally described on a Form 232, or of tabular data returned from laboratory.</p>
<p>The object is “horizon data forward” in that you start with the layers, and can add or create site-level attributes by normalization, joins, and calculation.</p>
<p>Most of the time if you are using your NASIS data, or an official database, there are defined ways of getting the data “into” an SPC. For example, <code>fetchOSD</code> returns a <em>SoilProfileCollection</em> that has been assembled from horizon and site level attributes gleaned from the OSDs text, Soil Classification database, and other sources.</p>
<p>In the pre-course, we had you set up a process so you could connect to your local NASIS instance to “fetch” data and have methods like <code>fetchNASIS</code> put things together for you.</p>
<p>This input to make a <em>SoilProfileCollection</em> can be represented most simply as a <code>data.frame</code> with unique site or profile ID and depth combinations for each horizon or layer–for example, a subset of the <code>phorizon</code> or <code>chorizon</code> table in NASIS.</p>
<p>A simple demonstration of “tabular horizon data” is the <code>sp4</code> data set bundled with <code>aqp</code>: some serpentine soil profiles stored in a <code>data.frame</code> in the <code>aqp</code> package (after McGahan et al., 2009).</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb36-1"><a href="data.html#cb36-1" tabindex="-1"></a><span class="fu">library</span>(aqp)</span>
<span id="cb36-2"><a href="data.html#cb36-2" tabindex="-1"></a></span>
<span id="cb36-3"><a href="data.html#cb36-3" tabindex="-1"></a><span class="co"># Load sample serpentine soil data (McGahan et al., 2009)</span></span>
<span id="cb36-4"><a href="data.html#cb36-4" tabindex="-1"></a><span class="fu">data</span>(sp4, <span class="at">package =</span> <span class="st">&quot;aqp&quot;</span>)</span>
<span id="cb36-5"><a href="data.html#cb36-5" tabindex="-1"></a></span>
<span id="cb36-6"><a href="data.html#cb36-6" tabindex="-1"></a><span class="co"># this is a data.frame</span></span>
<span id="cb36-7"><a href="data.html#cb36-7" tabindex="-1"></a><span class="co"># same as if loaded from CSV file etc.</span></span>
<span id="cb36-8"><a href="data.html#cb36-8" tabindex="-1"></a><span class="fu">class</span>(sp4)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb38-1"><a href="data.html#cb38-1" tabindex="-1"></a><span class="co"># inspect the first couple of rows</span></span>
<span id="cb38-2"><a href="data.html#cb38-2" tabindex="-1"></a><span class="fu">head</span>(sp4)</span></code></pre></div>
<pre><code>##       id name top bottom   K   Mg  Ca CEC_7 ex_Ca_to_Mg sand silt clay   CF
## 1 colusa    A   0      3 0.3 25.7 9.0  23.0        0.35   46   33   21 0.12
## 2 colusa  ABt   3      8 0.2 23.7 5.6  21.4        0.23   42   31   27 0.27
## 3 colusa  Bt1   8     30 0.1 23.2 1.9  23.7        0.08   40   28   32 0.27
## 4 colusa  Bt2  30     42 0.1 44.3 0.3  43.0        0.01   27   18   55 0.16
## 5  glenn    A   0      9 0.2 21.9 4.4  18.8        0.20   54   20   25 0.55
## 6  glenn   Bt   9     34 0.3 18.9 4.5  27.5        0.20   49   18   34 0.84</code></pre>
<p>To convert this horizon data into a <em>SoilProfileCollection</em>, we need to identify three parameters: <code>idname</code>, <code>top</code>, and <code>bottom</code>. These parameters refer to the columns of unique profile IDs, top depths and bottom depths, respectively.</p>
<p>There are a couple of important constraints and considerations:</p>
<ul>
<li>records (rows) represent horizons</li>
<li>profiles are uniquely identified by a column (user pedon ID, pedon record ID, etc.)</li>
<li>profiles IDs cannot contain missing values (NA)</li>
<li>horizon top and bottom depths are identified by column names</li>
<li>ideally there are no gaps, overlap, or missing top/bottom depths (more on that later)</li>
</ul>
<p>Use a formula to specify column names in the <code>data.frame</code>, in this case <code>"id"</code>, <code>"top"</code> and <code>"bottom"</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb40-1"><a href="data.html#cb40-1" tabindex="-1"></a><span class="co">#      profile ID ~ top depth + bottom depth</span></span>
<span id="cb40-2"><a href="data.html#cb40-2" tabindex="-1"></a><span class="fu">depths</span>(sp4) <span class="ot">&lt;-</span> id <span class="sc">~</span> top <span class="sc">+</span> bottom</span>
<span id="cb40-3"><a href="data.html#cb40-3" tabindex="-1"></a></span>
<span id="cb40-4"><a href="data.html#cb40-4" tabindex="-1"></a><span class="co"># note new class</span></span>
<span id="cb40-5"><a href="data.html#cb40-5" tabindex="-1"></a><span class="fu">class</span>(sp4)</span></code></pre></div>
<pre><code>## [1] &quot;SoilProfileCollection&quot;
## attr(,&quot;package&quot;)
## [1] &quot;aqp&quot;</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb42-1"><a href="data.html#cb42-1" tabindex="-1"></a><span class="co"># compact summary</span></span>
<span id="cb42-2"><a href="data.html#cb42-2" tabindex="-1"></a>sp4</span></code></pre></div>
<pre><code>## SoilProfileCollection with 10 profiles and 30 horizons
## profile ID: id  |  horizon ID: hzID 
## Depth range: 16 - 49 cm
## 
## ----- Horizons (6 / 30 rows  |  10 / 14 columns) -----
##      id hzID top bottom name   K   Mg  Ca CEC_7 ex_Ca_to_Mg
##  colusa    1   0      3    A 0.3 25.7 9.0  23.0        0.35
##  colusa    2   3      8  ABt 0.2 23.7 5.6  21.4        0.23
##  colusa    3   8     30  Bt1 0.1 23.2 1.9  23.7        0.08
##  colusa    4  30     42  Bt2 0.1 44.3 0.3  43.0        0.01
##   glenn    5   0      9    A 0.2 21.9 4.4  18.8        0.20
##   glenn    6   9     34   Bt 0.3 18.9 4.5  27.5        0.20
## [... more horizons ...]
## 
## ----- Sites (6 / 10 rows  |  1 / 1 columns) -----
##         id
##     colusa
##      glenn
##      kings
##   mariposa
##  mendocino
##       napa
## [... more sites ...]
## 
## Spatial Data:
## [EMPTY]</code></pre>
<p>The formula expresses the idea that a profile <code>id</code> defined by set of <code>top</code> and <code>bottom</code> depths.</p>
<p>NOTE: A character vector with same names has the same effect, and can be easier to “program” with than the formula-based syntax.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb44-1"><a href="data.html#cb44-1" tabindex="-1"></a><span class="fu">depths</span>(sp4) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;top&quot;</span>, <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="promoting-to-spatial-soilprofilecollection" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Promoting to “Spatial” <em>SoilProfileCollection</em><a href="data.html#promoting-to-spatial-soilprofilecollection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can also use the <em>SoilProfileCollection</em> to manage the information about a profile’s position on the Earth.</p>
<p>Chapter 4 will cover spatial data in greater detail, and the <a href="http://ncss-tech.github.io/aqp/articles/Introduction-to-SoilProfileCollection-Objects.html#spatial-data">SoilProfileCollection Reference</a> has a section on Spatial Data. For now know you can use the <code>initSpatial&lt;-</code> method to define “X” and “Y” coordinate columns and the coordinate reference system in one line:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb45-1"><a href="data.html#cb45-1" tabindex="-1"></a>sp4<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">10</span>)</span>
<span id="cb45-2"><a href="data.html#cb45-2" tabindex="-1"></a>sp4<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">10</span>) <span class="co"># dummy XY coordinates</span></span>
<span id="cb45-3"><a href="data.html#cb45-3" tabindex="-1"></a></span>
<span id="cb45-4"><a href="data.html#cb45-4" tabindex="-1"></a><span class="fu">initSpatial</span>(sp4, <span class="at">crs =</span> <span class="st">&quot;OGC:CRS84&quot;</span>) <span class="ot">&lt;-</span> <span class="er">~</span> x <span class="sc">+</span> y</span></code></pre></div>
<p>This is new syntax introduced in aqp 2.0, the older syntax uses the <code>coordinates&lt;-</code> and <code>proj4string&lt;-</code> methods.</p>
<div id="extracting-site-and-horizon-data" class="section level4 hasAnchor" number="2.4.2.1">
<h4><span class="header-section-number">2.4.2.1</span> Extracting Site and Horizon Data<a href="data.html#extracting-site-and-horizon-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>You can extract values from the collection’s <code>@site</code> and <code>@horizon</code> slots using the <code>site()</code> and <code>horizons()</code> functions. These create <code>data.frame</code> objects that are separate from the <em>SoilProfileCollection</em>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb46-1"><a href="data.html#cb46-1" tabindex="-1"></a><span class="co"># extract site data from SPC into new data.frame &#39;s&#39;</span></span>
<span id="cb46-2"><a href="data.html#cb46-2" tabindex="-1"></a><span class="co"># note that it only contains profile IDs</span></span>
<span id="cb46-3"><a href="data.html#cb46-3" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">site</span>(sp4)</span>
<span id="cb46-4"><a href="data.html#cb46-4" tabindex="-1"></a><span class="fu">str</span>(s)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    10 obs. of  1 variable:
##  $ id: chr  &quot;colusa&quot; &quot;glenn&quot; &quot;kings&quot; &quot;mariposa&quot; ...</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb48-1"><a href="data.html#cb48-1" tabindex="-1"></a><span class="co"># extract horizon data from SPC into new data.frame &#39;h&#39;</span></span>
<span id="cb48-2"><a href="data.html#cb48-2" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">horizons</span>(sp4)</span>
<span id="cb48-3"><a href="data.html#cb48-3" tabindex="-1"></a><span class="fu">str</span>(h)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    30 obs. of  14 variables:
##  $ id         : chr  &quot;colusa&quot; &quot;colusa&quot; &quot;colusa&quot; &quot;colusa&quot; ...
##  $ name       : chr  &quot;A&quot; &quot;ABt&quot; &quot;Bt1&quot; &quot;Bt2&quot; ...
##  $ top        : int  0 3 8 30 0 9 0 4 13 0 ...
##  $ bottom     : int  3 8 30 42 9 34 4 13 40 3 ...
##  $ K          : num  0.3 0.2 0.1 0.1 0.2 0.3 0.2 0.6 0.8 0.6 ...
##  $ Mg         : num  25.7 23.7 23.2 44.3 21.9 18.9 12.1 12.1 17.7 28.3 ...
##  $ Ca         : num  9 5.6 1.9 0.3 4.4 4.5 1.4 7 4.4 5.8 ...
##  $ CEC_7      : num  23 21.4 23.7 43 18.8 27.5 23.7 18 20 29.3 ...
##  $ ex_Ca_to_Mg: num  0.35 0.23 0.08 0.01 0.2 0.2 0.58 0.51 0.25 0.2 ...
##  $ sand       : int  46 42 40 27 54 49 43 36 27 42 ...
##  $ silt       : int  33 31 28 18 20 18 55 49 45 26 ...
##  $ clay       : int  21 27 32 55 25 34 3 15 27 32 ...
##  $ CF         : num  0.12 0.27 0.27 0.16 0.55 0.84 0.5 0.75 0.67 0.25 ...
##  $ hzID       : chr  &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</code></pre>
</div>
<div id="methods-like-data.frame" class="section level4 hasAnchor" number="2.4.2.2">
<h4><span class="header-section-number">2.4.2.2</span> Methods like <code>data.frame</code><a href="data.html#methods-like-data.frame" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The base R functions for accessing and setting <code>data.frame</code> columns by name such as <code>$</code> and <code>[[</code> work for <em>SoilProfileCollection</em> objects, too. Review <code>data.frame</code> methods:</p>
<ul>
<li><code>[[</code> and <code>$</code>: single columns in <code>data.frame</code>, by name
<ul>
<li><code>x[['variable']]</code></li>
<li><code>x$variable</code></li>
</ul></li>
<li><code>[</code>: combinations of rows and columns, by name or index
<ul>
<li><code>x[i, ]</code>: specified rows, all columns</li>
<li><code>x[, j]</code>: all rows, specified columns</li>
<li><code>x[i, j]</code>: specified rows, specified columns</li>
</ul></li>
</ul>
<p>See <a href="intro.html">Chapter 1</a> and the Chapter 2 <a href="http://ncss-tech.github.io/stats_for_soil_survey/misc/2a_appendix_data_types.html">Appendix</a> for additional details and examples.</p>
<div id="column-access-by-name-and" class="section level5 hasAnchor" number="2.4.2.2.1">
<h5><span class="header-section-number">2.4.2.2.1</span> Column Access by Name: <code>$</code> and <code>[[</code><a href="data.html#column-access-by-name-and" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb50"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb50-1"><a href="data.html#cb50-1" tabindex="-1"></a><span class="co"># sp4 is a SoilProfileCollection</span></span>
<span id="cb50-2"><a href="data.html#cb50-2" tabindex="-1"></a>sp4<span class="sc">$</span>clay</span></code></pre></div>
<pre><code>##  [1] 21 27 32 55 25 34  3 15 27 32 25 31 33 13 21 23 15 17 12 19 14 14 22 25 40 51 67 24 25 32</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb52-1"><a href="data.html#cb52-1" tabindex="-1"></a>sp4[[<span class="st">&#39;clay&#39;</span>]]</span></code></pre></div>
<pre><code>##  [1] 21 27 32 55 25 34  3 15 27 32 25 31 33 13 21 23 15 17 12 19 14 14 22 25 40 51 67 24 25 32</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb54-1"><a href="data.html#cb54-1" tabindex="-1"></a><span class="co"># horizon data.frame</span></span>
<span id="cb54-2"><a href="data.html#cb54-2" tabindex="-1"></a>h<span class="sc">$</span>clay</span></code></pre></div>
<pre><code>##  [1] 21 27 32 55 25 34  3 15 27 32 25 31 33 13 21 23 15 17 12 19 14 14 22 25 40 51 67 24 25 32</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb56-1"><a href="data.html#cb56-1" tabindex="-1"></a>h[[<span class="st">&#39;clay&#39;</span>]]</span></code></pre></div>
<pre><code>##  [1] 21 27 32 55 25 34  3 15 27 32 25 31 33 13 21 23 15 17 12 19 14 14 22 25 40 51 67 24 25 32</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb58-1"><a href="data.html#cb58-1" tabindex="-1"></a><span class="co"># use $&lt;- or [[&lt;- to set proportional clay content</span></span>
<span id="cb58-2"><a href="data.html#cb58-2" tabindex="-1"></a>sp4<span class="sc">$</span>clay <span class="ot">&lt;-</span> sp4[[<span class="st">&#39;clay&#39;</span>]] <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb58-3"><a href="data.html#cb58-3" tabindex="-1"></a></span>
<span id="cb58-4"><a href="data.html#cb58-4" tabindex="-1"></a><span class="co"># undo what we did above; back to percentage</span></span>
<span id="cb58-5"><a href="data.html#cb58-5" tabindex="-1"></a>sp4[[<span class="st">&#39;clay&#39;</span>]] <span class="ot">&lt;-</span> sp4<span class="sc">$</span>clay <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb58-6"><a href="data.html#cb58-6" tabindex="-1"></a></span>
<span id="cb58-7"><a href="data.html#cb58-7" tabindex="-1"></a><span class="co"># create new site variable (&quot;numberone&quot; recycled for all sites)</span></span>
<span id="cb58-8"><a href="data.html#cb58-8" tabindex="-1"></a><span class="fu">site</span>(sp4)<span class="sc">$</span>newvar1 <span class="ot">&lt;-</span> <span class="st">&quot;numberone&quot;</span></span>
<span id="cb58-9"><a href="data.html#cb58-9" tabindex="-1"></a></span>
<span id="cb58-10"><a href="data.html#cb58-10" tabindex="-1"></a><span class="co"># create new horizon variable (&quot;numbertwo&quot; recycled for all horizons)</span></span>
<span id="cb58-11"><a href="data.html#cb58-11" tabindex="-1"></a><span class="fu">horizons</span>(sp4)<span class="sc">$</span>newvar2 <span class="ot">&lt;-</span> <span class="st">&quot;numbertwo&quot;</span></span></code></pre></div>
</div>
<div id="row-access" class="section level5 hasAnchor" number="2.4.2.2.2">
<h5><span class="header-section-number">2.4.2.2.2</span> Row Access: <code>[</code><a href="data.html#row-access" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The <em>SoilProfileCollection</em> also has <code>[</code> (“single bracket”), but with a different interpretation from the <code>[i, j]</code> indexing of <code>data.frame</code> objects.</p>
<ul>
<li><p>In a <code>data.frame</code> you have <code>object[row, column, drop=TRUE]</code>; the result is a <code>data.frame</code> (or a vector with default <code>drop=TRUE</code>).</p></li>
<li><p>In a <em>SoilProfileCollection</em> you have <code>object[site, horizon]</code>; the result is a <em>SoilProfileCollection</em>.</p></li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb59-1"><a href="data.html#cb59-1" tabindex="-1"></a><span class="co"># i-index: first 2 profiles, all horizons</span></span>
<span id="cb59-2"><a href="data.html#cb59-2" tabindex="-1"></a>sp4[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, ]</span></code></pre></div>
<pre><code>## SoilProfileCollection with 2 profiles and 6 horizons
## profile ID: id  |  horizon ID: hzID 
## Depth range: 34 - 42 cm
## 
## ----- Horizons (6 / 6 rows  |  10 / 15 columns) -----
##      id hzID top bottom name   K   Mg  Ca CEC_7 ex_Ca_to_Mg
##  colusa    1   0      3    A 0.3 25.7 9.0  23.0        0.35
##  colusa    2   3      8  ABt 0.2 23.7 5.6  21.4        0.23
##  colusa    3   8     30  Bt1 0.1 23.2 1.9  23.7        0.08
##  colusa    4  30     42  Bt2 0.1 44.3 0.3  43.0        0.01
##   glenn    5   0      9    A 0.2 21.9 4.4  18.8        0.20
##   glenn    6   9     34   Bt 0.3 18.9 4.5  27.5        0.20
## 
## ----- Sites (2 / 2 rows  |  2 / 2 columns) -----
##      id   newvar1
##  colusa numberone
##   glenn numberone
## 
## Spatial Data:
## [EMPTY]</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb61-1"><a href="data.html#cb61-1" tabindex="-1"></a><span class="co"># j-index: all profiles; first 2 horizons of each profile</span></span>
<span id="cb61-2"><a href="data.html#cb61-2" tabindex="-1"></a>sp4[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>## SoilProfileCollection with 10 profiles and 20 horizons
## profile ID: id  |  horizon ID: hzID 
## Depth range: 5 - 40 cm
## 
## ----- Horizons (6 / 20 rows  |  10 / 15 columns) -----
##      id hzID top bottom name   K   Mg  Ca CEC_7 ex_Ca_to_Mg
##  colusa    1   0      3    A 0.3 25.7 9.0  23.0        0.35
##  colusa    2   3      8  ABt 0.2 23.7 5.6  21.4        0.23
##   glenn    5   0      9    A 0.2 21.9 4.4  18.8        0.20
##   glenn    6   9     34   Bt 0.3 18.9 4.5  27.5        0.20
##   kings    7   0      4    A 0.2 12.1 1.4  23.7        0.58
##   kings    8   4     13  Bt1 0.6 12.1 7.0  18.0        0.51
## [... more horizons ...]
## 
## ----- Sites (6 / 10 rows  |  2 / 2 columns) -----
##         id   newvar1
##     colusa numberone
##      glenn numberone
##      kings numberone
##   mariposa numberone
##  mendocino numberone
##       napa numberone
## [... more sites ...]
## 
## Spatial Data:
## [EMPTY]</code></pre>
<p>When you use the <code>[</code> function, everything in the <em>SoilProfileCollection</em> is subset simultaneously depending on the constraints specified by the indices.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb63-1"><a href="data.html#cb63-1" tabindex="-1"></a><span class="co"># First profile, first 2 horizons</span></span>
<span id="cb63-2"><a href="data.html#cb63-2" tabindex="-1"></a><span class="fu">horizons</span>(sp4[<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span></code></pre></div>
<pre><code>##       id name top bottom   K   Mg  Ca CEC_7 ex_Ca_to_Mg sand silt clay   CF hzID   newvar2
## 1 colusa    A   0      3 0.3 25.7 9.0  23.0        0.35   46   33   21 0.12    1 numbertwo
## 2 colusa  ABt   3      8 0.2 23.7 5.6  21.4        0.23   42   31   27 0.27    2 numbertwo</code></pre>
<p>All slots in the collection have a relationship to the site or <em>i</em>-index. When you remove sites (profiles), all associated records (e.g. spatial, diagnostics, horizons, etc.) in the object are removed.</p>
<p>Similarly, when all horizons are removed (say, you request the 6th j-index from a profile that has only 5 layers), the site index and all associated data are removed from the collection.</p>
</div>
</div>
</div>
</div>
<div id="exercise-1-assemble-a-soilprofilecollection-from-several-csv-files" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Exercise 1: Assemble a <em>SoilProfileCollection</em> from several CSV files<a href="data.html#exercise-1-assemble-a-soilprofilecollection-from-several-csv-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Save the code you use in an R script, add answers as comments, and send to your mentor.</p>
<p><a href="https://github.com/ncss-tech/stats_for_soil_survey/blob/master/exercises/SPC-from-CSV-files.R">Link to exercise R code</a></p>
<p><img src="static-figures/ch2-SPC-from-CSV-exercise.jpg" /></p>
<p><strong>Questions:</strong></p>
<p>Run the code in the linked R file and answer these questions.</p>
<ol style="list-style-type: decimal">
<li><p>How many profiles (sites) and horizons are in the <code>granite</code> SoilProfileCollection? How many in <code>andesite</code>? See <code>length()</code> and <code>nrow()</code> functions for SoilProfileCollection objects.</p></li>
<li><p>Which profile (and which horizon in that profile) has the highest ratio of oxalate-extractable Fe to dithionite-citrate-extractable Fe (<code>Fe_o_to_Fe_d</code>)?</p></li>
</ol>
</div>
<div id="using-the-soildb-package" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Using the <code>soilDB</code> Package<a href="data.html#using-the-soildb-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>soilDB</code> package for R provides functions for accessing data stored in NASIS, KSSL, SDA, SoilWeb, SoilGrids and other sources.</p>
<p>These high-level ‘fetch’ functions bundle or wrap lower-level ‘get’ functions which access internal database interfaces to NASIS and other data sources. The ODBC connection to NASIS that you set up during the pre-course is an example of an internal database interface.</p>
<p>Basic data checks are run within ‘fetch’ functions. These checks ensure the basic integrity of the data as it is queried and moved from its existing structure into an SPC. There are times when it is useful to use the lower-level <code>get</code> functions individually. They generally return single <code>data.frame</code> or <code>list</code> of <code>data.frame</code>.</p>
<p>You can set up scripts to make custom queries against these or other sources on your own – there is an example at the end of this section.</p>
<p>For now, we will start with the ‘fetch’ functions and others that will get you a large variety of data you can use for soil and ecological site analyses.</p>
<div id="soildb-functions-for-tabular-data" class="section level3 hasAnchor" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> soilDB functions for tabular data<a href="data.html#soildb-functions-for-tabular-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>soilDB</code> functions are the quickest way to get up and running:</p>
<ul>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchNASIS.html"><strong>fetchNASIS()</strong></a></p>
<ul>
<li>Gets and re-packages data from a local NASIS database.
<ul>
<li>soilDB Vignette <a href="https://ncss-tech.github.io/soilDB/articles/fetchNASIS.html">Columns in <code>fetchNASIS(from="pedons")</code></a></li>
</ul></li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchVegdata.html"><strong>fetchVegdata()</strong></a></p>
<ul>
<li>Gets Vegetation Plot and related/child tables into a list from a local NASIS database.</li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchNASISLabData.html"><strong>fetchNASISLabData()</strong></a></p>
<ul>
<li>Gets KSSL laboratory pedon/horizon layer data from a local NASIS database.</li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchNASISWebReport.html"><strong>fetchNASISWebReport()</strong></a></p></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/SDA_query.html"><strong>SDA_query()</strong></a></p>
<ul>
<li>Can be used to access SSURGO, STATSGO (spatial and tabular), and Lab DataMart snapshots</li>
<li>Submits queries to the Soil Data Access system.
<ul>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/SDA-tutorial.html">Soil Data Access Tutorial</a></li>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/SDA-tutorial-2.html">SDA and Spatial Data</a></li>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/SDA-cointerp-tutorial.html">SDA and Interpretations</a></li>
</ul></li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchLDM.html"><strong>fetchLDM()</strong></a></p>
<ul>
<li>Gets KSSL data from the Lab Data Mart snapshot in Soil Data Access</li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchSDA_component.html"><strong>fetchSDA()</strong></a></p>
<ul>
<li>Fetches legend/mapunit/component/horizon data from Soil Data Access.</li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchKSSL.html"><strong>fetchKSSL()</strong></a></p>
<ul>
<li>Gets KSSL data from the SoilWeb system via BBOX, MLRA, or series name query.
<ul>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/KSSL-demo.html">KSSL Data Demo</a></li>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/fetchKSSL-VG-demo.html">Water Retention Curve Development from KSSL Data</a></li>
</ul></li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchOSD.html"><strong>fetchOSD()</strong></a></p>
<ul>
<li>Fetches a limited subset of horizon- and site-level attributes for named soil series from the SoilWeb system.
<ul>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/soil-series-query-functions.html">Querying Soil Series Data</a></li>
</ul></li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/OSDquery.html"><strong>OSDquery()</strong></a></p>
<ul>
<li>Full-text searching of OSD sections.
<ul>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/soil-series-query-functions.html#6_OSD_Full_Text_Search">Querying Soil Series Data</a></li>
</ul></li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchSCAN.html"><strong>fetchSCAN()</strong></a></p>
<ul>
<li>Queries soil and climate data from USDA-NRCS SCAN Stations.
<ul>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/fetchSCAN-demo.html">A Unified Interface to SCAN/SNOTEL Data</a></li>
</ul></li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchHenry.html"><strong>fetchHenry()</strong></a></p>
<ul>
<li>Downloads data from the Henry Mount Soil Climate Database.
<ul>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/Henry-demo.html">Henry Mount Soil Climate Database Tutorial</a></li>
</ul></li>
</ul></li>
<li><p><a href="http://ncss-tech.github.io/soilDB/reference/fetchPedonPC.html"><strong>fetchPedonPC()</strong></a></p>
<ul>
<li>Fetches commonly used site and horizon data from a PedonPC (MS Access) database.</li>
</ul></li>
</ul>
</div>
<div id="open-database-connectivity-odbc-connection-to-nasis" class="section level3 hasAnchor" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> Open Database Connectivity (ODBC) Connection to NASIS<a href="data.html#open-database-connectivity-odbc-connection-to-nasis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After setting up an ODBC connection, as you did as part of the pre-course, you can use R to access data from a selected set defined in your local NASIS database.</p>
<ul>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/setup_local_nasis.html"><strong>How to Create an ODBC Connection to local NASIS database for R</strong></a>.</li>
</ul>
<p><em>Does NASIS need to be open and running to query data using soilDB?</em></p>
<p>No, <code>fetchNASIS()</code> works whether the NASIS application is running or not. You just need to make sure that the data you want has been loaded into your selected set.</p>
</div>
<div id="fetchnasis" class="section level3 hasAnchor" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> <code>fetchNASIS()</code><a href="data.html#fetchnasis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <a href="http://ncss-tech.github.io/soilDB/reference/fetchNASIS.html">fetchNASIS()</a> convenience function extracts data from a NASIS selected set via Structured Query Language (SQL).</p>
<p>Note that the import process in <code>fetchNASIS()</code>, and the other methods, is not comprehensive. It does not pull every column for every table related to pedon data out of NASIS.</p>
<p>Instead, it pulls essential / commonly used pedon and horizon data. Higher level functions like <code>fetchNASIS()</code> bundle a series of lower-level queries to get specific parts of the Pedon or Component data structures. Much of the nested complexity of NASIS is simplified in the resulting object.</p>
<p><img src="s4ssbook_files/figure-html/structure_diagram_a-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Many-to-one relationships are “flattened” where possible by <code>fetchNASIS()</code>. This aggregates the data from various tables into one “site” record with related horizon records, per profile.</p>
<p>You can see the child tables that are aggregated using the <code>get_extended_data_from_NASIS()</code> method, which returns a named list of child table sources that can be joined to the <em>SoilProfileCollection</em> made with <code>fetchNASIS()</code> using the internal record IDs.</p>
<div id="fetchnasis-arguments" class="section level4 hasAnchor" number="2.6.3.1">
<h4><span class="header-section-number">2.6.3.1</span> fetchNASIS arguments<a href="data.html#fetchnasis-arguments" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>fetchNASIS()</code> has a number of different arguments:</p>
<ul>
<li><p><strong>from = ‘pedons’ or ‘components’ or ‘pedon_report’</strong></p>
<ul>
<li>This option allows you to select which data you want to load from NASIS. Choosing either ‘pedons’ or ‘components’ will load data from your local database. If ‘pedon_report’ is specified then it will load data from the text file generated by the NASIS report ‘fetchNASIS’ (run offline). This is useful for loading more than 20,000 pedons at one time, such for an entire Soil Survey Region.</li>
</ul></li>
<li><p><strong>url =</strong> string specifying the (temporary) URL for the NASIS <code>pedon_report</code> output generated by the <code>fetchNASIS</code> NASIS Report that can be run “Offline Against National Database” <a href="../data/book/02/fetchNASIS_61769c83-6180-486f-b8c8-9b0109ee1039.txt">EXAMPLE OUTPUT (MT663)</a></p></li>
<li><p><strong>SS = <code>TRUE</code>/<code>FALSE</code></strong></p>
<ul>
<li>The Selected Set (SS) option allows you to choose whether you want the data to load from your current selected set in NASIS or from the local database tables. The default is set to <code>TRUE</code> so if unspecified <code>fetchNASIS()</code> will always load from the data in the selected set.</li>
</ul></li>
<li><p><strong>stringAsFactors = <code>NULL</code></strong></p>
<ul>
<li>This option is no longer used. See <a href="https://ncss-tech.github.io/soilDB/reference/NASISDomainsAsFactor.html"><code>soilDB::NASISDomainsAsFactor()</code></a></li>
</ul></li>
<li><p><strong>rmHzErrors = <code>TRUE</code>/<code>FALSE</code></strong></p>
<ul>
<li>Setting this value to <code>TRUE</code> removes pedons that do not pass checks for horizon depth consistency. Default: <code>FALSE</code></li>
</ul></li>
<li><p><strong>nullFragsAreZero = <code>TRUE</code>/<code>FALSE</code></strong></p>
<ul>
<li>Setting this value to <code>TRUE</code> (the default) converts null entries for rock fragment volumes to 0. This is typically the right assumption because rock fragment data are typically populated only when observed. If you know that your data contain a combination of omitted information (e.g. no rock fragment volumes are populated) then consider setting this argument to <code>FALSE</code>.</li>
</ul></li>
<li><p><strong>soilColorState = ‘moist’ or ‘dry’</strong></p>
<ul>
<li>Select dry or moist colors to be converted and placed into a horizon-level attribute called <code>soil_color</code>. The default is set to ‘moist’ unless specified. Moist and dry colors are also stored in <code>moist_soil_color</code> and <code>dry_soil_color</code>.</li>
</ul></li>
<li><p><strong>lab = <code>TRUE</code>/<code>FALSE</code></strong></p>
<ul>
<li>This option allows for loading the data associated with horizons that may be in the <code>phlabresults</code> table. The default is set to <code>FALSE</code>, which will not load records from the <code>phlabresults</code> table.</li>
</ul></li>
<li><p><strong>fill = <code>TRUE</code>/<code>FALSE</code></strong></p>
<ul>
<li>This option adds horizons to pedons or components that lack horizon data in the database, preserving their “position” within the output SoilProfileCollection object. Default is <code>FALSE</code> such that profiles without horizons are omitted from the result.</li>
</ul></li>
<li><p><strong>dropAdditional = <code>TRUE</code>/<code>FALSE</code></strong></p>
<ul>
<li>Used only for <code>from='components'</code> with <code>duplicates = TRUE</code>. Prevent “duplication” of <code>mustatus == "additional"</code> mapunits? Default: <code>TRUE</code></li>
</ul></li>
<li><p><strong>dropNonRepresentative = <code>TRUE</code>/<code>FALSE</code></strong></p>
<ul>
<li>Used only for <code>from='components'</code> with duplicates = TRUE. Prevent “duplication” of non-representative data mapunits? Default: <code>TRUE</code></li>
</ul></li>
<li><p><strong>duplicates = FALSE</strong></p>
<ul>
<li>Used only for <code>from='components'</code>. Duplicate components for all instances of use (i.e. one for each legend data mapunit is used on; optionally for additional mapunits, and/or non-representative data mapunits?). This will include columns from <code>get_component_correlation_data_from_NASIS_db()</code> that identify which legend(s) each component is used on. NOTE: This requires that parent tables above “component” (such as legend, mapunit, correlation and datamapunit) are loaded in your NASIS database/selected set.</li>
</ul></li>
<li><p><strong>dsn = <code>NULL</code></strong></p>
<ul>
<li>Optional: custom path to an SQLite snapshot or DBIConnection object to database with NASIS schema. See <a href="https://ncss-tech.github.io/soilDB/reference/createStaticNASIS.html"><code>soilDB::createStaticNASIS()</code></a>.</li>
</ul></li>
</ul>
</div>
</div>
<div id="the-gopheridge-dataset" class="section level3 hasAnchor" number="2.6.4">
<h3><span class="header-section-number">2.6.4</span> The <code>gopheridge</code> Dataset<a href="data.html#the-gopheridge-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>gopheridge</code> sample data set is a sample R object returned from <code>fetchNASIS()</code> in a self-contained <code>.rda</code> file stored in <code>soilDB</code>.</p>
<p>Open RStudio, and set up the environment by loading packages and the <code>gopheridge</code> sample dataset.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb65-1"><a href="data.html#cb65-1" tabindex="-1"></a><span class="fu">library</span>(aqp)</span>
<span id="cb65-2"><a href="data.html#cb65-2" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb65-3"><a href="data.html#cb65-3" tabindex="-1"></a></span>
<span id="cb65-4"><a href="data.html#cb65-4" tabindex="-1"></a><span class="co"># load example dataset</span></span>
<span id="cb65-5"><a href="data.html#cb65-5" tabindex="-1"></a><span class="fu">data</span>(gopheridge, <span class="at">package =</span> <span class="st">&quot;soilDB&quot;</span>)</span>
<span id="cb65-6"><a href="data.html#cb65-6" tabindex="-1"></a></span>
<span id="cb65-7"><a href="data.html#cb65-7" tabindex="-1"></a><span class="co"># what kind of object is this?</span></span>
<span id="cb65-8"><a href="data.html#cb65-8" tabindex="-1"></a><span class="fu">class</span>(gopheridge)</span></code></pre></div>
<pre><code>## [1] &quot;SoilProfileCollection&quot;
## attr(,&quot;package&quot;)
## [1] &quot;aqp&quot;</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb67-1"><a href="data.html#cb67-1" tabindex="-1"></a><span class="co"># what does the internal structure look like?</span></span>
<span id="cb67-2"><a href="data.html#cb67-2" tabindex="-1"></a><span class="fu">str</span>(gopheridge, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Formal class &#39;SoilProfileCollection&#39; [package &quot;aqp&quot;] with 8 slots
##   ..@ idcol       : chr &quot;peiid&quot;
##   ..@ hzidcol     : chr &quot;phiid&quot;
##   ..@ depthcols   : chr [1:2] &quot;hzdept&quot; &quot;hzdepb&quot;
##   ..@ metadata    :List of 6
##   ..@ horizons    :&#39;data.frame&#39;: 317 obs. of  77 variables:
##   ..@ site        :&#39;data.frame&#39;: 52 obs. of  164 variables:
##   ..@ diagnostic  :&#39;data.frame&#39;: 164 obs. of  4 variables:
##   ..@ restrictions:&#39;data.frame&#39;: 56 obs. of  8 variables:</code></pre>
<p>There are many columns in the data.frame objects within a <code>fetchNASIS()</code> <em>SoilProfileCollection</em>.</p>
<p>The following guide is part of the soilDB documentation and describes the columns that are returned from a <code>fetchNASIS(from="pedons")</code> call. In the future this guide will be extended to describe component data.</p>
<ul>
<li><a href="https://ncss-tech.github.io/soilDB/articles/fetchNASIS.html">fetchNASIS(from=“pedons”) column description guide</a></li>
</ul>
<p>With <code>siteNames()</code> and <code>horizonNames()</code> we can view the names for eachslot respectively in the <code>gopheridge</code> object.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb69-1"><a href="data.html#cb69-1" tabindex="-1"></a><span class="co"># the fields at the site and horizon levels within the SPC</span></span>
<span id="cb69-2"><a href="data.html#cb69-2" tabindex="-1"></a><span class="fu">siteNames</span>(gopheridge)</span></code></pre></div>
<pre><code>##   [1] &quot;peiid&quot;                                    &quot;siteiid&quot;                                 
##   [3] &quot;ecositeid&quot;                                &quot;ecositenm&quot;                               
##   [5] &quot;ecositecorrdate&quot;                          &quot;es_classifier&quot;                           
##   [7] &quot;siteecositehistory.classifier&quot;            &quot;es_selection_method&quot;                     
##   [9] &quot;upedonid&quot;                                 &quot;siteobsiid&quot;                              
##  [11] &quot;usiteid&quot;                                  &quot;obsdate&quot;                                 
##  [13] &quot;utmzone&quot;                                  &quot;utmeasting&quot;                              
##  [15] &quot;utmnorthing&quot;                              &quot;horizdatnm&quot;                              
##  [17] &quot;longstddecimaldegrees&quot;                    &quot;latstddecimaldegrees&quot;                    
##  [19] &quot;gpspositionalerror&quot;                       &quot;describer&quot;                               
##  [21] &quot;descname&quot;                                 &quot;pedonpurpose&quot;                            
##  [23] &quot;pedontype&quot;                                &quot;pedlabsampnum&quot;                           
##  [25] &quot;labdatadescflag&quot;                          &quot;tsectstopnum&quot;                            
##  [27] &quot;tsectinterval&quot;                            &quot;utransectid&quot;                             
##  [29] &quot;tsectkind&quot;                                &quot;tsectselmeth&quot;                            
##  [31] &quot;erocl&quot;                                    &quot;elev_field&quot;                              
##  [33] &quot;slope_field&quot;                              &quot;aspect_field&quot;                            
##  [35] &quot;elev&quot;                                     &quot;slope&quot;                                   
##  [37] &quot;aspect&quot;                                   &quot;ecostatename&quot;                            
##  [39] &quot;ecostateid&quot;                               &quot;commphasename&quot;                           
##  [41] &quot;commphaseid&quot;                              &quot;plantassocnm&quot;                            
##  [43] &quot;earthcovkind1&quot;                            &quot;earthcovkind2&quot;                           
##  [45] &quot;bedrckdepth&quot;                              &quot;bedrckkind&quot;                              
##  [47] &quot;bedrckhardness&quot;                           &quot;pmgroupname&quot;                             
##  [49] &quot;hillslopeprof&quot;                            &quot;geomslopeseg&quot;                            
##  [51] &quot;shapeacross&quot;                              &quot;shapedown&quot;                               
##  [53] &quot;slopecomplex&quot;                             &quot;drainagecl&quot;                              
##  [55] &quot;geomposhill&quot;                              &quot;geomposmntn&quot;                             
##  [57] &quot;geompostrce&quot;                              &quot;geomposflats&quot;                            
##  [59] &quot;swaterdepth&quot;                              &quot;flodfreqcl&quot;                              
##  [61] &quot;floddurcl&quot;                                &quot;flodmonthbeg&quot;                            
##  [63] &quot;pondfreqcl&quot;                               &quot;ponddurcl&quot;                               
##  [65] &quot;pondmonthbeg&quot;                             &quot;climstaid&quot;                               
##  [67] &quot;climstanm&quot;                                &quot;climstatype&quot;                             
##  [69] &quot;ffd&quot;                                      &quot;map&quot;                                     
##  [71] &quot;reannualprecip&quot;                           &quot;airtempa&quot;                                
##  [73] &quot;soiltempa&quot;                                &quot;airtemps&quot;                                
##  [75] &quot;soiltemps&quot;                                &quot;airtempw&quot;                                
##  [77] &quot;soiltempw&quot;                                &quot;surface_fine_gravel&quot;                     
##  [79] &quot;surface_gravel&quot;                           &quot;surface_cobbles&quot;                         
##  [81] &quot;surface_stones&quot;                           &quot;surface_boulders&quot;                        
##  [83] &quot;surface_channers&quot;                         &quot;surface_flagstones&quot;                      
##  [85] &quot;surface_parafine_gravel&quot;                  &quot;surface_paragravel&quot;                      
##  [87] &quot;surface_paracobbles&quot;                      &quot;surface_parastones&quot;                      
##  [89] &quot;surface_paraboulders&quot;                     &quot;surface_parachanners&quot;                    
##  [91] &quot;surface_paraflagstones&quot;                   &quot;surface_unspecified&quot;                     
##  [93] &quot;surface_total_frags_pct_nopf&quot;             &quot;surface_total_frags_pct&quot;                 
##  [95] &quot;othervegid&quot;                               &quot;othervegclass&quot;                           
##  [97] &quot;site_state&quot;                               &quot;site_county&quot;                             
##  [99] &quot;site_mlra&quot;                                &quot;slope_shape&quot;                             
## [101] &quot;surface_fgravel&quot;                          &quot;classdate&quot;                               
## [103] &quot;classifier&quot;                               &quot;classtype&quot;                               
## [105] &quot;taxonname&quot;                                &quot;localphase&quot;                              
## [107] &quot;taxonkind&quot;                                &quot;seriesstatus&quot;                            
## [109] &quot;taxclname&quot;                                &quot;taxpartsize&quot;                             
## [111] &quot;taxorder&quot;                                 &quot;taxsuborder&quot;                             
## [113] &quot;taxgrtgroup&quot;                              &quot;taxsubgrp&quot;                               
## [115] &quot;soiltaxedition&quot;                           &quot;osdtypelocflag&quot;                          
## [117] &quot;taxmoistcl&quot;                               &quot;taxtempregime&quot;                           
## [119] &quot;taxfamother&quot;                              &quot;taxreaction&quot;                             
## [121] &quot;taxfamhahatmatcl&quot;                         &quot;psctopdepth&quot;                             
## [123] &quot;pscbotdepth&quot;                              &quot;selection_method&quot;                        
## [125] &quot;ochric.epipedon&quot;                          &quot;argillic.horizon&quot;                        
## [127] &quot;paralithic.contact&quot;                       &quot;lithic.contact&quot;                          
## [129] &quot;umbric.epipedon&quot;                          &quot;cambic.horizon&quot;                          
## [131] &quot;mollic.epipedon&quot;                          &quot;densic.materials&quot;                        
## [133] &quot;paralithic.materials&quot;                     &quot;lithologic.discontinuity&quot;                
## [135] &quot;andic.soil.properties&quot;                    &quot;densic.contact&quot;                          
## [137] &quot;abrupt.textural.change&quot;                   &quot;aquic.conditions&quot;                        
## [139] &quot;duripan&quot;                                  &quot;slickensides&quot;                            
## [141] &quot;redox.depletions.with.chroma.2.or.less&quot;   &quot;redox.concentrations&quot;                    
## [143] &quot;reduced.matrix&quot;                           &quot;histic.epipedon&quot;                         
## [145] &quot;albic.horizon&quot;                            &quot;spodic.horizon&quot;                          
## [147] &quot;fibric.soil.materials&quot;                    &quot;hemic.soil.materials&quot;                    
## [149] &quot;sapric.soil.materials&quot;                    &quot;volcanic.glass&quot;                          
## [151] &quot;folistic.epipedon&quot;                        &quot;strongly.contrasting.particle.size.class&quot;
## [153] &quot;calcic.horizon&quot;                           &quot;human.transported.material&quot;              
## [155] &quot;albic.materials&quot;                          &quot;secondary.carbonates&quot;                    
## [157] &quot;anthropic.epipedon&quot;                       &quot;landform_string&quot;                         
## [159] &quot;landscape_string&quot;                         &quot;microfeature_string&quot;                     
## [161] &quot;geomicrorelief_string&quot;                    &quot;pmkind&quot;                                  
## [163] &quot;pmorigin&quot;                                 &quot;site_id&quot;</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb71-1"><a href="data.html#cb71-1" tabindex="-1"></a><span class="fu">horizonNames</span>(gopheridge)</span></code></pre></div>
<pre><code>##  [1] &quot;phiid&quot;                &quot;peiid&quot;                &quot;pedon_id&quot;             &quot;hzname&quot;              
##  [5] &quot;dspcomplayerid&quot;       &quot;hzdept&quot;               &quot;hzdepb&quot;               &quot;bounddistinct&quot;       
##  [9] &quot;boundtopo&quot;            &quot;claytotest&quot;           &quot;silttotest&quot;           &quot;sandtotest&quot;          
## [13] &quot;clay&quot;                 &quot;silt&quot;                 &quot;sand&quot;                 &quot;fragvoltot&quot;          
## [17] &quot;texture&quot;              &quot;texcl&quot;                &quot;lieutex&quot;              &quot;phfield&quot;             
## [21] &quot;effclass&quot;             &quot;labsampnum&quot;           &quot;rupresblkdry&quot;         &quot;rupresblkmst&quot;        
## [25] &quot;rupresblkcem&quot;         &quot;stickiness&quot;           &quot;plasticity&quot;           &quot;ksatpedon&quot;           
## [29] &quot;texture_class&quot;        &quot;hzID&quot;                 &quot;d_hue&quot;                &quot;d_value&quot;             
## [33] &quot;d_chroma&quot;             &quot;dry_soil_color&quot;       &quot;d_r&quot;                  &quot;d_g&quot;                 
## [37] &quot;d_b&quot;                  &quot;d_sigma&quot;              &quot;m_hue&quot;                &quot;m_value&quot;             
## [41] &quot;m_chroma&quot;             &quot;moist_soil_color&quot;     &quot;m_r&quot;                  &quot;m_g&quot;                 
## [45] &quot;m_b&quot;                  &quot;m_sigma&quot;              &quot;soil_color&quot;           &quot;fine_gravel&quot;         
## [49] &quot;gravel&quot;               &quot;cobbles&quot;              &quot;stones&quot;               &quot;boulders&quot;            
## [53] &quot;channers&quot;             &quot;flagstones&quot;           &quot;parafine_gravel&quot;      &quot;paragravel&quot;          
## [57] &quot;paracobbles&quot;          &quot;parastones&quot;           &quot;paraboulders&quot;         &quot;parachanners&quot;        
## [61] &quot;paraflagstones&quot;       &quot;unspecified&quot;          &quot;total_frags_pct_nopf&quot; &quot;total_frags_pct&quot;     
## [65] &quot;art_fgr&quot;              &quot;art_gr&quot;               &quot;art_cb&quot;               &quot;art_st&quot;              
## [69] &quot;art_by&quot;               &quot;art_ch&quot;               &quot;art_fl&quot;               &quot;art_unspecified&quot;     
## [73] &quot;total_art_pct&quot;        &quot;huartvol_cohesive&quot;    &quot;huartvol_penetrable&quot;  &quot;huartvol_innocuous&quot;  
## [77] &quot;huartvol_persistent&quot;</code></pre>
<div id="make-profile-sketches" class="section level4 hasAnchor" number="2.6.4.1">
<h4><span class="header-section-number">2.6.4.1</span> Make profile sketches<a href="data.html#make-profile-sketches" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>plotSPC()</code> or <code>plot()</code> function generates sketches of a <em>SoilProfileCollection</em> object based on horizon depths, designations, and colors. The <a href="http://ncss-tech.github.io/aqp/articles/Introduction-to-SoilProfileCollection-Objects.html#plotting-soilprofilecollection-objects"><em>SoilProfileCollection</em> Reference</a> vignette contains many examples demonstrating way in which these sketches can be customized. The <a href="https://ncss-tech.github.io/AQP/aqp/sketches.html">Soil Profile Sketches tutorial</a> contains additional examples that demonstrate ways to customize soil profile sketches.</p>
<p>See <a href="http://ncss-tech.github.io/aqp/reference/SoilProfileCollection-plotting-methods.html"><code>?plotSPC</code> for a detailed list of arguments and examples</a>.</p>
<p>The <code>fetchNASIS()</code> function automatically converts moist Munsell colors into R-style colors, available in the <code>soil_color</code> horizon level attribute. This color is used by default in <code>plotSPC()</code></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb73-1"><a href="data.html#cb73-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb73-2"><a href="data.html#cb73-2" tabindex="-1"></a></span>
<span id="cb73-3"><a href="data.html#cb73-3" tabindex="-1"></a><span class="co"># omitting pedon IDs and horizon designations</span></span>
<span id="cb73-4"><a href="data.html#cb73-4" tabindex="-1"></a><span class="fu">plotSPC</span>(gopheridge,</span>
<span id="cb73-5"><a href="data.html#cb73-5" tabindex="-1"></a>        <span class="at">print.id =</span> <span class="cn">FALSE</span>,</span>
<span id="cb73-6"><a href="data.html#cb73-6" tabindex="-1"></a>        <span class="at">name =</span> <span class="cn">NA</span>,</span>
<span id="cb73-7"><a href="data.html#cb73-7" tabindex="-1"></a>        <span class="at">width =</span> <span class="fl">0.3</span>)</span>
<span id="cb73-8"><a href="data.html#cb73-8" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Pedons from the `gopheridge` sample dataset&#39;</span>, <span class="at">line =</span> <span class="sc">-</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="s4ssbook_files/figure-html/unnamed-chunk-48-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>Additional examples / documentation related to soil profile sketches:</p>
<ul>
<li><p><a href="http://ncss-tech.github.io/aqp/articles/Introduction-to-SoilProfileCollection-Objects.html"><em>SoilProfileCollection</em> Reference</a></p></li>
<li><p><a href="http://ncss-tech.github.io/AQP/sharpshootR/OSD-dendrogram.html">OSD Dendrogram tutorial</a></p></li>
<li><p><a href="https://ncss-tech.github.io/AQP/aqp/hz-boundaries.html">Visualization of Horizon Boundaries tutorial</a></p></li>
<li><p><a href="http://ncss-tech.github.io/AQP/soilDB/competing-series.html">Competing Series tutorial</a></p></li>
</ul>
</div>
<div id="pedon-data-checks" class="section level4 hasAnchor" number="2.6.4.2">
<h4><span class="header-section-number">2.6.4.2</span> Pedon Data Checks<a href="data.html#pedon-data-checks" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When you load pedons using the <code>fetchNASIS()</code> function, the following data checks are performed:</p>
<ul>
<li><strong>Inconsistent horizon boundaries</strong>. Pedons with inconsistent horizon boundaries are not loaded when <code>rmHzErrors = TRUE</code>. In most cases, this occurs when the bottom depth of a horizon is not the same as the upper depth of the next lower horizon.</li>
</ul>
<pre><code>##   hzname top bot
## 1      A   0  30
## 2    Bt1  38  56
## 3    Bt2  56 121
## 4     Bk 121 135
## 5      R 135  NA</code></pre>
<p>Note the issue above. The bottom depth of the A horizon and the upper depth of the Bt1 horizon should be the same: either 30 or 38 cm. The correct depth needs to be determined and fixed in the database.</p>
<ul>
<li><p><strong>Missing lower horizon depths.</strong> Offending horizons are fixed by replacing the missing bottom depth with the top depth plus 1 cm. In the case of the profile shown above, a bottom depth of 137 cm would be inserted where the depth is missing.</p></li>
<li><p><strong>Sites missing pedon records</strong>. Data without corresponding horizons are not loaded.</p></li>
</ul>
</div>
<div id="find-data-with-errors" class="section level4 hasAnchor" number="2.6.4.3">
<h4><span class="header-section-number">2.6.4.3</span> Find Data with Errors<a href="data.html#find-data-with-errors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If errors in the pedon data are detected when loading data using <code>fetchNASIS()</code>, the following “get” commands can trace them back to the corresponding records in NASIS.</p>
<p>These access an option that is stored in a special object called an <code>environment</code> associated with the soilDB package – they generally contain vectors of IDs to help locating the problematic data.</p>
<ul>
<li><code>get('sites.missing.pedons', envir = soilDB.env)</code>
<ul>
<li>Returns user site ID for sites missing pedons</li>
</ul></li>
<li><code>get('dup.pedon.ids', envir = soilDB.env)</code>
<ul>
<li>Returns user pedon ID for sites with duplicate pedon ID</li>
</ul></li>
<li><code>get('bad.pedon.ids', envir = soilDB.env)</code>
<ul>
<li>Returns user pedon ID for pedons with inconsistent horizon depths</li>
</ul></li>
<li><code>get('bad.horizons', envir = soilDB.env)</code>
<ul>
<li>Returns a data.frame of horizon-level information for pedons with inconsistent horizon depths</li>
</ul></li>
</ul>
<p>Here is a full list of ID vectors that can be created when errors are detected:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb75-1"><a href="data.html#cb75-1" tabindex="-1"></a><span class="co"># fetchNASIS(&quot;pedons&quot;)</span></span>
<span id="cb75-2"><a href="data.html#cb75-2" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;sites.missing.pedons&#39;</span>, <span class="at">envir =</span> <span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-3"><a href="data.html#cb75-3" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;dup.pedon.ids&#39;</span>, <span class="at">envir =</span> <span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-4"><a href="data.html#cb75-4" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;bad.pedon.ids&#39;</span>, <span class="at">envir =</span> <span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-5"><a href="data.html#cb75-5" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;missing.bottom.depths&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-6"><a href="data.html#cb75-6" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;top.bottom.equal&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-7"><a href="data.html#cb75-7" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;bad.horizons&#39;</span>, <span class="at">envir =</span> <span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-8"><a href="data.html#cb75-8" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;rock.fragment.volume.gt100.phiid&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-9"><a href="data.html#cb75-9" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;artifact.volume.gt100.phiid&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-10"><a href="data.html#cb75-10" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;multisiteobs.surface&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-11"><a href="data.html#cb75-11" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;surface.fragment.cover.gt100.siteobsiid&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-12"><a href="data.html#cb75-12" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;multiple.labsampnum.per.phiid&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-13"><a href="data.html#cb75-13" tabindex="-1"></a></span>
<span id="cb75-14"><a href="data.html#cb75-14" tabindex="-1"></a><span class="co"># fetchNASISLabData()</span></span>
<span id="cb75-15"><a href="data.html#cb75-15" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;bad.labpedon.ids&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-16"><a href="data.html#cb75-16" tabindex="-1"></a></span>
<span id="cb75-17"><a href="data.html#cb75-17" tabindex="-1"></a><span class="co"># fetchNASIS(&quot;components&quot;), fetchNASISWebReport()</span></span>
<span id="cb75-18"><a href="data.html#cb75-18" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;dupe.coiids&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-19"><a href="data.html#cb75-19" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;dupe.muiids&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-20"><a href="data.html#cb75-20" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;multiple.mu.per.dmu&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-21"><a href="data.html#cb75-21" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&quot;component.hz.problems&quot;</span>, <span class="at">envir =</span> <span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-22"><a href="data.html#cb75-22" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;multiple.ecosite.per.coiid&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-23"><a href="data.html#cb75-23" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;multiple.otherveg.per.coiid&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-24"><a href="data.html#cb75-24" tabindex="-1"></a></span>
<span id="cb75-25"><a href="data.html#cb75-25" tabindex="-1"></a><span class="co"># Soil Data Access</span></span>
<span id="cb75-26"><a href="data.html#cb75-26" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;dup.compmgrp.cokeyrvindictor&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-27"><a href="data.html#cb75-27" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;component.hz.problems&#39;</span>, <span class="at">envir=</span><span class="fu">get_soilDB_env</span>())</span>
<span id="cb75-28"><a href="data.html#cb75-28" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;component.ecosite.problems&#39;</span>, <span class="at">envir =</span> <span class="fu">get_soilDB_env</span>())</span></code></pre></div>
<p>These <code>get()</code> calls access variables stored in the package environment <code>soilDB.env</code>. The variables only exist if there are “problems” / values found by the data checks. If you fix the errors in the NASIS database and the checks don’t find any errors then these vectors of IDs will not be defined.</p>
</div>
</div>
</div>
<div id="basic-data-inspection" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Basic Data Inspection<a href="data.html#basic-data-inspection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that you’ve loaded some data, you can look at additional ways to summarize and interact with data elements.</p>
<div id="table-tabulation-and-cross-tabulation" class="section level3 hasAnchor" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> <code>table()</code>: Tabulation and Cross Tabulation<a href="data.html#table-tabulation-and-cross-tabulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The base R <code>table()</code> function is very useful for quick summary operations. It returns a named vector with the amount of each unique level of the a given vector.</p>
<p>The numeric vector of “counts” is commonly combined with other functions such as <code>sort()</code>, <code>order()</code>, <code>prop.table()</code>, <code>is.na()</code> to identify abundance, proportions, or missing data (<code>NA</code>).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb76-1"><a href="data.html#cb76-1" tabindex="-1"></a><span class="co"># load required packages</span></span>
<span id="cb76-2"><a href="data.html#cb76-2" tabindex="-1"></a><span class="fu">library</span>(aqp)</span>
<span id="cb76-3"><a href="data.html#cb76-3" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb76-4"><a href="data.html#cb76-4" tabindex="-1"></a></span>
<span id="cb76-5"><a href="data.html#cb76-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;gopheridge&quot;</span>, <span class="at">package =</span> <span class="st">&quot;soilDB&quot;</span>)</span>
<span id="cb76-6"><a href="data.html#cb76-6" tabindex="-1"></a></span>
<span id="cb76-7"><a href="data.html#cb76-7" tabindex="-1"></a><span class="co"># for these examples, we use the gopheridge object as our &quot;selected set&quot;</span></span>
<span id="cb76-8"><a href="data.html#cb76-8" tabindex="-1"></a>pedons <span class="ot">&lt;-</span> gopheridge </span>
<span id="cb76-9"><a href="data.html#cb76-9" tabindex="-1"></a></span>
<span id="cb76-10"><a href="data.html#cb76-10" tabindex="-1"></a><span class="do">## you can use fetchNASIS to load your own data, like this:</span></span>
<span id="cb76-11"><a href="data.html#cb76-11" tabindex="-1"></a><span class="co"># pedons &lt;- fetchNASIS()</span></span>
<span id="cb76-12"><a href="data.html#cb76-12" tabindex="-1"></a></span>
<span id="cb76-13"><a href="data.html#cb76-13" tabindex="-1"></a><span class="co"># summarize which soil taxa we have loaded</span></span>
<span id="cb76-14"><a href="data.html#cb76-14" tabindex="-1"></a><span class="fu">table</span>(pedons<span class="sc">$</span>taxonname)</span></code></pre></div>
<pre><code>## 
## Gopheridge 
##         52</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb78-1"><a href="data.html#cb78-1" tabindex="-1"></a><span class="co"># sort taxonomic names in descending order</span></span>
<span id="cb78-2"><a href="data.html#cb78-2" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(pedons<span class="sc">$</span>taxonname), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Gopheridge 
##         52</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb80-1"><a href="data.html#cb80-1" tabindex="-1"></a><span class="co"># could do the same thing for taxonomic subgroups </span></span>
<span id="cb80-2"><a href="data.html#cb80-2" tabindex="-1"></a><span class="fu">table</span>(pedons<span class="sc">$</span>taxsubgrp)</span></code></pre></div>
<pre><code>## 
## mollic haploxeralfs  typic haploxerepts  ultic haploxeralfs  ultic haploxerolls 
##                   1                   6                  44                   1</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb82-1"><a href="data.html#cb82-1" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(pedons<span class="sc">$</span>taxsubgrp), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  ultic haploxeralfs  typic haploxerepts mollic haploxeralfs  ultic haploxerolls 
##                  44                   6                   1                   1</code></pre>
<p>We can convert counts in the <code>table()</code> result into proportions with <code>prop.table()</code>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb84-1"><a href="data.html#cb84-1" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(pedons<span class="sc">$</span>taxsubgrp))</span></code></pre></div>
<pre><code>## 
## mollic haploxeralfs  typic haploxerepts  ultic haploxeralfs  ultic haploxerolls 
##          0.01923077          0.11538462          0.84615385          0.01923077</code></pre>
<p><code>table()</code> can be used to get counts over multiple dimensions of factor levels. This is called <em>cross tabulation</em>.</p>
<p>For instance, let’s cross tabulate taxonomic subgroup (<code>taxsubgrp</code>) and the particle size family class (<code>taxpartsize</code>) for <code>pedons</code></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb86-1"><a href="data.html#cb86-1" tabindex="-1"></a><span class="fu">table</span>(pedons<span class="sc">$</span>taxsubgrp, pedons<span class="sc">$</span>taxpartsize)</span></code></pre></div>
<pre><code>##                      
##                       clayey-skeletal coarse-loamy fine fine-loamy loamy-skeletal
##   mollic haploxeralfs               0            0    0          0              1
##   typic haploxerepts                1            0    0          0              5
##   ultic haploxeralfs                2            0    1          1             40
##   ultic haploxerolls                0            1    0          0              0</code></pre>
<p>As expected with <code>gopheridge</code> the majority of pedons are <em>Loamy-skeletal Ultic Haploxeralfs</em>.</p>
<p>Since <code>pedons</code> contains site and horizon level data, when cross tabulating we need to be sure pair a column from the site data with other site-level columns, and the same for horizon-level. This is because all arguments to <code>table()</code> must have the same length.</p>
<p>For example, let’s cross-tabulate horizon designation (<code>hzname</code>) with horizon texture class (<code>texcl</code>).</p>
<p>We can use the <code>addmargins()</code> function to add the row and column sums to the margins of the table for easier interpretation when there are many rows/columns in the result.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb88-1"><a href="data.html#cb88-1" tabindex="-1"></a><span class="fu">addmargins</span>(<span class="fu">table</span>(pedons<span class="sc">$</span>hzname, pedons<span class="sc">$</span>texcl))</span></code></pre></div>
<pre><code>##        
##           c  cl   l scl sic sicl sil  sl Sum
##   2BCt5   0   1   0   0   0    0   0   0   1
##   2Bt1    0   0   3   0   0    0   0   0   3
##   2Bt2    1   2   1   1   0    0   0   0   5
##   2Bt3    1   3   1   0   0    0   0   0   5
##   2Bt4    2   0   0   0   0    0   0   0   2
##   2CBt    0   0   0   1   0    0   0   0   1
##   2Cr     0   0   0   0   0    0   0   0   0
##   2Crt    0   0   0   0   0    0   0   0   0
##   2R      0   0   0   0   0    0   0   0   0
##   A       0   0  33   0   0    0  12   3  48
##   A1      0   0   2   0   0    0   2   0   4
##   A2      0   0   2   0   0    0   2   0   4
##   A3      0   0   1   0   0    0   0   0   1
##   AB      0   0   2   0   0    0   2   0   4
##   BA      0   0  17   0   0    1   0   0  18
##   BC      0   0   4   0   0    0   0   0   4
##   BCt     0   2   2   1   0    0   1   0   6
##   Bt      0   0   1   1   1    0   0   0   3
##   Bt1     0   3  28   1   0    3   5   0  40
##   Bt2     3  15  14   1   1    3   1   0  38
##   Bt3     4   8   6   1   0    1   1   0  21
##   Bt4     1   2   2   0   0    0   0   0   5
##   Bw      0   0   6   0   0    0   1   0   7
##   Bw1     0   0   5   0   0    0   0   0   5
##   Bw2     0   0   5   0   0    0   0   0   5
##   Bw3     0   0   3   0   0    0   0   0   3
##   C       1   0   1   0   0    0   0   0   2
##   C/Brt   0   1   0   0   0    0   0   0   1
##   CBt     0   0   0   1   0    0   0   0   1
##   Cr      0   0   1   0   0    0   0   0   1
##   Crt     0   0   0   0   0    0   0   0   0
##   Ct      0   0   1   0   0    0   0   0   1
##   Oe      0   0   0   0   0    0   0   0   0
##   Oi      0   0   0   0   0    0   0   0   0
##   R       0   0   0   0   0    0   0   0   0
##   Sum    13  37 141   8   2    8  27   3 239</code></pre>
</div>
<div id="missing-values" class="section level3 hasAnchor" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Missing Values<a href="data.html#missing-values" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Missing values are encoded in R as <code>NA</code>. The <code>table()</code> function has a <code>useNA</code> argument that affects whether <code>NA</code> values are counted.</p>
<p>Use <code>is.na()</code> to return a logical value that identifies missing data.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb90-1"><a href="data.html#cb90-1" tabindex="-1"></a><span class="fu">table</span>(pedons<span class="sc">$</span>taxsubgrp, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span></code></pre></div>
<pre><code>## 
## mollic haploxeralfs  typic haploxerepts  ultic haploxeralfs  ultic haploxerolls 
##                   1                   6                  44                   1</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb92-1"><a href="data.html#cb92-1" tabindex="-1"></a><span class="co">#  is.na(...) </span></span>
<span id="cb92-2"><a href="data.html#cb92-2" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">is.na</span>(pedons<span class="sc">$</span>taxsubgrp))</span></code></pre></div>
<pre><code>## 
## FALSE 
##    52</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb94-1"><a href="data.html#cb94-1" tabindex="-1"></a><span class="co">#  is NOT NA !is.na(...)</span></span>
<span id="cb94-2"><a href="data.html#cb94-2" tabindex="-1"></a><span class="fu">table</span>(<span class="sc">!</span><span class="fu">is.na</span>(pedons<span class="sc">$</span>taxsubgrp))</span></code></pre></div>
<pre><code>## 
## TRUE 
##   52</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb96-1"><a href="data.html#cb96-1" tabindex="-1"></a><span class="co"># it can also be applied to horizon level columns in the SPC</span></span>
<span id="cb96-2"><a href="data.html#cb96-2" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(pedons<span class="sc">$</span>texture), <span class="at">decreasing=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##        BR         L      GR-L     GRV-L     CBV-L       SPM     GRX-L       SIL    GRV-CL    CBV-CL    GR-SIL 
##        58        36        33        24        18        14        12        12         9         8         7 
##     CBX-L    GRX-CL    CBX-CL   GRV-SIL        CL   GRV-SCL     GRX-C       MPM        SL      CB-L     GR-CL 
##         6         5         4         4         3         3         3         3         3         2         2 
##   GRX-SCL     PGR-C    PGRX-L      SICL    STV-CL     STV-L     STX-C     STX-L         C      CB-C     CB-CL 
##         2         2         2         2         2         2         2         2         1         1         1 
##    CB-SCL    CB-SIL   CBV-SIL   CBX-SCL      CN-L   CN-SICL     CNX-L  CNX-SICL     FLV-L      GR-C    GR-SIC 
##         1         1         1         1         1         1         1         1         1         1         1 
##  GRV-SICL   GRX-SIC   GRX-SIL  PCB-SICL PCBV-SICL     PCN-C   PCNX-CL    PGRV-C   PGRV-CL  PGRX-SCL  PGRX-SIL 
##         1         1         1         1         1         1         1         1         1         1         1 
##      ST-L     STV-C    STX-CL  STX-SICL 
##         1         1         1         1</code></pre>
</div>
<div id="logical-operators" class="section level3 hasAnchor" number="2.7.3">
<h3><span class="header-section-number">2.7.3</span> Logical Operators<a href="data.html#logical-operators" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Logic.html">Logical operators</a> act on vectors for the purposes of comparison.</p>
<ul>
<li><p><code>==</code> “EQUAL TO”</p></li>
<li><p><code>!=</code> “NOT EQUAL TO”</p></li>
<li><p><code>&lt;</code> LESS than</p>
<ul>
<li>LESS than or equal to <code>&lt;=</code></li>
</ul></li>
<li><p><code>&gt;</code> GREATER than</p>
<ul>
<li>GREATER than or equal to <code>&gt;=</code></li>
</ul></li>
<li><p><code>%in%</code> Equivalent to <code>IN ()</code> in SQL; same logic as <code>match()</code> but returns a logical, not integer</p>
<ul>
<li><p>Example: <code>pedons$taxpartsize %in% c('loamy-skeletal', 'sandy-skeletal')</code></p></li>
<li><p>Returns a vector of <code>TRUE</code>/<code>FALSE</code> equal in length to left-hand side</p></li>
</ul></li>
<li><p><code>&amp;</code> logical AND</p></li>
<li><p><code>|</code> logical OR</p></li>
</ul>
<p>Any logical operation on <code>NA</code> returns <code>NA</code>, so it is important to make sure your data are complete before relying on logical expressions to find conditions of interest.</p>
</div>
<div id="pattern-matching" class="section level3 hasAnchor" number="2.7.4">
<h3><span class="header-section-number">2.7.4</span> Pattern Matching<a href="data.html#pattern-matching" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following examples use the <code>grep()</code> function to pattern match within the data. We do this to create an index of the <em>SoilProfileCollection</em> for records that match the specified pattern, and then use that index to filter to specific sites and profiles.</p>
<p>Patterns are specified using <a href="http://regexr.com/">regular expression</a> (REGEX) syntax.</p>
<p>This process can be applied to many different columns in the SPC based on how you need to filter the data. This example pattern matches on the <code>taxsubgrp</code> column, but another useful application might be to pattern match on geomorphology or parent material.</p>
<p>Say we want to see what the variation of particle size classes are within a specific subgroup. We can use <code>grep()</code> to create a row index, then apply that index to the <em>SoilProfileCollection</em>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb98-1"><a href="data.html#cb98-1" tabindex="-1"></a><span class="co"># create a numeric index for pedons with taxsubgroup containing &#39;typic&#39;</span></span>
<span id="cb98-2"><a href="data.html#cb98-2" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&#39;typic&#39;</span>, pedons<span class="sc">$</span>taxsubgrp)</span>
<span id="cb98-3"><a href="data.html#cb98-3" tabindex="-1"></a>idx</span></code></pre></div>
<pre><code>## [1] 11 12 13 14 26 50</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb100-1"><a href="data.html#cb100-1" tabindex="-1"></a><span class="co"># use square bracket notation to subset &#39;typic&#39; soils in `subset1` object</span></span>
<span id="cb100-2"><a href="data.html#cb100-2" tabindex="-1"></a>subset1 <span class="ot">&lt;-</span> pedons[idx,]</span>
<span id="cb100-3"><a href="data.html#cb100-3" tabindex="-1"></a></span>
<span id="cb100-4"><a href="data.html#cb100-4" tabindex="-1"></a><span class="co"># or use the index directly to summarize taxpartsize for &#39;typic&#39; soils</span></span>
<span id="cb100-5"><a href="data.html#cb100-5" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(pedons<span class="sc">$</span>taxpartsize[idx]), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  loamy-skeletal clayey-skeletal 
##               5               1</code></pre>
<p>Note: <code>grep()</code> below has an <code>invert</code> argument (default <code>FALSE</code>). This option is very useful for excluding the results of the pattern matching process by inverting whatever the result is. <code>grepl()</code> is the <em>logical</em> version of <code>grep()</code>, so you can invert it using the logical NOT operator: <code>!</code>.</p>
<p>Another method is to create an index using <code>which()</code> function. <code>which()</code> takes any logical vector (or expression), and it returns the indices (positions) where that expression returns <code>TRUE</code>. The use of <code>which</code> becomes more important when there are missing values (NA) in an expression.</p>
<p><em>Do a graphical check to see the “typic” profiles are selected.</em></p>
<p>Plot them in R using the <em>SoilProfileCollection</em> “plot” method (e.g., specialized version of the generic <code>plot()</code> function).</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb102-1"><a href="data.html#cb102-1" tabindex="-1"></a><span class="co"># adjust margins</span></span>
<span id="cb102-2"><a href="data.html#cb102-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb102-3"><a href="data.html#cb102-3" tabindex="-1"></a></span>
<span id="cb102-4"><a href="data.html#cb102-4" tabindex="-1"></a><span class="co"># plot the first 10 profiles of subset1</span></span>
<span id="cb102-5"><a href="data.html#cb102-5" tabindex="-1"></a><span class="fu">plot</span>(subset1[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ], <span class="at">label =</span> <span class="st">&#39;taxsubgrp&#39;</span>, <span class="at">max.depth =</span> <span class="dv">60</span>)</span>
<span id="cb102-6"><a href="data.html#cb102-6" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Pedons with the word &quot;typic&quot; at subgroup-level of Soil Taxonomy&#39;</span>, <span class="at">line=</span><span class="sc">-</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="s4ssbook_files/figure-html/unnamed-chunk-56-1.png" width="768" style="display: block; margin: auto;" /></p>
<div id="resources-for-regular-expressions" class="section level4 hasAnchor" number="2.7.4.1">
<h4><span class="header-section-number">2.7.4.1</span> Resources for Regular Expressions<a href="data.html#resources-for-regular-expressions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A great way to test out regular expressions, and get in-depth explanations of how the syntax is working, is to use an online expression builder. For example, Regex101 or RegExr.</p>
<ul>
<li><p><a href="https://regex101.com/" class="uri">https://regex101.com/</a> &amp; <a href="https://regexr.com/" class="uri">https://regexr.com/</a> - Online regular expression testers</p></li>
<li><p>For more information on using regular expressions in <code>grep()</code> for pattern matching operations, see:</p>
<ul>
<li><p>GNU <a href="https://www.gnu.org/software/findutils/manual/html_node/find_html/grep-regular-expression-syntax.html">Regular-expression-syntax</a></p></li>
<li><p>Quick Start Guide :<a href="http://www.regular-expressions.info/quickstart.html" class="uri">http://www.regular-expressions.info/quickstart.html</a></p></li>
</ul></li>
</ul>
<p>Quick check: <em>Review the chapter content, or run the commands, and review the documentation, to answer the questions.</em></p>
<ul>
<li><p><em>True or False</em>: <code>grepl()</code> returns a <em>numeric</em> vector</p></li>
<li><p><em>True or False</em>: <code>which(grepl('typic', pedons$taxsubgrp))</code> is the same as <code>grep('typic', pedons$taxsubgrp)</code>.</p></li>
</ul>
</div>
<div id="statistics-for-soil-survey-regex-operator-reference" class="section level4 hasAnchor" number="2.7.4.2">
<h4><span class="header-section-number">2.7.4.2</span> Statistics for Soil Survey: REGEX Operator Reference<a href="data.html#statistics-for-soil-survey-regex-operator-reference" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p><code>.</code> One character, any character</p></li>
<li><p><code>*</code> Zero-or-more Quantifier (of previous token)</p></li>
<li><p><code>+</code> One-or-more Quantifier (of previous token)</p></li>
<li><p><code>{n}</code> quantifier where <code>n</code> is the the number of a match “repeats” (of previous token)</p></li>
<li><p><code>[A-Z!]</code> ONE capital letter, or an exclamation mark</p></li>
<li><p><code>[0-9]{2}</code> TWO numbers (using <code>{</code> quantifier)</p></li>
<li><p><code>|</code> is equivalent to <code>OR</code>:</p>
<ul>
<li>Example: <code>grep('loamy|sandy', c("loamy-skeletal","sandy","sandy-skeletal"))</code>
<ul>
<li>“loamy <em>OR</em> sandy”</li>
</ul></li>
</ul></li>
<li><p><code>^</code> Anchor to beginning of string / line:</p>
<ul>
<li>Example: <code>grep('^sandy', c("loamy-skeletal","sandy","sandy-skeletal"))</code>
<ul>
<li>“<em>STARTS WITH</em> sandy”</li>
</ul></li>
</ul></li>
<li><p><code>$</code> Anchor to end of string / line:</p>
<ul>
<li>Example: <code>grep('skeletal$', c("loamy-skeletal","sandy","sandy-skeletal"))</code>
<ul>
<li>“<em>ENDS WITH</em> skeletal”</li>
</ul></li>
</ul></li>
<li><p><code>\\b</code> Anchor to word boundary:</p>
<ul>
<li>Example: <code>grep('\\bmesic', c("mesic","thermic","isomesic"))</code>
<ul>
<li>“<em>WORD STARTS WITH</em> mesic” (e.g. not “isomesic”)</li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<div id="filtering" class="section level3 hasAnchor" number="2.7.5">
<h3><span class="header-section-number">2.7.5</span> Filtering<a href="data.html#filtering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A variety of methods are available to subset or “filter” R data objects, from a simple <code>data.frame</code> or vector, to something more complex like a <code>Spatial</code> object or a <em>SoilProfileCollection</em>.</p>
<p>You can index many R objects using numeric or logical expressions as above. There are also methods that make this process a little easier.</p>
<p>The base R method for this is <code>subset()</code> and it works on <code>data.frame</code> objects. It is nice because you can specify column names without explicitly referencing the data set, since subset uses non-standard evaluation of expressions passed as arguments.</p>
<div id="filtering-with-aqpsubset" class="section level4 hasAnchor" number="2.7.5.1">
<h4><span class="header-section-number">2.7.5.1</span> Filtering with <code>aqp::subset()</code><a href="data.html#filtering-with-aqpsubset" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We use the <em>SoilProfileCollection</em> <code>subset</code> method, where we first specify a data (<code>pedons</code>) object then we can write expressions for the columns that exist in that object.</p>
<p>Here, we combine two logical expressions to find <code>taxsubgrp</code> containing <code>"alfs"</code> (Alfisols) with <code>obsdate</code> before January 1st, 2010.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb103-1"><a href="data.html#cb103-1" tabindex="-1"></a>subset2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(pedons, <span class="fu">grepl</span>(<span class="st">&quot;alfs&quot;</span>, taxsubgrp) <span class="sc">&amp;</span> obsdate <span class="sc">&lt;</span> <span class="fu">as.POSIXlt</span>(<span class="st">&quot;2010-01-01&quot;</span>))</span>
<span id="cb103-2"><a href="data.html#cb103-2" tabindex="-1"></a></span>
<span id="cb103-3"><a href="data.html#cb103-3" tabindex="-1"></a><span class="co"># check taxonomic range of particle size classes in the data</span></span>
<span id="cb103-4"><a href="data.html#cb103-4" tabindex="-1"></a><span class="co"># overwhelmingly these are described as loamy-skeletal ultic haploxeralfs</span></span>
<span id="cb103-5"><a href="data.html#cb103-5" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(subset2<span class="sc">$</span>taxsubgrp), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  ultic haploxeralfs mollic haploxeralfs 
##                  28                   1</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb105-1"><a href="data.html#cb105-1" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(subset2<span class="sc">$</span>taxpartsize), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  loamy-skeletal clayey-skeletal            fine      fine-loamy 
##              25               2               1               1</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb107-1"><a href="data.html#cb107-1" tabindex="-1"></a><span class="co"># check year described and taxpartsize</span></span>
<span id="cb107-2"><a href="data.html#cb107-2" tabindex="-1"></a><span class="fu">table</span>(subset2<span class="sc">$</span>taxpartsize, <span class="fu">substr</span>(subset2<span class="sc">$</span>obsdate, <span class="dv">0</span>, <span class="dv">4</span>))</span></code></pre></div>
<pre><code>##                  
##                   2007 2008 2009
##   clayey-skeletal    1    0    1
##   fine               1    0    0
##   fine-loamy         1    0    0
##   loamy-skeletal    19    1    5</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb109-1"><a href="data.html#cb109-1" tabindex="-1"></a><span class="co"># a double equal sign &#39;==&#39; is used for exact character or numeric criteria</span></span>
<span id="cb109-2"><a href="data.html#cb109-2" tabindex="-1"></a>subset3 <span class="ot">&lt;-</span> <span class="fu">subset</span>(subset2, taxpartsize <span class="sc">==</span> <span class="st">&#39;loamy-skeletal&#39;</span>)</span>
<span id="cb109-3"><a href="data.html#cb109-3" tabindex="-1"></a></span>
<span id="cb109-4"><a href="data.html#cb109-4" tabindex="-1"></a><span class="fu">table</span>(subset3<span class="sc">$</span>taxpartsize)</span></code></pre></div>
<pre><code>## 
## loamy-skeletal 
##             25</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb111-1"><a href="data.html#cb111-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb111-2"><a href="data.html#cb111-2" tabindex="-1"></a><span class="fu">plotSPC</span>(subset3[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, ], <span class="at">print.id =</span> <span class="cn">FALSE</span>)</span>
<span id="cb111-3"><a href="data.html#cb111-3" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Loamy-skeletal Ultic Haploxeralfs&#39;</span>)</span></code></pre></div>
<p><img src="s4ssbook_files/figure-html/unnamed-chunk-57-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="dates-and-times" class="section level3 hasAnchor" number="2.7.6">
<h3><span class="header-section-number">2.7.6</span> Dates and Times<a href="data.html#dates-and-times" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dates and times use special object types in R. The <a href="https://en.wikipedia.org/wiki/Unix_time">Unix time</a>, also known as “Posix time,” is a system for describing a point in time. Unix epoch is a whole number value that is the number of seconds elapsed since the 00:00:00 UTC on 1 January 1970 minus leap seconds.</p>
<p>We can use logical comparison operators on dates and times if their string representation such as <code>"01/01/1970"</code> is converted to a common base R UNIX time representation known as <code>POSIXlt</code> or <code>POSIXct</code>.</p>
<p>This conversion accounts for important things such as timezone using your computer’s locale–which is important to keep in mind.</p>
<p>When converting to POSIX time several unambiguous (year-month-day) date time formats can be detected.</p>
<p>For instance, if you want to convert a date in the common month-day-year format, you need to specify the <code>format</code> argument:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb112-1"><a href="data.html#cb112-1" tabindex="-1"></a><span class="fu">as.POSIXct</span>(<span class="dv">24</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">60</span>, <span class="at">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-02 UTC&quot;</code></pre>
<p>By default the timezone will match your current timezone. Dates without times are treated as being at midnight UTC.</p>
<p>You can customize the timezone with <code>tz</code> argument:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb114-1"><a href="data.html#cb114-1" tabindex="-1"></a><span class="fu">as.POSIXlt</span>(<span class="st">&quot;01/01/1970&quot;</span>, <span class="at">tz =</span> <span class="st">&quot;UTC&quot;</span>, <span class="at">format =</span> <span class="st">&quot;%m/%d/%Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1970-01-01 UTC&quot;</code></pre>
<p><code>POSIXlt</code> and <code>POSIXct</code> objects can be formatted with the <code>format()</code> function. <code>strptime()</code> can be used to parse character vectors into date/times. You use <code>as.POSIXlt()</code> with character input, and <code>as.POSIXct()</code> with numeric input.</p>
<p>R also has the Date class which can be used for formatting calendar dates. You can convert POSIXlt/POSIXct objects to Date objects with <code>as.Date()</code></p>
</div>
</div>
<div id="exercise-2-o-horizon-thickness" class="section level2 hasAnchor" number="2.8">
<h2><span class="header-section-number">2.8</span> Exercise 2: O Horizon Thickness<a href="data.html#exercise-2-o-horizon-thickness" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This exercise uses a synthetic transect generated with R code. The 10 hypothetical pedons along the transect have been described using the a standardized set of horizon designations: Oe, Oa, A, Cg1, Cg2. The thicknesses of layers, the depth to gleyed matrix, and soil organic carbon content vary between pedons.</p>
<p>We will start to examine this dataset graphically, and then will utilize some functions defined for the <em>SoilProfileCollection</em> to extract information from the data.</p>
<p>Save the code you use in an R script, add answers as comments, and send to your mentor.</p>
<p><img src="s4ssbook_files/figure-html/unnamed-chunk-60-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The aqp function <code>thicknessOf()</code> can be used to calculate the thickness of horizons matching a regular expression pattern. For example, to calculate the total O horizon thickness we can match the pattern <code>"O"</code>:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb116-1"><a href="data.html#cb116-1" tabindex="-1"></a>ohz_thickness <span class="ot">&lt;-</span> <span class="fu">thicknessOf</span>(ohz, <span class="at">pattern =</span> <span class="st">&quot;O&quot;</span>, <span class="at">prefix =</span> <span class="st">&quot;O_&quot;</span>)</span>
<span id="cb116-2"><a href="data.html#cb116-2" tabindex="-1"></a>ohz_thickness</span></code></pre></div>
<pre><code>##      id O_thickness
## 1  P-01          23
## 2  P-02          40
## 3  P-03          37
## 4  P-04          42
## 5  P-05          24
## 6  P-06          45
## 7  P-07          43
## 8  P-08          33
## 9  P-09          47
## 10 P-10          42</code></pre>
<p>We will use the <code>site()</code> LEFT JOIN method to merge the calculated thickness into the <em>SoilProfileCollection</em>.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb118-1"><a href="data.html#cb118-1" tabindex="-1"></a><span class="fu">site</span>(ohz) <span class="ot">&lt;-</span> ohz_thickness</span></code></pre></div>
<p>Now, let’s plot the profiles in order of total O horizon thickness. We draw dashed lines at 20 and 40cm to indicate the thresholds for histic epipedon and Histosols soil order:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb119-1"><a href="data.html#cb119-1" tabindex="-1"></a><span class="fu">plotSPC</span>(ohz, <span class="at">plot.order =</span> <span class="fu">order</span>(ohz<span class="sc">$</span>O_thickness))</span>
<span id="cb119-2"><a href="data.html#cb119-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">40</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="s4ssbook_files/figure-html/unnamed-chunk-63-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Using the object <code>ohz</code> object we just inspected, answer the following questions using techniques from the previous sections. Check your logic by comparing to the profile sketch.</p>
<ol style="list-style-type: decimal">
<li><p>Check if any soil organic carbon values are <code>NA</code>. Make a profile sketch (<code>plotSPC()</code>) using organic carbon percentage (<code>"soc"</code>) to color the profiles. Then calculate a new column using the function <code>is.na()</code> and use that to color the profiles. Which profiles have missing data? In which horizons?</p></li>
<li><p>Tabulate unique horizon designations (<code>ohz$name</code>). How many of each horizon designation are present?</p></li>
<li><p>Use regular expressions to count the number of Cg horizons in the collection. How many Cg horizons have organic carbon data in the <code>"soc"</code> column?</p></li>
<li><p>Filter the <code>ohz</code> object using <code>aqp::subset()</code> to select pedons where <code>O_thickness</code> column is greater than <code>20</code> and less than <code>40</code>. This is the histic epipedon thickness requirement. How many pedons have a histic epipedon?</p></li>
<li><p>Filter the <code>ohz</code> object using <code>aqp::subset()</code> to select pedons where <code>O_thickness</code> column is greater than <code>40</code>. This is the Histosols order thickness requirement. How many pedons are Histosols?</p></li>
</ol>
</div>
<div id="generalized-horizon-labels" class="section level2 hasAnchor" number="2.9">
<h2><span class="header-section-number">2.9</span> Generalized Horizon Labels<a href="data.html#generalized-horizon-labels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>After review of the data, a new set of more general labels can be assigned to each horizon to define groups over which soil properties will be aggregated. These are called “Generalized Horizon Labels” (GHL). These new labels define functionally similar groups that usually span multiple genetic horizons.</p>
<p>Consider this situation: you have a collection of pedons that have been correlated to a named soil series or component. You would like to objectively compute a range in characteristics (“low-rv-high” values) and the typical range of horizon depths.</p>
<p>Most collections of pedon data have variation in description style and horizons used, horizon depths, and number of horizons described.</p>
<p><img src="static-figures/genhz-sketch.png" /></p>
<p>In the scenario depicted in the image above there are several obvious “micro-correlation” decisions that can be to group horizons for aggregation.</p>
<p>For example: what horizon prototype scheme (e.g., A-Bt1-Bt2-Bt3-Cr-R) best conveys the concept of this soil series or soil component? Does it make sense to group the Bt3, Bt4, BCt, and CBt horizons for aggregation? What about grouping Bt3 and 2Bt3 horizons? Do BA and AB horizons occur frequently enough to be included as their own group?</p>
<div id="formal-approach" class="section level3 hasAnchor" number="2.9.1">
<h3><span class="header-section-number">2.9.1</span> Formal Approach<a href="data.html#formal-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Generalized horizon labels are an aggregation strategy. Here is a basic outline of the process:</p>
<ol style="list-style-type: decimal">
<li><p>Select a set of GHL that best represents a group of pedons to be aggregated. This could be based on series descriptions, expert knowledge, or inspection of the most frequently described horizon designations.</p></li>
<li><p>Assign GHL to each horizon using whatever information is available for grouping horizons. This micro-correlation of horizon designations will often require slightly different rules for each dataset and group. Careful inspection of horizon designation and observed properties is critical.</p></li>
<li><p>Evaluate GHL assignments and manually refine as needed.</p></li>
<li><p>Keep track of final GHL assignments in NASIS (<code>dspcomplayerid</code>) column, an R script, or a text file.</p></li>
<li><p>Compute range in characteristics, aka low-rv-high values, for clay, sand, pH, etc. using the labels as grouping variables.</p></li>
<li><p>Estimate most likely top and bottom depths for each GHL group.</p></li>
</ol>
</div>
<div id="functions-for-handling-generalized-horizon-labels" class="section level3 hasAnchor" number="2.9.2">
<h3><span class="header-section-number">2.9.2</span> Functions for Handling Generalized Horizon Labels<a href="data.html#functions-for-handling-generalized-horizon-labels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The aqp package defines several functions that can be used to assign GHLs or summarize the data associated with them.</p>
<p>The function <code>generalize.hz()</code> can be used to apply new labels based on regular expression pattern matching. The function <code>GHL()</code> can be used to get or set the column containing generalized horizon labels for a <em>SoilProfileCollection</em>.</p>
<p>Exercise 4 in this chapter will let you work through the process of summarizing data using GHLs with your own data. But first we continue with tools to inspect your data retrieved from NASIS with soilDB. It is very important that basic QC/QA be performed on your data before proceeding with any statistical summaries.</p>
</div>
</div>
<div id="fetchnasis-data-checks" class="section level2 hasAnchor" number="2.10">
<h2><span class="header-section-number">2.10</span> <code>fetchNASIS()</code> data checks<a href="data.html#fetchnasis-data-checks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>fetchNASIS()</code> does a lot of the hard work for you by pulling out a variety of child tables and joining them to site/horizon tables.</p>
<p>This results in a <em>SoilProfileCollection</em> object that has many of the NASIS data columns. A variety of internal processes are performed to get data that conforms with site or horizon tables. Output is generated in the console that you should always look at.</p>
<p>We will walk through a few of the most common outputs.</p>
<p><em>Quality control and limited “filling” of fragments, horizon depth data, site data, tables</em></p>
<pre><code>replacing missing lower horizon depths with top depth + 1cm ... [19 horizons]
-&gt; QC: horizon errors detected:
    Use `get(&#39;bad.pedon.ids&#39;, envir=soilDB.env)` for pedon record IDs (peiid)
    Use `get(&#39;bad.horizons&#39;, envir=soilDB.env)` for horizon designations
-&gt; QC: pedons missing bottom hz depths:
    Use `get(&#39;missing.bottom.depths&#39;, envir=soilDB.env)` for pedon record IDs (peiid)</code></pre>
<p><em>Notes about default settings and handling of <code>NULL</code> (missing data elements or records)</em></p>
<pre><code>NOTE: all records are missing surface fragment cover
NOTE: all records are missing rock fragment volume</code></pre>
<div id="inspecting-results" class="section level3 hasAnchor" number="2.10.1">
<h3><span class="header-section-number">2.10.1</span> Inspecting Results<a href="data.html#inspecting-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will analyze occurrence of andic soil properties in pedons from MT647. This is a demonstration of inspecting a NASIS dataset by splitting it based on a specific diagnostic feature.</p>
<p>We will download a “selected set” from the course website from an <em>.rda</em> file to save you the effort of crafting your selected set just for this example.</p>
<p>Downloading and installing the <em>.rda</em> is equivalent to NASIS query <em>SSRO_Northwest: _PedonPC_Plus_DataDump_select</em> for User Site ID: <code>%MT647%</code>, NASIS Site: <code>SSRO_Northwest</code>, and NASIS Group: <code>NW-MIS Point Data</code>.</p>
<p>After populating your NASIS selected set <code>mt647</code> is created in R with <code>mt647 &lt;- fetchNASIS(rmHzErrors=TRUE)</code> and <code>mt647err</code> with <code>mt647err &lt;- fetchNASIS(rmHzErrors=FALSE)</code>. <code>rmHzErrors=FALSE</code> is the default behavior, we are creating two objects to demonstrate how to identify and fix common horizon errors.</p>
<div id="load-example-data" class="section level4 hasAnchor" number="2.10.1.1">
<h4><span class="header-section-number">2.10.1.1</span> Load Example Data<a href="data.html#load-example-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To load the sample object data into R, just use <code>load()</code> and the path to the <em>.rda</em> file. In this case we are using a remote path, so we use <code>url()</code> to open the connection:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb122-1"><a href="data.html#cb122-1" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">&quot;https://github.com/ncss-tech/stats_for_soil_survey/raw/master/data/book/02/mt647.rda&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="select-pedons-with-andic-soil-properties" class="section level3 hasAnchor" number="2.10.2">
<h3><span class="header-section-number">2.10.2</span> Select Pedons with Andic Soil Properties<a href="data.html#select-pedons-with-andic-soil-properties" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb123"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb123-1"><a href="data.html#cb123-1" tabindex="-1"></a><span class="fu">length</span>(mt647)</span></code></pre></div>
<pre><code>## [1] 481</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb125-1"><a href="data.html#cb125-1" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">site</span>(mt647)<span class="sc">$</span>andic.soil.properties, <span class="at">useNA =</span> <span class="st">&quot;ifany&quot;</span>)</span></code></pre></div>
<pre><code>## 
## FALSE  TRUE  &lt;NA&gt; 
##     2    83   396</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb127-1"><a href="data.html#cb127-1" tabindex="-1"></a><span class="co"># get just the profiles with andic.soil.properties == TRUE</span></span>
<span id="cb127-2"><a href="data.html#cb127-2" tabindex="-1"></a>mt647.asp <span class="ot">&lt;-</span> <span class="fu">subset</span>(mt647, andic.soil.properties)</span>
<span id="cb127-3"><a href="data.html#cb127-3" tabindex="-1"></a>mt647.asp</span></code></pre></div>
<pre><code>## SoilProfileCollection with 83 profiles and 446 horizons
## profile ID: peiid  |  horizon ID: phiid 
## Depth range: 20 - 305 cm
## 
## ----- Horizons (6 / 446 rows  |  10 / 77 columns) -----
##   peiid   phiid hzdept hzdepb hzname texture pedon_id dspcomplayerid bounddistinct boundtopo
##  828140 4005861      0      2     Oe    &lt;NA&gt;  P23-134           &lt;NA&gt;          &lt;NA&gt;      &lt;NA&gt;
##  828140 4005863      2     13      E   CBV-L  P23-134           &lt;NA&gt;         clear    smooth
##  828140 4005859     13     23    Bs1   CBV-L  P23-134           &lt;NA&gt;         clear    smooth
##  828140 4005862     23     33    Bs2   CBV-L  P23-134           &lt;NA&gt;       gradual    smooth
##  828140 4005864     33     69     BC GRX-FSL  P23-134           &lt;NA&gt;       gradual    smooth
##  828140 4005860     69    152     2C GRX-FSL  P23-134           &lt;NA&gt;          &lt;NA&gt;      &lt;NA&gt;
## [... more horizons ...]
## 
## ----- Sites (6 / 83 rows  |  10 / 132 columns) -----
##  siteiid  peiid ecositeid ecositenm ecositecorrdate es_classifier siteecositehistory.classifier es_selection_method
##   845415 828140      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##   845429 828152      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##   845430 828153      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##   845432 828155      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##   845434 828157      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##   845451 828176      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  upedonid siteobsiid
##   P23-134     821442
##   P92-052     821456
##   P92-046     821457
##   P93-053     821459
##   P91-103     821461
##   P89-011     821478
## [... more sites ...]
## 
## Spatial Data:
## [EMPTY]</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb129-1"><a href="data.html#cb129-1" tabindex="-1"></a><span class="fu">length</span>(mt647.asp)</span></code></pre></div>
<pre><code>## [1] 83</code></pre>
<p>We can compare this to what we see in the NASIS Pedon Diagnostic Features table:</p>
<p><img src="static-figures/ch2_mt647_asp_diagnostics.png" /></p>
<div id="using-fetchnasis-output-to-find-errors" class="section level4 hasAnchor" number="2.10.2.1">
<h4><span class="header-section-number">2.10.2.1</span> Using <code>fetchNASIS()</code> output to find errors<a href="data.html#using-fetchnasis-output-to-find-errors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Any profiles that have have logic errors detected are stored in <code>soilDB.env</code> <code>bad.pedon.ids</code> variable after you run <code>fetchNASIS</code>. If this variable does not exist either you have not run <code>fetchNASIS()</code> in the current session or there are no errors.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb131-1"><a href="data.html#cb131-1" tabindex="-1"></a><span class="co"># these are the troublesome user pedon IDs</span></span>
<span id="cb131-2"><a href="data.html#cb131-2" tabindex="-1"></a><span class="fu">get</span>(<span class="st">&#39;bad.pedon.ids&#39;</span>, <span class="at">envir =</span> soilDB.env)</span></code></pre></div>
<pre><code>##  [1] &quot;P93-037&quot; &quot;P90-008&quot; &quot;P90-004&quot; &quot;P90-009&quot; &quot;P93-058&quot; &quot;P93-059&quot; &quot;P90-025&quot; &quot;P90-002&quot; &quot;P90-012&quot; &quot;P92-001&quot; &quot;P92-085&quot;
## [12] &quot;P90-019&quot; &quot;P90-010&quot; &quot;P90-015&quot; &quot;P91-094&quot; &quot;P92-029&quot; &quot;P92-076&quot; &quot;P93-026&quot; &quot;P93-035&quot; &quot;P93-063&quot; &quot;P93-064&quot; &quot;P93-041&quot;
## [23] &quot;P93-043&quot; &quot;P93-044&quot; &quot;P93-083&quot; &quot;P93-112&quot; &quot;P93-113&quot; &quot;P93-124&quot; &quot;P93-001&quot; &quot;P96-007&quot; &quot;P91-025&quot; &quot;P93-078&quot; &quot;P92-044&quot;
## [34] &quot;P91-112&quot; &quot;P92-038&quot; &quot;P90-018&quot; &quot;P93-057&quot; &quot;P93-084&quot; &quot;P90-016&quot; &quot;P92-063&quot; &quot;P92-048&quot; &quot;P93-052&quot; &quot;F01-230&quot; &quot;F95-420&quot;
## [45] &quot;F95-114&quot; &quot;F96-205&quot; &quot;P75-006&quot; &quot;P91-105&quot; &quot;P91-059&quot;</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb133-1"><a href="data.html#cb133-1" tabindex="-1"></a><span class="co"># rmHzErrors=TRUE removes the &quot;bad&quot; illogical pedons</span></span>
<span id="cb133-2"><a href="data.html#cb133-2" tabindex="-1"></a><span class="fu">any</span>(mt647<span class="sc">$</span>upedonid <span class="sc">%in%</span> <span class="fu">get</span>(<span class="st">&#39;bad.pedon.ids&#39;</span>, <span class="at">envir=</span>soilDB.env))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb135-1"><a href="data.html#cb135-1" tabindex="-1"></a><span class="co"># mt647err is created with rmHzErrors=FALSE</span></span>
<span id="cb135-2"><a href="data.html#cb135-2" tabindex="-1"></a><span class="fu">any</span>(mt647err<span class="sc">$</span>upedonid <span class="sc">%in%</span> <span class="fu">get</span>(<span class="st">&#39;bad.pedon.ids&#39;</span>, <span class="at">envir=</span>soilDB.env))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb137-1"><a href="data.html#cb137-1" tabindex="-1"></a><span class="co"># mt647.asp is a subset of mt647, so  no errors</span></span>
<span id="cb137-2"><a href="data.html#cb137-2" tabindex="-1"></a><span class="fu">any</span>(mt647.asp<span class="sc">$</span>upedonid <span class="sc">%in%</span> <span class="fu">get</span>(<span class="st">&#39;bad.pedon.ids&#39;</span>, <span class="at">envir=</span>soilDB.env))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>When <code>fetchNASIS(..., rmHzErrors = TRUE)</code> any horizons that were omitted from the <em>SoilProfileCollection</em> will be stored in the <code>bad.horizons</code> variable in the <code>soilDB.env</code> environment.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb139-1"><a href="data.html#cb139-1" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">get</span>(<span class="st">&#39;bad.horizons&#39;</span>, <span class="at">envir=</span>soilDB.env))</span></code></pre></div>
<pre><code>##      peiid   phiid upedonid hzname hzdept hzdepb
## 67  868038 4270406  F01-230      E     NA     NA
## 68  868038 4270407  F01-230     Bw     NA     NA
## 95  868072 4270514  F95-114   &lt;NA&gt;     NA     NA
## 99  868048 4270437  F95-420   &lt;NA&gt;     NA     NA
## 111 868074 4270519  F96-205      B     NA     NA
## 112 868074 4270521  F96-205      C     NA     NA</code></pre>
</div>
<div id="logic-checks-for-the-soilprofilecollection" class="section level4 hasAnchor" number="2.10.2.2">
<h4><span class="header-section-number">2.10.2.2</span> Logic Checks for the <em>SoilProfileCollection</em><a href="data.html#logic-checks-for-the-soilprofilecollection" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The <code>aqp</code> package has several functions that do logic checks on <em>SoilProfileCollection</em> objects. The main method that does this in <code>aqp</code> is <code>checkHzDepthLogic()</code> which returns a data.frame of results of running four logic tests on the horizon data from each profile.</p>
<p>Checks for:</p>
<ol style="list-style-type: decimal">
<li><p>bottom depths less than top depth / bad top depth order (<code>"depthLogic"</code>)</p></li>
<li><p>bottom depths equal to top depth (<code>"sameDepth"</code>)</p></li>
<li><p>overlaps and gaps (<code>"overlapOrGap"</code>)</p></li>
<li><p>missing depths (<code>"missingDepth"</code>)</p></li>
</ol>
<div class="sourceCode" id="cb141"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb141-1"><a href="data.html#cb141-1" tabindex="-1"></a>logic_tests <span class="ot">&lt;-</span> <span class="fu">checkHzDepthLogic</span>(mt647err)</span>
<span id="cb141-2"><a href="data.html#cb141-2" tabindex="-1"></a></span>
<span id="cb141-3"><a href="data.html#cb141-3" tabindex="-1"></a><span class="co"># look at first few (look OK; valid == TRUE)</span></span>
<span id="cb141-4"><a href="data.html#cb141-4" tabindex="-1"></a><span class="fu">head</span>(logic_tests)</span></code></pre></div>
<pre><code>##    peiid valid depthLogic sameDepth missingDepth overlapOrGap
## 1 828138  TRUE      FALSE     FALSE        FALSE        FALSE
## 2 828139  TRUE      FALSE     FALSE        FALSE        FALSE
## 3 828140  TRUE      FALSE     FALSE        FALSE        FALSE
## 4 828141  TRUE      FALSE     FALSE        FALSE        FALSE
## 5 828142  TRUE      FALSE     FALSE        FALSE        FALSE
## 6 828143  TRUE      FALSE     FALSE        FALSE        FALSE</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb143-1"><a href="data.html#cb143-1" tabindex="-1"></a><span class="co"># these all have overlapOrGap errors</span></span>
<span id="cb143-2"><a href="data.html#cb143-2" tabindex="-1"></a><span class="fu">head</span>(logic_tests[<span class="sc">!</span>logic_tests<span class="sc">$</span>valid, ])</span></code></pre></div>
<pre><code>##     peiid valid depthLogic sameDepth missingDepth overlapOrGap
## 11 828148 FALSE      FALSE     FALSE        FALSE         TRUE
## 23 828160 FALSE      FALSE     FALSE        FALSE         TRUE
## 25 828162 FALSE      FALSE     FALSE        FALSE         TRUE
## 34 828171 FALSE      FALSE     FALSE        FALSE         TRUE
## 35 828172 FALSE      FALSE     FALSE        FALSE         TRUE
## 36 828173 FALSE      FALSE     FALSE        FALSE         TRUE</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb145-1"><a href="data.html#cb145-1" tabindex="-1"></a><span class="co"># join the logic test data into the site table</span></span>
<span id="cb145-2"><a href="data.html#cb145-2" tabindex="-1"></a><span class="fu">site</span>(mt647err) <span class="ot">&lt;-</span> logic_tests</span></code></pre></div>
<p>Use the <code>$valid</code> vector in result to select profiles with depth logic issues (<code>logic_tests$valid == FALSE</code>)</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb146-1"><a href="data.html#cb146-1" tabindex="-1"></a>bad.profiles <span class="ot">&lt;-</span> <span class="fu">subset</span>(mt647err, <span class="sc">!</span>valid)</span>
<span id="cb146-2"><a href="data.html#cb146-2" tabindex="-1"></a>bad.profiles</span></code></pre></div>
<pre><code>## SoilProfileCollection with 49 profiles and 338 horizons
## profile ID: peiid  |  horizon ID: phiid 
## Depth range: 15 - 152 cm
## 
## ----- Horizons (6 / 338 rows  |  10 / 77 columns) -----
##   peiid   phiid hzdept hzdepb hzname texture pedon_id dspcomplayerid bounddistinct boundtopo
##  828148 4005908      0      3     Oe    &lt;NA&gt;  P93-037           &lt;NA&gt;          &lt;NA&gt;      &lt;NA&gt;
##  828148 4005907      3      5     Oi    &lt;NA&gt;  P93-037           &lt;NA&gt;          &lt;NA&gt;      &lt;NA&gt;
##  828148 4005905      5     15      E  CB-FSL  P93-037           &lt;NA&gt;         clear    smooth
##  828148 4005911     15     23     Bs  CB-SIL  P93-037           &lt;NA&gt;        abrupt    smooth
##  828148 4005909     23     25     2E CBV-FSL  P93-037           &lt;NA&gt;         clear    smooth
##  828148 4005910     25     58     2B CBV-FSL  P93-037           &lt;NA&gt;       gradual    smooth
## [... more horizons ...]
## 
## ----- Sites (6 / 49 rows  |  10 / 137 columns) -----
##   peiid siteiid ecositeid ecositenm ecositecorrdate es_classifier siteecositehistory.classifier es_selection_method
##  828148  845423      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828160  845435      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828162  845437      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828171  845446      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828172  845447      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828173  845448      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  upedonid siteobsiid
##   P93-037     821450
##   P90-008     821462
##   P90-004     821464
##   P90-009     821473
##   P93-058     821474
##   P93-059     821475
## [... more sites ...]
## 
## Spatial Data:
## [EMPTY]</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb148-1"><a href="data.html#cb148-1" tabindex="-1"></a><span class="fu">length</span>(bad.profiles)</span></code></pre></div>
<pre><code>## [1] 49</code></pre>
<p>Alternately, we can keep only the “valid” ones (where <code>logic_tests$valid == TRUE</code>):</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb150-1"><a href="data.html#cb150-1" tabindex="-1"></a>good.profiles <span class="ot">&lt;-</span> <span class="fu">subset</span>(mt647err, logic_tests<span class="sc">$</span>valid)</span>
<span id="cb150-2"><a href="data.html#cb150-2" tabindex="-1"></a>good.profiles</span></code></pre></div>
<pre><code>## SoilProfileCollection with 481 profiles and 2536 horizons
## profile ID: peiid  |  horizon ID: phiid 
## Depth range: 14 - 1552 cm
## 
## ----- Horizons (6 / 2536 rows  |  10 / 77 columns) -----
##   peiid   phiid hzdept hzdepb hzname texture pedon_id dspcomplayerid bounddistinct boundtopo
##  828138 4005848      0      5      O    &lt;NA&gt;  P91-043           &lt;NA&gt;          &lt;NA&gt;      &lt;NA&gt;
##  828138 4005852      5     18      E    GR-L  P91-043           &lt;NA&gt;         clear    smooth
##  828138 4005850     18     38    Bw1   GRV-L  P91-043           &lt;NA&gt;       gradual      wavy
##  828138 4005849     38     51    Bw2 CBV-FSL  P91-043           &lt;NA&gt;       gradual      wavy
##  828138 4005853     51     71     BC  CBV-SL  P91-043           &lt;NA&gt;         clear      wavy
##  828138 4005851     71     81      R    &lt;NA&gt;  P91-043           &lt;NA&gt;          &lt;NA&gt;      &lt;NA&gt;
## [... more horizons ...]
## 
## ----- Sites (6 / 481 rows  |  10 / 137 columns) -----
##   peiid siteiid ecositeid ecositenm ecositecorrdate es_classifier siteecositehistory.classifier es_selection_method
##  828138  845413      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828139  845414      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828140  845415      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828141  845416      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828142  845417      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  828143  845418      &lt;NA&gt;      &lt;NA&gt;            &lt;NA&gt;          &lt;NA&gt;                          &lt;NA&gt;                &lt;NA&gt;
##  upedonid siteobsiid
##   P91-043     821440
##   P91-029     821441
##   P23-134     821442
##   P93-025     821443
##   P93-075     821444
##   P93-074     821445
## [... more sites ...]
## 
## Spatial Data:
## [EMPTY]</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb152-1"><a href="data.html#cb152-1" tabindex="-1"></a><span class="fu">length</span>(good.profiles)</span></code></pre></div>
<pre><code>## [1] 481</code></pre>
<p>Once you have created a subset <em>SoilProfileCollection</em>, you can manually inspect the data in that set to identify areas where there are issues. Ideally you would fix these in NASIS. If you don’t have the ability to fix them in NASIS, you might write some R code into your analysis script to apply patches to missing or invalid data before proceeding with summaries.</p>
</div>
</div>
</div>
<div id="extended-data-functions" class="section level2 hasAnchor" number="2.11">
<h2><span class="header-section-number">2.11</span> Extended Data Functions<a href="data.html#extended-data-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Additional data related to both site and horizon information can be fetched using the <a href="http://ncss-tech.github.io/soilDB/reference/get_extended_data_from_NASIS.html"><code>get_extended_data_from_NASIS()</code></a> function. This function returns a named <em>list</em> object with several tables that <code>fetchNASIS()</code> draws from.</p>
<p>There are a variety of calculated fields that are included in the default <code>fetchNASIS()</code> result based on these extended data. Sometimes you need to work with a less aggregated representation of the source data to chase down data issues.</p>
<div id="elements-of-get_extended_data_from_nasis" class="section level3 hasAnchor" number="2.11.1">
<h3><span class="header-section-number">2.11.1</span> Elements of <code>get_extended_data_from_NASIS()</code><a href="data.html#elements-of-get_extended_data_from_nasis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Ecological Site History (<code>"ecositehistory"</code>)</p></li>
<li><p>Diagnostic Features (<code>"diagnostic"</code>)</p></li>
<li><p>Diagnostic Feature <code>TRUE</code>/<code>FALSE</code> Summary (<code>"diagHzBoolean"</code>)</p></li>
<li><p>Restrictions (<code>"restriction"</code>)</p></li>
<li><p>Fragment and Texture Summaries</p>
<ul>
<li><p>Horizon Fragments (<code>"frag_summary"</code>)</p></li>
<li><p>Horizon Artifacts (<code>"art_summary"</code>)</p></li>
<li><p>Surface Fragments (<code>"surf_frag_summary"</code>)</p></li>
<li><p>Texture Class Modifiers (<code>"texmodifier"</code>)</p></li>
</ul></li>
<li><p>Geomorphic Table Summaries (<code>"geomorph"</code>)</p></li>
<li><p>Parent Material Summaries (<code>"pm"</code>)</p></li>
<li><p>Taxonomic History (<code>"taxhistory"</code>)</p></li>
<li><p>Site Text Notes w/ Photo links(<code>"photo"</code>)</p></li>
<li><p>Horizon Structure (<code>"struct"</code>)</p></li>
<li><p>Horizon Designation (<code>"hzdesgn"</code>)</p></li>
</ul>
</div>
<div id="load-example-data-1" class="section level3 hasAnchor" number="2.11.2">
<h3><span class="header-section-number">2.11.2</span> Load Example Data<a href="data.html#load-example-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Below is a summary of additional information that can be readily brought into R from your NASIS selected set via the <code>get_extended_data_from_NASIS()</code> function.</p>
<p>Before continuing, imagine opening the NASIS client, populating your selected set with <code>2015MT663%</code> using a query like “<em>NSSC Pangaea – POINT-Pedon/Site by User Pedon ID</em>”</p>
<p>Load the data like we did above.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb154-1"><a href="data.html#cb154-1" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">&quot;https://github.com/ncss-tech/stats_for_soil_survey/raw/master/data/book/02/mt663.rda&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb155"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb155-1"><a href="data.html#cb155-1" tabindex="-1"></a><span class="do">## fetch extended site and horizon data from local NASIS</span></span>
<span id="cb155-2"><a href="data.html#cb155-2" tabindex="-1"></a><span class="co"># mt663 &lt;- fetchNASIS()</span></span>
<span id="cb155-3"><a href="data.html#cb155-3" tabindex="-1"></a><span class="co"># mt663ext &lt;- get_extended_data_from_NASIS_db()</span></span></code></pre></div>
<p>We could use the <code>get_extended_data_from_NASIS_db()</code> function if <code>2015MT663%</code> or other data were in the selected set, but we will use the <code>mt663ext</code> data we loaded from the <em>.rda</em> file.</p>
<p>The column names are the names of variables that you could join to your site or horizon data by various means. Generally these variable names, with a few exceptions, mirror the <a href="https://www.nrcs.usda.gov/resources/education-and-teaching-materials/nasis-database-metadata">NASIS 7 data model names</a>.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb156-1"><a href="data.html#cb156-1" tabindex="-1"></a><span class="co"># site and pedon related extended data</span></span>
<span id="cb156-2"><a href="data.html#cb156-2" tabindex="-1"></a></span>
<span id="cb156-3"><a href="data.html#cb156-3" tabindex="-1"></a><span class="co"># list all dataframes in the extended data</span></span>
<span id="cb156-4"><a href="data.html#cb156-4" tabindex="-1"></a><span class="fu">str</span>(mt663ext, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## List of 14
##  $ ecositehistory:&#39;data.frame&#39;:  0 obs. of  7 variables:
##  $ siteaoverlap  :&#39;data.frame&#39;:  127 obs. of  5 variables:
##  $ diagnostic    :&#39;data.frame&#39;:  292 obs. of  4 variables:
##  $ diagHzBoolean :&#39;data.frame&#39;:  115 obs. of  20 variables:
##  $ restriction   :&#39;data.frame&#39;:  11 obs. of  8 variables:
##  $ frag_summary  :&#39;data.frame&#39;:  561 obs. of  18 variables:
##  $ art_summary   :&#39;data.frame&#39;:  561 obs. of  14 variables:
##  $ texmodifier   :&#39;data.frame&#39;:  622 obs. of  5 variables:
##  $ geomorph      :&#39;data.frame&#39;:  241 obs. of  9 variables:
##  $ taxhistory    :&#39;data.frame&#39;:  115 obs. of  23 variables:
##  $ photo         :&#39;data.frame&#39;:  793 obs. of  4 variables:
##  $ pm            :&#39;data.frame&#39;:  179 obs. of  9 variables:
##  $ struct        :&#39;data.frame&#39;:  444 obs. of  6 variables:
##  $ hzdesgn       :&#39;data.frame&#39;:  561 obs. of  19 variables:</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb158-1"><a href="data.html#cb158-1" tabindex="-1"></a><span class="co"># vegetation data summary</span></span>
<span id="cb158-2"><a href="data.html#cb158-2" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>ecositehistory) </span></code></pre></div>
<pre><code>## [1] &quot;siteiid&quot;                       &quot;ecositeid&quot;                     &quot;ecositenm&quot;                    
## [4] &quot;ecositecorrdate&quot;               &quot;es_classifier&quot;                 &quot;siteecositehistory.classifier&quot;
## [7] &quot;es_selection_method&quot;</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb160-1"><a href="data.html#cb160-1" tabindex="-1"></a><span class="co"># diagnostic features</span></span>
<span id="cb160-2"><a href="data.html#cb160-2" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>diagnostic) </span></code></pre></div>
<pre><code>## [1] &quot;peiid&quot;    &quot;featkind&quot; &quot;featdept&quot; &quot;featdepb&quot;</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb162-1"><a href="data.html#cb162-1" tabindex="-1"></a><span class="co"># surface rock fragments</span></span>
<span id="cb162-2"><a href="data.html#cb162-2" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>surf_frag_summary)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb164-1"><a href="data.html#cb164-1" tabindex="-1"></a><span class="co"># geomorphic description</span></span>
<span id="cb164-2"><a href="data.html#cb164-2" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>geomorph)</span></code></pre></div>
<pre><code>## [1] &quot;peiid&quot;          &quot;geomicrorelief&quot; &quot;geommicelev&quot;    &quot;geomfmod&quot;       &quot;geomfname&quot;      &quot;geomfeatid&quot;    
## [7] &quot;existsonfeat&quot;   &quot;geomfiidref&quot;    &quot;geomftname&quot;</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb166-1"><a href="data.html#cb166-1" tabindex="-1"></a><span class="co"># taxonomic history data</span></span>
<span id="cb166-2"><a href="data.html#cb166-2" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>taxhistory)</span></code></pre></div>
<pre><code>##  [1] &quot;peiid&quot;            &quot;classdate&quot;        &quot;classifier&quot;       &quot;classtype&quot;        &quot;taxonname&quot;        &quot;localphase&quot;      
##  [7] &quot;taxonkind&quot;        &quot;seriesstatus&quot;     &quot;taxclname&quot;        &quot;taxpartsize&quot;      &quot;taxorder&quot;         &quot;taxsuborder&quot;     
## [13] &quot;taxgrtgroup&quot;      &quot;taxsubgrp&quot;        &quot;soiltaxedition&quot;   &quot;osdtypelocflag&quot;   &quot;taxmoistcl&quot;       &quot;taxtempregime&quot;   
## [19] &quot;taxfamother&quot;      &quot;taxreaction&quot;      &quot;taxfamhahatmatcl&quot; &quot;psctopdepth&quot;      &quot;pscbotdepth&quot;</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb168-1"><a href="data.html#cb168-1" tabindex="-1"></a><span class="co"># linked photo stored in site textnotes</span></span>
<span id="cb168-2"><a href="data.html#cb168-2" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>photo) </span></code></pre></div>
<pre><code>## [1] &quot;siteiid&quot;   &quot;recdate&quot;   &quot;textcat&quot;   &quot;imagepath&quot;</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb170-1"><a href="data.html#cb170-1" tabindex="-1"></a><span class="co"># site parent materials</span></span>
<span id="cb170-2"><a href="data.html#cb170-2" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>pm)</span></code></pre></div>
<pre><code>## [1] &quot;siteiid&quot;    &quot;seqnum&quot;     &quot;pmorder&quot;    &quot;pmdept&quot;     &quot;pmdepb&quot;     &quot;pmmodifier&quot; &quot;pmgenmod&quot;   &quot;pmkind&quot;    
## [9] &quot;pmorigin&quot;</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb172-1"><a href="data.html#cb172-1" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb172-2"><a href="data.html#cb172-2" tabindex="-1"></a><span class="do">### horizon related extended data</span></span>
<span id="cb172-3"><a href="data.html#cb172-3" tabindex="-1"></a><span class="do">### </span></span>
<span id="cb172-4"><a href="data.html#cb172-4" tabindex="-1"></a></span>
<span id="cb172-5"><a href="data.html#cb172-5" tabindex="-1"></a><span class="co"># rock fragments </span></span>
<span id="cb172-6"><a href="data.html#cb172-6" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>frag_summary) </span></code></pre></div>
<pre><code>##  [1] &quot;phiid&quot;                &quot;fine_gravel&quot;          &quot;gravel&quot;               &quot;cobbles&quot;             
##  [5] &quot;stones&quot;               &quot;boulders&quot;             &quot;channers&quot;             &quot;flagstones&quot;          
##  [9] &quot;parafine_gravel&quot;      &quot;paragravel&quot;           &quot;paracobbles&quot;          &quot;parastones&quot;          
## [13] &quot;paraboulders&quot;         &quot;parachanners&quot;         &quot;paraflagstones&quot;       &quot;unspecified&quot;         
## [17] &quot;total_frags_pct_nopf&quot; &quot;total_frags_pct&quot;</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb174-1"><a href="data.html#cb174-1" tabindex="-1"></a><span class="co"># soil texture modifers</span></span>
<span id="cb174-2"><a href="data.html#cb174-2" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>texmodifier)</span></code></pre></div>
<pre><code>## [1] &quot;peiid&quot;  &quot;phiid&quot;  &quot;phtiid&quot; &quot;seqnum&quot; &quot;texmod&quot;</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb176-1"><a href="data.html#cb176-1" tabindex="-1"></a><span class="co"># soil structure data</span></span>
<span id="cb176-2"><a href="data.html#cb176-2" tabindex="-1"></a><span class="fu">colnames</span>(mt663ext<span class="sc">$</span>struct) </span></code></pre></div>
<pre><code>## [1] &quot;phiid&quot;         &quot;structgrade&quot;   &quot;structsize&quot;    &quot;structtype&quot;    &quot;structid&quot;      &quot;structpartsto&quot;</code></pre>
</div>
<div id="visualizing-common-landforms" class="section level3 hasAnchor" number="2.11.3">
<h3><span class="header-section-number">2.11.3</span> Visualizing Common Landforms<a href="data.html#visualizing-common-landforms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following code generates a simple graphical summary of the 10 most commonly occurring <code>"landform_string"</code> (a calculated field in <code>fetchNASIS()</code>) to inspect which are the most common.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb178-1"><a href="data.html#cb178-1" tabindex="-1"></a><span class="co"># load data from a NASIS selected set (or sample object)</span></span>
<span id="cb178-2"><a href="data.html#cb178-2" tabindex="-1"></a>pedons <span class="ot">&lt;-</span> mt663</span>
<span id="cb178-3"><a href="data.html#cb178-3" tabindex="-1"></a></span>
<span id="cb178-4"><a href="data.html#cb178-4" tabindex="-1"></a><span class="co"># create &#39;lf&#39; object of landform factors sorted in descending order</span></span>
<span id="cb178-5"><a href="data.html#cb178-5" tabindex="-1"></a>lf <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">table</span>(pedons<span class="sc">$</span>landform_string), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb178-6"><a href="data.html#cb178-6" tabindex="-1"></a></span>
<span id="cb178-7"><a href="data.html#cb178-7" tabindex="-1"></a><span class="co"># plot top 10 or length, whichever is shorter</span></span>
<span id="cb178-8"><a href="data.html#cb178-8" tabindex="-1"></a>Hmisc<span class="sc">::</span><span class="fu">dotchart2</span>(lf[<span class="dv">1</span><span class="sc">:</span><span class="fu">pmin</span>(<span class="dv">10</span>, <span class="fu">length</span>(lf))],</span>
<span id="cb178-9"><a href="data.html#cb178-9" tabindex="-1"></a>                 <span class="at">col =</span> <span class="st">&#39;black&#39;</span>,</span>
<span id="cb178-10"><a href="data.html#cb178-10" tabindex="-1"></a>                 <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(lf)),</span>
<span id="cb178-11"><a href="data.html#cb178-11" tabindex="-1"></a>                 <span class="at">cex.labels =</span> <span class="fl">0.75</span>)</span></code></pre></div>
<p><img src="s4ssbook_files/figure-html/owndata_c-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>For a challenge and to further inspect your own data try the above code with some other summaries of geomorphic data produced by <code>fetchNASIS()</code>.</p>
<p>You can swap <code>landform_string</code> for: <code>landscape_string</code> (landscape), <code>hillslopeprof</code> (2D), <code>geomposmntn</code>, <code>geomposhill</code>, <code>geompostrce</code>, <code>geomposflats</code> (3D), <code>slope_shape</code>, <code>shapeacross</code>, <code>shapedown</code> (slope shape across/down), <code>microfeature_string</code> (microfeature), or <code>geomicrorelief_string</code> (site observation microrelief).</p>
</div>
<div id="diagnostic-features" class="section level3 hasAnchor" number="2.11.4">
<h3><span class="header-section-number">2.11.4</span> Diagnostic Features<a href="data.html#diagnostic-features" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="boolean-diagnostic-features-in-fetchnasis" class="section level4 hasAnchor" number="2.11.4.1">
<h4><span class="header-section-number">2.11.4.1</span> Boolean Diagnostic Features in <code>fetchNASIS()</code><a href="data.html#boolean-diagnostic-features-in-fetchnasis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If diagnostic features are populated in the Pedon Diagnostic Features table in NASIS, then Boolean (<code>TRUE</code> or <code>FALSE</code>, or “logical”) fields are created for each diagnostic feature type found in the data brought in by <code>fetchNASIS</code>.</p>
<p>These fields can be used to model presence / absence of a diagnostic soil feature by extracting the site data from the <em>SoilProfileCollection</em> with <code>site()</code>.</p>
</div>
<div id="thickness-from-diagnostic-features-table" class="section level4 hasAnchor" number="2.11.4.2">
<h4><span class="header-section-number">2.11.4.2</span> Thickness from Diagnostic Features Table<a href="data.html#thickness-from-diagnostic-features-table" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The following is an example of how you could use the diagnostic features (if populated!) from the extended data to determine the thickness of a diagnostic feature of interest.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb179-1"><a href="data.html#cb179-1" tabindex="-1"></a><span class="co"># get diagnostic features associated with pedons loaded from selected set</span></span>
<span id="cb179-2"><a href="data.html#cb179-2" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">diagnostic_hz</span>(mt663)</span>
<span id="cb179-3"><a href="data.html#cb179-3" tabindex="-1"></a></span>
<span id="cb179-4"><a href="data.html#cb179-4" tabindex="-1"></a><span class="co"># summary of the diagnostic features in your data!</span></span>
<span id="cb179-5"><a href="data.html#cb179-5" tabindex="-1"></a><span class="fu">unique</span>(d<span class="sc">$</span>featkind)</span></code></pre></div>
<pre><code>##  [1] &quot;ochric epipedon&quot;          &quot;cambic horizon&quot;           &quot;lithic contact&quot;           &quot;mollic epipedon&quot;         
##  [5] &quot;argillic horizon&quot;         &quot;redox concentrations&quot;     &quot;andic soil properties&quot;    &quot;secondary carbonates&quot;    
##  [9] &quot;sapric soil materials&quot;    &quot;aquic conditions&quot;         &quot;reduced matrix&quot;           &quot;albic horizon&quot;           
## [13] &quot;spodic horizon&quot;           &quot;glossic horizon&quot;          &quot;spodic materials&quot;         &quot;lithologic discontinuity&quot;
## [17] &quot;densic materials&quot;         &quot;umbric epipedon&quot;          &quot;albic materials&quot;          NA</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb181-1"><a href="data.html#cb181-1" tabindex="-1"></a><span class="co"># tabulate</span></span>
<span id="cb181-2"><a href="data.html#cb181-2" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">table</span>(<span class="fu">droplevels</span>(<span class="fu">factor</span>(d<span class="sc">$</span>featkind))), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##          ochric epipedon           cambic horizon         argillic horizon          mollic epipedon 
##                       61                       54                       43                       42 
##    andic soil properties           lithic contact     secondary carbonates          umbric epipedon 
##                       30                       20                        7                        7 
##            albic horizon           spodic horizon          glossic horizon           reduced matrix 
##                        6                        4                        3                        3 
##    sapric soil materials lithologic discontinuity          albic materials         aquic conditions 
##                        3                        2                        1                        1 
##         densic materials     redox concentrations         spodic materials 
##                        1                        1                        1</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb183-1"><a href="data.html#cb183-1" tabindex="-1"></a><span class="co"># subset argillic horizons</span></span>
<span id="cb183-2"><a href="data.html#cb183-2" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[d<span class="sc">$</span>featkind <span class="sc">==</span> <span class="st">&#39;argillic horizon&#39;</span>, ]</span>
<span id="cb183-3"><a href="data.html#cb183-3" tabindex="-1"></a></span>
<span id="cb183-4"><a href="data.html#cb183-4" tabindex="-1"></a><span class="co"># create a new column and subtract the upper from the lower depth</span></span>
<span id="cb183-5"><a href="data.html#cb183-5" tabindex="-1"></a>d<span class="sc">$</span>argillic_thickness_cm <span class="ot">&lt;-</span> d<span class="sc">$</span>featdepb <span class="sc">-</span> d<span class="sc">$</span>featdept</span>
<span id="cb183-6"><a href="data.html#cb183-6" tabindex="-1"></a></span>
<span id="cb183-7"><a href="data.html#cb183-7" tabindex="-1"></a><span class="co"># create another new column with the upper depth to the diagnostic feature</span></span>
<span id="cb183-8"><a href="data.html#cb183-8" tabindex="-1"></a>d<span class="sc">$</span>depth_to_argillic_cm <span class="ot">&lt;-</span> d<span class="sc">$</span>featdept</span>
<span id="cb183-9"><a href="data.html#cb183-9" tabindex="-1"></a></span>
<span id="cb183-10"><a href="data.html#cb183-10" tabindex="-1"></a><span class="co"># omit NA values</span></span>
<span id="cb183-11"><a href="data.html#cb183-11" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(d)</span>
<span id="cb183-12"><a href="data.html#cb183-12" tabindex="-1"></a></span>
<span id="cb183-13"><a href="data.html#cb183-13" tabindex="-1"></a><span class="co"># subset to pedon records IDs and calculated thickness</span></span>
<span id="cb183-14"><a href="data.html#cb183-14" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[, <span class="fu">c</span>(<span class="st">&#39;peiid&#39;</span>, <span class="st">&#39;argillic_thickness_cm&#39;</span>, <span class="st">&#39;depth_to_argillic_cm&#39;</span>)]</span>
<span id="cb183-15"><a href="data.html#cb183-15" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<pre><code>##      peiid argillic_thickness_cm depth_to_argillic_cm
## 7  1092610                    56                   30
## 24 1092617                    38                   34
## 26 1092618                    29                   23
## 28 1092619                    38                   32
## 30 1092620                    29                   24
## 33 1092621                    23                   19</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb185-1"><a href="data.html#cb185-1" tabindex="-1"></a><span class="co"># left-join with existing site data</span></span>
<span id="cb185-2"><a href="data.html#cb185-2" tabindex="-1"></a><span class="fu">site</span>(mt663) <span class="ot">&lt;-</span> d</span>
<span id="cb185-3"><a href="data.html#cb185-3" tabindex="-1"></a></span>
<span id="cb185-4"><a href="data.html#cb185-4" tabindex="-1"></a><span class="co"># plot as histogram</span></span>
<span id="cb185-5"><a href="data.html#cb185-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb185-6"><a href="data.html#cb185-6" tabindex="-1"></a></span>
<span id="cb185-7"><a href="data.html#cb185-7" tabindex="-1"></a><span class="co"># note additional arguments to adjust figure labels</span></span>
<span id="cb185-8"><a href="data.html#cb185-8" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb185-9"><a href="data.html#cb185-9" tabindex="-1"></a>  mt663<span class="sc">$</span>argillic_thickness_cm, </span>
<span id="cb185-10"><a href="data.html#cb185-10" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&#39;Thickness of argillic (cm)&#39;</span>, </span>
<span id="cb185-11"><a href="data.html#cb185-11" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb185-12"><a href="data.html#cb185-12" tabindex="-1"></a>  <span class="at">las =</span> <span class="dv">1</span></span>
<span id="cb185-13"><a href="data.html#cb185-13" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="s4ssbook_files/figure-html/unnamed-chunk-75-1.png" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb186-1"><a href="data.html#cb186-1" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb186-2"><a href="data.html#cb186-2" tabindex="-1"></a>  mt663<span class="sc">$</span>depth_to_argillic_cm, </span>
<span id="cb186-3"><a href="data.html#cb186-3" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&#39;Depth to argillic top depth (cm)&#39;</span>, </span>
<span id="cb186-4"><a href="data.html#cb186-4" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&#39;&#39;</span>,</span>
<span id="cb186-5"><a href="data.html#cb186-5" tabindex="-1"></a>  <span class="at">las =</span> <span class="dv">1</span></span>
<span id="cb186-6"><a href="data.html#cb186-6" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="s4ssbook_files/figure-html/unnamed-chunk-75-2.png" width="576" style="display: block; margin: auto;" /></p>
<p>Quick check: <em>What can you do with the boolean diagnostic feature data stored in the site table of a <code>fetchNASIS()</code> SoilProfileCollection?</em></p>
</div>
<div id="diagnostic-feature-diagrams" class="section level4 hasAnchor" number="2.11.4.3">
<h4><span class="header-section-number">2.11.4.3</span> Diagnostic Feature Diagrams<a href="data.html#diagnostic-feature-diagrams" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb187"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb187-1"><a href="data.html#cb187-1" tabindex="-1"></a><span class="co"># work up diagnostic plot based on the mt663 dataset loaded above</span></span>
<span id="cb187-2"><a href="data.html#cb187-2" tabindex="-1"></a><span class="fu">library</span>(aqp)</span>
<span id="cb187-3"><a href="data.html#cb187-3" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb187-4"><a href="data.html#cb187-4" tabindex="-1"></a><span class="fu">library</span>(sharpshootR)</span>
<span id="cb187-5"><a href="data.html#cb187-5" tabindex="-1"></a></span>
<span id="cb187-6"><a href="data.html#cb187-6" tabindex="-1"></a><span class="co"># can limit which diagnostic features to show by setting &#39;v&#39; manually</span></span>
<span id="cb187-7"><a href="data.html#cb187-7" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;ochric.epipedon&#39;</span>, <span class="st">&#39;mollic.epipedon&#39;</span>, <span class="st">&#39;andic.soil.properties&#39;</span>, </span>
<span id="cb187-8"><a href="data.html#cb187-8" tabindex="-1"></a>       <span class="st">&#39;argillic.horizon&#39;</span>, <span class="st">&#39;cambic.horizon&#39;</span>, </span>
<span id="cb187-9"><a href="data.html#cb187-9" tabindex="-1"></a>       <span class="st">&#39;lithic.contact&#39;</span>)</span>
<span id="cb187-10"><a href="data.html#cb187-10" tabindex="-1"></a></span>
<span id="cb187-11"><a href="data.html#cb187-11" tabindex="-1"></a><span class="co"># the default concatenated landform_string may have multiple levels</span></span>
<span id="cb187-12"><a href="data.html#cb187-12" tabindex="-1"></a><span class="co">#  depending on how the geomorphic tables were populated</span></span>
<span id="cb187-13"><a href="data.html#cb187-13" tabindex="-1"></a><span class="co">#  these are concatenated using the ampersand (&amp;) character</span></span>
<span id="cb187-14"><a href="data.html#cb187-14" tabindex="-1"></a><span class="co">#  so take the first string split using ampersand as a delimiter</span></span>
<span id="cb187-15"><a href="data.html#cb187-15" tabindex="-1"></a>mt663<span class="sc">$</span>first_landform <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(mt663<span class="sc">$</span>landform_string, <span class="st">&quot;&amp;&quot;</span>), </span>
<span id="cb187-16"><a href="data.html#cb187-16" tabindex="-1"></a>                                  <span class="cf">function</span>(x) x[[<span class="dv">1</span>]])</span>
<span id="cb187-17"><a href="data.html#cb187-17" tabindex="-1"></a></span>
<span id="cb187-18"><a href="data.html#cb187-18" tabindex="-1"></a><span class="co"># plot with diagnostic features ordered according to co-occurrence</span></span>
<span id="cb187-19"><a href="data.html#cb187-19" tabindex="-1"></a><span class="co"># v: site-level attributes to consider</span></span>
<span id="cb187-20"><a href="data.html#cb187-20" tabindex="-1"></a><span class="co"># k: number of clusters to identify</span></span>
<span id="cb187-21"><a href="data.html#cb187-21" tabindex="-1"></a><span class="fu">diagnosticPropertyPlot</span>(</span>
<span id="cb187-22"><a href="data.html#cb187-22" tabindex="-1"></a>  mt663[<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, ], <span class="at">v =</span> v, <span class="at">k =</span> <span class="dv">5</span>,</span>
<span id="cb187-23"><a href="data.html#cb187-23" tabindex="-1"></a>  <span class="at">grid.label =</span> <span class="st">&#39;usiteid&#39;</span>, </span>
<span id="cb187-24"><a href="data.html#cb187-24" tabindex="-1"></a>  <span class="at">dend.label =</span> <span class="st">&#39;first_landform&#39;</span>, </span>
<span id="cb187-25"><a href="data.html#cb187-25" tabindex="-1"></a>  <span class="at">sort.vars =</span> <span class="cn">TRUE</span></span>
<span id="cb187-26"><a href="data.html#cb187-26" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="s4ssbook_files/figure-html/unnamed-chunk-76-1.png" width="864" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="exercise-3-diagnostic-horizons-in-your-own-data" class="section level2 hasAnchor" number="2.12">
<h2><span class="header-section-number">2.12</span> Exercise 3: Diagnostic Horizons in Your Own Data<a href="data.html#exercise-3-diagnostic-horizons-in-your-own-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Save the code you use in an R script, add answers as comments, and send to your mentor.</p>
<p>Use the following script to generate a diagnostic-feature diagram for the pedon data you’ve loaded from your NASIS selected set. Alternately, you may use the MT663 data from the example above, just substitute the object <code>mt663</code> for <code>f</code>.</p>
<p>You can select a subset of desired diagnostic properties or use all diagnostic feature columns.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb188-1"><a href="data.html#cb188-1" tabindex="-1"></a><span class="fu">library</span>(aqp)</span>
<span id="cb188-2"><a href="data.html#cb188-2" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb188-3"><a href="data.html#cb188-3" tabindex="-1"></a><span class="fu">library</span>(sharpshootR)</span>
<span id="cb188-4"><a href="data.html#cb188-4" tabindex="-1"></a></span>
<span id="cb188-5"><a href="data.html#cb188-5" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb188-6"><a href="data.html#cb188-6" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fetchNASIS</span>(<span class="at">from =</span> <span class="st">&#39;pedons&#39;</span>)</span>
<span id="cb188-7"><a href="data.html#cb188-7" tabindex="-1"></a></span>
<span id="cb188-8"><a href="data.html#cb188-8" tabindex="-1"></a><span class="co"># ... May need to use subset() to reduce the number of pedons!</span></span>
<span id="cb188-9"><a href="data.html#cb188-9" tabindex="-1"></a></span>
<span id="cb188-10"><a href="data.html#cb188-10" tabindex="-1"></a><span class="co"># get all diagnostic feature columns from site data </span></span>
<span id="cb188-11"><a href="data.html#cb188-11" tabindex="-1"></a><span class="co"># by pattern matching on &#39;[.]&#39; in the site attribute names</span></span>
<span id="cb188-12"><a href="data.html#cb188-12" tabindex="-1"></a><span class="co"># this is not a generic rule, but works here</span></span>
<span id="cb188-13"><a href="data.html#cb188-13" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&#39;[.]&#39;</span>, <span class="fu">siteNames</span>(f))</span>
<span id="cb188-14"><a href="data.html#cb188-14" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">siteNames</span>(f)[idx]</span>
<span id="cb188-15"><a href="data.html#cb188-15" tabindex="-1"></a></span>
<span id="cb188-16"><a href="data.html#cb188-16" tabindex="-1"></a><span class="co"># inspect v</span></span>
<span id="cb188-17"><a href="data.html#cb188-17" tabindex="-1"></a>v</span>
<span id="cb188-18"><a href="data.html#cb188-18" tabindex="-1"></a></span>
<span id="cb188-19"><a href="data.html#cb188-19" tabindex="-1"></a><span class="co"># insert diagnostics of interest from the possible list in &#39;v&#39;</span></span>
<span id="cb188-20"><a href="data.html#cb188-20" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;ochric.epipedon&#39;</span>, <span class="st">&#39;cambic.horizon&#39;</span>, </span>
<span id="cb188-21"><a href="data.html#cb188-21" tabindex="-1"></a>       <span class="st">&#39;argillic.horizon&#39;</span>, <span class="st">&#39;paralithic.contact&#39;</span>,</span>
<span id="cb188-22"><a href="data.html#cb188-22" tabindex="-1"></a>       <span class="st">&#39;lithic.contact&#39;</span>)</span>
<span id="cb188-23"><a href="data.html#cb188-23" tabindex="-1"></a></span>
<span id="cb188-24"><a href="data.html#cb188-24" tabindex="-1"></a><span class="co"># generate diagnostic property diagram</span></span>
<span id="cb188-25"><a href="data.html#cb188-25" tabindex="-1"></a><span class="fu">diagnosticPropertyPlot</span>(</span>
<span id="cb188-26"><a href="data.html#cb188-26" tabindex="-1"></a>  f, <span class="at">v =</span> v, <span class="at">k =</span> <span class="dv">5</span>, </span>
<span id="cb188-27"><a href="data.html#cb188-27" tabindex="-1"></a>  <span class="at">grid.label =</span> <span class="st">&#39;usiteid&#39;</span>, </span>
<span id="cb188-28"><a href="data.html#cb188-28" tabindex="-1"></a>  <span class="at">dend.label =</span> <span class="st">&#39;taxonname&#39;</span></span>
<span id="cb188-29"><a href="data.html#cb188-29" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Questions:</strong></p>
<p>Use the results of <code>site()</code>, <code>horizons()</code>, <code>diagnostic_hz()</code> to answer the following questions about your own data. These functions return data.frame objects from a SoilProfileCollection derived from your local NASIS data.</p>
<ol style="list-style-type: decimal">
<li><p>How many pedons do you have in your selected set? Check the number of rows in the site portion of the SoilProfileCollection with <code>nrow()</code>, or use the method <code>length()</code> on the collection.</p></li>
<li><p>How many diagnostic features do you have for those pedons? How many different <code>"featkind"</code>? You can calculate the number of unique values with with <code>length()</code> and <code>unique()</code></p></li>
<li><p>Interpret: What diagnostic features did you choose to plot? Did you notice any patterns in the diagnostic features that tend to occur together?</p></li>
</ol>
<p>For more information on generating diagnostic feature diagrams, see the following tutorial:</p>
<ul>
<li><a href="http://ncss-tech.github.io/AQP/sharpshootR/diagnostic-property-plot.html"><strong>Diagnostic Feature Property Plots</strong></a>.</li>
</ul>
</div>
<div id="custom-queries-to-local-nasis-database" class="section level2 hasAnchor" number="2.13">
<h2><span class="header-section-number">2.13</span> Custom Queries to Local NASIS Database<a href="data.html#custom-queries-to-local-nasis-database" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>fetchNASIS()</code> and related convenience functions are wrappers around commonly used chunks of SQL (Structured Query Language). Queries of the NASIS local database can be written in <a href="https://en.wikipedia.org/wiki/Transact-SQL">T-SQL</a> which is the dialect of <a href="https://en.wikipedia.org/wiki/SQL">SQL</a> used to communicate with Microsoft SQL Server. This is the connection that you set for the pre-course.</p>
<p>To create a <code>DBIConnection</code> object that can access the NASIS local database, use <code>dbConnectNASIS()</code> or simply <code>NASIS()</code>. This will look for an ODBC connection of the name <code>"nasis_local"</code> and will authenticate with the read-only credentials.</p>
<p>You can also pass an existing <code>DBIConnection</code> or path to SQLite file as the <code>dsn</code> argument to connect to an alternate source. The default driver type used for NASIS connections is <code>OdbcConnection</code> from the <code>odbc</code> package.</p>
<p>To query or execute SQL commands on a connection you created, you can use <code>dbGetQuery(connection, query)</code>, where <code>connection</code> is your <code>DBIConnection</code> object and <code>query</code> is the SQL to execute.</p>
<p>The soilDB package also includes a helper function <code>dbQueryNASIS()</code>, which functions just like <code>dbGetQuery()</code> except the default is to close the connection after returning the result. This can be convenient for interactive use or cases where a function needs to only execute a single query, as it will prevent you from leaving connections open accidentally.</p>
<div id="example-site-soil-temperature-data-from-ca792-sequoia-kings-canyon-national-park" class="section level3 hasAnchor" number="2.13.1">
<h3><span class="header-section-number">2.13.1</span> Example: Site Soil Temperature Data from CA792 (Sequoia-Kings Canyon National Park)<a href="data.html#example-site-soil-temperature-data-from-ca792-sequoia-kings-canyon-national-park" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following example will return all records in your selected set <code>sitesoiltemp</code> table, along with a couple of fields from the <code>site</code>, <code>siteobs</code>, and <code>pedon</code> tables. This is a convenient way to collect all of the field-based soil temperature data associated with the pedons in your selected set for further analysis.</p>
<p>You can use the CA792 (Sequoia-Kings Canyon National Park) pedons as an example. Use a query that searches user pedon ID for the following pattern <code>%CA792%</code> to download and populate a selected set in the NASIS client.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb189-1"><a href="data.html#cb189-1" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb189-2"><a href="data.html#cb189-2" tabindex="-1"></a></span>
<span id="cb189-3"><a href="data.html#cb189-3" tabindex="-1"></a><span class="co"># write query as a character string</span></span>
<span id="cb189-4"><a href="data.html#cb189-4" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="st">&quot;SELECT siteiid as siteiid, peiid, usiteid, obsdate, soitemp, soitempdep </span></span>
<span id="cb189-5"><a href="data.html#cb189-5" tabindex="-1"></a><span class="st">       FROM site_View_1</span></span>
<span id="cb189-6"><a href="data.html#cb189-6" tabindex="-1"></a><span class="st">       INNER JOIN siteobs_View_1 ON site_View_1.siteiid = siteobs_View_1.siteiidref</span></span>
<span id="cb189-7"><a href="data.html#cb189-7" tabindex="-1"></a><span class="st">       LEFT OUTER JOIN sitesoiltemp_View_1 ON siteobs_View_1.siteobsiid = sitesoiltemp_View_1.siteobsiidref</span></span>
<span id="cb189-8"><a href="data.html#cb189-8" tabindex="-1"></a><span class="st">       LEFT OUTER JOIN pedon_View_1 ON siteobs_View_1.siteobsiid = pedon_View_1.siteobsiidref</span></span>
<span id="cb189-9"><a href="data.html#cb189-9" tabindex="-1"></a><span class="st">      ORDER BY obsdate, siteiid;&quot;</span></span>
<span id="cb189-10"><a href="data.html#cb189-10" tabindex="-1"></a></span>
<span id="cb189-11"><a href="data.html#cb189-11" tabindex="-1"></a><span class="co"># setup connection to local NASIS</span></span>
<span id="cb189-12"><a href="data.html#cb189-12" tabindex="-1"></a>channel <span class="ot">&lt;-</span> <span class="fu">NASIS</span>()</span>
<span id="cb189-13"><a href="data.html#cb189-13" tabindex="-1"></a></span>
<span id="cb189-14"><a href="data.html#cb189-14" tabindex="-1"></a><span class="co"># exec query</span></span>
<span id="cb189-15"><a href="data.html#cb189-15" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">dbQueryNASIS</span>(channel, q)</span></code></pre></div>
<p>The functions <code>dbConnectNASIS()</code> (alias <code>NASIS()</code>) and <code>dbQueryNASIS()</code> allow you to create a connection to the NASIS local database and send queries to that connection, respectively. By default, <code>dbQueryNASIS()</code> will close your connection after completing the query; you can change this by setting <code>close=FALSE</code>.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r codeBlocks"><code class="sourceCode r"><span id="cb190-1"><a href="data.html#cb190-1" tabindex="-1"></a><span class="co"># check results</span></span>
<span id="cb190-2"><a href="data.html#cb190-2" tabindex="-1"></a><span class="fu">str</span>(d)</span>
<span id="cb190-3"><a href="data.html#cb190-3" tabindex="-1"></a></span>
<span id="cb190-4"><a href="data.html#cb190-4" tabindex="-1"></a><span class="co"># remove records missing values</span></span>
<span id="cb190-5"><a href="data.html#cb190-5" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(d)</span>
<span id="cb190-6"><a href="data.html#cb190-6" tabindex="-1"></a></span>
<span id="cb190-7"><a href="data.html#cb190-7" tabindex="-1"></a><span class="co"># tabulate unique soil depths</span></span>
<span id="cb190-8"><a href="data.html#cb190-8" tabindex="-1"></a><span class="fu">table</span>(d<span class="sc">$</span>soitempdep)</span>
<span id="cb190-9"><a href="data.html#cb190-9" tabindex="-1"></a></span>
<span id="cb190-10"><a href="data.html#cb190-10" tabindex="-1"></a><span class="co"># extract doy of year</span></span>
<span id="cb190-11"><a href="data.html#cb190-11" tabindex="-1"></a>d<span class="sc">$</span>doy <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(d<span class="sc">$</span>obsdate, <span class="st">&quot;%j&quot;</span>))</span>
<span id="cb190-12"><a href="data.html#cb190-12" tabindex="-1"></a></span>
<span id="cb190-13"><a href="data.html#cb190-13" tabindex="-1"></a><span class="co"># when where measurements collected?</span></span>
<span id="cb190-14"><a href="data.html#cb190-14" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb190-15"><a href="data.html#cb190-15" tabindex="-1"></a>  d<span class="sc">$</span>doy,</span>
<span id="cb190-16"><a href="data.html#cb190-16" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">366</span>),</span>
<span id="cb190-17"><a href="data.html#cb190-17" tabindex="-1"></a>  <span class="at">las =</span> <span class="dv">1</span>,</span>
<span id="cb190-18"><a href="data.html#cb190-18" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&#39;Soil Temperature Measurements&#39;</span>,</span>
<span id="cb190-19"><a href="data.html#cb190-19" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&#39;Day of Year&#39;</span></span>
<span id="cb190-20"><a href="data.html#cb190-20" tabindex="-1"></a>)</span>
<span id="cb190-21"><a href="data.html#cb190-21" tabindex="-1"></a></span>
<span id="cb190-22"><a href="data.html#cb190-22" tabindex="-1"></a><span class="co"># soil temperature by day of year</span></span>
<span id="cb190-23"><a href="data.html#cb190-23" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb190-24"><a href="data.html#cb190-24" tabindex="-1"></a>  soitemp <span class="sc">~</span> doy,</span>
<span id="cb190-25"><a href="data.html#cb190-25" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb190-26"><a href="data.html#cb190-26" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&#39;Soil Temperature Measurements (CA792)</span><span class="sc">\n</span><span class="st">NASIS &quot;Site Soil Temperature&quot; table&#39;</span>,</span>
<span id="cb190-27"><a href="data.html#cb190-27" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&#39;p&#39;</span>,</span>
<span id="cb190-28"><a href="data.html#cb190-28" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">21</span>, </span>
<span id="cb190-29"><a href="data.html#cb190-29" tabindex="-1"></a>  <span class="at">bg =</span> <span class="st">&#39;royalblue&#39;</span>,</span>
<span id="cb190-30"><a href="data.html#cb190-30" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">366</span>),</span>
<span id="cb190-31"><a href="data.html#cb190-31" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">26</span>),</span>
<span id="cb190-32"><a href="data.html#cb190-32" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&#39;Day of Year&#39;</span>,</span>
<span id="cb190-33"><a href="data.html#cb190-33" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&#39;Soil Temperature at 50cm (deg C)&#39;</span>,</span>
<span id="cb190-34"><a href="data.html#cb190-34" tabindex="-1"></a>  <span class="at">las =</span> <span class="dv">1</span></span>
<span id="cb190-35"><a href="data.html#cb190-35" tabindex="-1"></a>)</span>
<span id="cb190-36"><a href="data.html#cb190-36" tabindex="-1"></a></span>
<span id="cb190-37"><a href="data.html#cb190-37" tabindex="-1"></a><span class="co"># vernal equinox, summer solstice, autumnal equinox, winter solstice</span></span>
<span id="cb190-38"><a href="data.html#cb190-38" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&#39;2022-03-20&#39;</span>, <span class="st">&#39;2022-06-21&#39;</span>, <span class="st">&#39;2022-09-23&#39;</span>, <span class="st">&#39;2022-12-21&#39;</span>))</span>
<span id="cb190-39"><a href="data.html#cb190-39" tabindex="-1"></a></span>
<span id="cb190-40"><a href="data.html#cb190-40" tabindex="-1"></a><span class="co"># convert dates -&gt; Julian date, or day-of-year</span></span>
<span id="cb190-41"><a href="data.html#cb190-41" tabindex="-1"></a>doy <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(x, <span class="st">&quot;%j&quot;</span>))</span>
<span id="cb190-42"><a href="data.html#cb190-42" tabindex="-1"></a></span>
<span id="cb190-43"><a href="data.html#cb190-43" tabindex="-1"></a><span class="co"># add vertical lines</span></span>
<span id="cb190-44"><a href="data.html#cb190-44" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> doy, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="fu">grey</span>(<span class="fl">0.45</span>))</span>
<span id="cb190-45"><a href="data.html#cb190-45" tabindex="-1"></a></span>
<span id="cb190-46"><a href="data.html#cb190-46" tabindex="-1"></a><span class="co"># annotate</span></span>
<span id="cb190-47"><a href="data.html#cb190-47" tabindex="-1"></a><span class="co"># pos argument: left-center offset</span></span>
<span id="cb190-48"><a href="data.html#cb190-48" tabindex="-1"></a><span class="fu">text</span>(</span>
<span id="cb190-49"><a href="data.html#cb190-49" tabindex="-1"></a>  <span class="at">x =</span> doy, </span>
<span id="cb190-50"><a href="data.html#cb190-50" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb190-51"><a href="data.html#cb190-51" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&#39;vernal equinox&#39;</span>, <span class="st">&#39;summer solstice&#39;</span>, <span class="st">&#39;autumnal equinox&#39;</span>, <span class="st">&#39;winter solstice&#39;</span>), </span>
<span id="cb190-52"><a href="data.html#cb190-52" tabindex="-1"></a>  <span class="at">pos =</span> <span class="dv">2</span>,</span>
<span id="cb190-53"><a href="data.html#cb190-53" tabindex="-1"></a>  <span class="at">cex =</span> <span class="fl">0.75</span>,</span>
<span id="cb190-54"><a href="data.html#cb190-54" tabindex="-1"></a>  <span class="at">font =</span> <span class="dv">3</span></span>
<span id="cb190-55"><a href="data.html#cb190-55" tabindex="-1"></a>)</span>
<span id="cb190-56"><a href="data.html#cb190-56" tabindex="-1"></a></span>
<span id="cb190-57"><a href="data.html#cb190-57" tabindex="-1"></a><span class="co"># box/whisker plot showing distribution of day-of-year </span></span>
<span id="cb190-58"><a href="data.html#cb190-58" tabindex="-1"></a><span class="co"># when measurements (pedon descriptions) were collected</span></span>
<span id="cb190-59"><a href="data.html#cb190-59" tabindex="-1"></a><span class="fu">boxplot</span>(d<span class="sc">$</span>doy, <span class="at">at =</span> <span class="dv">26</span>, <span class="at">horizontal =</span> <span class="cn">TRUE</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&#39;white&#39;</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="static-figures/CA792-soil-temperature-example.png" /> +</p>
</div>
</div>
<div id="exercise-4-generalized-horizons-with-loafercreek" class="section level2 hasAnchor" number="2.14">
<h2><span class="header-section-number">2.14</span> Exercise 4: Generalized Horizons with Loafercreek<a href="data.html#exercise-4-generalized-horizons-with-loafercreek" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here we will introduce the concept of using regular expressions to apply “Generalized Horizon Labels” based on the field soil description horizon designations.</p>
<p>This demonstrates one way of grouping horizon data for determining the Range in Characteristics of layers within a Soil Series or a SSURGO component.</p>
<ul>
<li><a href="http://ncss-tech.github.io/stats_for_soil_survey/exercises/genhz_homework.html">Generalized Horizon Labels with Loafercreek</a></li>
</ul>
<p>For the exercise during class we will give you some time to read over the materials and apply the process to the sample <code>loafercreek</code> data. The code to apply the process to <code>loafercreek</code> is given. Then we ask that you apply the process to your own data, adjusting your generalized horizon patterns as needed for your local soils.</p>
<p>This may take more time than we have during class itself, so you should follow up as needed with your mentor to complete the exercise. Chapter 3 Exploratory Data Analysis will get deeper into some of the topics that are referenced in the <code>loafercreek</code> code, such as summary statistics on grouped data. You will send a table and profile plots to your mentor when you are done.</p>
<p>Further discussion of generalized horizon labels to order profiles based on horizon-level properties can be found in this tutorial:</p>
<ul>
<li><a href="http://ncss-tech.github.io/AQP/aqp/genhz-distance-eval.html">Pair-Wise Distances by Generalized Horizon Labels tutorial</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="eda.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["s4ssbook.pdf", "s4ssbook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
