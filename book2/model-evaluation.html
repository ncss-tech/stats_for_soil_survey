<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Model Evaluation | Statistics for Soil Survey - Part 2</title>
  <meta name="description" content="Web-based course content for Statistics for Soil Survey - Part 2 made with bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Model Evaluation | Statistics for Soil Survey - Part 2" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Web-based course content for Statistics for Soil Survey - Part 2 made with bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Model Evaluation | Statistics for Soil Survey - Part 2" />
  
  <meta name="twitter:description" content="Web-based course content for Statistics for Soil Survey - Part 2 made with bookdown::gitbook." />
  

<meta name="author" content="Soil Survey Staff" />


<meta name="date" content="2025-01-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="numerical-tax.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="../book/index.html">Statistics for Soil Survey - Part 1</a></li>
<li><a href="index.html">Statistics for Soil Survey - Part 2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Pre-course Assignment</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i><b>0.1</b> Setup</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#additional-reading"><i class="fa fa-check"></i><b>0.2</b> Additional Reading</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>1.1</b> Outline</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="model-evaluation.html"><a href="model-evaluation.html"><i class="fa fa-check"></i><b>2</b> Model Evaluation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="model-evaluation.html"><a href="model-evaluation.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="model-evaluation.html"><a href="model-evaluation.html#examples---dispersion"><i class="fa fa-check"></i><b>2.1.1</b> Examples - Dispersion</a></li>
<li class="chapter" data-level="2.1.2" data-path="model-evaluation.html"><a href="model-evaluation.html#examples---variation-and-certainty"><i class="fa fa-check"></i><b>2.1.2</b> Examples - Variation and Certainty</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="model-evaluation.html"><a href="model-evaluation.html#theory-of-uncertainty"><i class="fa fa-check"></i><b>2.2</b> Theory of Uncertainty</a></li>
<li class="chapter" data-level="2.3" data-path="model-evaluation.html"><a href="model-evaluation.html#resampling-to-estimate-uncertainty"><i class="fa fa-check"></i><b>2.3</b> Resampling to Estimate Uncertainty</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="model-evaluation.html"><a href="model-evaluation.html#examples---confidence-intervals"><i class="fa fa-check"></i><b>2.3.1</b> Examples - Confidence Intervals</a></li>
<li class="chapter" data-level="2.3.2" data-path="model-evaluation.html"><a href="model-evaluation.html#exercise-1"><i class="fa fa-check"></i><b>2.3.2</b> Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="model-evaluation.html"><a href="model-evaluation.html#performance-metrics"><i class="fa fa-check"></i><b>2.4</b> Performance Metrics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="model-evaluation.html"><a href="model-evaluation.html#regression-metrics"><i class="fa fa-check"></i><b>2.4.1</b> Regression Metrics</a></li>
<li class="chapter" data-level="2.4.2" data-path="model-evaluation.html"><a href="model-evaluation.html#examples"><i class="fa fa-check"></i><b>2.4.2</b> Examples</a></li>
<li class="chapter" data-level="2.4.3" data-path="model-evaluation.html"><a href="model-evaluation.html#exercise-2"><i class="fa fa-check"></i><b>2.4.3</b> Exercise 2</a></li>
<li class="chapter" data-level="2.4.4" data-path="model-evaluation.html"><a href="model-evaluation.html#categorical"><i class="fa fa-check"></i><b>2.4.4</b> Categorical</a></li>
<li class="chapter" data-level="2.4.5" data-path="model-evaluation.html"><a href="model-evaluation.html#examples-1"><i class="fa fa-check"></i><b>2.4.5</b> Examples</a></li>
<li class="chapter" data-level="2.4.6" data-path="model-evaluation.html"><a href="model-evaluation.html#exercise-3"><i class="fa fa-check"></i><b>2.4.6</b> Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="model-evaluation.html"><a href="model-evaluation.html#validation"><i class="fa fa-check"></i><b>2.5</b> Validation</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="model-evaluation.html"><a href="model-evaluation.html#internal-validation"><i class="fa fa-check"></i><b>2.5.1</b> Internal Validation</a></li>
<li class="chapter" data-level="2.5.2" data-path="model-evaluation.html"><a href="model-evaluation.html#external-validation"><i class="fa fa-check"></i><b>2.5.2</b> External Validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="numerical-tax.html"><a href="numerical-tax.html"><i class="fa fa-check"></i><b>3</b> Numerical Taxonomy and Ordination</a>
<ul>
<li class="chapter" data-level="3.1" data-path="numerical-tax.html"><a href="numerical-tax.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="numerical-tax.html"><a href="numerical-tax.html#objectives"><i class="fa fa-check"></i><b>3.1.1</b> Objectives</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="numerical-tax.html"><a href="numerical-tax.html#whirlwind-tour"><i class="fa fa-check"></i><b>3.2</b> Whirlwind Tour</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="numerical-tax.html"><a href="numerical-tax.html#similarity-disimilarty-and-distance"><i class="fa fa-check"></i><b>3.2.1</b> Similarity, Disimilarty, and Distance</a></li>
<li class="chapter" data-level="3.2.2" data-path="numerical-tax.html"><a href="numerical-tax.html#standardization-of-characteristics"><i class="fa fa-check"></i><b>3.2.2</b> Standardization of Characteristics</a></li>
<li class="chapter" data-level="3.2.3" data-path="numerical-tax.html"><a href="numerical-tax.html#missing-data"><i class="fa fa-check"></i><b>3.2.3</b> Missing Data</a></li>
<li class="chapter" data-level="3.2.4" data-path="numerical-tax.html"><a href="numerical-tax.html#visualizing-pair-wise-distances-the-dendrogram"><i class="fa fa-check"></i><b>3.2.4</b> Visualizing Pair-Wise Distances: The Dendrogram</a></li>
<li class="chapter" data-level="3.2.5" data-path="numerical-tax.html"><a href="numerical-tax.html#cluster-analysis-finding-groups-in-data"><i class="fa fa-check"></i><b>3.2.5</b> Cluster Analysis: Finding Groups in Data</a></li>
<li class="chapter" data-level="3.2.6" data-path="numerical-tax.html"><a href="numerical-tax.html#ordination-visualization-in-a-reduced-space"><i class="fa fa-check"></i><b>3.2.6</b> Ordination: Visualization in a Reduced Space</a></li>
<li class="chapter" data-level="3.2.7" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-soil-profiles"><i class="fa fa-check"></i><b>3.2.7</b> Pair-Wise Distances Between Soil Profiles</a></li>
<li class="chapter" data-level="3.2.8" data-path="numerical-tax.html"><a href="numerical-tax.html#final-discussion"><i class="fa fa-check"></i><b>3.2.8</b> Final Discussion</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="numerical-tax.html"><a href="numerical-tax.html#elaboration-with-examples"><i class="fa fa-check"></i><b>3.3</b> Elaboration with Examples</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="numerical-tax.html"><a href="numerical-tax.html#set-up-the-r-session"><i class="fa fa-check"></i><b>3.3.1</b> Set Up the R Session</a></li>
<li class="chapter" data-level="3.3.2" data-path="numerical-tax.html"><a href="numerical-tax.html#data-sources"><i class="fa fa-check"></i><b>3.3.2</b> Data Sources</a></li>
<li class="chapter" data-level="3.3.3" data-path="numerical-tax.html"><a href="numerical-tax.html#try-it"><i class="fa fa-check"></i><b>3.3.3</b> Try it!</a></li>
<li class="chapter" data-level="3.3.4" data-path="numerical-tax.html"><a href="numerical-tax.html#evaluating-missing-data"><i class="fa fa-check"></i><b>3.3.4</b> Evaluating Missing Data</a></li>
<li class="chapter" data-level="3.3.5" data-path="numerical-tax.html"><a href="numerical-tax.html#more-on-the-distance-matrix-and-how-to-make-one"><i class="fa fa-check"></i><b>3.3.5</b> More on the Distance Matrix and How to Make One</a></li>
<li class="chapter" data-level="3.3.6" data-path="numerical-tax.html"><a href="numerical-tax.html#thematic-distance-matrix-plots"><i class="fa fa-check"></i><b>3.3.6</b> Thematic Distance Matrix Plots</a></li>
<li class="chapter" data-level="3.3.7" data-path="numerical-tax.html"><a href="numerical-tax.html#hierachrical-clustering"><i class="fa fa-check"></i><b>3.3.7</b> Hierachrical Clustering</a></li>
<li class="chapter" data-level="3.3.8" data-path="numerical-tax.html"><a href="numerical-tax.html#centroid-and-medoid-partitioning-clustering-1"><i class="fa fa-check"></i><b>3.3.8</b> Centroid and Medoid (Partitioning) Clustering</a></li>
<li class="chapter" data-level="3.3.9" data-path="numerical-tax.html"><a href="numerical-tax.html#ordination"><i class="fa fa-check"></i><b>3.3.9</b> Ordination</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="numerical-tax.html"><a href="numerical-tax.html#practical-applications"><i class="fa fa-check"></i><b>3.4</b> Practical Applications</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-soil-profiles-1"><i class="fa fa-check"></i><b>3.4.1</b> Pair-Wise Distances Between Soil Profiles</a></li>
<li class="chapter" data-level="3.4.2" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-soil-series"><i class="fa fa-check"></i><b>3.4.2</b> Pair-Wise Distances Between Soil Series</a></li>
<li class="chapter" data-level="3.4.3" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-subgroup-level-taxa"><i class="fa fa-check"></i><b>3.4.3</b> Pair-Wise Distances Between Subgroup-Level Taxa</a></li>
<li class="chapter" data-level="3.4.4" data-path="numerical-tax.html"><a href="numerical-tax.html#soil-color-signatures"><i class="fa fa-check"></i><b>3.4.4</b> Soil Color Signatures</a></li>
<li class="chapter" data-level="3.4.5" data-path="numerical-tax.html"><a href="numerical-tax.html#clustering-of-soil-colors"><i class="fa fa-check"></i><b>3.4.5</b> Clustering of Soil Colors</a></li>
<li class="chapter" data-level="3.4.6" data-path="numerical-tax.html"><a href="numerical-tax.html#how-do-the-interpretations-compare"><i class="fa fa-check"></i><b>3.4.6</b> “How Do the Interpretations Compare?”</a></li>
<li class="chapter" data-level="3.4.7" data-path="numerical-tax.html"><a href="numerical-tax.html#mlra-concepts-via-climate-and-elevation-samples"><i class="fa fa-check"></i><b>3.4.7</b> MLRA Concepts via Climate and Elevation Samples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>4</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="linear-regression.html"><a href="linear-regression.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="linear-regression.html"><a href="linear-regression.html#linear-regression-example"><i class="fa fa-check"></i><b>4.2</b> Linear Regression Example</a></li>
<li class="chapter" data-level="4.3" data-path="linear-regression.html"><a href="linear-regression.html#data"><i class="fa fa-check"></i><b>4.3</b> Data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="linear-regression.html"><a href="linear-regression.html#henry-mount-database"><i class="fa fa-check"></i><b>4.3.1</b> Henry Mount Database</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-regression.html"><a href="linear-regression.html#aggregate-time-series"><i class="fa fa-check"></i><b>4.3.2</b> Aggregate Time Series</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-regression.html"><a href="linear-regression.html#final-dataset"><i class="fa fa-check"></i><b>4.3.3</b> Final Dataset</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-regression.html"><a href="linear-regression.html#spatial-data"><i class="fa fa-check"></i><b>4.4</b> Spatial data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="linear-regression.html"><a href="linear-regression.html#plot-coordinates"><i class="fa fa-check"></i><b>4.4.1</b> Plot Coordinates</a></li>
<li class="chapter" data-level="4.4.2" data-path="linear-regression.html"><a href="linear-regression.html#extracting-spatial-data"><i class="fa fa-check"></i><b>4.4.2</b> Extracting Spatial Data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-regression.html"><a href="linear-regression.html#exploratory-data-analysis-eda"><i class="fa fa-check"></i><b>4.5</b> Exploratory Data Analysis (EDA)</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="linear-regression.html"><a href="linear-regression.html#compare-samples-vs-population"><i class="fa fa-check"></i><b>4.5.1</b> Compare Samples vs Population</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="linear-regression.html"><a href="linear-regression.html#linear-modeling"><i class="fa fa-check"></i><b>4.6</b> Linear modeling</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="linear-regression.html"><a href="linear-regression.html#diagnostics"><i class="fa fa-check"></i><b>4.6.1</b> Diagnostics</a></li>
<li class="chapter" data-level="4.6.2" data-path="linear-regression.html"><a href="linear-regression.html#variable-selectionreduction"><i class="fa fa-check"></i><b>4.6.2</b> Variable selection/reduction</a></li>
<li class="chapter" data-level="4.6.3" data-path="linear-regression.html"><a href="linear-regression.html#final-model-accuracy-assessment"><i class="fa fa-check"></i><b>4.6.3</b> Final model &amp; accuracy assessment</a></li>
<li class="chapter" data-level="4.6.4" data-path="linear-regression.html"><a href="linear-regression.html#model-interpretation"><i class="fa fa-check"></i><b>4.6.4</b> Model Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="linear-regression.html"><a href="linear-regression.html#generate-spatial-predictions"><i class="fa fa-check"></i><b>4.7</b> Generate spatial predictions</a></li>
<li class="chapter" data-level="4.8" data-path="linear-regression.html"><a href="linear-regression.html#create-map"><i class="fa fa-check"></i><b>4.8</b> Create Map</a></li>
<li class="chapter" data-level="4.9" data-path="linear-regression.html"><a href="linear-regression.html#exercise"><i class="fa fa-check"></i><b>4.9</b> Exercise</a></li>
<li class="chapter" data-level="4.10" data-path="linear-regression.html"><a href="linear-regression.html#additional-reading-1"><i class="fa fa-check"></i><b>4.10</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>5</b> Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="glm.html"><a href="glm.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="glm.html"><a href="glm.html#logistic-regression"><i class="fa fa-check"></i><b>5.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="5.3" data-path="glm.html"><a href="glm.html#examples-2"><i class="fa fa-check"></i><b>5.3</b> Examples</a></li>
<li class="chapter" data-level="5.4" data-path="glm.html"><a href="glm.html#exercise-4"><i class="fa fa-check"></i><b>5.4</b> Exercise</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="glm.html"><a href="glm.html#load-packages"><i class="fa fa-check"></i><b>5.4.1</b> Load packages</a></li>
<li class="chapter" data-level="5.4.2" data-path="glm.html"><a href="glm.html#read-in-data"><i class="fa fa-check"></i><b>5.4.2</b> Read in data</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="glm.html"><a href="glm.html#exploratory-analysis-eda"><i class="fa fa-check"></i><b>5.5</b> Exploratory analysis (EDA)</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="glm.html"><a href="glm.html#data-wrangling"><i class="fa fa-check"></i><b>5.5.1</b> Data wrangling</a></li>
<li class="chapter" data-level="5.5.2" data-path="glm.html"><a href="glm.html#geomorphic-data"><i class="fa fa-check"></i><b>5.5.2</b> Geomorphic data</a></li>
<li class="chapter" data-level="5.5.3" data-path="glm.html"><a href="glm.html#soil-scientist-bias"><i class="fa fa-check"></i><b>5.5.3</b> Soil Scientist Bias</a></li>
<li class="chapter" data-level="5.5.4" data-path="glm.html"><a href="glm.html#plot-coordinates-1"><i class="fa fa-check"></i><b>5.5.4</b> Plot coordinates</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="glm.html"><a href="glm.html#exercise-1-view-the-data"><i class="fa fa-check"></i><b>5.6</b> Exercise 1: View the data</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="glm.html"><a href="glm.html#extracting-spatial-data-1"><i class="fa fa-check"></i><b>5.6.1</b> Extracting spatial data</a></li>
<li class="chapter" data-level="5.6.2" data-path="glm.html"><a href="glm.html#examine-spatial-data"><i class="fa fa-check"></i><b>5.6.2</b> Examine spatial data</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="glm.html"><a href="glm.html#constructing-the-model"><i class="fa fa-check"></i><b>5.7</b> Constructing the model</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="glm.html"><a href="glm.html#diagnostic"><i class="fa fa-check"></i><b>5.7.1</b> Diagnostic</a></li>
<li class="chapter" data-level="5.7.2" data-path="glm.html"><a href="glm.html#variable-selection-model-validation"><i class="fa fa-check"></i><b>5.7.2</b> Variable Selection &amp; model validation</a></li>
<li class="chapter" data-level="5.7.3" data-path="glm.html"><a href="glm.html#final-model-accuracy"><i class="fa fa-check"></i><b>5.7.3</b> Final model &amp; accuracy</a></li>
<li class="chapter" data-level="5.7.4" data-path="glm.html"><a href="glm.html#model-effects"><i class="fa fa-check"></i><b>5.7.4</b> Model effects</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="glm.html"><a href="glm.html#generate-spatial-predictions-1"><i class="fa fa-check"></i><b>5.8</b> Generate spatial predictions</a></li>
<li class="chapter" data-level="5.9" data-path="glm.html"><a href="glm.html#exercise-5"><i class="fa fa-check"></i><b>5.9</b> Exercise</a></li>
<li class="chapter" data-level="5.10" data-path="glm.html"><a href="glm.html#additional-reading-2"><i class="fa fa-check"></i><b>5.10</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tree-based-models.html"><a href="tree-based-models.html"><i class="fa fa-check"></i><b>6</b> Tree-based Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="tree-based-models.html"><a href="tree-based-models.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="tree-based-models.html"><a href="tree-based-models.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>6.2</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="tree-based-models.html"><a href="tree-based-models.html#getting-data-into-r-and-exporting-to-shapefile"><i class="fa fa-check"></i><b>6.2.1</b> Getting Data Into R and Exporting to Shapefile</a></li>
<li class="chapter" data-level="6.2.2" data-path="tree-based-models.html"><a href="tree-based-models.html#examining-data-in-r"><i class="fa fa-check"></i><b>6.2.2</b> Examining Data in R</a></li>
<li class="chapter" data-level="6.2.3" data-path="tree-based-models.html"><a href="tree-based-models.html#exercise-1-1"><i class="fa fa-check"></i><b>6.2.3</b> Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="tree-based-models.html"><a href="tree-based-models.html#classification-and-regression-trees-cart"><i class="fa fa-check"></i><b>6.3</b> Classification and Regression Trees (CART)</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="tree-based-models.html"><a href="tree-based-models.html#exercise-2-rpart"><i class="fa fa-check"></i><b>6.3.1</b> Exercise 2: rpart</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="tree-based-models.html"><a href="tree-based-models.html#random-forest"><i class="fa fa-check"></i><b>6.4</b> Random Forest</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="tree-based-models.html"><a href="tree-based-models.html#exercise-3-randomforest"><i class="fa fa-check"></i><b>6.4.1</b> Exercise 3: randomForest</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="tree-based-models.html"><a href="tree-based-models.html#prediction-using-tree-based-models"><i class="fa fa-check"></i><b>6.5</b> Prediction using Tree-based Models</a></li>
<li class="chapter" data-level="6.6" data-path="tree-based-models.html"><a href="tree-based-models.html#summary"><i class="fa fa-check"></i><b>6.6</b> Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html"><i class="fa fa-check"></i><b>A</b> Accuracy and Uncertainty for Categorical Predictions</a>
<ul>
<li class="chapter" data-level="A.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#status-quo"><i class="fa fa-check"></i><b>A.1</b> Status Quo</a></li>
<li class="chapter" data-level="A.2" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#theses"><i class="fa fa-check"></i><b>A.2</b> Theses</a></li>
<li class="chapter" data-level="A.3" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#soap-box-time"><i class="fa fa-check"></i><b>A.3</b> Soap Box Time</a></li>
<li class="chapter" data-level="A.4" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#concept-demonstration-via-simulated-data"><i class="fa fa-check"></i><b>A.4</b> Concept Demonstration via Simulated Data</a></li>
<li class="chapter" data-level="A.5" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#accuracy"><i class="fa fa-check"></i><b>A.5</b> Accuracy</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#confusion-matrix-area-under-roc"><i class="fa fa-check"></i><b>A.5.1</b> Confusion Matrix / Area Under ROC</a></li>
<li class="chapter" data-level="A.5.2" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#brier-scores"><i class="fa fa-check"></i><b>A.5.2</b> Brier Scores</a></li>
<li class="chapter" data-level="A.5.3" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#tau-and-weighted-tau-class-similarity"><i class="fa fa-check"></i><b>A.5.3</b> Tau and Weighted Tau (class-similarity)</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#uncertainty"><i class="fa fa-check"></i><b>A.6</b> Uncertainty</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#shanon-entropy"><i class="fa fa-check"></i><b>A.6.1</b> Shanon Entropy</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#review"><i class="fa fa-check"></i><b>A.7</b> Review</a></li>
<li class="chapter" data-level="A.8" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#example-implementation"><i class="fa fa-check"></i><b>A.8</b> Example Implementation</a></li>
<li class="chapter" data-level="A.9" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#resources"><i class="fa fa-check"></i><b>A.9</b> Resources</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#evaluating-accuracy-of-categorical-probabilistic-predictions"><i class="fa fa-check"></i><b>A.9.1</b> Evaluating Accuracy of Categorical / Probabilistic Predictions</a></li>
<li class="chapter" data-level="A.9.2" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#sampling-and-stability-of-estimates"><i class="fa fa-check"></i><b>A.9.2</b> Sampling and Stability of Estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="commentary-selecting-a-modeling-framework.html"><a href="commentary-selecting-a-modeling-framework.html"><i class="fa fa-check"></i><b>B</b> Commentary: Selecting a Modeling Framework</a>
<ul>
<li class="chapter" data-level="B.1" data-path="commentary-selecting-a-modeling-framework.html"><a href="commentary-selecting-a-modeling-framework.html#soil-temperature-regime-modeling-in-ca792"><i class="fa fa-check"></i><b>B.1</b> Soil Temperature Regime Modeling in CA792</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistics for Soil Survey - Part 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-evaluation" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Model Evaluation<a href="model-evaluation.html#model-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><img src="static-figures/logo.jpg" /></p>
<div id="introduction" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Introduction<a href="model-evaluation.html#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Validating and assessing the uncertainty of a model is just as, if not more important, than generating the model itself. Validation quantifies the model’s ability to explain variance in the data while uncertainty quantifies the confidence of model prediction. Uncertainty and validation assessments enable the end user to better understand model error, the nature and distribution of the input data, and the overall accuracy and spatial applicability of the model. Within a soil model, there are several sources of error:</p>
<ul>
<li>Measurement errors</li>
<li>Interpretation errors</li>
<li>Digitization errors</li>
<li>Classification errors</li>
<li>Generalization errors</li>
<li>Interpolation errors</li>
<li>Semantic errors</li>
</ul>
<p>Errors are simply the difference between reality and our representation of reality. Assessing the data structure with simple statistical measures such as mean, median and mode can be useful for understanding the central tendency of the data, but more complicated calculations are needed to get at dispersion or the variation of a property within a population to further assess error and uncertainty (Zar, 1999).</p>
<p><strong>Measure of Dispersion</strong></p>
<ul>
<li>Range: The difference between the highest and lowest values measured or observed. Not always reliable because it can include outliers, error, or misclassified data.</li>
<li>Quantiles: These refer to 25% increments in the rank of observations. Typically, the 25th and 75th quantiles are used to represent the spread of the most typical values around the central tendency.</li>
</ul>
<p><strong>Measure of Variation</strong> * Variance: The deviation of from the mean is calculated as sum of squares (SS) to use absolute deviation (eliminate any distinction between negative and positive correlation). <span class="math inline">\(variance (sample) = \frac{SS}{n-1}\)</span></p>
<ul>
<li><span class="math inline">\(SS = \sum{(X - x)^2}\)</span></li>
<li>Standard deviation: Used to return variance to the original units <span class="math inline">\(sd = \sqrt{\frac{SS}{n-1}}\)</span></li>
<li>Coefficient of variation: Scale standard deviation with mean so that multiple properties can be compared <span class="math inline">\(CV = \frac{SD}{x}\)</span></li>
</ul>
<p><strong>Measures of Certainty</strong></p>
<ul>
<li>Standard Error: represents the variance of the mean that would be found with repeated sampling. Estimated by dividing standard deviation by the square root of n. The concept of standard error is important for hypothesis testing.</li>
<li>Confidence interval: Interval in which you are confident that a given percentage (known as the confidence limit 95, 80, 75%) of the population lie. If a normal distribution is assumed, for a 95% confidence interval, it can be estimated that the value is 95% likely to fall between as SD * 1.96 +/- mean.</li>
</ul>
<div id="examples---dispersion" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Examples - Dispersion<a href="model-evaluation.html#examples---dispersion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Below is a simulated example demonstrating the affect of sample size and standard deviation on quantile estimates.</p>
<!-- I wonder if there is a more clear representation of what is going on here. For example  -->
<pre><code>## # A tibble: 8 × 5
## # Groups:   sd [2]
##   sd     n       med_min med_mean med_max
##   &lt;chr&gt;  &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
## 1 sd = 1 n = 10     6.31     7.06    7.79
## 2 sd = 1 n = 30     6.69     7.11    7.46
## 3 sd = 1 n = 60     6.76     7.02    7.30
## 4 sd = 1 n = 100    6.78     7.00    7.29
## 5 sd = 2 n = 10     5.38     6.93    7.82
## 6 sd = 2 n = 30     6.43     7.12    7.86
## 7 sd = 2 n = 60     6.52     7.01    7.60
## 8 sd = 2 n = 100    6.61     7.06    7.67</code></pre>
<p><img src="002-uncertainty_files/figure-html/unnamed-chunk-2-1.png" width="768" /></p>
<p>The results show that quantile estimates are more variable with smaller sample sizes and larger inherent standard deviations. This example demonstrates how our results would differ if we were to sample the same soils again. We would be “uncertain” of our results unless the underlying standard deviation is small or our sample size was large. Both factors would also impact how certain we could be that 2 or more classes of soils are different.</p>
</div>
<div id="examples---variation-and-certainty" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Examples - Variation and Certainty<a href="model-evaluation.html#examples---variation-and-certainty" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Demonstration of how to calculate variance.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="model-evaluation.html#cb2-1" tabindex="-1"></a><span class="co"># calculate the mean</span></span>
<span id="cb2-2"><a href="model-evaluation.html#cb2-2" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pH)</span>
<span id="cb2-3"><a href="model-evaluation.html#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="model-evaluation.html#cb2-4" tabindex="-1"></a><span class="co"># subtract mean from each value and square (i.e. residuals)</span></span>
<span id="cb2-5"><a href="model-evaluation.html#cb2-5" tabindex="-1"></a>test<span class="sc">$</span>S <span class="ot">&lt;-</span> (test<span class="sc">$</span>pH <span class="sc">-</span> mu)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb2-6"><a href="model-evaluation.html#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="model-evaluation.html#cb2-7" tabindex="-1"></a><span class="co"># calculate overall sum of squares</span></span>
<span id="cb2-8"><a href="model-evaluation.html#cb2-8" tabindex="-1"></a>SS <span class="ot">&lt;-</span> <span class="fu">sum</span>(test<span class="sc">$</span>S)</span>
<span id="cb2-9"><a href="model-evaluation.html#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="model-evaluation.html#cb2-10" tabindex="-1"></a><span class="co"># calculate standard deviation (length gives us the total number of sample/observations)</span></span>
<span id="cb2-11"><a href="model-evaluation.html#cb2-11" tabindex="-1"></a><span class="fu">sqrt</span>(SS <span class="sc">/</span> (<span class="fu">length</span>(test<span class="sc">$</span>pH) <span class="sc">-</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 1.572971</code></pre>
<p>Note below how our estimate of the variance can vary widely, particularly for simulated datasets with a inherent standard deviation of 2.</p>
<pre><code>## # A tibble: 8 × 5
## # Groups:   sd [2]
##   sd     n       sd2_min sd2_mean sd2_max
##   &lt;chr&gt;  &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
## 1 sd = 1 n = 10    0.535    0.934    1.33
## 2 sd = 1 n = 30    0.750    0.989    1.24
## 3 sd = 1 n = 60    0.830    0.967    1.17
## 4 sd = 1 n = 100   0.894    1.02     1.20
## 5 sd = 2 n = 10    0.768    2.07     3.22
## 6 sd = 2 n = 30    1.29     1.96     2.46
## 7 sd = 2 n = 60    1.65     1.99     2.37
## 8 sd = 2 n = 100   1.67     1.97     2.31</code></pre>
<p>Now let’s see Standard Error (standard deviation / square root of n) below. The results show how our estimates become more precise as the sample size increases.</p>
<pre><code>## # A tibble: 8 × 5
## # Groups:   sd [2]
##   sd     n       SE_min SE_mean SE_max
##   &lt;chr&gt;  &lt;fct&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 sd = 1 n = 10  0.169    0.295  0.420
## 2 sd = 1 n = 30  0.137    0.181  0.226
## 3 sd = 1 n = 60  0.107    0.125  0.150
## 4 sd = 1 n = 100 0.0894   0.102  0.120
## 5 sd = 2 n = 10  0.243    0.655  1.02 
## 6 sd = 2 n = 30  0.235    0.359  0.449
## 7 sd = 2 n = 60  0.213    0.257  0.306
## 8 sd = 2 n = 100 0.167    0.197  0.231</code></pre>
</div>
</div>
<div id="theory-of-uncertainty" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Theory of Uncertainty<a href="model-evaluation.html#theory-of-uncertainty" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>At it’s most basic level, uncertainty is simply a lack of certainty. In soil survey, uncertainty encompasses both of these aspects:</p>
<ol style="list-style-type: decimal">
<li>you’ve gathered multiple observations and you need to describe them in relation to one another, and</li>
<li>you must predict a property or characteristic at unobserved locations.</li>
</ol>
<p>It is difficult to quantify the knowledge we have about data and information uncertainty. While we may have good data of the accuracy of our GPS, how likely are we to include that in our estimates of model error? How important is it? In other disciplines, they spend a lot of time quantifying and tracking measurement error. In soil science, we tend to treat measurement as having an exact known location and value. Given the unknowns in mapping and predicting soil properties, this is a reasonable treatment of relatively small levels of error.</p>
<p>When using secondary information as data (or data that is actually a prior prediction or result of a model, including soil components), considering incorporated error can be crucial. One way to deal with this is through re-sampling an alternate way is to through error propagation theory. The most common way to deal with this in soil survey and digital soil mapping is to assess error through model validation.</p>
<p><strong>Explanatory vs. Predictive Modelling</strong></p>
<p>While explanatory and predictive modeling can use the same types of models, data and even questions, the errors and uncertainty are important for different reasons</p>
<p><strong>Explanatory or Descriptive</strong> - data are collected and analyzed in order to test causal hypothesis and observe correlations and relationships between data element. Often used at the beginning phases of soil-landscape exploration. How does the soil relate to each of the soil forming factors?</p>
<p><strong>Predictive</strong> - applying a model or algorithm to data for the purpose of making a prediction (in new or unknown locations) (Shueli, 2010).</p>
</div>
<div id="resampling-to-estimate-uncertainty" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Resampling to Estimate Uncertainty<a href="model-evaluation.html#resampling-to-estimate-uncertainty" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When calculating many basic statistical parameters, the assumption is that the data is parametric. That implies that the data is continuous (ratio or interval) and normally distributed. This is rarely the case with soil data. Soil properties are often not normally distributed (you cannot have less that 0% organic matter, for instance) and often we are trying to predict soil taxa or other nominal classes.</p>
<p>Re-sampling is a general term that defines any procedure to repeatedly draw samples form a given data-set. You are essentially pretending to collect a series of separate samples from your sample set then calculating a statistic on that sample. Re-sampling techniques can be used on known and unknown data distributions for uncertainty estimation and validation <span class="citation">(<a href="#ref-good2013">Good 2013</a>)</span>.</p>
<div id="examples---confidence-intervals" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Examples - Confidence Intervals<a href="model-evaluation.html#examples---confidence-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="model-evaluation.html#cb6-1" tabindex="-1"></a><span class="co"># this bootstrap is estimating the uncertainty associated with the variance of sas$pH_0.30_obs</span></span>
<span id="cb6-2"><a href="model-evaluation.html#cb6-2" tabindex="-1"></a><span class="co"># an example of getting a confidence interval through bootstrapping (no assumption of a normal distribution)</span></span>
<span id="cb6-3"><a href="model-evaluation.html#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="model-evaluation.html#cb6-4" tabindex="-1"></a><span class="co"># load the GSP Salt Affected Soil dataset</span></span>
<span id="cb6-5"><a href="model-evaluation.html#cb6-5" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/ncss-tech/stats_for_soil_survey/master/data/gsp_sas.csv&quot;</span></span>
<span id="cb6-6"><a href="model-evaluation.html#cb6-6" tabindex="-1"></a>sas <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url)</span>
<span id="cb6-7"><a href="model-evaluation.html#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="model-evaluation.html#cb6-8" tabindex="-1"></a>N   <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sas)</span>
<span id="cb6-9"><a href="model-evaluation.html#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="model-evaluation.html#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="model-evaluation.html#cb6-11" tabindex="-1"></a><span class="co"># abbreviate our data to simply the commands</span></span>
<span id="cb6-12"><a href="model-evaluation.html#cb6-12" tabindex="-1"></a>ph <span class="ot">&lt;-</span> <span class="fu">na.exclude</span>(sas<span class="sc">$</span>pH_0<span class="fl">.30</span>_obs)</span>
<span id="cb6-13"><a href="model-evaluation.html#cb6-13" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb6-14"><a href="model-evaluation.html#cb6-14" tabindex="-1"></a></span>
<span id="cb6-15"><a href="model-evaluation.html#cb6-15" tabindex="-1"></a><span class="co"># set number of iterations</span></span>
<span id="cb6-16"><a href="model-evaluation.html#cb6-16" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb6-17"><a href="model-evaluation.html#cb6-17" tabindex="-1"></a></span>
<span id="cb6-18"><a href="model-evaluation.html#cb6-18" tabindex="-1"></a><span class="co"># create a data frame to store the results</span></span>
<span id="cb6-19"><a href="model-evaluation.html#cb6-19" tabindex="-1"></a>boot_stats <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-20"><a href="model-evaluation.html#cb6-20" tabindex="-1"></a>  <span class="at">vars =</span> <span class="fu">numeric</span>(k),</span>
<span id="cb6-21"><a href="model-evaluation.html#cb6-21" tabindex="-1"></a>  <span class="at">means =</span> <span class="fu">numeric</span>(k)</span>
<span id="cb6-22"><a href="model-evaluation.html#cb6-22" tabindex="-1"></a>  )</span>
<span id="cb6-23"><a href="model-evaluation.html#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a href="model-evaluation.html#cb6-24" tabindex="-1"></a><span class="co"># for each instance (i) in the set from 1 to N (50 in this case)</span></span>
<span id="cb6-25"><a href="model-evaluation.html#cb6-25" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb6-26"><a href="model-evaluation.html#cb6-26" tabindex="-1"></a>  <span class="co"># create a new variable dB from each bootstrap sample of d</span></span>
<span id="cb6-27"><a href="model-evaluation.html#cb6-27" tabindex="-1"></a>  boot.sample <span class="ot">=</span> <span class="fu">sample</span>(ph, n, <span class="at">replace =</span> <span class="cn">TRUE</span>) </span>
<span id="cb6-28"><a href="model-evaluation.html#cb6-28" tabindex="-1"></a>  boot_stats<span class="sc">$</span>means[i] <span class="ot">=</span> <span class="fu">mean</span>(boot.sample)</span>
<span id="cb6-29"><a href="model-evaluation.html#cb6-29" tabindex="-1"></a>  boot_stats<span class="sc">$</span>vars[i]  <span class="ot">=</span> <span class="fu">var</span>(boot.sample)</span>
<span id="cb6-30"><a href="model-evaluation.html#cb6-30" tabindex="-1"></a>  }</span>
<span id="cb6-31"><a href="model-evaluation.html#cb6-31" tabindex="-1"></a></span>
<span id="cb6-32"><a href="model-evaluation.html#cb6-32" tabindex="-1"></a><span class="fu">quantile</span>(boot_stats<span class="sc">$</span>vars)</span></code></pre></div>
<pre><code>##        0%       25%       50%       75%      100% 
## 0.9108295 1.0228083 1.1424803 1.2628137 1.5688706</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="model-evaluation.html#cb8-1" tabindex="-1"></a><span class="fu">stripchart</span>(boot_stats<span class="sc">$</span>vars)</span></code></pre></div>
<p><img src="002-uncertainty_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="model-evaluation.html#cb9-1" tabindex="-1"></a><span class="co"># Traditional Approach</span></span>
<span id="cb9-2"><a href="model-evaluation.html#cb9-2" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-3"><a href="model-evaluation.html#cb9-3" tabindex="-1"></a>  <span class="co"># lower 5th</span></span>
<span id="cb9-4"><a href="model-evaluation.html#cb9-4" tabindex="-1"></a>  <span class="at">l =</span> <span class="fu">mean</span>(ph) <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sd</span>(ph) <span class="sc">/</span> <span class="fu">sqrt</span>(N),</span>
<span id="cb9-5"><a href="model-evaluation.html#cb9-5" tabindex="-1"></a>  <span class="co"># upper 95th</span></span>
<span id="cb9-6"><a href="model-evaluation.html#cb9-6" tabindex="-1"></a>  <span class="at">u =</span> <span class="fu">mean</span>(ph) <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> <span class="fu">sd</span>(ph) <span class="sc">/</span> <span class="fu">sqrt</span>(N)</span>
<span id="cb9-7"><a href="model-evaluation.html#cb9-7" tabindex="-1"></a>  )</span>
<span id="cb9-8"><a href="model-evaluation.html#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="model-evaluation.html#cb9-9" tabindex="-1"></a><span class="co"># Compare Bootstrap to Confidence Interval</span></span>
<span id="cb9-10"><a href="model-evaluation.html#cb9-10" tabindex="-1"></a><span class="fu">quantile</span>(boot_stats<span class="sc">$</span>means, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
<pre><code>##     2.5%    97.5% 
## 5.705315 6.236405</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="model-evaluation.html#cb11-1" tabindex="-1"></a>ci</span></code></pre></div>
<pre><code>##        l        u 
## 6.002983 6.024366</code></pre>
</div>
<div id="exercise-1" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Exercise 1<a href="model-evaluation.html#exercise-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Create a new R script.</p></li>
<li><p>Calculate a bootstrapped median, 10th percentile, and 90th percentile for <code>EC_0.30_obs</code>.</p></li>
<li><p>Calculate a traditional confidence interval for <code>EC_0.30_obs</code>.</p></li>
<li><p>Why is the traditional confidence interval so much narrower?</p></li>
<li><p>Forward you R script your instructor.</p></li>
</ol>
</div>
</div>
<div id="performance-metrics" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Performance Metrics<a href="model-evaluation.html#performance-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When evaluating a model, we need to estimate both it’s accuracy and precision. <strong>Accuracy</strong> estimates the ability of a measurement or prediction to match the actual or reference value of the quantity being measured. <strong>Precision</strong> in contrast estimates our ability to reproduce a measurement or prediction consistently. Typically people will refer to <strong>uncertainty</strong>, which is the inverse of precision.</p>
<p>Below is a summary of the various measures used to quantify accuracy and precision. The choice of metric depends on whether we are measuring or modeling continuous or categorical variables. In general, all models that estimate continuous variables are referred to as <strong>regression</strong> models. Sometimes regression models are referred too as <em>quantitative</em>, while categorical models are referred too as <em>qualitative</em>.</p>
<p><img src="static-figures/accuracy_vs_precision.png" /></p>
<div id="regression-metrics" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Regression Metrics<a href="model-evaluation.html#regression-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Bias:</strong></p>
<ul>
<li><strong>Mean Error (ME)/Prediction Error/Bias:</strong>
<ul>
<li>Description: Quantifies whether the overall error is <em>systematically</em> positive or negative; the closer to 0, the better.</li>
<li>Pro: In the same use as the original values</li>
</ul></li>
</ul>
<p><strong>Accuracy:</strong></p>
<ul>
<li><strong>Mean Square Error (MSE):</strong>
<ul>
<li>Description: Squared estimate of the average error size.</li>
<li>Con: Not in the same units as the original values.</li>
</ul></li>
<li><strong>Root Mean Square Error (RMSE):</strong>
<ul>
<li>Description: Positive estimate of the average error size; the smaller, the better.</li>
<li>Pro: In the same units as the original values.</li>
</ul></li>
<li><strong>Coefficient of Determination (R2):</strong>
<ul>
<li>Description: Represents the proportion of variance explained by the model.</li>
<li>Pro: Values range between 0 and 1. Values &lt; 0 can occur if the prediction is worse than simply predicting the average value.</li>
<li>Con: Over-optimistic when extreme values or skewed distributions are present. Often confused with the squared Pearson’s correlation coefficient (r2).</li>
<li>References: Kutner et al. 2004; <a href="http://mng.bz/ndYf">Zumel and Mount 2020</a></li>
</ul></li>
</ul>
<!-- The RMSE and bias figure is hard to understand without further explanation. Can we use colors in addition to line type? -->
<p><img src="002-uncertainty_files/figure-html/unnamed-chunk-10-1.png" width="672" /><img src="002-uncertainty_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<p><strong>Precision/Uncertainty:</strong></p>
<ul>
<li><strong>Standard Error (SE):</strong>
<ul>
<li>Description: Error in the model parameters (e.g., coefficients or overall prediction).</li>
</ul></li>
<li><strong>Confidence Interval (CI):</strong>
<ul>
<li>Description: Conversion of the SE to an interval according to a given probability (e.g., 95 percent); its range is narrower than the prediction interval.</li>
<li>Con: Assumes a normal distribution, unless transformed or bootstrapped.</li>
<li>References: Webster (2001)</li>
</ul></li>
<li><strong>Prediction Interval (PI):</strong>
<ul>
<li>Description: Interval designed to capture the range in values of a prediction according to a given probability.</li>
</ul></li>
<li><strong>Relative Prediction Interval (RPI):</strong>
<ul>
<li>Description: Ratio of the 95 percent prediction interval range to the 95 percent observed inter-quantile range in values. Can use different probability values (e.g., 90 percent PI to 90 percent inter-quantile range).
Pro: Typically ranges between 0 and 1; values larger than 1 indicate very high model uncertainty. No distribution assumptions.
References: Nauman and Duniway (2019)</li>
</ul></li>
</ul>
<p><img src="002-uncertainty_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="examples" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Examples<a href="model-evaluation.html#examples" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="model-evaluation.html#cb13-1" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb13-2"><a href="model-evaluation.html#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="model-evaluation.html#cb13-3" tabindex="-1"></a><span class="co"># Numeric accuracy metrics----</span></span>
<span id="cb13-4"><a href="model-evaluation.html#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="model-evaluation.html#cb13-5" tabindex="-1"></a><span class="co"># R2 ----</span></span>
<span id="cb13-6"><a href="model-evaluation.html#cb13-6" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">R2</span>(</span>
<span id="cb13-7"><a href="model-evaluation.html#cb13-7" tabindex="-1"></a>  <span class="at">pred =</span> sas<span class="sc">$</span>pH_0<span class="fl">.30</span>_pred, </span>
<span id="cb13-8"><a href="model-evaluation.html#cb13-8" tabindex="-1"></a>  <span class="at">obs  =</span> sas<span class="sc">$</span>pH_0<span class="fl">.30</span>_obs, </span>
<span id="cb13-9"><a href="model-evaluation.html#cb13-9" tabindex="-1"></a>  <span class="at">formula =</span> <span class="st">&quot;traditional&quot;</span>, </span>
<span id="cb13-10"><a href="model-evaluation.html#cb13-10" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb13-11"><a href="model-evaluation.html#cb13-11" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## [1] 0.8526782</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="model-evaluation.html#cb15-1" tabindex="-1"></a><span class="co"># RMSE ----</span></span>
<span id="cb15-2"><a href="model-evaluation.html#cb15-2" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">RMSE</span>(</span>
<span id="cb15-3"><a href="model-evaluation.html#cb15-3" tabindex="-1"></a>  <span class="at">pred =</span> sas<span class="sc">$</span>pH_0<span class="fl">.30</span>_pred, </span>
<span id="cb15-4"><a href="model-evaluation.html#cb15-4" tabindex="-1"></a>  <span class="at">obs  =</span> sas<span class="sc">$</span>pH_0<span class="fl">.30</span>_obs, </span>
<span id="cb15-5"><a href="model-evaluation.html#cb15-5" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb15-6"><a href="model-evaluation.html#cb15-6" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## [1] 0.4690274</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="model-evaluation.html#cb17-1" tabindex="-1"></a><span class="co"># Numeric precision/uncertainty metrics----</span></span>
<span id="cb17-2"><a href="model-evaluation.html#cb17-2" tabindex="-1"></a><span class="co"># R2 confidence interval</span></span>
<span id="cb17-3"><a href="model-evaluation.html#cb17-3" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;pH_0.30_pred&quot;</span>, <span class="st">&quot;pH_0.30_obs&quot;</span>)</span>
<span id="cb17-4"><a href="model-evaluation.html#cb17-4" tabindex="-1"></a>MBESS<span class="sc">::</span><span class="fu">ci.R2</span>(</span>
<span id="cb17-5"><a href="model-evaluation.html#cb17-5" tabindex="-1"></a>  <span class="at">R2 =</span> <span class="fl">0.85</span>, </span>
<span id="cb17-6"><a href="model-evaluation.html#cb17-6" tabindex="-1"></a>  <span class="at">N  =</span> <span class="fu">sum</span>(<span class="fu">complete.cases</span>(sas[vars])), </span>
<span id="cb17-7"><a href="model-evaluation.html#cb17-7" tabindex="-1"></a>  <span class="at">K  =</span> <span class="dv">1</span>, </span>
<span id="cb17-8"><a href="model-evaluation.html#cb17-8" tabindex="-1"></a>  <span class="at">conf.level =</span> <span class="fl">0.975</span></span>
<span id="cb17-9"><a href="model-evaluation.html#cb17-9" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb17-10"><a href="model-evaluation.html#cb17-10" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-11"><a href="model-evaluation.html#cb17-11" tabindex="-1"></a>  _[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)]</span></code></pre></div>
<pre><code>## Lower.Conf.Limit.R2 Upper.Conf.Limit.R2 
##           0.8462365           0.8536713</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="model-evaluation.html#cb19-1" tabindex="-1"></a><span class="co"># RMSE confidence interval</span></span>
<span id="cb19-2"><a href="model-evaluation.html#cb19-2" tabindex="-1"></a><span class="do">## Standard Error</span></span>
<span id="cb19-3"><a href="model-evaluation.html#cb19-3" tabindex="-1"></a>n  <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">complete.cases</span>(sas[vars]))</span>
<span id="cb19-4"><a href="model-evaluation.html#cb19-4" tabindex="-1"></a>SE <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">var</span>((sas<span class="sc">$</span>pH_0<span class="fl">.30</span>_obs <span class="sc">-</span> sas<span class="sc">$</span>pH_0<span class="fl">.30</span>_pred)<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> n)</span>
<span id="cb19-5"><a href="model-evaluation.html#cb19-5" tabindex="-1"></a>SE</span></code></pre></div>
<pre><code>## [1] 0.00541306</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="model-evaluation.html#cb21-1" tabindex="-1"></a><span class="do">## Confidence Interval</span></span>
<span id="cb21-2"><a href="model-evaluation.html#cb21-2" tabindex="-1"></a><span class="fl">0.47</span> <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> SE, SE)</span></code></pre></div>
<pre><code>## [1] 0.4645869 0.4754131</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="model-evaluation.html#cb23-1" tabindex="-1"></a><span class="co"># plot errors</span></span>
<span id="cb23-2"><a href="model-evaluation.html#cb23-2" tabindex="-1"></a></span>
<span id="cb23-3"><a href="model-evaluation.html#cb23-3" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sas), <span class="dv">100</span>)</span>
<span id="cb23-4"><a href="model-evaluation.html#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="model-evaluation.html#cb23-5" tabindex="-1"></a><span class="fu">ggplot</span>(sas[idx, ], <span class="fu">aes</span>(<span class="at">x =</span> pH_0<span class="fl">.30</span>_pred, <span class="at">y =</span> pH_0<span class="fl">.30</span>_obs)) <span class="sc">+</span></span>
<span id="cb23-6"><a href="model-evaluation.html#cb23-6" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-7"><a href="model-evaluation.html#cb23-7" tabindex="-1"></a>  <span class="co"># draw a 1 to 1 line</span></span>
<span id="cb23-8"><a href="model-evaluation.html#cb23-8" tabindex="-1"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span></span>
<span id="cb23-9"><a href="model-evaluation.html#cb23-9" tabindex="-1"></a>  <span class="co"># draw a linear fit; method = &quot;lm&quot;</span></span>
<span id="cb23-10"><a href="model-evaluation.html#cb23-10" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p><img src="002-uncertainty_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="model-evaluation.html#cb24-1" tabindex="-1"></a><span class="fu">ggplot</span>(sas, <span class="fu">aes</span>(<span class="at">x =</span> pH_0<span class="fl">.30</span>_pred, <span class="at">y =</span> pH_0<span class="fl">.30</span>_obs)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="model-evaluation.html#cb24-2" tabindex="-1"></a>  <span class="co"># use a hex geom if there are too many points and they overlap</span></span>
<span id="cb24-3"><a href="model-evaluation.html#cb24-3" tabindex="-1"></a>  <span class="fu">geom_hex</span>() <span class="sc">+</span></span>
<span id="cb24-4"><a href="model-evaluation.html#cb24-4" tabindex="-1"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span></span>
<span id="cb24-5"><a href="model-evaluation.html#cb24-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<p><img src="002-uncertainty_files/figure-html/unnamed-chunk-12-2.png" width="672" /></p>
</div>
<div id="exercise-2" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Exercise 2<a href="model-evaluation.html#exercise-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Append the following exercises to your previous R script.</p></li>
<li><p>Compare the traditional <span class="math inline">\(R^2\)</span> to the alternative <span class="math inline">\(R^2\)</span> for <code>EC_0.30_obs</code> vs <code>EC_0.30_pred</code>?</p></li>
<li><p>Calculate the <code>RMSE()</code> and <code>MAE()</code>for <code>EC_0.30_obs</code> vs <code>EC_0.30_pred</code>?</p></li>
<li><p>Plot a hex bin scatterplot of <code>EC_0.30_obs</code> vs <code>EC_0.30_pred</code> with a linear smoother.</p></li>
<li><p>Forward you R script your instructor.</p></li>
</ol>
</div>
<div id="categorical" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Categorical<a href="model-evaluation.html#categorical" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="probability-based-metrics-threshold-independent" class="section level4 hasAnchor" number="2.4.4.1">
<h4><span class="header-section-number">2.4.4.1</span> Probability-based metrics (threshold-independent)<a href="model-evaluation.html#probability-based-metrics-threshold-independent" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Beware the <span class="math inline">\(D^2\)</span>, Tjur’s D, and AUC (or c-statistic) only apply to binary classes.</p>
<p><strong>Accuracy:</strong></p>
<ul>
<li><strong>Brier Score (BS):</strong>
<ul>
<li>Description: In the case of binary outcomes (e.g., 1 vs. 0), it is equivalent to the Mean Square Error, where a positive outcome equals 1 minus the predicted probability. For multinomial outcomes, the squared error is averaged for all classes. Lower values denote higher accuracy.</li>
<li>Pro: Integrates more information about predictions (all probabilities) vs. the most likely class used by overall accuracy or tau index.</li>
<li>Con: Does not incorporate prior knowledge of class proportions. Does not incorporate class similarity.</li>
<li>References: Brier (1950); Harrell (2015); Steyerberg (2019)</li>
</ul></li>
<li><strong>Deviance Squared (D2) or Pseudo R2:</strong>
<ul>
<li>Description: The proportion of deviance explained.</li>
<li>Pro: Values range between 0 and 1. Values &lt; 0 can occur if the prediction is worse than simply predicting the average value.</li>
<li>Con: Over-optimistic when extreme values or skewed distributions are present.</li>
</ul></li>
<li><strong>Coefficient of Discrimination (or Tjur’s D):</strong>
<ul>
<li>Description: Difference in average probability of true positives and true negatives. It is another alternative version of D2 or Pseudo R2.</li>
<li>Pro: Values range between 0 and 1.</li>
<li>References: Tjur (2013)</li>
</ul></li>
<li><strong>Concordance (c) Statistic or Area Under the Curve (AUC):</strong>
<ul>
<li>Description: Probability that a binary classifier does better than random chance. The area under the receiver operator characteristic curve.</li>
<li>Pro: Values range between 0.5 and 1.</li>
<li>Con: Less sensitive than D2.</li>
<li>References: Hand (2012); Harrell (2015)</li>
</ul></li>
</ul>
<p><strong>Precision/Uncertainty:</strong></p>
<ul>
<li><strong>Shannon entropy:</strong>
<ul>
<li>Description: Quantitative measure of “information,” “complexity,” “certainty,” or “diversity” contained within a vector of probabilities. Larger values denote less information, higher complexity, less certainty, and greater diversity.</li>
<li>Pro: Integrates “confusion” over all probabilities. Entropy values from different models (e.g., differing numbers of classes) can be directly compared.</li>
<li>Con: Does not incorporate the similarity between classes.</li>
<li>References: Shannon (1948)</li>
</ul></li>
<li><strong>Normalized Shannon Entropy:</strong>
<ul>
<li>Description: An alternate version of Shannon Entropy that is constrained to the interval [0,1].</li>
<li>Pro: Integrates “confusion” over all probabilities. Constrained to [0,1].</li>
<li>Con: Cannot be used to compare models with differing numbers of classes. May not be implemented in all software packages.</li>
<li>References: Kempen et al. (2009)</li>
</ul></li>
<li><strong>Confusion Index:</strong>
<ul>
<li>Description: An index of confusion among the top two most likely classes.</li>
<li>Pro: Simple calculation and constrained to [0,1].</li>
<li>Con: Cannot be used to compare models with differing numbers of classes. Only describes uncertainty of top two classes. May not be implemented in all software packages.</li>
<li>References: Burrough et al. (1997)</li>
</ul></li>
</ul>
</div>
<div id="class-based-metrics" class="section level4 hasAnchor" number="2.4.4.2">
<h4><span class="header-section-number">2.4.4.2</span> Class-based metrics<a href="model-evaluation.html#class-based-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>These metrics are derivatives of the confusion matrix <span class="citation">(<a href="#ref-congalton2019">Congalton and Green 2019a</a>; <a href="#ref-fielding_review_1997">Fielding and Bell 1997</a>; <a href="#ref-kuhn2013">Kuhn and Johnson 2013</a>)</span> (<code>caret::confusionMatrix()</code>)</p>
<p>Beware, measures like overall accuracy and row-wise metrics of the confusion matrix (e.g. user accuracy) are dependent on the prevalence (i.e frequency) of observation in the surveyed area. For example, if dissimilar soils, such as hydric soils, are an inclusions (e.g. 5%) within a survey area, even a poor model could have a overall accuracy of 95%, because small classes by their vary nature don’t contribute significantly to the overall model error. Row-wise metrics by comparison are similarly are impacted by the prevalence or areal extent of soils. Again, more prevalence classes by their vary nature are more likely to be found. The consequence of this is their values are relative to the survey area from which they’re derived <span class="citation">(<a href="#ref-foody_assessing_2010">Foody 2010</a>; <a href="#ref-kuhn2013">Kuhn and Johnson 2013</a>, <a href="#ref-kuhn_feature_2019">2019</a>; <a href="#ref-eisenberg_accuracy_1995">Eisenberg 1995</a>; <a href="#ref-simon_sensitivity_1990">Simon and Boring 1990</a>)</span>. If the model were extrapolated to an new area or the existing area were subdivided, and the underlying prevalence of classes changed, the row-wise metrics would also be affected. The same is not true for column-wise metrics, because they are conditional on the class being true. Alternative calculations exist for row-wise accuracy that corrects for prevalence, such as the positive predictive value (PPV) and negative predictive value (NPV), which are available via the <code>caret::confusionMatrix</code> function. Similar named functions exist in other R packages, but don’t incorporate the prevalence corrected calculations.</p>
<table>
<colgroup>
<col width="24%" />
<col width="25%" />
<col width="26%" />
<col width="24%" />
</colgroup>
<thead>
<tr class="header">
<th>Confusion Matrix</th>
<th>Observed</th>
<th></th>
<th>Metric</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Predicted</strong></td>
<td>No</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>No</td>
<td>True Negative (TN)</td>
<td>False Negative (FN)</td>
<td>NPV/ UA</td>
</tr>
<tr class="odd">
<td>Yes</td>
<td>False Positive (FP)</td>
<td>True Positive (TP)</td>
<td>PPV/ Precision / UA</td>
</tr>
<tr class="even">
<td>——————-</td>
<td>——————–</td>
<td>———————</td>
<td>——————-</td>
</tr>
<tr class="odd">
<td>Metric</td>
<td>Specificity / PA</td>
<td>Sensitivity / PA</td>
<td>Overall</td>
</tr>
</tbody>
</table>
<p><strong>Accuracy:</strong></p>
<ul>
<li><strong>Overall Accuracy:</strong>
<ul>
<li>Description: The proportion of correctly classified observations as tabulated in the confusion matrix.</li>
<li>Pro: Simple to calculate and interpret, based entirely on the confusion matrix.</li>
<li>Con: Does not account for mistakes due to chance. Does not incorporate prior knowledge of class proportions. Does not incorporate class similarity. Does not incorporate information contained within vector of predicted probabilities.</li>
<li>References: Story and Congalton 1986</li>
</ul></li>
<li><strong>Kappa Coefficient:</strong>
<ul>
<li>Description: An index that represents the agreement between predicted and observed values and accounts for chance agreement.</li>
<li>Pro: Easily calculated from the confusion matrix. Generated by most software packages along with the confusion matrix.</li>
<li>Con: Interpretation of Kappa values between 0 and 1 is largely arbitrary. A value of &lt; 0 indicates no agreement, and a value of 1 indicates perfect agreement. Recommended to use Kappa along with other measures of accuracy. Numerous authors now question the utility and assumptions of Kappa.
References: Congalton and Mead (1983); Foody (2020)</li>
</ul></li>
<li><strong>Tau Index:</strong>
<ul>
<li>Description: An index of agreement that accounts for agreement by chance—effectively a replacement for Kappa (<code>aqp::tauW()</code>).</li>
<li>Pro: The index is more informative when appropriate class proportions are supplied. Index values can be referenced to concepts such as “better” or “worse” than random allocation.</li>
<li>Con: Appropriate prior class proportions are method dependent. Interpretation requires some training.</li>
<li>References: Ma &amp; Remond (1995)</li>
</ul></li>
<li><strong>Weighted Tau Index:</strong>
<ul>
<li>Description: Alternative version of the tau index that accommodates class similarity. - Pro: The index is more informative when appropriate class proportions are supplied. Class similarity down-weights mistakes between similar classes.</li>
<li>Con: Appropriate prior class proportions are method dependent. There is no universal method for estimating class similarity weights. Interpretation requires some training.</li>
<li>References: Rossiter (2017)</li>
</ul></li>
<li><strong>Prevalence (P):</strong> % of class occurrence in the population, usually this is estimated from the sample</li>
<li>Overall Accuracy: % of observations that were correctly classified, for all classes</li>
<li><strong>Sensitivity (SN) (aka Recall or True Positive Rate):</strong>
<ul>
<li>TP / (TP + FN)</li>
<li>% of TRUE predictions that were correctly classified, for an individual class</li>
</ul></li>
<li><strong>Specificity (SP) (aka True Negative Rate):</strong>
<ul>
<li>TN / (TN + FP)</li>
<li>errors of commission (Type I)</li>
<li>% of FALSE observations that were correctly classified, for an individual class</li>
</ul></li>
<li><strong>Precision:</strong>
<ul>
<li>TP / (TP + FP)</li>
<li>% of TRUE observations that were classified as a class, that actually were that class</li>
</ul></li>
<li><strong>Positive Predictive Value (PPV):</strong>
<ul>
<li>if prevalence = 50 then TP / (TP + FP)</li>
<li>if prevalence != 50 then SN * P / (SN * P) + ((1 - SP) * (1 - P))</li>
<li>% of TRUE observations that were classified as a class, that actually were that class</li>
</ul></li>
<li><strong>Negative Predictive Value (NPV):</strong>
<ul>
<li>if prevalence = 50 then TN / (TN + FN)</li>
<li>if prevalence != 50 then SP * (1 - P) / (P * (1 - SN)) + (SP * (1 - P))</li>
<li>% of FALSE observations that were classified as a class, that actually were that class</li>
</ul></li>
<li><strong>Producer’s Accuracy (PA):</strong>
<ul>
<li>diagonal values (TN &amp; TP) / observed values</li>
<li>% of predictions that were correctly classified, for an individual class</li>
</ul></li>
<li><strong>User’s Accuracy (UA):</strong>
<ul>
<li>diagonal values / predicted values</li>
<li>% of FALSE observations that were classified as a class, that actually were that class</li>
</ul></li>
</ul>
<p><strong>Precision/Uncertainty:</strong></p>
<ul>
<li><strong>Standard Error (SE):</strong>
<ul>
<li>Description: Error in the model parameters (e.g., coefficients or overall prediction).</li>
</ul></li>
<li><strong>Confidence Interval (CI):</strong>
<ul>
<li>Description: Conversion of the SE to an interval according to a given probability (e.g., 95 percent); its range is narrower than the prediction interval.</li>
<li>Con: Assumes a normal distribution, unless transformed or bootstrapped.</li>
<li>References:</li>
</ul></li>
</ul>
</div>
</div>
<div id="examples-1" class="section level3 hasAnchor" number="2.4.5">
<h3><span class="header-section-number">2.4.5</span> Examples<a href="model-evaluation.html#examples-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="model-evaluation.html#cb25-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/ncss-tech/stats_for_soil_survey/master/data/gsp_bs.csv&quot;</span></span>
<span id="cb25-2"><a href="model-evaluation.html#cb25-2" tabindex="-1"></a>bs <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url)</span>
<span id="cb25-3"><a href="model-evaluation.html#cb25-3" tabindex="-1"></a>bs <span class="ot">&lt;-</span> <span class="fu">subset</span>(bs, <span class="fu">complete.cases</span>(BS2_obs, BS2_pred))</span>
<span id="cb25-4"><a href="model-evaluation.html#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="model-evaluation.html#cb25-5" tabindex="-1"></a></span>
<span id="cb25-6"><a href="model-evaluation.html#cb25-6" tabindex="-1"></a><span class="co"># Probability metrics ----</span></span>
<span id="cb25-7"><a href="model-evaluation.html#cb25-7" tabindex="-1"></a></span>
<span id="cb25-8"><a href="model-evaluation.html#cb25-8" tabindex="-1"></a><span class="do">## Brier score ----</span></span>
<span id="cb25-9"><a href="model-evaluation.html#cb25-9" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;BS2_pred&quot;</span>, <span class="st">&quot;BS2_obs&quot;</span>)</span>
<span id="cb25-10"><a href="model-evaluation.html#cb25-10" tabindex="-1"></a>aqp<span class="sc">::</span><span class="fu">brierScore</span>(</span>
<span id="cb25-11"><a href="model-evaluation.html#cb25-11" tabindex="-1"></a>  bs[vars], </span>
<span id="cb25-12"><a href="model-evaluation.html#cb25-12" tabindex="-1"></a>  <span class="at">classLabels =</span> <span class="st">&quot;BS2_pred&quot;</span>, </span>
<span id="cb25-13"><a href="model-evaluation.html#cb25-13" tabindex="-1"></a>  <span class="at">actual =</span> <span class="st">&quot;BS2_obs&quot;</span></span>
<span id="cb25-14"><a href="model-evaluation.html#cb25-14" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## [1] 0.04872617</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="model-evaluation.html#cb27-1" tabindex="-1"></a><span class="do">## D2 &amp; Tjur D2----</span></span>
<span id="cb27-2"><a href="model-evaluation.html#cb27-2" tabindex="-1"></a>modEvA<span class="sc">::</span><span class="fu">RsqGLM</span>(</span>
<span id="cb27-3"><a href="model-evaluation.html#cb27-3" tabindex="-1"></a>  <span class="at">obs =</span> bs<span class="sc">$</span>BS2_obs, </span>
<span id="cb27-4"><a href="model-evaluation.html#cb27-4" tabindex="-1"></a>  <span class="at">pred =</span> bs<span class="sc">$</span>BS2_pred, </span>
<span id="cb27-5"><a href="model-evaluation.html#cb27-5" tabindex="-1"></a>  <span class="at">plot =</span> <span class="cn">FALSE</span></span>
<span id="cb27-6"><a href="model-evaluation.html#cb27-6" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb27-7"><a href="model-evaluation.html#cb27-7" tabindex="-1"></a>  <span class="fu">unlist</span>()</span></code></pre></div>
<pre><code>##   CoxSnell Nagelkerke   McFadden       Tjur  sqPearson 
##  0.4205557  0.7920635  0.7207848  0.4775784  0.6169488</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="model-evaluation.html#cb29-1" tabindex="-1"></a><span class="co"># Shannon entropy ----</span></span>
<span id="cb29-2"><a href="model-evaluation.html#cb29-2" tabindex="-1"></a><span class="co"># fake example</span></span>
<span id="cb29-3"><a href="model-evaluation.html#cb29-3" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>)</span>
<span id="cb29-4"><a href="model-evaluation.html#cb29-4" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">obs =</span> test, <span class="at">pred =</span> <span class="dv">1</span> <span class="sc">-</span> test)</span>
<span id="cb29-5"><a href="model-evaluation.html#cb29-5" tabindex="-1"></a><span class="fu">cbind</span>(</span>
<span id="cb29-6"><a href="model-evaluation.html#cb29-6" tabindex="-1"></a>  test,</span>
<span id="cb29-7"><a href="model-evaluation.html#cb29-7" tabindex="-1"></a>  <span class="at">entropy =</span> <span class="fu">apply</span>(test, <span class="dv">1</span>, aqp<span class="sc">::</span>shannonEntropy)</span>
<span id="cb29-8"><a href="model-evaluation.html#cb29-8" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##   obs pred   entropy
## 1 0.0  1.0 0.0000000
## 2 0.1  0.9 0.4689956
## 3 0.2  0.8 0.7219281
## 4 0.3  0.7 0.8812909
## 5 0.4  0.6 0.9709506
## 6 0.5  0.5 1.0000000</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="model-evaluation.html#cb31-1" tabindex="-1"></a><span class="co"># bs example</span></span>
<span id="cb31-2"><a href="model-evaluation.html#cb31-2" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb31-3"><a href="model-evaluation.html#cb31-3" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="fu">data.frame</span>(bs<span class="sc">$</span>BS2_pred, <span class="dv">1</span> <span class="sc">-</span> bs<span class="sc">$</span>BS2_pred), <span class="dv">1</span>, aqp<span class="sc">::</span>shannonEntropy)</span>
<span id="cb31-4"><a href="model-evaluation.html#cb31-4" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.2462  0.4645  0.5033  0.7749  1.0000</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="model-evaluation.html#cb33-1" tabindex="-1"></a><span class="co"># Class-based metrics -----</span></span>
<span id="cb33-2"><a href="model-evaluation.html#cb33-2" tabindex="-1"></a></span>
<span id="cb33-3"><a href="model-evaluation.html#cb33-3" tabindex="-1"></a><span class="do">## Confusion matrix ----</span></span>
<span id="cb33-4"><a href="model-evaluation.html#cb33-4" tabindex="-1"></a><span class="co"># beware caret::confusionMatrix() prefers factors with equal numbers of levels</span></span>
<span id="cb33-5"><a href="model-evaluation.html#cb33-5" tabindex="-1"></a><span class="co"># also if your table only has 2 classes, you need to specify which is &#39;positive&#39;</span></span>
<span id="cb33-6"><a href="model-evaluation.html#cb33-6" tabindex="-1"></a>cm1 <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">pred =</span> <span class="fu">as.factor</span>(bs<span class="sc">$</span>BS2_pred <span class="sc">&gt;</span> <span class="fl">0.5</span>), <span class="at">obs =</span> <span class="fu">as.factor</span>(bs<span class="sc">$</span>BS2_obs))</span>
<span id="cb33-7"><a href="model-evaluation.html#cb33-7" tabindex="-1"></a>cm1</span></code></pre></div>
<pre><code>##        obs
## pred    FALSE  TRUE
##   FALSE 28788  1173
##   TRUE    411  3033</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="model-evaluation.html#cb35-1" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb35-2"><a href="model-evaluation.html#cb35-2" tabindex="-1"></a></span>
<span id="cb35-3"><a href="model-evaluation.html#cb35-3" tabindex="-1"></a>cm2 <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(cm1, <span class="at">positive =</span> <span class="st">&quot;TRUE&quot;</span>)</span>
<span id="cb35-4"><a href="model-evaluation.html#cb35-4" tabindex="-1"></a>cm2</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##        obs
## pred    FALSE  TRUE
##   FALSE 28788  1173
##   TRUE    411  3033
##                                           
##                Accuracy : 0.9526          
##                  95% CI : (0.9502, 0.9548)
##     No Information Rate : 0.8741          
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.7665          
##                                           
##  Mcnemar&#39;s Test P-Value : &lt; 2.2e-16       
##                                           
##             Sensitivity : 0.72111         
##             Specificity : 0.98592         
##          Pos Pred Value : 0.88066         
##          Neg Pred Value : 0.96085         
##              Prevalence : 0.12591         
##          Detection Rate : 0.09079         
##    Detection Prevalence : 0.10310         
##       Balanced Accuracy : 0.85352         
##                                           
##        &#39;Positive&#39; Class : TRUE            
## </code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="model-evaluation.html#cb37-1" tabindex="-1"></a><span class="do">## Examine thresholds ----</span></span>
<span id="cb37-2"><a href="model-evaluation.html#cb37-2" tabindex="-1"></a></span>
<span id="cb37-3"><a href="model-evaluation.html#cb37-3" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb37-4"><a href="model-evaluation.html#cb37-4" tabindex="-1"></a></span>
<span id="cb37-5"><a href="model-evaluation.html#cb37-5" tabindex="-1"></a><span class="co"># generate an prediction object at all possible thresholds</span></span>
<span id="cb37-6"><a href="model-evaluation.html#cb37-6" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(bs<span class="sc">$</span>BS2_pred, bs<span class="sc">$</span>BS2_obs)</span>
<span id="cb37-7"><a href="model-evaluation.html#cb37-7" tabindex="-1"></a></span>
<span id="cb37-8"><a href="model-evaluation.html#cb37-8" tabindex="-1"></a></span>
<span id="cb37-9"><a href="model-evaluation.html#cb37-9" tabindex="-1"></a><span class="co"># save default plotting parameters</span></span>
<span id="cb37-10"><a href="model-evaluation.html#cb37-10" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">par</span>()</span>
<span id="cb37-11"><a href="model-evaluation.html#cb37-11" tabindex="-1"></a><span class="co"># override default plotting parameter</span></span>
<span id="cb37-12"><a href="model-evaluation.html#cb37-12" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="at">pty =</span> <span class="st">&quot;s&quot;</span>)</span>
<span id="cb37-13"><a href="model-evaluation.html#cb37-13" tabindex="-1"></a></span>
<span id="cb37-14"><a href="model-evaluation.html#cb37-14" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">&quot;tpr&quot;</span>, <span class="st">&quot;fpr&quot;</span>)</span>
<span id="cb37-15"><a href="model-evaluation.html#cb37-15" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb37-16"><a href="model-evaluation.html#cb37-16" tabindex="-1"></a>  perf, </span>
<span id="cb37-17"><a href="model-evaluation.html#cb37-17" tabindex="-1"></a>  <span class="at">avg =</span> <span class="st">&quot;threshold&quot;</span>, </span>
<span id="cb37-18"><a href="model-evaluation.html#cb37-18" tabindex="-1"></a>  <span class="at">print.cutoffs.at =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>),</span>
<span id="cb37-19"><a href="model-evaluation.html#cb37-19" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;TPR vs FPR&quot;</span></span>
<span id="cb37-20"><a href="model-evaluation.html#cb37-20" tabindex="-1"></a>  )</span>
<span id="cb37-21"><a href="model-evaluation.html#cb37-21" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb37-22"><a href="model-evaluation.html#cb37-22" tabindex="-1"></a></span>
<span id="cb37-23"><a href="model-evaluation.html#cb37-23" tabindex="-1"></a></span>
<span id="cb37-24"><a href="model-evaluation.html#cb37-24" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">&quot;sens&quot;</span>, <span class="st">&quot;spec&quot;</span>)</span>
<span id="cb37-25"><a href="model-evaluation.html#cb37-25" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb37-26"><a href="model-evaluation.html#cb37-26" tabindex="-1"></a>  perf, </span>
<span id="cb37-27"><a href="model-evaluation.html#cb37-27" tabindex="-1"></a>  <span class="at">avg =</span> <span class="st">&quot;threshold&quot;</span>, </span>
<span id="cb37-28"><a href="model-evaluation.html#cb37-28" tabindex="-1"></a>  <span class="at">print.cutoffs.at =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>),</span>
<span id="cb37-29"><a href="model-evaluation.html#cb37-29" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Sensitivity vs Specificity&quot;</span></span>
<span id="cb37-30"><a href="model-evaluation.html#cb37-30" tabindex="-1"></a>  )</span>
<span id="cb37-31"><a href="model-evaluation.html#cb37-31" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb37-32"><a href="model-evaluation.html#cb37-32" tabindex="-1"></a></span>
<span id="cb37-33"><a href="model-evaluation.html#cb37-33" tabindex="-1"></a></span>
<span id="cb37-34"><a href="model-evaluation.html#cb37-34" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="st">&quot;sens&quot;</span>, <span class="st">&quot;ppv&quot;</span>)</span>
<span id="cb37-35"><a href="model-evaluation.html#cb37-35" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb37-36"><a href="model-evaluation.html#cb37-36" tabindex="-1"></a>  perf, </span>
<span id="cb37-37"><a href="model-evaluation.html#cb37-37" tabindex="-1"></a>  <span class="at">avg =</span> <span class="st">&quot;threshold&quot;</span>, </span>
<span id="cb37-38"><a href="model-evaluation.html#cb37-38" tabindex="-1"></a>  <span class="at">print.cutoffs.at =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>),</span>
<span id="cb37-39"><a href="model-evaluation.html#cb37-39" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Sensitivity vs PPV&quot;</span></span>
<span id="cb37-40"><a href="model-evaluation.html#cb37-40" tabindex="-1"></a>  )</span>
<span id="cb37-41"><a href="model-evaluation.html#cb37-41" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="002-uncertainty_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="model-evaluation.html#cb38-1" tabindex="-1"></a><span class="co"># reset the plotting parameters</span></span>
<span id="cb38-2"><a href="model-evaluation.html#cb38-2" tabindex="-1"></a><span class="fu">par</span>(p)</span>
<span id="cb38-3"><a href="model-evaluation.html#cb38-3" tabindex="-1"></a></span>
<span id="cb38-4"><a href="model-evaluation.html#cb38-4" tabindex="-1"></a></span>
<span id="cb38-5"><a href="model-evaluation.html#cb38-5" tabindex="-1"></a><span class="do">## Examine overlapping histograms ----</span></span>
<span id="cb38-6"><a href="model-evaluation.html#cb38-6" tabindex="-1"></a><span class="fu">ggplot</span>(bs, <span class="fu">aes</span>(<span class="at">x =</span> BS2_pred, <span class="at">fill =</span> BS2_obs)) <span class="sc">+</span></span>
<span id="cb38-7"><a href="model-evaluation.html#cb38-7" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-8"><a href="model-evaluation.html#cb38-8" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.50</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-9"><a href="model-evaluation.html#cb38-9" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.45</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-10"><a href="model-evaluation.html#cb38-10" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.33</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-11"><a href="model-evaluation.html#cb38-11" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;BS2 Probability&quot;</span>)</span></code></pre></div>
<p><img src="002-uncertainty_files/figure-html/unnamed-chunk-16-2.png" width="672" /></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="model-evaluation.html#cb39-1" tabindex="-1"></a><span class="do">## Trade Precision for Sensitivity by Varying the Threshold </span></span>
<span id="cb39-2"><a href="model-evaluation.html#cb39-2" tabindex="-1"></a>tb <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">predicted =</span> bs<span class="sc">$</span>BS2_pred <span class="sc">&gt;</span> <span class="fl">0.45</span>, <span class="at">observed =</span> bs<span class="sc">$</span>BS2_obs)</span>
<span id="cb39-3"><a href="model-evaluation.html#cb39-3" tabindex="-1"></a>tb</span></code></pre></div>
<pre><code>##          observed
## predicted FALSE  TRUE
##     FALSE 28519   767
##     TRUE    680  3439</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="model-evaluation.html#cb41-1" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(tb)<span class="sc">$</span>byClass</span></code></pre></div>
<pre><code>##          Sensitivity          Specificity       Pos Pred Value 
##            0.9767115            0.8176415            0.9738100 
##       Neg Pred Value            Precision               Recall 
##            0.8349114            0.9738100            0.9767115 
##                   F1           Prevalence       Detection Rate 
##            0.9752586            0.8740907            0.8537345 
## Detection Prevalence    Balanced Accuracy 
##            0.8766951            0.8971765</code></pre>
</div>
<div id="exercise-3" class="section level3 hasAnchor" number="2.4.6">
<h3><span class="header-section-number">2.4.6</span> Exercise 3<a href="model-evaluation.html#exercise-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p>Append the following exercises to your previous R script.</p></li>
<li><p>Calculate the Brier score, <span class="math inline">\(D^2\)</span> and Shannon Entropy for the <code>BS1</code> class from the <code>bs</code> dataset.</p></li>
<li><p>What probably threshold creates the best split for the <code>BS1</code> class.</p></li>
<li><p>Calculate a confusion matrix for <code>sas30_obs</code> vs <code>sas30_pred</code> from the <code>sas</code> dataset. Be sure to manually set the factor levels as shown below.</p></li>
</ol>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="model-evaluation.html#cb43-1" tabindex="-1"></a>lev <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(sas<span class="sc">$</span>sas030_obs, sas<span class="sc">$</span>sas030_pred))</span>
<span id="cb43-2"><a href="model-evaluation.html#cb43-2" tabindex="-1"></a>lev <span class="ot">&lt;-</span> lev[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">11</span>)]</span>
<span id="cb43-3"><a href="model-evaluation.html#cb43-3" tabindex="-1"></a>sas<span class="sc">$</span>sas030_obs  <span class="ot">&lt;-</span> <span class="fu">factor</span>(sas<span class="sc">$</span>sas030_obs,  <span class="at">levels =</span> lev)</span>
<span id="cb43-4"><a href="model-evaluation.html#cb43-4" tabindex="-1"></a>sas<span class="sc">$</span>sas030_pred <span class="ot">&lt;-</span> <span class="fu">factor</span>(sas<span class="sc">$</span>sas030_pred, <span class="at">levels =</span> lev)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li><p>Why can’t you calculate a Brier score and Shannon entropy for the <code>SAS</code> classes from the <code>sas</code> dataset?</p></li>
<li><p>Forward you R script your instructor.</p></li>
</ol>
<div id="stratified-randomareal-adjustment" class="section level4 hasAnchor" number="2.4.6.1">
<h4><span class="header-section-number">2.4.6.1</span> Stratified-random/areal-adjustment<a href="model-evaluation.html#stratified-randomareal-adjustment" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In the case of stratified-random samples or non-probability samples, it is necessary to adjust the class totals by their known area prior to calculating their accuracy or standard errors <span class="citation">(<a href="#ref-brus_sampling_2011">Brus, Kempen, and Heuvelink 2011</a>; <a href="#ref-stehman_estimating_2014">Stehman 2014</a>; <a href="#ref-campbell_introduction_2023">Campbell, Wynne, and Thomas 2023</a>; <a href="#ref-congalton_basic_2019">Congalton and Green 2019b</a>)</span>. This is often the case when a minority class (e.g. minor component or small map unit) is sampled in excess of it’s true proportion relative to the total sample set. This even equal sampling is a good idea in order to adequately sample small but important soil classes (e.g. hydric soils), which will result in greater precision of resulting classes. Surprisingly few R functions to include adjustments for these unequal weights, with the exception of the <a href="https://yardstick.tidymodels.org/"><code>yardstick</code></a>, <a href="https://pages.cms.hu-berlin.de/pflugmad/mapac/"><code>mapac</code></a>, and <a href="https://github.com/mayer79/MetricsWeighted"><code>MetricsWeighted</code></a> R packages. The <a href="http://r-survey.r-forge.r-project.org/survey/"><code>survey</code></a> R package also has numerous function to analyze design-based survey samples with varying sampling weights. Only the <code>mapac</code> R package provides estimates of the post stratified standard errors for the various confusion matrix derivatives.</p>
<p>In the simplest case where the an existing soil class map is validated by an independent test dataset, it is only necessary to weight the confusion matrix using the prior probabilities of the original map.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="model-evaluation.html#cb44-1" tabindex="-1"></a><span class="co"># weights</span></span>
<span id="cb44-2"><a href="model-evaluation.html#cb44-2" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">0.95</span>, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">0.05</span>)</span>
<span id="cb44-3"><a href="model-evaluation.html#cb44-3" tabindex="-1"></a></span>
<span id="cb44-4"><a href="model-evaluation.html#cb44-4" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb44-5"><a href="model-evaluation.html#cb44-5" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">pred =</span> bs<span class="sc">$</span>BS2_pred <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="at">obs =</span> bs<span class="sc">$</span>BS2_obs)</span>
<span id="cb44-6"><a href="model-evaluation.html#cb44-6" tabindex="-1"></a>cm</span></code></pre></div>
<pre><code>##        obs
## pred    FALSE  TRUE
##   FALSE 28788  1173
##   TRUE    411  3033</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="model-evaluation.html#cb46-1" tabindex="-1"></a><span class="co"># apply weights</span></span>
<span id="cb46-2"><a href="model-evaluation.html#cb46-2" tabindex="-1"></a>cm_wt <span class="ot">&lt;-</span> wt <span class="sc">*</span> cm<span class="sc">/</span><span class="fu">rowSums</span>(cm)</span>
<span id="cb46-3"><a href="model-evaluation.html#cb46-3" tabindex="-1"></a>cm_wt <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##        obs
## pred    FALSE  TRUE
##   FALSE 0.913 0.037
##   TRUE  0.006 0.044</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="model-evaluation.html#cb48-1" tabindex="-1"></a><span class="co"># optional transformation to original totals</span></span>
<span id="cb48-2"><a href="model-evaluation.html#cb48-2" tabindex="-1"></a>cm_wt2 <span class="ot">&lt;-</span> {cm_wt <span class="sc">*</span> <span class="fu">sum</span>(cm)} <span class="sc">|&gt;</span> <span class="fu">round</span>()</span>
<span id="cb48-3"><a href="model-evaluation.html#cb48-3" tabindex="-1"></a>cm_wt2</span></code></pre></div>
<pre><code>##        obs
## pred    FALSE  TRUE
##   FALSE 30492  1242
##   TRUE    199  1471</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="model-evaluation.html#cb50-1" tabindex="-1"></a><span class="co"># compare weighted and unweighted confusion matrices</span></span>
<span id="cb50-2"><a href="model-evaluation.html#cb50-2" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(cm,     <span class="at">positive =</span> <span class="st">&quot;TRUE&quot;</span>)<span class="sc">$</span>byClass</span></code></pre></div>
<pre><code>##          Sensitivity          Specificity       Pos Pred Value 
##           0.72111270           0.98592418           0.88066202 
##       Neg Pred Value            Precision               Recall 
##           0.96084910           0.88066202           0.72111270 
##                   F1           Prevalence       Detection Rate 
##           0.79294118           0.12590930           0.09079479 
## Detection Prevalence    Balanced Accuracy 
##           0.10309834           0.85351844</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="model-evaluation.html#cb52-1" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(cm_wt2, <span class="at">positive =</span> <span class="st">&quot;TRUE&quot;</span>)<span class="sc">$</span>byClass</span></code></pre></div>
<pre><code>##          Sensitivity          Specificity       Pos Pred Value 
##           0.54220420           0.99351601           0.88083832 
##       Neg Pred Value            Precision               Recall 
##           0.96086217           0.88083832           0.54220420 
##                   F1           Prevalence       Detection Rate 
##           0.67122975           0.08121782           0.04403664 
## Detection Prevalence    Balanced Accuracy 
##           0.04999401           0.76786011</code></pre>
<p>However as is often the case, when the samples are stratified using environmental covariates the strata don’t coincide with the resulting digital soil map, and therefore the accuracy and errors within each strata need to be estimated separately and then averaged using the strata sizes as weights <span class="citation">(<a href="#ref-brus_sampling_2011">Brus, Kempen, and Heuvelink 2011</a>; <a href="#ref-stehman_estimating_2014">Stehman 2014</a>)</span>. The sample weights will equal the total number of pixels each sample represents.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="model-evaluation.html#cb54-1" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_git</span>(<span class="st">&quot;https://scm.cms.hu-berlin.de/pflugmad/mapac.git&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="model-evaluation.html#cb55-1" tabindex="-1"></a><span class="fu">library</span>(mapac)</span>
<span id="cb55-2"><a href="model-evaluation.html#cb55-2" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb55-3"><a href="model-evaluation.html#cb55-3" tabindex="-1"></a></span>
<span id="cb55-4"><a href="model-evaluation.html#cb55-4" tabindex="-1"></a></span>
<span id="cb55-5"><a href="model-evaluation.html#cb55-5" tabindex="-1"></a>exdata <span class="ot">&lt;-</span> <span class="fu">aa_examples</span>(<span class="st">&quot;stehman2014&quot;</span>)</span>
<span id="cb55-6"><a href="model-evaluation.html#cb55-6" tabindex="-1"></a></span>
<span id="cb55-7"><a href="model-evaluation.html#cb55-7" tabindex="-1"></a><span class="co"># post stratified confusion matrix</span></span>
<span id="cb55-8"><a href="model-evaluation.html#cb55-8" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">aa_stratified</span>(</span>
<span id="cb55-9"><a href="model-evaluation.html#cb55-9" tabindex="-1"></a>  <span class="at">stratum   =</span> exdata<span class="sc">$</span>stratum, </span>
<span id="cb55-10"><a href="model-evaluation.html#cb55-10" tabindex="-1"></a>  <span class="at">reference =</span> exdata<span class="sc">$</span>ref, </span>
<span id="cb55-11"><a href="model-evaluation.html#cb55-11" tabindex="-1"></a>  <span class="at">map       =</span> exdata<span class="sc">$</span>map, </span>
<span id="cb55-12"><a href="model-evaluation.html#cb55-12" tabindex="-1"></a>  <span class="at">h         =</span> exdata[[<span class="st">&quot;h&quot;</span>]], </span>
<span id="cb55-13"><a href="model-evaluation.html#cb55-13" tabindex="-1"></a>  <span class="at">N_h       =</span> exdata[[<span class="st">&quot;N_h&quot;</span>]]</span>
<span id="cb55-14"><a href="model-evaluation.html#cb55-14" tabindex="-1"></a>  )</span>
<span id="cb55-15"><a href="model-evaluation.html#cb55-15" tabindex="-1"></a>cm<span class="sc">$</span>cmp <span class="sc">*</span> <span class="fu">sum</span>(exdata<span class="sc">$</span>N_h)</span></code></pre></div>
<pre><code>##       A     B    C    D
## A 23000  4000 4000    0
## B 12000 27000 8000    0
## C     0  2000 6000 4000
## D     0  1000 2000 7000</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="model-evaluation.html#cb57-1" tabindex="-1"></a>cm<span class="sc">$</span>stats</span></code></pre></div>
<pre><code>##   class        ua     ua_se        pa     pa_se        f1      f1_se
## 1     A 0.7419355 0.1645627 0.6571429 0.1477318 0.6969697 0.11034620
## 2     B 0.5744681 0.1248023 0.7941176 0.1165671 0.6666667 0.09354009
## 3     C 0.5000000 0.2151657 0.3000000 0.1504438 0.3750000 0.13219833
## 4     D 0.7000000 0.1527525 0.6363636 0.1623242 0.6666667 0.11284328</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="model-evaluation.html#cb59-1" tabindex="-1"></a><span class="co"># compute stratum weights</span></span>
<span id="cb59-2"><a href="model-evaluation.html#cb59-2" tabindex="-1"></a>W <span class="ot">&lt;-</span> exdata<span class="sc">$</span>N_h <span class="sc">/</span> <span class="fu">as.integer</span>(<span class="fu">table</span>(exdata<span class="sc">$</span>stratum))</span>
<span id="cb59-3"><a href="model-evaluation.html#cb59-3" tabindex="-1"></a><span class="fu">names</span>(W) <span class="ot">&lt;-</span> exdata<span class="sc">$</span>h</span>
<span id="cb59-4"><a href="model-evaluation.html#cb59-4" tabindex="-1"></a></span>
<span id="cb59-5"><a href="model-evaluation.html#cb59-5" tabindex="-1"></a>ex <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(exdata[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-6"><a href="model-evaluation.html#cb59-6" tabindex="-1"></a>ex[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(ex, as.factor)</span>
<span id="cb59-7"><a href="model-evaluation.html#cb59-7" tabindex="-1"></a>ex <span class="ot">&lt;-</span> <span class="fu">within</span>(ex, {</span>
<span id="cb59-8"><a href="model-evaluation.html#cb59-8" tabindex="-1"></a>  w <span class="ot">=</span> W[<span class="fu">match</span>(stratum, <span class="fu">names</span>(W))]</span>
<span id="cb59-9"><a href="model-evaluation.html#cb59-9" tabindex="-1"></a>  ref_A <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(reference <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>))</span>
<span id="cb59-10"><a href="model-evaluation.html#cb59-10" tabindex="-1"></a>  map_A <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(map       <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>))</span>
<span id="cb59-11"><a href="model-evaluation.html#cb59-11" tabindex="-1"></a>})</span>
<span id="cb59-12"><a href="model-evaluation.html#cb59-12" tabindex="-1"></a></span>
<span id="cb59-13"><a href="model-evaluation.html#cb59-13" tabindex="-1"></a></span>
<span id="cb59-14"><a href="model-evaluation.html#cb59-14" tabindex="-1"></a><span class="co"># weighted sensitivty from yardstick</span></span>
<span id="cb59-15"><a href="model-evaluation.html#cb59-15" tabindex="-1"></a>yardstick<span class="sc">::</span><span class="fu">sens</span>(</span>
<span id="cb59-16"><a href="model-evaluation.html#cb59-16" tabindex="-1"></a>  ex, </span>
<span id="cb59-17"><a href="model-evaluation.html#cb59-17" tabindex="-1"></a>  <span class="at">truth =</span> ref_A, </span>
<span id="cb59-18"><a href="model-evaluation.html#cb59-18" tabindex="-1"></a>  <span class="at">estimate =</span> map_A, </span>
<span id="cb59-19"><a href="model-evaluation.html#cb59-19" tabindex="-1"></a>  <span class="at">case_weights =</span> w, </span>
<span id="cb59-20"><a href="model-evaluation.html#cb59-20" tabindex="-1"></a>  <span class="at">event_level =</span> <span class="st">&quot;second&quot;</span></span>
<span id="cb59-21"><a href="model-evaluation.html#cb59-21" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 sens    binary         0.657</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="model-evaluation.html#cb61-1" tabindex="-1"></a><span class="co"># weight the confusion matrix</span></span>
<span id="cb61-2"><a href="model-evaluation.html#cb61-2" tabindex="-1"></a>ex_svy <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">weights =</span> <span class="sc">~</span>w, <span class="at">strata =</span> <span class="sc">~</span>stratum, <span class="at">data =</span> ex, <span class="at">variables =</span> <span class="sc">~</span>map<span class="sc">+</span>reference)</span>
<span id="cb61-3"><a href="model-evaluation.html#cb61-3" tabindex="-1"></a>tb <span class="ot">&lt;-</span> <span class="fu">svytable</span>(<span class="sc">~</span>map<span class="sc">+</span>reference, <span class="at">design =</span> ex_svy)</span>
<span id="cb61-4"><a href="model-evaluation.html#cb61-4" tabindex="-1"></a>tb</span></code></pre></div>
<pre><code>##    reference
## map     A     B     C     D
##   A 23000  4000  4000     0
##   B 12000 27000  8000     0
##   C     0  2000  6000  4000
##   D     0  1000  2000  7000</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="model-evaluation.html#cb63-1" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(tb)<span class="sc">$</span>byClass</span></code></pre></div>
<pre><code>##          Sensitivity Specificity Pos Pred Value Neg Pred Value Precision
## Class: A   0.6571429   0.8769231      0.7419355      0.8260870 0.7419355
## Class: B   0.7941176   0.6969697      0.5744681      0.8679245 0.5744681
## Class: C   0.3000000   0.9250000      0.5000000      0.8409091 0.5000000
## Class: D   0.6363636   0.9662921      0.7000000      0.9555556 0.7000000
##             Recall        F1 Prevalence Detection Rate Detection Prevalence
## Class: A 0.6571429 0.6969697       0.35           0.23                 0.31
## Class: B 0.7941176 0.6666667       0.34           0.27                 0.47
## Class: C 0.3000000 0.3750000       0.20           0.06                 0.12
## Class: D 0.6363636 0.6666667       0.11           0.07                 0.10
##          Balanced Accuracy
## Class: A         0.7670330
## Class: B         0.7455437
## Class: C         0.6125000
## Class: D         0.8013279</code></pre>
</div>
</div>
</div>
<div id="validation" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Validation<a href="model-evaluation.html#validation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Validation refers to the process and the result of a process where the validity of a model is tested. That is, how well does the model represent reality? There are varying degrees of formality and thoroughness that can be used in validation. While multiple stages of the modeling process can be validated, usually it’s the output of the model that is investigated and reported. You can group initial validation into three broad groups: Expert evaluation, Theoretical Analysis and Prediction Accuracy.</p>
<p><strong>Expert Evaluation:</strong> In this case, the model output is inspected by an expert user. The first evaluator will be you (the developer), but ideally an outside expert will be utilized. This is often a step in an iterative process. Evaluate the model output, does it make sense, do you see things that need to be improved? Then make changes to the model to improve the output.</p>
<p><strong>Theoretical Analysis:</strong> compare the results of the model to what is theoretically possible. In systems modeling, this might include diagnostics statistics including residual analysis, cross-correlation of variables and outputs, sensitivity analysis and model analysis such as Akaike Information Criterion (AIC). This can also include simple comparison of output to known possible values. This is especially important for linear regression where the slope of the model is assumed to be steady no matter the values of the dependent variables.</p>
<p><strong>Prediction Accuracy</strong>: The correctness of the parameter being predicted by the model (soil taxa, property etc.). Ideally this is done with an independent set of data.</p>
<p>In soil science, we typically use the term model validation to refer to a statistical analysis that assesses how well a model will predict at an unknown location. A complete model should have a formal statistical evaluation that can be reported and stored as model and output meta-data. That is the portion of validation we will focus. For this discussion, validation can be thought of as an assessment of prediction error and variance.</p>
<p><strong>Three types of validation used in the course</strong></p>
<ul>
<li>Internal - Performance on population underlying the sample</li>
<li>External - Performance on related (similar/adjacent) but independent population</li>
</ul>
<!-- ## Apparent Validation -->
<!-- In this exploratory and explanatory phase you are looking for relationships that can be used later for predictive purposes. -->
<!-- - Use Goodness of fit tests on all the data in your sample -->
<!--     - Correlation (R2, rho, etc.) -->
<!--     - P-values (test questions about individual or combinations of variables) -->
<!-- - Analyze Residuals (distribution of model errors) to diagnose modeling problems. One or more of these issues indicate that one or more important variables was omitted from the model or that an incorrect functional form was used (linear when the function should be non-linear) -->
<!--     - Heteroscedasticity -->
<!--     - Normality -->
<!--     - Spatial distribution (auto-correlation) -->
<div id="internal-validation" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Internal Validation<a href="model-evaluation.html#internal-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="split-sample---a-single-partition-of-the-data-into-a-learning-and-a-calibration-set." class="section level4 hasAnchor" number="2.5.1.1">
<h4><span class="header-section-number">2.5.1.1</span> Split-sample - A single partition of the data into a learning and a calibration set.<a href="model-evaluation.html#split-sample---a-single-partition-of-the-data-into-a-learning-and-a-calibration-set." class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Achieve an independent validation by partitioning the samples into calibration or training and validation data-sets (70% of the samples available are recommended for calibration)
<ul>
<li>Build model on calibration (training) data-set</li>
<li>Test model on validation (test) data-set</li>
<li>Report accuracy on the validation data-set</li>
</ul></li>
<li>This method is relatively simple (conceptually and computationally). Results depend on having an adequate sample size to both develop and test the model.</li>
</ul>
</div>
<div id="cross-validation---alternate-development-and-validation" class="section level4 hasAnchor" number="2.5.1.2">
<h4><span class="header-section-number">2.5.1.2</span> Cross-validation - Alternate development and validation<a href="model-evaluation.html#cross-validation---alternate-development-and-validation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Leave-One-Out Cross-Validation (LOOCV)</strong></p>
<ul>
<li>One observation is used for testing and all others are used to develop model</li>
<li>Repeat n (total number of observations) times</li>
<li>Average error over n</li>
<li>The mean of the accuracy is the expected accuracy of the model (this assumes that new data is from the same population) (Efron, 1983)</li>
</ul>
<p><strong>k-fold Cross-Validation (k-fold) CV</strong></p>
<ul>
<li>Randomly divide observations into calibration and validation sets.</li>
<li>Repeat k times, each time one k group is used for error estimates</li>
<li>Average error of k</li>
<li>Less computationally intensive than LOOCV, but it is more robust and can be done with smaller sample sizes than a simple split.</li>
<li>Several R packages have tools to cross-validate predictions, including: <code>DAAG</code> and <code>boot</code> for <code>lm()</code> and <code>glm()</code> objects, <code>caret</code>, <code>rms</code>,</li>
</ul>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="model-evaluation.html#cb65-1" tabindex="-1"></a><span class="do">### Linear model example</span></span>
<span id="cb65-2"><a href="model-evaluation.html#cb65-2" tabindex="-1"></a><span class="co"># Create folds</span></span>
<span id="cb65-3"><a href="model-evaluation.html#cb65-3" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(sas), <span class="at">k =</span> <span class="dv">10</span>)</span>
<span id="cb65-4"><a href="model-evaluation.html#cb65-4" tabindex="-1"></a></span>
<span id="cb65-5"><a href="model-evaluation.html#cb65-5" tabindex="-1"></a><span class="co"># Cross validate</span></span>
<span id="cb65-6"><a href="model-evaluation.html#cb65-6" tabindex="-1"></a>lm_cv <span class="ot">&lt;-</span> <span class="fu">lapply</span>(folds, <span class="cf">function</span>(x) {</span>
<span id="cb65-7"><a href="model-evaluation.html#cb65-7" tabindex="-1"></a>  train <span class="ot">=</span> sas[<span class="sc">-</span>x,]</span>
<span id="cb65-8"><a href="model-evaluation.html#cb65-8" tabindex="-1"></a>  test  <span class="ot">=</span> sas[x,]</span>
<span id="cb65-9"><a href="model-evaluation.html#cb65-9" tabindex="-1"></a>  obs   <span class="ot">=</span> test<span class="sc">$</span>pH_0<span class="fl">.30</span>_obs</span>
<span id="cb65-10"><a href="model-evaluation.html#cb65-10" tabindex="-1"></a>  <span class="co"># predict = predict(model, test)</span></span>
<span id="cb65-11"><a href="model-evaluation.html#cb65-11" tabindex="-1"></a>  pred  <span class="ot">=</span> test<span class="sc">$</span>pH_0<span class="fl">.30</span>_pred</span>
<span id="cb65-12"><a href="model-evaluation.html#cb65-12" tabindex="-1"></a>  RMSE  <span class="ot">=</span> <span class="fu">RMSE</span>(pred, obs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-13"><a href="model-evaluation.html#cb65-13" tabindex="-1"></a>  R2    <span class="ot">=</span> <span class="fu">R2</span>(pred, obs, <span class="at">formula =</span> <span class="st">&quot;traditional&quot;</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-14"><a href="model-evaluation.html#cb65-14" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="at">RMSE =</span> RMSE, <span class="at">R2 =</span> R2))</span>
<span id="cb65-15"><a href="model-evaluation.html#cb65-15" tabindex="-1"></a>})</span>
<span id="cb65-16"><a href="model-evaluation.html#cb65-16" tabindex="-1"></a></span>
<span id="cb65-17"><a href="model-evaluation.html#cb65-17" tabindex="-1"></a><span class="co"># Convert to a data.frame</span></span>
<span id="cb65-18"><a href="model-evaluation.html#cb65-18" tabindex="-1"></a>lm_cv <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, lm_cv)</span>
<span id="cb65-19"><a href="model-evaluation.html#cb65-19" tabindex="-1"></a></span>
<span id="cb65-20"><a href="model-evaluation.html#cb65-20" tabindex="-1"></a><span class="co"># Summarize results</span></span>
<span id="cb65-21"><a href="model-evaluation.html#cb65-21" tabindex="-1"></a><span class="fu">summary</span>(lm_cv)</span></code></pre></div>
<pre><code>##       RMSE              R2        
##  Min.   :0.4498   Min.   :0.8392  
##  1st Qu.:0.4593   1st Qu.:0.8475  
##  Median :0.4717   Median :0.8517  
##  Mean   :0.4689   Mean   :0.8526  
##  3rd Qu.:0.4749   3rd Qu.:0.8594  
##  Max.   :0.4843   Max.   :0.8650</code></pre>
</div>
<div id="subsample-resampling-or-sample-simulation" class="section level4 hasAnchor" number="2.5.1.3">
<h4><span class="header-section-number">2.5.1.3</span> Subsample (Resampling or sample simulation)<a href="model-evaluation.html#subsample-resampling-or-sample-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In this method, the ‘leave-out’ method can be random (Bootstrap) or observation selection can use a more sophisticated method to select observations to represent the population including Monte Carlo (Molarino, 2005) and .632+bootstrap of Efron &amp; Tibshirani (1997). The details of those aren’t important, except to know that they can give you a better idea of the robustness of your model.</p>
<ul>
<li>As with re-sampling for uncertainty estimation, observations are repeatedly sampled
<ul>
<li>Select a number of samples (Randomly or from known distribution).</li>
<li>Develop the model</li>
<li>Estimate model accuracy on unselected samples</li>
<li>Repeat the process (with independent sample) a large number of times, 500 - 5,000.</li>
<li>The expected model accuracy is then the mean of the estimates.</li>
</ul></li>
</ul>
<p><strong>NOTE:</strong> The BEST model should not be assumed to be the one that makes the ‘truest’ predictions. Beware of over-fitting. When a model is over-fit, it predicts due to very specific “quirks” in the calibration data set and not due to explanatory relationships that will apply to validation and independent data-sets. One strategy to avoid this situation is to build models with as few variables as possible. Parsimonious models (those that use the least amount of information possible to obtain the same result or convey the same meaning) often have higher predicative validity. The use of metrics such as Akaike’s Information Criterion (AIC) can be helpful for balancing error and parameter minimization.</p>
</div>
</div>
<div id="external-validation" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> External Validation<a href="model-evaluation.html#external-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this case, an independent data-set is used as the test case.</p>
<ul>
<li>Independent observations predicted with model</li>
<li>Errors (ME, RMSE) calculated on predicted vs. actual</li>
<li>Some exploratory analysis can be helpful to diagnose and explain model performance.</li>
</ul>
<p>The use of validation will be demonstrated as part of each modeling section. The size of the data-set used, understanding of the variables involved and the nature of the statistical models and algorithms used all influence which validation techniques are most convenient and appropriate.</p>
<!-- ## Additional reading -->
<!-- Efron, B., Tibshirani, R.J., 1993. An introduction to the bootstrap. Monographs on Statistics and Applied Probability, vol. 57. Chapman & Hall, London, UK. -->
<!-- Hastie, T., R. Tibshirani, and J. Friedman 2009. The Elements of Statistical Learning: Data Mining, Inference, and Prediction. Springer, New York. [http://statweb.stanford.edu/~tibs/ElemStatLearn/](http://statweb.stanford.edu/~tibs/ElemStatLearn/) -->
<!-- Molinaro, A. M. (2005). Prediction error estimation: a comparison of resampling methods. Bioinformatics, 21(15), 3301-3307. doi:10.1093/bioinformatics/bti499 -->
<!-- Shmueli, G.. (2010). To Explain or to Predict?. Statistical Science, 25(3), 289:310. Retrieved from http://www.jstor.org/stable/41058949 -->
<!-- Zar, J.H., 1999. Biostatistical analysis. Pearson Education India. -->
<!-- references automatically added here  -->

<!-- load libraries for examples, which run before any code is displayed -->
</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-brus_sampling_2011" class="csl-entry">
Brus, D. J., B. Kempen, and G. B. M. Heuvelink. 2011. <span>“Sampling for Validation of Digital Soil Maps.”</span> <em>European Journal of Soil Science</em> 62 (3): 394–407. <a href="https://doi.org/10.1111/j.1365-2389.2011.01364.x">https://doi.org/10.1111/j.1365-2389.2011.01364.x</a>.
</div>
<div id="ref-campbell_introduction_2023" class="csl-entry">
Campbell, James B., Randolph H. Wynne, and Valerie A. Thomas. 2023. <em>Introduction to Remote Sensing</em>. 6. edition. New York: Guilford Press. <a href="https://www.guilford.com/books/Introduction-to-Remote-Sensing/Campbell-Wynne-Thomas/9781462549405">https://www.guilford.com/books/Introduction-to-Remote-Sensing/Campbell-Wynne-Thomas/9781462549405</a>.
</div>
<div id="ref-congalton2019" class="csl-entry">
Congalton, Russell G., and Kass Green. 2019a. <em>Assessing the <span>Accuracy</span> of <span>Remotely</span> <span>Sensed</span> <span>Data</span>: <span>Principles</span> and <span>Practices</span>, <span>Third</span> <span>Edition</span></em>. 3rd ed. CRC Press. <a href="https://doi.org/10.1201/9780429052729">https://doi.org/10.1201/9780429052729</a>.
</div>
<div id="ref-congalton_basic_2019" class="csl-entry">
———. 2019b. <span>“Basic <span>Analysis</span> <span>Techniques</span>.”</span> In <em>Assessing the <span>Accuracy</span> of <span>Remotely</span> <span>Sensed</span> <span>Data</span></em>, 3rd ed., 127–44. CRC Press. <a href="https://doi.org/10.1201/9780429052729-8">https://doi.org/10.1201/9780429052729-8</a>.
</div>
<div id="ref-eisenberg_accuracy_1995" class="csl-entry">
Eisenberg, Mark J. 1995. <span>“Accuracy and Predictive Values in Clinical Decision-Making.”</span> <em>Cleveland Clinic Journal of Medicine</em> 62 (5): 311. <a href="http://www.ccjm.org/content/62/5/311.abstract">http://www.ccjm.org/content/62/5/311.abstract</a>.
</div>
<div id="ref-fielding_review_1997" class="csl-entry">
Fielding, Alan H., and John F. Bell. 1997. <span>“A Review of Methods for the Assessment of Prediction Errors in Conservation Presence/Absence Models.”</span> <em>Environmental Conservation</em> 24 (1): 38–49. <a href="https://doi.org/10.1017/S0376892997000088">https://doi.org/10.1017/S0376892997000088</a>.
</div>
<div id="ref-foody_assessing_2010" class="csl-entry">
Foody, Giles M. 2010. <span>“Assessing the Accuracy of Land Cover Change with Imperfect Ground Reference Data.”</span> <em>Remote Sensing of Environment</em> 114 (10): 2271–85. <a href="https://doi.org/10.1016/j.rse.2010.05.003">https://doi.org/10.1016/j.rse.2010.05.003</a>.
</div>
<div id="ref-good2013" class="csl-entry">
Good, Phillip I. 2013. <em>Introduction to <span>Statistics</span> <span>Through</span> <span>Resampling</span> <span>Methods</span> and <span>R</span></em>. Hoboken, NJ, USA: John Wiley &amp; Sons, Inc. <a href="https://doi.org/10.1002/9781118497593">https://doi.org/10.1002/9781118497593</a>.
</div>
<div id="ref-kuhn2013" class="csl-entry">
Kuhn, Max, and Kjell Johnson. 2013. <em>Applied <span>Predictive</span> <span>Modeling</span></em>. New York, NY: Springer New York. <a href="https://doi.org/10.1007/978-1-4614-6849-3">https://doi.org/10.1007/978-1-4614-6849-3</a>.
</div>
<div id="ref-kuhn_feature_2019" class="csl-entry">
———. 2019. <em>Feature Engineering and Selection: A Practical Approach for Predictive Models</em>. 1st ed. New York: Chapman; Hall/<span>CRC</span>. <a href="https://doi.org/10.1201/9781315108230">https://doi.org/10.1201/9781315108230</a>.
</div>
<div id="ref-simon_sensitivity_1990" class="csl-entry">
Simon, David, and John R. Boring. 1990. <span>“Sensitivity, Specificity, and Predictive Value.”</span> In <em>Clinical Methods: The History, Physical, and Laboratory Examinations</em>, edited by H. Kenneth Walker, W. Dallas Hall, and J. Willis Hurst, 3rd ed. Boston: Butterworths. <a href="http://www.ncbi.nlm.nih.gov/books/NBK383/">http://www.ncbi.nlm.nih.gov/books/NBK383/</a>.
</div>
<div id="ref-stehman_estimating_2014" class="csl-entry">
Stehman, Stephen V. 2014. <span>“Estimating Area and Map Accuracy for Stratified Random Sampling When the Strata Are Different from the Map Classes.”</span> <em>International Journal of Remote Sensing</em> 35 (13): 4923–39. <a href="https://doi.org/10.1080/01431161.2014.930207">https://doi.org/10.1080/01431161.2014.930207</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="numerical-tax.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["s4ssbook.pdf", "s4ssbook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
