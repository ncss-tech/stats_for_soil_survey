<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Numerical Taxonomy and Ordination | Statistics for Soil Survey - Part 2</title>
  <meta name="description" content="Web-based course content for Statistics for Soil Survey - Part 2 made with bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Numerical Taxonomy and Ordination | Statistics for Soil Survey - Part 2" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Web-based course content for Statistics for Soil Survey - Part 2 made with bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Numerical Taxonomy and Ordination | Statistics for Soil Survey - Part 2" />
  
  <meta name="twitter:description" content="Web-based course content for Statistics for Soil Survey - Part 2 made with bookdown::gitbook." />
  

<meta name="author" content="Soil Survey Staff" />


<meta name="date" content="2022-02-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="uncertainty.html"/>
<link rel="next" href="linear-regression.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="../book/index.html">Statistics for Soil Survey - Part 1</a></li>
<li><a href="index.html">Statistics for Soil Survey - Part 2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Pre-course Assignment</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i><b>0.1</b> Setup</a>
<ul>
<li class="chapter" data-level="0.1.1" data-path="index.html"><a href="index.html#create-workspace"><i class="fa fa-check"></i><b>0.1.1</b> Create Workspace</a></li>
<li class="chapter" data-level="0.1.2" data-path="index.html"><a href="index.html#configure-rstudio"><i class="fa fa-check"></i><b>0.1.2</b> Configure RStudio</a></li>
<li class="chapter" data-level="0.1.3" data-path="index.html"><a href="index.html#install-.rprofile"><i class="fa fa-check"></i><b>0.1.3</b> Install .RProfile</a></li>
<li class="chapter" data-level="0.1.4" data-path="index.html"><a href="index.html#install-required-packages"><i class="fa fa-check"></i><b>0.1.4</b> Install Required Packages</a></li>
<li class="chapter" data-level="0.1.5" data-path="index.html"><a href="index.html#common-errors"><i class="fa fa-check"></i><b>0.1.5</b> Common Errors</a></li>
<li class="chapter" data-level="0.1.6" data-path="index.html"><a href="index.html#packages-not-on-cran"><i class="fa fa-check"></i><b>0.1.6</b> Packages not on CRAN</a></li>
</ul></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#connect-to-local-nasis"><i class="fa fa-check"></i><b>0.2</b> Connect to Local NASIS</a>
<ul>
<li class="chapter" data-level="0.2.1" data-path="index.html"><a href="index.html#demonstrate-a-working-connection"><i class="fa fa-check"></i><b>0.2.1</b> Demonstrate a Working Connection</a></li>
</ul></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#additional-supportoptional-readings"><i class="fa fa-check"></i><b>0.3</b> Additional Support/Optional Readings</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>1.1</b> Outline</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>2</b> Uncertainty</a>
<ul>
<li class="chapter" data-level="2.1" data-path="uncertainty.html"><a href="uncertainty.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="uncertainty.html"><a href="uncertainty.html#examples---dispersion"><i class="fa fa-check"></i><b>2.1.1</b> Examples - Dispersion</a></li>
<li class="chapter" data-level="2.1.2" data-path="uncertainty.html"><a href="uncertainty.html#examples---variation-and-certainty"><i class="fa fa-check"></i><b>2.1.2</b> Examples - Variation and Certainty</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="uncertainty.html"><a href="uncertainty.html#theory-of-uncertainty"><i class="fa fa-check"></i><b>2.2</b> Theory of Uncertainty</a></li>
<li class="chapter" data-level="2.3" data-path="uncertainty.html"><a href="uncertainty.html#resampling-to-estimate-uncertainty"><i class="fa fa-check"></i><b>2.3</b> Resampling to Estimate Uncertainty</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="uncertainty.html"><a href="uncertainty.html#examples"><i class="fa fa-check"></i><b>2.3.1</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="uncertainty.html"><a href="uncertainty.html#performance-metrics"><i class="fa fa-check"></i><b>2.4</b> Performance Metrics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="uncertainty.html"><a href="uncertainty.html#numerical"><i class="fa fa-check"></i><b>2.4.1</b> Numerical</a></li>
<li class="chapter" data-level="2.4.2" data-path="uncertainty.html"><a href="uncertainty.html#categorical"><i class="fa fa-check"></i><b>2.4.2</b> Categorical</a></li>
<li class="chapter" data-level="2.4.3" data-path="uncertainty.html"><a href="uncertainty.html#exercise"><i class="fa fa-check"></i><b>2.4.3</b> Exercise ?</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="uncertainty.html"><a href="uncertainty.html#validation"><i class="fa fa-check"></i><b>2.5</b> Validation</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="uncertainty.html"><a href="uncertainty.html#internal-validation"><i class="fa fa-check"></i><b>2.5.1</b> Internal Validation</a></li>
<li class="chapter" data-level="2.5.2" data-path="uncertainty.html"><a href="uncertainty.html#external-validation"><i class="fa fa-check"></i><b>2.5.2</b> External Validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="numerical-tax.html"><a href="numerical-tax.html"><i class="fa fa-check"></i><b>3</b> Numerical Taxonomy and Ordination</a>
<ul>
<li class="chapter" data-level="3.1" data-path="numerical-tax.html"><a href="numerical-tax.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="numerical-tax.html"><a href="numerical-tax.html#objectives"><i class="fa fa-check"></i><b>3.1.1</b> Objectives</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="numerical-tax.html"><a href="numerical-tax.html#whirlwind-tour"><i class="fa fa-check"></i><b>3.2</b> Whirlwind Tour</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="numerical-tax.html"><a href="numerical-tax.html#similarity-disimilarty-and-distance"><i class="fa fa-check"></i><b>3.2.1</b> Similarity, Disimilarty, and Distance</a></li>
<li class="chapter" data-level="3.2.2" data-path="numerical-tax.html"><a href="numerical-tax.html#standardization-of-characteristics"><i class="fa fa-check"></i><b>3.2.2</b> Standardization of Characteristics</a></li>
<li class="chapter" data-level="3.2.3" data-path="numerical-tax.html"><a href="numerical-tax.html#missing-data"><i class="fa fa-check"></i><b>3.2.3</b> Missing Data</a></li>
<li class="chapter" data-level="3.2.4" data-path="numerical-tax.html"><a href="numerical-tax.html#visualizing-pair-wise-distances-the-dendrogram"><i class="fa fa-check"></i><b>3.2.4</b> Visualizing Pair-Wise Distances: The Dendrogram</a></li>
<li class="chapter" data-level="3.2.5" data-path="numerical-tax.html"><a href="numerical-tax.html#re-arranging-a-dendrogram-for-clarity"><i class="fa fa-check"></i><b>3.2.5</b> Re-arranging a Dendrogram for Clarity</a></li>
<li class="chapter" data-level="3.2.6" data-path="numerical-tax.html"><a href="numerical-tax.html#cluster-analysis-finding-groups-in-data"><i class="fa fa-check"></i><b>3.2.6</b> Cluster Analysis: Finding Groups in Data</a></li>
<li class="chapter" data-level="3.2.7" data-path="numerical-tax.html"><a href="numerical-tax.html#ordination-visualization-in-a-reduced-space"><i class="fa fa-check"></i><b>3.2.7</b> Ordination: Visualization in a Reduced Space</a></li>
<li class="chapter" data-level="3.2.8" data-path="numerical-tax.html"><a href="numerical-tax.html#review-and-discuss-4"><i class="fa fa-check"></i><b>3.2.8</b> Review and Discuss</a></li>
<li class="chapter" data-level="3.2.9" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-soil-profiles"><i class="fa fa-check"></i><b>3.2.9</b> Pair-Wise Distances Between Soil Profiles</a></li>
<li class="chapter" data-level="3.2.10" data-path="numerical-tax.html"><a href="numerical-tax.html#final-discussion"><i class="fa fa-check"></i><b>3.2.10</b> Final Discussion</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="numerical-tax.html"><a href="numerical-tax.html#excercises"><i class="fa fa-check"></i><b>3.3</b> Excercises</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="numerical-tax.html"><a href="numerical-tax.html#set-up-the-r-session"><i class="fa fa-check"></i><b>3.3.1</b> Set Up the R Session</a></li>
<li class="chapter" data-level="3.3.2" data-path="numerical-tax.html"><a href="numerical-tax.html#evaluating-missing-data"><i class="fa fa-check"></i><b>3.3.2</b> Evaluating Missing Data</a></li>
<li class="chapter" data-level="3.3.3" data-path="numerical-tax.html"><a href="numerical-tax.html#more-on-the-distance-matrix-and-how-to-make-one"><i class="fa fa-check"></i><b>3.3.3</b> More on the Distance Matrix and How to Make One</a></li>
<li class="chapter" data-level="3.3.4" data-path="numerical-tax.html"><a href="numerical-tax.html#hierachrical-clustering"><i class="fa fa-check"></i><b>3.3.4</b> Hierachrical Clustering</a></li>
<li class="chapter" data-level="3.3.5" data-path="numerical-tax.html"><a href="numerical-tax.html#centroid-and-medoid-partitioning-clustering-1"><i class="fa fa-check"></i><b>3.3.5</b> Centroid and Medoid (Partitioning) Clustering</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="numerical-tax.html"><a href="numerical-tax.html#practical-applications"><i class="fa fa-check"></i><b>3.4</b> Practical Applications</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-soil-profiles-1"><i class="fa fa-check"></i><b>3.4.1</b> Pair-Wise Distances Between Soil Profiles</a></li>
<li class="chapter" data-level="3.4.2" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-soil-series"><i class="fa fa-check"></i><b>3.4.2</b> Pair-Wise Distances Between Soil Series</a></li>
<li class="chapter" data-level="3.4.3" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-subgroup-level-taxa"><i class="fa fa-check"></i><b>3.4.3</b> Pair-Wise Distances Between Subgroup-Level Taxa</a></li>
<li class="chapter" data-level="3.4.4" data-path="numerical-tax.html"><a href="numerical-tax.html#soil-color-signatures"><i class="fa fa-check"></i><b>3.4.4</b> Soil Color Signatures</a></li>
<li class="chapter" data-level="3.4.5" data-path="numerical-tax.html"><a href="numerical-tax.html#clustering-of-soil-colors"><i class="fa fa-check"></i><b>3.4.5</b> Clustering of Soil Colors</a></li>
<li class="chapter" data-level="3.4.6" data-path="numerical-tax.html"><a href="numerical-tax.html#how-do-the-interpretations-compare"><i class="fa fa-check"></i><b>3.4.6</b> “How Do the Interpretations Compare?”</a></li>
<li class="chapter" data-level="3.4.7" data-path="numerical-tax.html"><a href="numerical-tax.html#mlra-concepts-via-climate-and-elevation-samples"><i class="fa fa-check"></i><b>3.4.7</b> MLRA Concepts via Climate and Elevation Samples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>4</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="linear-regression.html"><a href="linear-regression.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="linear-regression.html"><a href="linear-regression.html#linear-regression-example"><i class="fa fa-check"></i><b>4.2</b> Linear Regression Example</a></li>
<li class="chapter" data-level="4.3" data-path="linear-regression.html"><a href="linear-regression.html#data"><i class="fa fa-check"></i><b>4.3</b> Data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="linear-regression.html"><a href="linear-regression.html#henry-mount-database"><i class="fa fa-check"></i><b>4.3.1</b> Henry Mount Database</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-regression.html"><a href="linear-regression.html#aggregate-time-series"><i class="fa fa-check"></i><b>4.3.2</b> Aggregate Time Series</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-regression.html"><a href="linear-regression.html#final-dataset"><i class="fa fa-check"></i><b>4.3.3</b> Final Dataset</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-regression.html"><a href="linear-regression.html#spatial-data"><i class="fa fa-check"></i><b>4.4</b> Spatial data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="linear-regression.html"><a href="linear-regression.html#plot-coordinates"><i class="fa fa-check"></i><b>4.4.1</b> Plot Coordinates</a></li>
<li class="chapter" data-level="4.4.2" data-path="linear-regression.html"><a href="linear-regression.html#extracting-spatial-data"><i class="fa fa-check"></i><b>4.4.2</b> Extracting Spatial Data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-regression.html"><a href="linear-regression.html#exploratory-data-analysis-eda"><i class="fa fa-check"></i><b>4.5</b> Exploratory Data Analysis (EDA)</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="linear-regression.html"><a href="linear-regression.html#compare-samples-vs-population"><i class="fa fa-check"></i><b>4.5.1</b> Compare Samples vs Population</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="linear-regression.html"><a href="linear-regression.html#linear-modeling"><i class="fa fa-check"></i><b>4.6</b> Linear modeling</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="linear-regression.html"><a href="linear-regression.html#diagnostics"><i class="fa fa-check"></i><b>4.6.1</b> Diagnostics</a></li>
<li class="chapter" data-level="4.6.2" data-path="linear-regression.html"><a href="linear-regression.html#variable-selection-model-validation"><i class="fa fa-check"></i><b>4.6.2</b> Variable selection &amp; model validation</a></li>
<li class="chapter" data-level="4.6.3" data-path="linear-regression.html"><a href="linear-regression.html#final-model-accuracy-assessment"><i class="fa fa-check"></i><b>4.6.3</b> Final model &amp; accuracy assessment</a></li>
<li class="chapter" data-level="4.6.4" data-path="linear-regression.html"><a href="linear-regression.html#model-effects"><i class="fa fa-check"></i><b>4.6.4</b> Model Effects</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="linear-regression.html"><a href="linear-regression.html#generate-spatial-predictions"><i class="fa fa-check"></i><b>4.7</b> Generate spatial predictions</a></li>
<li class="chapter" data-level="4.8" data-path="linear-regression.html"><a href="linear-regression.html#create-map"><i class="fa fa-check"></i><b>4.8</b> Create Map</a></li>
<li class="chapter" data-level="4.9" data-path="linear-regression.html"><a href="linear-regression.html#additional-reading"><i class="fa fa-check"></i><b>4.9</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>5</b> Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="glm.html"><a href="glm.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="glm.html"><a href="glm.html#logistic-regression"><i class="fa fa-check"></i><b>5.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="5.3" data-path="glm.html"><a href="glm.html#examples-1"><i class="fa fa-check"></i><b>5.3</b> Examples</a></li>
<li class="chapter" data-level="5.4" data-path="glm.html"><a href="glm.html#exercise-1"><i class="fa fa-check"></i><b>5.4</b> Exercise</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="glm.html"><a href="glm.html#load-packages"><i class="fa fa-check"></i><b>5.4.1</b> Load packages</a></li>
<li class="chapter" data-level="5.4.2" data-path="glm.html"><a href="glm.html#read-in-data"><i class="fa fa-check"></i><b>5.4.2</b> Read in data</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="glm.html"><a href="glm.html#exploratory-analysis-eda"><i class="fa fa-check"></i><b>5.5</b> Exploratory analysis (EDA)</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="glm.html"><a href="glm.html#data-wrangling"><i class="fa fa-check"></i><b>5.5.1</b> Data wrangling</a></li>
<li class="chapter" data-level="5.5.2" data-path="glm.html"><a href="glm.html#geomorphic-data"><i class="fa fa-check"></i><b>5.5.2</b> Geomorphic data</a></li>
<li class="chapter" data-level="5.5.3" data-path="glm.html"><a href="glm.html#soil-scientist-bias"><i class="fa fa-check"></i><b>5.5.3</b> Soil Scientist Bias</a></li>
<li class="chapter" data-level="5.5.4" data-path="glm.html"><a href="glm.html#plot-coordinates-1"><i class="fa fa-check"></i><b>5.5.4</b> Plot coordinates</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="glm.html"><a href="glm.html#exercise-1-view-the-data"><i class="fa fa-check"></i><b>5.6</b> Exercise 1: View the data</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="glm.html"><a href="glm.html#extracting-spatial-data-1"><i class="fa fa-check"></i><b>5.6.1</b> Extracting spatial data</a></li>
<li class="chapter" data-level="5.6.2" data-path="glm.html"><a href="glm.html#examine-spatial-data"><i class="fa fa-check"></i><b>5.6.2</b> Examine spatial data</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="glm.html"><a href="glm.html#constructing-the-model"><i class="fa fa-check"></i><b>5.7</b> Constructing the model</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="glm.html"><a href="glm.html#diagnostic"><i class="fa fa-check"></i><b>5.7.1</b> Diagnostic</a></li>
<li class="chapter" data-level="5.7.2" data-path="glm.html"><a href="glm.html#variable-selection-model-validation-1"><i class="fa fa-check"></i><b>5.7.2</b> Variable Selection &amp; model validation</a></li>
<li class="chapter" data-level="5.7.3" data-path="glm.html"><a href="glm.html#final-model-accuracy"><i class="fa fa-check"></i><b>5.7.3</b> Final model &amp; accuracy</a></li>
<li class="chapter" data-level="5.7.4" data-path="glm.html"><a href="glm.html#model-effects-1"><i class="fa fa-check"></i><b>5.7.4</b> Model effects</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="glm.html"><a href="glm.html#generate-spatial-predictions-1"><i class="fa fa-check"></i><b>5.8</b> Generate spatial predictions</a></li>
<li class="chapter" data-level="5.9" data-path="glm.html"><a href="glm.html#additional-reading-1"><i class="fa fa-check"></i><b>5.9</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tree-based-models.html"><a href="tree-based-models.html"><i class="fa fa-check"></i><b>6</b> Tree-based Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="tree-based-models.html"><a href="tree-based-models.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="tree-based-models.html"><a href="tree-based-models.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>6.2</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="tree-based-models.html"><a href="tree-based-models.html#getting-data-into-r-and-exporting-to-shapefile"><i class="fa fa-check"></i><b>6.2.1</b> Getting Data Into R and Exporting to Shapefile</a></li>
<li class="chapter" data-level="6.2.2" data-path="tree-based-models.html"><a href="tree-based-models.html#examining-data-in-r"><i class="fa fa-check"></i><b>6.2.2</b> Examining Data in R</a></li>
<li class="chapter" data-level="6.2.3" data-path="tree-based-models.html"><a href="tree-based-models.html#exercise-1-1"><i class="fa fa-check"></i><b>6.2.3</b> Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="tree-based-models.html"><a href="tree-based-models.html#classification-and-regression-trees-cart"><i class="fa fa-check"></i><b>6.3</b> Classification and Regression Trees (CART)</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="tree-based-models.html"><a href="tree-based-models.html#exercise-2-rpart"><i class="fa fa-check"></i><b>6.3.1</b> Exercise 2: rpart</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="tree-based-models.html"><a href="tree-based-models.html#random-forest"><i class="fa fa-check"></i><b>6.4</b> Random Forest</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="tree-based-models.html"><a href="tree-based-models.html#exercise-3-randomforest"><i class="fa fa-check"></i><b>6.4.1</b> Exercise 3: randomForest</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="tree-based-models.html"><a href="tree-based-models.html#prediction-using-tree-based-models"><i class="fa fa-check"></i><b>6.5</b> Prediction using Tree-based Models</a></li>
<li class="chapter" data-level="6.6" data-path="tree-based-models.html"><a href="tree-based-models.html#summary"><i class="fa fa-check"></i><b>6.6</b> Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html"><i class="fa fa-check"></i><b>A</b> Accuracy and Uncertainty for Categorical Predictions</a>
<ul>
<li class="chapter" data-level="A.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#status-quo"><i class="fa fa-check"></i><b>A.1</b> Status Quo</a></li>
<li class="chapter" data-level="A.2" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#theses"><i class="fa fa-check"></i><b>A.2</b> Theses</a></li>
<li class="chapter" data-level="A.3" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#soap-box-time"><i class="fa fa-check"></i><b>A.3</b> Soap Box Time</a></li>
<li class="chapter" data-level="A.4" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#concept-demonstration-via-simulated-data"><i class="fa fa-check"></i><b>A.4</b> Concept Demonstration via Simulated Data</a></li>
<li class="chapter" data-level="A.5" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#accuracy"><i class="fa fa-check"></i><b>A.5</b> Accuracy</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#confusion-matrix-area-under-roc"><i class="fa fa-check"></i><b>A.5.1</b> Confusion Matrix / Area Under ROC</a></li>
<li class="chapter" data-level="A.5.2" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#brier-scores"><i class="fa fa-check"></i><b>A.5.2</b> Brier Scores</a></li>
<li class="chapter" data-level="A.5.3" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#tau-and-weighted-tau-class-similarity"><i class="fa fa-check"></i><b>A.5.3</b> Tau and Weighted Tau (class-similarity)</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#uncertainty-1"><i class="fa fa-check"></i><b>A.6</b> Uncertainty</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#shanon-entropy"><i class="fa fa-check"></i><b>A.6.1</b> Shanon Entropy</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#review"><i class="fa fa-check"></i><b>A.7</b> Review</a></li>
<li class="chapter" data-level="A.8" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#example-implementation"><i class="fa fa-check"></i><b>A.8</b> Example Implementation</a></li>
<li class="chapter" data-level="A.9" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#resources"><i class="fa fa-check"></i><b>A.9</b> Resources</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#evaluating-accuracy-of-categorical-probabilistic-predictions"><i class="fa fa-check"></i><b>A.9.1</b> Evaluating Accuracy of Categorical / Probabilistic Predictions</a></li>
<li class="chapter" data-level="A.9.2" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#sampling-and-stability-of-estimates"><i class="fa fa-check"></i><b>A.9.2</b> Sampling and Stability of Estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="commentary-selecting-a-modeling-framework.html"><a href="commentary-selecting-a-modeling-framework.html"><i class="fa fa-check"></i><b>B</b> Commentary: Selecting a Modeling Framework</a>
<ul>
<li class="chapter" data-level="B.1" data-path="commentary-selecting-a-modeling-framework.html"><a href="commentary-selecting-a-modeling-framework.html#soil-temperature-regime-modeling-in-ca792"><i class="fa fa-check"></i><b>B.1</b> Soil Temperature Regime Modeling in CA792</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistics for Soil Survey - Part 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="numerical-tax" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Numerical Taxonomy and Ordination</h1>
<p><img src="static-figures/soils-by-pigments.png" /></p>
<div id="introduction-1" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<p>Nearly every aspect of soil survey involves the question: “Is X more similar to Y or to Z?” The quantification of similarity within a collection of horizons, pedons, components, map units, or even landscapes represents an exciting new way to enhance the precision and accuracy of the day-to-day work of soil scientists. After completing this module, you should be able to quantitatively organize objects based on measured or observed characteristics in a consistent and repeatable manner. Perhaps you will find a solution to the long-standing “similar or dissimilar” question.</p>
<div id="objectives" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Objectives</h3>
<ul>
<li>Learn essential vocabulary used in the field of numerical taxonomy. Review some of the literature.</li>
<li>Gain experience with R functions and packages commonly used for clustering and ordination.</li>
<li>Learn how to create and interpret a distance matrix and appropriate distance metrics.</li>
<li>Learn how to create and interpret a dendrogram.</li>
<li>Lean the basics and application of hierarchical clustering methods.</li>
<li>Lean the basics and application of partitioning clustering methods.</li>
<li>Learn the basics and application of ordination methods.</li>
<li>Apply skills to a range of data sources for soils and vegetation.</li>
<li>Apply techniques from numerical taxonomy to addressing the “similar or dissimilar” question.</li>
<li>Learn some strategies for coping with missing data.</li>
</ul>
</div>
</div>
<div id="whirlwind-tour" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Whirlwind Tour</h2>
<p>Most of the examples featured in this whirlwind tour are based on soil data from <a href="https://dl.sciencesocieties.org/publications/sssaj/articles/73/6/2087">McGahan, D.G., Southard, R.J, Claassen, V.P. 2009. Plant-available calcium varies widely in soils on serpentinite landscapes. Soil Sci. Soc. Am. J. 73: 2087-2095.</a> These data are available in the dataset “sp4” that is built into <code>aqp</code> package for R.</p>
<div id="similarity-disimilarty-and-distance" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Similarity, Disimilarty, and Distance</h3>
<p>There are shelves of books and thousands of academic articles describing the theory and applications of “clustering” and “ordination” methods. This body of knowledge is commonly described as the field of <strong>numerical taxonomy</strong> <span class="citation">(<a href="#ref-Sneath1973" role="doc-biblioref">Sneath and Sokal 1973</a>)</span>. Central to this field is the quantification of <strong>similarity</strong> among “individuals” based on a relevant set of “characteristics.” Individuals are typically described as rows of data with a single characteristic per column, together referred to as a <strong>data matrix</strong>. For example:</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
name
</th>
<th style="text-align:center;">
clay
</th>
<th style="text-align:center;">
sand
</th>
<th style="text-align:center;">
Mg
</th>
<th style="text-align:center;">
Ca
</th>
<th style="text-align:center;">
CEC_7
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
21
</td>
<td style="text-align:center;">
46
</td>
<td style="text-align:center;">
25.7
</td>
<td style="text-align:center;">
9.0
</td>
<td style="text-align:center;">
23.0
</td>
</tr>
<tr>
<td style="text-align:center;">
ABt
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
42
</td>
<td style="text-align:center;">
23.7
</td>
<td style="text-align:center;">
5.6
</td>
<td style="text-align:center;">
21.4
</td>
</tr>
<tr>
<td style="text-align:center;">
Bt1
</td>
<td style="text-align:center;">
32
</td>
<td style="text-align:center;">
40
</td>
<td style="text-align:center;">
23.2
</td>
<td style="text-align:center;">
1.9
</td>
<td style="text-align:center;">
23.7
</td>
</tr>
<tr>
<td style="text-align:center;">
Bt2
</td>
<td style="text-align:center;">
55
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
44.3
</td>
<td style="text-align:center;">
0.3
</td>
<td style="text-align:center;">
43.0
</td>
</tr>
</tbody>
</table>
<p>Quantitative measures of similarity are more conveniently expressed as distance, or dissimilarity; in part because of convention and in part because of computational efficiency. In the simplest case, dissimilarity can be computed as the shortest distance between individuals in property-space. Another name for the shortest linear distance between points is the <a href="https://en.wikipedia.org/wiki/Euclidean_distance"><strong>Euclidean distance</strong></a>. Evaluated in two dimensions (between individuals <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span>), the Euclidean distance is calculated as follows:</p>
<p><span class="math display">\[D(p,q) = \sqrt{(p_{1} - q_{1})^{2} + (p_{2} - q_{2})^{2}}\]</span></p>
<p>where <span class="math inline">\(p_{1}\)</span> is the 1st characteristic (or dimension) of individual <span class="math inline">\(p\)</span>.</p>
<p>There are many other ways to define “distance” (e.g. distance metrics), but they will be covered later.</p>
<p>Using the sand and clay percentages from the data above, dissimilarity is represented as the length of the line connecting any two individuals in property space.</p>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-3-1.svg" width="480" style="display: block; margin: auto;" /></p>
<p>The following is a matrix of all pair-wise distances (the <a href="https://en.wikipedia.org/wiki/Distance_matrix"><strong>distance matrix</strong></a>):</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">A</th>
<th align="right">ABt</th>
<th align="right">Bt1</th>
<th align="right">Bt2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="right">0.0</td>
<td align="right"><b>7.2</b></td>
<td align="right">12.5</td>
<td align="right">38.9</td>
</tr>
<tr class="even">
<td align="left">ABt</td>
<td align="right"><b>7.2</b></td>
<td align="right">0.0</td>
<td align="right">5.4</td>
<td align="right"><b>31.8</b></td>
</tr>
<tr class="odd">
<td align="left">Bt1</td>
<td align="right">12.5</td>
<td align="right">5.4</td>
<td align="right">0.0</td>
<td align="right">26.4</td>
</tr>
<tr class="even">
<td align="left">Bt2</td>
<td align="right">38.9</td>
<td align="right"><b>31.8</b></td>
<td align="right">26.4</td>
<td align="right">0.0</td>
</tr>
</tbody>
</table>
<p>Note that this is the full form of the <a href="https://en.wikipedia.org/wiki/Distance_matrix"><strong>distance matrix</strong></a>. In this form, zeros are on the diagonal (i.e. the distance between an individual and itself is zero) and the upper and lower “triangles” are symmetric. The lower triangle is commonly used by most algorithms to encode pair-wise distances.</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">A</th>
<th align="right">ABt</th>
<th align="right">Bt1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABt</td>
<td align="right"><b>7.2</b></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">Bt1</td>
<td align="right">12.5</td>
<td align="right">5.4</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">Bt2</td>
<td align="right">38.9</td>
<td align="right"><b>31.8</b></td>
<td align="right">26.4</td>
</tr>
</tbody>
</table>
<p>Interpretation of the matrix is simple: Individual “A” is more like “ABt” than like “Bt1.” It is important to note that quantification of dissimilarity (distance) among individuals is always relative: “X is more like Y, as compared to Z.”</p>
<div id="distances-you-can-see-perceptual-color-difference" class="section level4" number="3.2.1.1">
<h4><span class="header-section-number">3.2.1.1</span> Distances You Can See: Perceptual Color Difference</h4>
<p>Simulated redoximorphic feature colors, constrast classes and CIE <span class="math inline">\(\Delta{E_{00}}\)</span>. Details <a href="https://ncss-tech.github.io/AQP/aqp/color-contrast.html">here</a>.
<img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-4-1.svg" width="768" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="standardization-of-characteristics" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Standardization of Characteristics</h3>
<p>Euclidean distance doesn’t make much sense if the characteristics do not share a common unit of measure or range of values. Nor is it relevant when some characteristics are categorical and some are continuous. For example, distances are distorted if you compare clay (%) and exchangeable Ca (cmol/kg).</p>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-5-1.svg" width="480" style="display: block; margin: auto;" /></p>
<p>In this example, exchangeable Ca contributes less to the distance between individuals than clay content, effectively down-weighting the importance of the exchangeable Ca. Typically, characteristics are given equal weight <span class="citation">(<a href="#ref-Sneath1973" role="doc-biblioref">Sneath and Sokal 1973</a>)</span>; however, weighting is much simpler to apply after <strong>standardization</strong>.</p>
<p><strong>Standardization</strong> of the data matrix solves the problem of unequal ranges or units of measure, typically by subtraction of the mean and division by standard deviation (<a href="https://en.wikipedia.org/wiki/Standard_score">z-score transformation</a>).</p>
<p><span class="math display">\[x_{std} = \frac{x - mean(x)}{sd(x)}\]</span></p>
<p>There are several other <strong>standardization</strong> methods covered later. The new data matrix looks like the following:</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
name
</th>
<th style="text-align:center;">
clay
</th>
<th style="text-align:center;">
sand
</th>
<th style="text-align:center;">
Mg
</th>
<th style="text-align:center;">
Ca
</th>
<th style="text-align:center;">
CEC_7
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
-0.86
</td>
<td style="text-align:center;">
0.88
</td>
<td style="text-align:center;">
-0.35
</td>
<td style="text-align:center;">
1.23
</td>
<td style="text-align:center;">
-0.47
</td>
</tr>
<tr>
<td style="text-align:center;">
ABt
</td>
<td style="text-align:center;">
-0.45
</td>
<td style="text-align:center;">
0.40
</td>
<td style="text-align:center;">
-0.55
</td>
<td style="text-align:center;">
0.36
</td>
<td style="text-align:center;">
-0.63
</td>
</tr>
<tr>
<td style="text-align:center;">
Bt1
</td>
<td style="text-align:center;">
-0.12
</td>
<td style="text-align:center;">
0.15
</td>
<td style="text-align:center;">
-0.60
</td>
<td style="text-align:center;">
-0.59
</td>
<td style="text-align:center;">
-0.40
</td>
</tr>
<tr>
<td style="text-align:center;">
Bt2
</td>
<td style="text-align:center;">
1.43
</td>
<td style="text-align:center;">
-1.43
</td>
<td style="text-align:center;">
1.49
</td>
<td style="text-align:center;">
-1.00
</td>
<td style="text-align:center;">
1.49
</td>
</tr>
</tbody>
</table>
<p>Using the standardized data matrix, distances computed in the property space of clay and exchangeable calcium are unbiased by the unique central tendency or spread of each character.</p>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-7-1.svg" width="480" style="display: block; margin: auto;" /></p>
<p>Rarely can the question of “dissimilarity” be answered with only two characteristics (dimensions). Euclidean distance, however, can be extended to an arbitrary number of <span class="math inline">\(n\)</span> dimensions.</p>
<p><span class="math display">\[D(p,q) = \sqrt{ \sum_{i=1}^{n}{(p_{i} - q_{i})^{2}} }\]</span></p>
<p>In the equation above, <span class="math inline">\(i\)</span> is one of <span class="math inline">\(n\)</span> total characteristics. Imagining what distance “looks like” is difficult if there are more than three dimensions. Instead, examine the distance matrix calculated using all five characteristics.</p>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-8-1.svg" width="624" style="display: block; margin: auto;" /></p>
<p>Rescaling to the interval {0,1}.
<img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-9-1.svg" width="624" style="display: block; margin: auto;" /></p>
<p>You can now begin to describe dissimilarity between individuals using an arbitrary number of (relevant) characteristics. You can make statements like <em>“The A horizon is roughly 2x more similar to the ABt horizon than it is to the Bt horizon.”</em> Although this is a trivial example, the utility of generalizing these methods to soil survey operations should be obvious.</p>
<div id="review-and-discuss" class="section level4" number="3.2.2.1">
<h4><span class="header-section-number">3.2.2.1</span> Review and Discuss</h4>
<ul>
<li>What are the “data matrix” and “distance matrix?”</li>
<li>What is standardization, and why is it important?</li>
<li>What is the largest impediment to creating a distance matrix from NASIS and KSSL data?</li>
<li><strong>Key point:</strong> Each characteristic is its own dimension in property-space.</li>
<li>Sand, clay, and CEC = 3 dimensions.</li>
<li>Sand, clay, CEC, OC, and horizon depth = 5 dimensions.</li>
<li>Multiple dimensions are simple to define in code but <a href="https://youtu.be/N0WjV6MmCyM">are hard to visualize</a>.</li>
<li>The <a href="https://en.wikipedia.org/wiki/Curse_of_dimensionality">curse of dimensionality</a>.</li>
</ul>
</div>
</div>
<div id="missing-data" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Missing Data</h3>
<p>Missing data are a fact of life. Soil scientists are quite familiar with missing lab data (<em>“Why didn’t we request optical grain counts?”</em>) or missing essential NASIS pedon data elements, such as horizon bottom depth, estimated clay fraction, or pH. Nearly all of the methods described in this document are very sensitive to missing data. In other words, they won’t work! Following are a couple of possible solutions:</p>
<ul>
<li>Fix the missing data if at all possible,</li>
<li>Estimate the missing data values from know relationships to other properties or a group-wise mean or median, or</li>
<li>Remove records containing any missing data.</li>
</ul>
</div>
<div id="visualizing-pair-wise-distances-the-dendrogram" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Visualizing Pair-Wise Distances: The Dendrogram</h3>
<p><a href="http://en.wikipedia.org/wiki/Dendrogram">Dendrograms</a> are a convenient approximation of <a href="http://hymenoptera.tamu.edu/courses/ento601/pdf/Sokal_1966.pdf">pair-wise distances</a> between individuals (after application of hierarchical grouping criteria; more on this later). Dissimilarity between branches is proportional to the level at which branches merge: branching at higher levels (relative to the root of the tree) suggests greater dissimilarity; branching at lower levels suggests greater similarity. Consider the previous example in which distance between individuals was defined in terms of sand and clay percentages.</p>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-10-1.svg" width="960" style="display: block; margin: auto;" /></p>
<p>Interpretation is simple. Euclidean distance in property-space is directly proportional to branching height in the corresponding dendrogram. Visualizing the geometry of pair-wise distances in more than three dimensions is difficult. A dendrogram, however, can conveniently summarize a distance matrix created from an arbitrary number of characteristics (dimensions). It is important to note that some information about pair-wise distances is lost or distorted in the dendrogram. Distortion is <em>least</em> near the terminal “leaves” of the dendrogram. This phenomena is analogous to the distortion generated by a map projection. It is impossible to flatten a higher-dimensional entity to a lower-dimensional form without causing distortion.</p>
</div>
<div id="re-arranging-a-dendrogram-for-clarity" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Re-arranging a Dendrogram for Clarity</h3>
<p>The branches of a dendrogram can be rotated like a mobile, so that the final ordering of the terminal “leaves” approximates an alternate ranking. For example, branches of the following dendrogram (right-hand side) have been rotated to approximate the expected hydrologic gradient from summit to toeslope.</p>
<p><img src="static-figures/ava-block-diagram-hillslope.png" /></p>
<div id="review-and-discuss-1" class="section level4" number="3.2.5.1">
<h4><span class="header-section-number">3.2.5.1</span> Review and Discuss</h4>
<ul>
<li>Do you have any questions about dendrogram interpretation? Dendrograms are used extensively in the rest of this chapter.</li>
<li>If you were explaining how to interpret a dendrogram to someone, would you start at the roots or leaves? Why?</li>
</ul>
</div>
</div>
<div id="cluster-analysis-finding-groups-in-data" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Cluster Analysis: Finding Groups in Data</h3>
<p><a href="https://en.wikipedia.org/wiki/Cluster_analysis"><strong>Cluster analysis</strong></a> is a massive topic that deals with the seemingly simple task of finding useful groups within a dataset. This topic and the methods used are also referred to as “unsupervised classification” in the fields of remote sensing and GIS. All of the <a href="https://cran.r-project.org/web/views/Multivariate.html">available algorithms</a> will find groups in a given dataset; however, it is up to the subject expert to determine the following:</p>
<ol style="list-style-type: decimal">
<li>Suitable characteristics and standardization method,</li>
<li>Appropriate clustering algorithm,</li>
<li>Criteria to determine the “right” number of clusters,</li>
<li>Limitations of the selected algorithm,</li>
<li>Interpretation of the final grouping based on subject knowledge, and</li>
<li>The possibility of needing to start over at step 1.</li>
</ol>
<div id="using-color-to-communicate-results-of-clustering-or-ordination" class="section level4" number="3.2.6.1">
<h4><span class="header-section-number">3.2.6.1</span> Using Color to Communicate Results of Clustering or Ordination</h4>
<p>Note that the widespread use of color in the following examples is not for aesthetic purposes. Colors are convenient for tri-variate data-spaces because you can visually integrate the information into a self-consistent set of classes.</p>
</div>
<div id="hierarchical-clustering" class="section level4" number="3.2.6.2">
<h4><span class="header-section-number">3.2.6.2</span> Hierarchical Clustering</h4>
<p><a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">Hierarchical clustering</a> is useful when a full <strong>distance matrix</strong> is available and the optimal number of clusters is not yet known. This form of clustering creates a data structure that can encode “grouping” information from one cluster to as many clusters as there are individuals. The expert must determine the optimal place to “cut the tree” and generate a fixed set of clusters. The results from a hierarchical clustering operation are nearly always presented as a dendrogram.</p>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-11-1.svg" width="960" style="display: block; margin: auto;" /></p>
<div id="methods" class="section level5" number="3.2.6.2.1">
<h5><span class="header-section-number">3.2.6.2.1</span> Methods</h5>
<p>There are two main types of <a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">hierarchical clustering</a>.</p>
<ol style="list-style-type: decimal">
<li><strong>Agglomerative:</strong> Start with individuals and iteratively combine into larger and larger groups.</li>
<li><strong>Divisive:</strong> Start with all individuals and iteratively split into smaller and smaller groups.</li>
</ol>
<p>Both methods are strongly influenced by the choice of <strong>standardization</strong> method and <strong>distance metric</strong>. Both methods require a full, pair-wise distance matrix as input. This requirement can limit the use of hierarchical clustering to datasets that can be fit into memory.</p>
<div style="width: 75%; margin: auto; border: 1px solid black; padding 5px;">
<img src="static-figures/which-direction.png">
</div>
<p><br></p>
<p>The agglomerative methods also depend on the choice of <a href="https://en.wikipedia.org/wiki/Hierarchical_clustering#Linkage_criteria">linkage criterion</a>. Some of these criteria include:</p>
<ol style="list-style-type: decimal">
<li>Average: usually generates spherical clusters, default in <code>agnes()</code> and recommended by <span class="citation">(<a href="#ref-Kaufman2005" role="doc-biblioref">Kaufman and Rousseeuw 2005</a>)</span>,</li>
<li>Single linkage: usually generates elongated clusters,</li>
<li>Complete linkage: usually generates small, compact clusters,</li>
<li>Ward’s (minimum variance) method,</li>
<li>Weighted average (or Gower’s) linkage: spherical clusters of roughly equal size, and</li>
<li>“Flexible strategy”: adjustable linkage based on parameter <span class="math inline">\(\alpha\)</span>.<br />
</li>
<li>“Flexible UPGMA” <span class="citation">(<a href="#ref-belbin1992" role="doc-biblioref">Belbin, Faith, and Milligan 1992</a>)</span>: adjustable linkage based on parameter <span class="math inline">\(\beta\)</span>.</li>
</ol>
<p>See <span class="citation">(<a href="#ref-Kaufman2005" role="doc-biblioref">Kaufman and Rousseeuw 2005</a>)</span>, <span class="citation">(<a href="#ref-Arkley1976" role="doc-biblioref">Arkley 1976</a>)</span>, <span class="citation">(<a href="#ref-Legendre1998" role="doc-biblioref">Legendre and Legendre 2012</a>)</span>, and <a href="https://www.rdocumentation.org/packages/cluster/versions/2.0.7-1/topics/agnes"><code>agnes()</code> manual page</a> for a detailed description of these linkage criteria. Selection of linkage criteria can be quantitatively evaluated using the <a href="https://en.wikipedia.org/wiki/Cophenetic_correlation">cophenetic correlation</a>; and index of how well a dendrogram preserves the original pair-wise distances. <a href="https://stats.stackexchange.com/questions/195446/choosing-the-right-linkage-method-for-hierarchical-clustering">This thread</a> on StackExchange has a nice summary of various linkage criteria. I really like <a href="https://www.stat.cmu.edu/~ryantibs/datamining/lectures/05-clus2.pdf">these slides by Brian Tibshirani</a> on the topic of agglomerative method selection. More on this later.</p>
<div id="review-and-discuss-2" class="section level6" number="3.2.6.2.1.1">
<h6><span class="header-section-number">3.2.6.2.1.1</span> Review and Discuss</h6>
<ul>
<li>The simplicity and lack of decisions make the divisive method convenient for most work.</li>
<li>The top-down approach is similar to the way in which we describe soil morphology and taxonomy.</li>
<li>Linkage criteria should be selected based on the hypothesized shape of clusters or prior subject knowledge.</li>
<li>When selecting a method, read/think about it; don’t just go “fishing.”</li>
<li><em>Personal opinion:</em> I usually select divisive hierarchical clustering over the other methods: structures <em>seem</em> to be generally more interpretable.</li>
</ul>
</div>
</div>
</div>
<div id="centroid-and-medoid-partitioning-clustering" class="section level4" number="3.2.6.3">
<h4><span class="header-section-number">3.2.6.3</span> Centroid and Medoid (Partitioning) Clustering</h4>
<p>Centroid and medoid cluster analyses are commonly referred to as <a href="https://en.wikipedia.org/wiki/K-means_clustering">k-means</a>-style analysis. “K-means,” however, is just one of many possible clustering algorithms that partition property-space into a fixed number of groups. These type of algorithms can be applied to very large datasets because they do not rely on the <strong>distance matrix</strong>. Instead, they are based on an iterative shuffling of group “centroids” until some criterion is minimized, for example, the mean variance within groups.</p>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-12-1.svg" width="576" style="display: block; margin: auto;" /></p>
<div id="methods-1" class="section level5" number="3.2.6.3.1">
<h5><span class="header-section-number">3.2.6.3.1</span> Methods</h5>
<p>This section describes three (out of many) of the most important partitioning-type algorithms.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/K-means_clustering">K-means</a>: Groups of individuals are partitioned around newly created “<a href="https://en.wikipedia.org/wiki/Centroid">centroids</a>.” Resulting clusters approximately spherical and contain an approximately equal number of individuals.</li>
<li><a href="https://en.wikipedia.org/wiki/K-medoids">K-medoids</a>: Groups of individuals are partitioned around selected “<a href="https://en.wikipedia.org/wiki/Medoid">medoids</a>.”</li>
<li><a href="https://en.wikipedia.org/wiki/Fuzzy_clustering">Fuzzy clustering</a>: Individuals are assigned a “fuzzy membership” value for each partition of property-space.</li>
</ul>
<p>All of these methods are sensitive to the type of <strong>standardization</strong> applied to the characteristics. These methods rely on iterative minimization of one or more criteria; therefore, each clustering “run” may generate slightly different output. Most implementations re-run the algorithm until it stabilizes.</p>
<div id="review-and-discuss-3" class="section level6" number="3.2.6.3.1.1">
<h6><span class="header-section-number">3.2.6.3.1.1</span> Review and Discuss</h6>
<ul>
<li>What is the difference between a “medoid” and a “centroid?” Can you think of a way in which both concepts could be applied to the grouping of soils data?</li>
<li>medoids are tied to individuals, centroids are hypothetical (calculated)</li>
<li>Fuzzy clustering is also referred to as “soft clustering,” while the other two methods are referred to as “hard clustering.” Sometimes, using both can be helpful, especially if individuals straddle the line between groups.</li>
<li>Each method has its own strength and weakness, for example <a href="http://varianceexplained.org/r/kmeans-free-lunch/">here is a nice summary of the limitations of k-means</a>.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="ordination-visualization-in-a-reduced-space" class="section level3" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> Ordination: Visualization in a Reduced Space</h3>
<p>Humans are generally quite good at extracting spatial patterns, almost instantly, from two dimensional fields: faces, written language, etc. Sadly, this ability does not extend beyond two or three dimensions. The term <a href="https://en.wikipedia.org/wiki/Ordination_(statistics)"><strong>ordination</strong></a> refers to a suite of methods that project coordinates in a high-dimensional space into suitable coordinates in a low-dimensional (reduced) space. Map projections are a simple form of ordination: coordinates from the curved surface of the Earth are projected to a two-dimensional plane. As with any projection, there are assumptions, limitations, and distortions. <a href="https://youtu.be/N0WjV6MmCyM">Carl Sagan gives a beautiful demonstration of this concept using shadows, in this excerpt from <em>Cosmos</em>.</a> <a href="http://colah.github.io/posts/2014-10-Visualizing-MNIST/">Here is another excellent demonstration based on handwriting recognition.</a></p>
Hole and Hironaka <span class="citation">(<a href="#ref-Hole1960" role="doc-biblioref">1960</a>)</span> were some of the first pedologists to apply ordination methods to soils data. The main figure from <a href="https://dl.sciencesocieties.org/publications/sssaj/pdfs/24/4/SS0240040309">their classic paper</a> was hand-drawn, based on a physical model (constructed from wooden dowels and spheres!) of the ordination.
<div style="width: 75%; margin: auto; border: 1px solid black; padding 5px;">
<img src="static-figures/hole-et-al-ordination.png">
</div>
<div id="major-types-of-ordination" class="section level4" number="3.2.7.1">
<h4><span class="header-section-number">3.2.7.1</span> Major Types of Ordination</h4>
<p>Of the many possible ordination <a href="http://ordination.okstate.edu/">methods</a>, there are two major types to keep in mind:</p>
<ol style="list-style-type: decimal">
<li><p>Constrained ordination: coordinates in the reduced space are subject to some kind of constraint (more rigid, simple interpretation). <a href="https://en.wikipedia.org/wiki/Principal_component_analysis">Principal component analysis</a> (PCA) is one of the simplest and most widely used ordination methods. The reduced space (“principal components”) are defined by linear combinations of characteristics.</p></li>
<li><p>Unconstrained ordination: coordinates in the reduced space are not subject to any kind of constraint (more flexible, less interpretable). <a href="https://en.wikipedia.org/wiki/Multidimensional_scaling#Non-metric_multidimensional_scaling">“Non-metric” multidimensional scaling</a> (nMDS) attempts to generate a reduced space that minimizes distortion in proportional similarity; i.e., similar individuals are near each other in the reduced space, dissimilar individuals are farther apart. The “non-metric” adjective implies that exact distances are not preserved.</p></li>
</ol>
<p>See <span class="citation">(<a href="#ref-Legendre1998" role="doc-biblioref">Legendre and Legendre 2012</a>)</span> for a comprehensive listing of methods, associated theory, and ecological applications.</p>
</div>
<div id="an-example-of-nmds-applied-to-soil-data" class="section level4" number="3.2.7.2">
<h4><span class="header-section-number">3.2.7.2</span> An Example of nMDS Applied to Soil Data</h4>
<p>The following example is based on a <strong>data matrix</strong> containing lab measurements of clay fraction, sand fraction, exchangeable Ca, exchangeable Mg, and CEC measured by NH<sub>4</sub>-Ac at pH 7.</p>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">clay</th>
<th align="right">sand</th>
<th align="right">Mg</th>
<th align="right">Ca</th>
<th align="right">CEC_7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="right">-0.41</td>
<td align="right">0.21</td>
<td align="right">0.06</td>
<td align="right">0.44</td>
<td align="right">-0.23</td>
</tr>
<tr class="even">
<td align="left">ABt</td>
<td align="right">0.04</td>
<td align="right">-0.07</td>
<td align="right">-0.06</td>
<td align="right">-0.13</td>
<td align="right">-0.38</td>
</tr>
<tr class="odd">
<td align="left">Bt1</td>
<td align="right">0.41</td>
<td align="right">-0.21</td>
<td align="right">-0.09</td>
<td align="right">-0.74</td>
<td align="right">-0.16</td>
</tr>
<tr class="even">
<td align="left"><b>…</b></td>
<td align="right"><b>…</b></td>
<td align="right"><b>…</b></td>
<td align="right"><b>…</b></td>
<td align="right"><b>…</b></td>
<td align="right"><b>…</b></td>
</tr>
</tbody>
</table>
<p>Note that distances between individuals, within clusters, and between clusters <strong>is more apparent in the nMDS</strong> representation of the distance matrix. Similar information is embedded in the dendrogram but it is not as intuitive.
<img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-13-1.svg" width="960" style="display: block; margin: auto;" /></p>
<div id="interpreting-the-results" class="section level5" number="3.2.7.2.1">
<h5><span class="header-section-number">3.2.7.2.1</span> Interpreting the Results</h5>
<p>We can conveniently annotate the results of an ordination with contextual information, such as the approximate trends in clay content or CEC. Note that ordination methods represent a <em>flattening</em> of multi-dimensional data space, and in the case of nMDS, preserve proportional (vs. exact) pair-wise distances. Therefore, it is quite common for surfaces (the contours below) fit to the 2D ordination to have complex patterns.
<img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-14-1.svg" width="960" style="display: block; margin: auto;" /></p>
<p>Putting the clustering results into context is important: recall that we are working with <em>individuals</em> that represent genetic horizons that have been clustered according to 5 physical / chemical properties (<em>characteristics</em>). Differences in CEC by NH4-Ac are one of the strongest contributors to the pair-wise distances and overall clustering structure.
<img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-15-1.svg" width="960" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="review-and-discuss-4" class="section level3" number="3.2.8">
<h3><span class="header-section-number">3.2.8</span> Review and Discuss</h3>
<ul>
<li>Which visualization of the distance matrix was simpler to interpret: Dendrogram or ordination by nMDS?</li>
<li>Do you have any questions about the figures?</li>
<li>Do you have any guesses on what the clusters represent?</li>
</ul>
</div>
<div id="pair-wise-distances-between-soil-profiles" class="section level3" number="3.2.9">
<h3><span class="header-section-number">3.2.9</span> Pair-Wise Distances Between Soil Profiles</h3>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-16-1.svg" width="768" style="display: block; margin: auto;" /></p>
<p><img src="static-figures/GHL-pair-wise-distances.png" /></p>
<p>Additional examples / elaboration:</p>
<ul>
<li><a href="http://ncss-tech.github.io/AQP/presentations/AQP-num_soil_classification.pdf">A generalized algorithm for determining pair-wise dissimilarity between soil profiles</a></li>
<li><a href="http://ncss-tech.github.io/AQP/aqp/genhz-distance-eval.html">Distances calculated from generalized horizon labels</a></li>
<li><a href="http://ncss-tech.github.io/AQP/soilDB/competing-series.html">Competing Soil Series</a></li>
<li><a href="http://dx.doi.org/10.1016/j.cageo.2012.10.020">AQP Paper, 2013</a></li>
<li><a href="https://acsess.onlinelibrary.wiley.com/doi/full/10.1002/saj2.20119">Maynard et al., 2020</a></li>
</ul>
</div>
<div id="final-discussion" class="section level3" number="3.2.10">
<h3><span class="header-section-number">3.2.10</span> Final Discussion</h3>
<ul>
<li>Missing data strategy</li>
<li>Meaningful characteristics</li>
<li>Standardization of characteristics</li>
<li>Distance metric</li>
<li>Clustering algorithm</li>
<li>Number of clusters</li>
<li>Application to soil survey and ESD</li>
</ul>
</div>
</div>
<div id="excercises" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Excercises</h2>
<p>This is the fun part.</p>
<div id="set-up-the-r-session" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Set Up the R Session</h3>
<p>Install R packages as needed. Open a new R script file to use as you follow along.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="numerical-tax.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load libraries</span></span>
<span id="cb49-2"><a href="numerical-tax.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aqp)</span>
<span id="cb49-3"><a href="numerical-tax.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb49-4"><a href="numerical-tax.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sharpshootR)</span>
<span id="cb49-5"><a href="numerical-tax.html#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb49-6"><a href="numerical-tax.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb49-7"><a href="numerical-tax.html#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb49-8"><a href="numerical-tax.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb49-9"><a href="numerical-tax.html#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb49-10"><a href="numerical-tax.html#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb49-11"><a href="numerical-tax.html#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code></pre></div>
<div id="data-sources" class="section level4" number="3.3.1.1">
<h4><span class="header-section-number">3.3.1.1</span> Data Sources</h4>
<p>Most of the examples used in the following exercises come from these sources:</p>
<ol style="list-style-type: decimal">
<li>Built-in data sets from the <code>aqp</code> and <code>soilDB</code> packages (“sp4,” “gopheridge,” and “loafercreek”).</li>
<li>Results from <a href="http://ncss-tech.github.io/AQP/soilDB/fetchNASIS-mini-tutorial.html"><code>fetchNASIS()</code></a>: pedon data from the local NASIS selected set.</li>
<li>Results from <a href="http://ncss-tech.github.io/AQP/soilDB/KSSL-demo.html"><code>fetchKSSL()</code></a>: lab characterization data from the SoilWeb snapshot.</li>
<li>Results from <a href="http://ncss-tech.github.io/AQP/sharpshootR/OSD-dendrogram.html"><code>fetchOSD()</code></a>: basic morphologic and taxonomic data from the SoilWeb snapshot.</li>
<li>Results from <a href="http://ncss-tech.github.io/AQP/soilDB/SDA-tutorial.html"><code>SDA_query()</code></a>: live SSURGO spatial and tabular data from <a href="http://sdmdataaccess.nrcs.usda.gov/">Soil Data Access</a></li>
<li>Data from SSR 2, as CSV, downloaded from class <a href="https://github.com/ncss-tech/stats_for_soil_survey/tree/master/data/clustering_and_ordination">GitHub site</a></li>
</ol>
<p>In most cases, you can edit the examples and swap-in just about any data that are in a <a href="http://ncss-tech.github.io/AQP/aqp/aqp-intro.html"><code>SoilProfileCollection</code> object</a>. For example, pedons from your local NASIS selected set can be loaded with <code>fetchNASIS()</code>.</p>
<div id="try-it" class="section level5" number="3.3.1.1.1">
<h5><span class="header-section-number">3.3.1.1.1</span> Try it!</h5>
<p>Tinker with some <code>SoilProfileCollection</code> objects.</p>
<ul>
<li>Get some data using one of the methods listed above. If you need help, see the manual pages for examples (<code>?fetchKSSL</code>) or the <a href="http://ncss-tech.github.io/AQP/aqp/aqp-intro.html">SoilProfileCollection tutorial</a>.</li>
<li>Determine the number of profiles and horizons within the collection.</li>
<li>View and extract some site and horizon attributes.</li>
<li>Generate some soil profile sketches.</li>
</ul>
</div>
</div>
</div>
<div id="evaluating-missing-data" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Evaluating Missing Data</h3>
<p>The <code>aqp</code> package provides two functions for checking the fraction of missing data within a <code>SoilProfileCollection</code> object. The first function (<code>evalMissingData</code>) generates an index that ranges from 0 (all missing) to 1 (all present) for each profile. This index can be used to subset or rank profiles for further investigation. The second function (<code>missingDataGrid</code>) creates a visualization of the <em>fraction</em> of data missing within each horizon. Both functions can optionally filter-out horizons that don’t typically have data, for example Cr, Cd, and R horizons.</p>
<p>The following examples are based on the <code>gopheridge</code> sample dataset.</p>
<p><strong>evalMissingData</strong></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="numerical-tax.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># example data</span></span>
<span id="cb50-2"><a href="numerical-tax.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;gopheridge&quot;</span>, <span class="at">package =</span> <span class="st">&quot;soilDB&quot;</span>)</span>
<span id="cb50-3"><a href="numerical-tax.html#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="numerical-tax.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># compute data completeness</span></span>
<span id="cb50-5"><a href="numerical-tax.html#cb50-5" aria-hidden="true" tabindex="-1"></a>gopheridge<span class="sc">$</span>data.complete <span class="ot">&lt;-</span> <span class="fu">evalMissingData</span>(gopheridge, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&#39;clay&#39;</span>, <span class="st">&#39;sand&#39;</span>, <span class="st">&#39;phfield&#39;</span>), <span class="at">name =</span> <span class="st">&#39;hzname&#39;</span>, <span class="at">p =</span> <span class="st">&#39;Cr|R|Cd&#39;</span>)</span>
<span id="cb50-6"><a href="numerical-tax.html#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="numerical-tax.html#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># check range in missing data</span></span>
<span id="cb50-8"><a href="numerical-tax.html#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gopheridge<span class="sc">$</span>data.complete)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.0000  0.2143  0.4672  1.0000  1.0000</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="numerical-tax.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rank</span></span>
<span id="cb52-2"><a href="numerical-tax.html#cb52-2" aria-hidden="true" tabindex="-1"></a>new.order <span class="ot">&lt;-</span> <span class="fu">order</span>(gopheridge<span class="sc">$</span>data.complete)</span>
<span id="cb52-3"><a href="numerical-tax.html#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="numerical-tax.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot along data completeness ranking</span></span>
<span id="cb52-5"><a href="numerical-tax.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb52-6"><a href="numerical-tax.html#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gopheridge, <span class="at">plot.order=</span>new.order, <span class="at">print.id=</span><span class="cn">FALSE</span>, <span class="at">name=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb52-7"><a href="numerical-tax.html#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="numerical-tax.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># add axis, note re-ordering of axis labels</span></span>
<span id="cb52-9"><a href="numerical-tax.html#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(gopheridge), <span class="at">labels =</span> <span class="fu">round</span>(gopheridge<span class="sc">$</span>data.complete[new.order], <span class="dv">2</span>),</span>
<span id="cb52-10"><a href="numerical-tax.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="at">line=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">cex.axis=</span><span class="fl">0.65</span>, <span class="at">las=</span><span class="dv">2</span>)</span>
<span id="cb52-11"><a href="numerical-tax.html#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="numerical-tax.html#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Gopheridge pedons sorted according to data completeness (clay, sand, pH)&#39;</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-18-1.svg" width="960" style="display: block; margin: auto;" /></p>
<p><strong>missingDataGrid</strong></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="numerical-tax.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># view missing data as a fraction</span></span>
<span id="cb53-2"><a href="numerical-tax.html#cb53-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">missingDataGrid</span>(gopheridge, <span class="at">max_depth=</span><span class="dv">100</span>, <span class="at">vars=</span><span class="fu">c</span>(<span class="st">&#39;clay&#39;</span>, <span class="st">&#39;sand&#39;</span>, <span class="st">&#39;phfield&#39;</span>), <span class="at">filter.column=</span><span class="st">&#39;hzname&#39;</span>, <span class="at">filter.regex =</span> <span class="st">&#39;Cr|R|Cd&#39;</span>, <span class="at">main=</span><span class="st">&#39;Fraction of missing data (clay, sand, pH)&#39;</span>, <span class="at">cols =</span> <span class="fu">viridis</span>(<span class="dv">10</span>))</span>
<span id="cb53-3"><a href="numerical-tax.html#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="numerical-tax.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot figure</span></span>
<span id="cb53-5"><a href="numerical-tax.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(res<span class="sc">$</span>fig)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-19-1.svg" width="912" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="numerical-tax.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check results</span></span>
<span id="cb54-2"><a href="numerical-tax.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res<span class="sc">$</span>summary)</span></code></pre></div>
<pre><code>##     peiid clay sand phfield
## 1 1137354    0  100     100
## 2 1147151    0    0     100
## 3 1147190    0    0     100
## 4  242808   29   29       0
## 5  252851   29   29      29
## 6  268791    0    0       0</code></pre>
<p>For now, extract those profiles that have a complete set of field-described clay, sand, or pH values for later use.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="numerical-tax.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># be sure to read the manual page for this function</span></span>
<span id="cb56-2"><a href="numerical-tax.html#cb56-2" aria-hidden="true" tabindex="-1"></a>gopheridge.complete <span class="ot">&lt;-</span> <span class="fu">subset</span>(gopheridge, data.complete <span class="sc">&gt;</span> <span class="fl">0.99</span>)</span>
<span id="cb56-3"><a href="numerical-tax.html#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="numerical-tax.html#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># another way</span></span>
<span id="cb56-5"><a href="numerical-tax.html#cb56-5" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(gopheridge<span class="sc">$</span>data.complete <span class="sc">&gt;</span> <span class="fl">0.99</span>)</span>
<span id="cb56-6"><a href="numerical-tax.html#cb56-6" aria-hidden="true" tabindex="-1"></a>gopheridge.complete <span class="ot">&lt;-</span> gopheridge[idx, ]</span>
<span id="cb56-7"><a href="numerical-tax.html#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="numerical-tax.html#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co"># looks good</span></span>
<span id="cb56-9"><a href="numerical-tax.html#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb56-10"><a href="numerical-tax.html#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gopheridge.complete, <span class="at">color=</span><span class="st">&#39;clay&#39;</span>, <span class="at">id.style=</span><span class="st">&#39;side&#39;</span>, <span class="at">label=</span><span class="st">&#39;pedon_id&#39;</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-20-1.svg" width="816" style="display: block; margin: auto;" /></p>
</div>
<div id="more-on-the-distance-matrix-and-how-to-make-one" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> More on the Distance Matrix and How to Make One</h3>
<p>The following three functions are essential to the creation of a <strong>distance matrix</strong>:</p>
<ul>
<li><code>dist()</code>: This function is in base R, is simple and fast, and has a limited number of distance metrics.</li>
<li><code>daisy()</code>: This function is in <a href="https://cran.r-project.org/web/packages/cluster/index.html">cluster package</a>, has a better selection of distance metrics, and has simple standardization. Much more convenient than <code>dist()</code>.</li>
<li><code>vegdist()</code>: This function is in <a href="https://cran.r-project.org/web/packages/vegan/index.html">vegan package</a>, has many distance metrics, and is primarily designed for species composition data.</li>
</ul>
<p>The following is a short demonstration:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="numerical-tax.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get some example data from the aqp package</span></span>
<span id="cb57-2"><a href="numerical-tax.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;sp4&#39;</span>, <span class="at">package =</span> <span class="st">&#39;aqp&#39;</span>)</span>
<span id="cb57-3"><a href="numerical-tax.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset select rows and columns</span></span>
<span id="cb57-4"><a href="numerical-tax.html#cb57-4" aria-hidden="true" tabindex="-1"></a>sp4 <span class="ot">&lt;-</span> sp4[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">c</span>(<span class="st">&#39;name&#39;</span>, <span class="st">&#39;clay&#39;</span>, <span class="st">&#39;sand&#39;</span>, <span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>, <span class="st">&#39;CEC_7&#39;</span>)]</span>
<span id="cb57-5"><a href="numerical-tax.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(sp4) <span class="ot">&lt;-</span> sp4<span class="sc">$</span>name</span>
<span id="cb57-6"><a href="numerical-tax.html#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="numerical-tax.html#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># compare distance functions</span></span>
<span id="cb57-8"><a href="numerical-tax.html#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="numerical-tax.html#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Euclidean distance, no standardization</span></span>
<span id="cb57-10"><a href="numerical-tax.html#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">dist</span>(sp4[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">method =</span> <span class="st">&#39;euclidean&#39;</span>))</span></code></pre></div>
<pre><code>##      A ABt Bt1
## ABt  8        
## Bt1 15   7    
## Bt2 48  44  39</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="numerical-tax.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Euclidean distance, standardization</span></span>
<span id="cb59-2"><a href="numerical-tax.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">daisy</span>(sp4[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">stand =</span> <span class="cn">TRUE</span>, <span class="at">metric =</span> <span class="st">&#39;euclidean&#39;</span>), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Dissimilarities :
##        A  ABt  Bt1
## ABt 1.45          
## Bt1 2.73 1.36     
## Bt2 6.45 5.65 4.91
## 
## Metric :  euclidean 
## Number of objects : 4</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="numerical-tax.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gower&#39;s generalized distance metric (includes standardization)</span></span>
<span id="cb61-2"><a href="numerical-tax.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">vegdist</span>(sp4[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">method =</span> <span class="st">&#39;gower&#39;</span>), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##        A  ABt  Bt1
## ABt 0.19          
## Bt1 0.32 0.16     
## Bt2 0.96 0.84 0.69</code></pre>
<div id="distance-calculations-with-categorical-data" class="section level4" number="3.3.3.1">
<h4><span class="header-section-number">3.3.3.1</span> Distance Calculations with Categorical Data</h4>
<p>The following example is excerpted from <a href="http://ncss-tech.github.io/AQP/sharpshootR/diagnostic-property-plot.html">“A Novel Display of Categorical Pedon Data”</a>. This example illustrates an application of clustering binary data (presence or absence of a diagnostic feature). Internally, the <code>diagnosticPropertyPlot()</code> function uses the <code>daisy()</code> function to compute pair-wise distances using the “general dissimilarity coefficient” of Gower <span class="citation">(<a href="#ref-Gower1971" role="doc-biblioref">Gower 1971</a>)</span>. A concise summary of this distance metric is in <span class="citation">(<a href="#ref-Kaufman2005" role="doc-biblioref">Kaufman and Rousseeuw 2005</a>)</span>.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="numerical-tax.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load some example NASIS data</span></span>
<span id="cb63-2"><a href="numerical-tax.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(loafercreek, <span class="at">package=</span><span class="st">&#39;soilDB&#39;</span>)</span>
<span id="cb63-3"><a href="numerical-tax.html#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="numerical-tax.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hzdesgnname</span>(loafercreek) <span class="ot">&lt;-</span> <span class="st">&#39;hzname&#39;</span></span>
<span id="cb63-5"><a href="numerical-tax.html#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="numerical-tax.html#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cut-down to a subset, first 20 pedons</span></span>
<span id="cb63-7"><a href="numerical-tax.html#cb63-7" aria-hidden="true" tabindex="-1"></a>loafercreek <span class="ot">&lt;-</span> loafercreek[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, ]</span>
<span id="cb63-8"><a href="numerical-tax.html#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="numerical-tax.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get depth class</span></span>
<span id="cb63-10"><a href="numerical-tax.html#cb63-10" aria-hidden="true" tabindex="-1"></a>sdc <span class="ot">&lt;-</span> <span class="fu">getSoilDepthClass</span>(loafercreek)</span>
<span id="cb63-11"><a href="numerical-tax.html#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="fu">site</span>(loafercreek) <span class="ot">&lt;-</span> sdc</span>
<span id="cb63-12"><a href="numerical-tax.html#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="numerical-tax.html#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnostic properties to consider, no need to convert to factors</span></span>
<span id="cb63-14"><a href="numerical-tax.html#cb63-14" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;lithic.contact&#39;</span>, <span class="st">&#39;paralithic.contact&#39;</span>, <span class="st">&#39;argillic.horizon&#39;</span>,</span>
<span id="cb63-15"><a href="numerical-tax.html#cb63-15" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;cambic.horizon&#39;</span>, <span class="st">&#39;ochric.epipedon&#39;</span>, <span class="st">&#39;mollic.epipedon&#39;</span>, <span class="st">&#39;very.shallow&#39;</span>,</span>
<span id="cb63-16"><a href="numerical-tax.html#cb63-16" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;shallow&#39;</span>, <span class="st">&#39;mod.deep&#39;</span>, <span class="st">&#39;deep&#39;</span>, <span class="st">&#39;very.deep&#39;</span>)</span>
<span id="cb63-17"><a href="numerical-tax.html#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="numerical-tax.html#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="co"># do the analysis and save the results to object &#39;x&#39;</span></span>
<span id="cb63-19"><a href="numerical-tax.html#cb63-19" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">diagnosticPropertyPlot</span>(loafercreek, v, <span class="at">k=</span><span class="dv">5</span>, <span class="at">grid.label=</span><span class="st">&#39;bedrckkind&#39;</span>, <span class="at">dend.label =</span> <span class="st">&#39;taxonname&#39;</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-22-1.svg" width="816" style="display: block; margin: auto;" /></p>
<p>If you are wondering what is in the object <code>x</code>, the <code>str()</code> function or manual page (<code>?diagnosticPropertyPlot</code>) can help.</p>
</div>
</div>
<div id="hierachrical-clustering" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Hierachrical Clustering</h3>
<p>The go-to functions for hierarchical clustering are as follows:</p>
<ul>
<li><code>hclust()</code>: This function is agglomerative, is in base R, requires a distance matrix, and implements most of the commonly used linkage criteria.</li>
<li><code>agnes()</code>: This function is agglomerative, is in <code>cluster</code> package, can perform standardization and distance calculations, and implements more linkage criteria.</li>
<li><code>diana()</code>: This function is divisive, is in <code>cluster</code> package, can perform standardization and distance calculations.</li>
</ul>
<div id="basic-agglomerative-hierarchical-clustering-with-hclust" class="section level4" number="3.3.4.1">
<h4><span class="header-section-number">3.3.4.1</span> Basic Agglomerative Hierarchical Clustering with <code>hclust</code></h4>
<p>The <code>hclust()</code> function and resulting <code>hclust</code>-class objects are simple to use, but limited.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="numerical-tax.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-make data, this time with all profiles</span></span>
<span id="cb64-2"><a href="numerical-tax.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;sp4&#39;</span>, <span class="at">package =</span> <span class="st">&#39;aqp&#39;</span>)</span>
<span id="cb64-3"><a href="numerical-tax.html#cb64-3" aria-hidden="true" tabindex="-1"></a>sp4 <span class="ot">&lt;-</span> sp4[, <span class="fu">c</span>(<span class="st">&#39;name&#39;</span>, <span class="st">&#39;clay&#39;</span>, <span class="st">&#39;sand&#39;</span>, <span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>, <span class="st">&#39;CEC_7&#39;</span>)]</span>
<span id="cb64-4"><a href="numerical-tax.html#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="numerical-tax.html#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># distance matrix</span></span>
<span id="cb64-6"><a href="numerical-tax.html#cb64-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">daisy</span>(sp4[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">metric =</span> <span class="st">&#39;euclidean&#39;</span>, <span class="at">stand =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-7"><a href="numerical-tax.html#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="numerical-tax.html#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># hierachical clustering with base function hclust</span></span>
<span id="cb64-9"><a href="numerical-tax.html#cb64-9" aria-hidden="true" tabindex="-1"></a>sp4.h <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> <span class="st">&#39;ward.D&#39;</span>)</span>
<span id="cb64-10"><a href="numerical-tax.html#cb64-10" aria-hidden="true" tabindex="-1"></a>sp4.h<span class="sc">$</span>labels <span class="ot">&lt;-</span> sp4<span class="sc">$</span>name</span>
<span id="cb64-11"><a href="numerical-tax.html#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="numerical-tax.html#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot with basic plotting method... not many options here</span></span>
<span id="cb64-13"><a href="numerical-tax.html#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb64-14"><a href="numerical-tax.html#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sp4.h, <span class="at">font=</span><span class="dv">2</span>, <span class="at">cex=</span><span class="fl">0.85</span>)</span>
<span id="cb64-15"><a href="numerical-tax.html#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="numerical-tax.html#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ID clusters after cutting tree</span></span>
<span id="cb64-17"><a href="numerical-tax.html#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rect.hclust</span>(sp4.h, <span class="dv">4</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-23-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="better-plots-via-ape-package" class="section level4" number="3.3.4.2">
<h4><span class="header-section-number">3.3.4.2</span> Better Plots via <code>ape</code> Package</h4>
<p>This example uses a different approach to plotting based on functions and classes from the <code>ape</code> package.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="numerical-tax.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-make data, this time with all profiles</span></span>
<span id="cb65-2"><a href="numerical-tax.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;sp4&#39;</span>, <span class="at">package =</span> <span class="st">&#39;aqp&#39;</span>)</span>
<span id="cb65-3"><a href="numerical-tax.html#cb65-3" aria-hidden="true" tabindex="-1"></a>sp4 <span class="ot">&lt;-</span> sp4[, <span class="fu">c</span>(<span class="st">&#39;name&#39;</span>, <span class="st">&#39;clay&#39;</span>, <span class="st">&#39;sand&#39;</span>, <span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>, <span class="st">&#39;CEC_7&#39;</span>)]</span>
<span id="cb65-4"><a href="numerical-tax.html#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="numerical-tax.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># distance matrix</span></span>
<span id="cb65-6"><a href="numerical-tax.html#cb65-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">daisy</span>(sp4[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">metric =</span> <span class="st">&#39;euclidean&#39;</span>, <span class="at">stand =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-7"><a href="numerical-tax.html#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="numerical-tax.html#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co"># divising clustering</span></span>
<span id="cb65-9"><a href="numerical-tax.html#cb65-9" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">diana</span>(d)</span>
<span id="cb65-10"><a href="numerical-tax.html#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="numerical-tax.html#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to ape class, via hclust class</span></span>
<span id="cb65-12"><a href="numerical-tax.html#cb65-12" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">as.hclust</span>(dd)</span>
<span id="cb65-13"><a href="numerical-tax.html#cb65-13" aria-hidden="true" tabindex="-1"></a>h<span class="sc">$</span>labels <span class="ot">&lt;-</span> sp4<span class="sc">$</span>name</span>
<span id="cb65-14"><a href="numerical-tax.html#cb65-14" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(h)</span>
<span id="cb65-15"><a href="numerical-tax.html#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="numerical-tax.html#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co"># define some nice colors</span></span>
<span id="cb65-17"><a href="numerical-tax.html#cb65-17" aria-hidden="true" tabindex="-1"></a>col.set <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Set1&#39;</span>)</span>
<span id="cb65-18"><a href="numerical-tax.html#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="numerical-tax.html#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="co"># cut tree into 4 groups</span></span>
<span id="cb65-20"><a href="numerical-tax.html#cb65-20" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">cutree</span>(h, <span class="dv">4</span>)</span>
<span id="cb65-21"><a href="numerical-tax.html#cb65-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-22"><a href="numerical-tax.html#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="co"># make color vector based on groups</span></span>
<span id="cb65-23"><a href="numerical-tax.html#cb65-23" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> col.set[groups]</span></code></pre></div>
<p>The plot methods for <code>phylo</code> class objects are quite flexible. Be sure to see the manual page <code>?plot.phylo</code>.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="numerical-tax.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb66-2"><a href="numerical-tax.html#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="at">label.offset=</span><span class="fl">0.125</span>, <span class="at">direction=</span><span class="st">&#39;right&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.85</span>, <span class="at">main=</span><span class="st">&#39;dendrogram&#39;</span>)</span>
<span id="cb66-3"><a href="numerical-tax.html#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>cols)</span>
<span id="cb66-4"><a href="numerical-tax.html#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="numerical-tax.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="at">type=</span><span class="st">&#39;radial&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.85</span>, <span class="at">main=</span><span class="st">&#39;radial&#39;</span>)</span>
<span id="cb66-6"><a href="numerical-tax.html#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>cols)</span>
<span id="cb66-7"><a href="numerical-tax.html#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="numerical-tax.html#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="at">type=</span><span class="st">&#39;fan&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.85</span>, <span class="at">main=</span><span class="st">&#39;fan&#39;</span>)</span>
<span id="cb66-9"><a href="numerical-tax.html#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>cols)</span>
<span id="cb66-10"><a href="numerical-tax.html#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="numerical-tax.html#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="at">type=</span><span class="st">&#39;unrooted&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.85</span>, <span class="at">main=</span><span class="st">&#39;unrooted&#39;</span>)</span>
<span id="cb66-12"><a href="numerical-tax.html#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>cols)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-25-1.svg" width="864" style="display: block; margin: auto;" /></p>
</div>
<div id="evaluation-of-dendrogram-representation" class="section level4" number="3.3.4.3">
<h4><span class="header-section-number">3.3.4.3</span> Evaluation of Dendrogram Representation</h4>
<p>Re-visiting our sample data from before, develop hierarchical clusterings using several strategies (methods / linkage criteria).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="numerical-tax.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-make data, this time with all profiles</span></span>
<span id="cb67-2"><a href="numerical-tax.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;sp4&#39;</span>, <span class="at">package =</span> <span class="st">&#39;aqp&#39;</span>)</span>
<span id="cb67-3"><a href="numerical-tax.html#cb67-3" aria-hidden="true" tabindex="-1"></a>sp4 <span class="ot">&lt;-</span> sp4[, <span class="fu">c</span>(<span class="st">&#39;name&#39;</span>, <span class="st">&#39;clay&#39;</span>, <span class="st">&#39;sand&#39;</span>, <span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>, <span class="st">&#39;CEC_7&#39;</span>)]</span>
<span id="cb67-4"><a href="numerical-tax.html#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="numerical-tax.html#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># distance matrix</span></span>
<span id="cb67-6"><a href="numerical-tax.html#cb67-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">daisy</span>(sp4[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">metric =</span> <span class="st">&#39;euclidean&#39;</span>, <span class="at">stand =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-7"><a href="numerical-tax.html#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="numerical-tax.html#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co"># hierarchical clustering based on several strategies</span></span>
<span id="cb67-9"><a href="numerical-tax.html#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co"># agglomerative</span></span>
<span id="cb67-10"><a href="numerical-tax.html#cb67-10" aria-hidden="true" tabindex="-1"></a>h.avg <span class="ot">&lt;-</span> <span class="fu">agnes</span>(d, <span class="at">method=</span><span class="st">&#39;average&#39;</span>)</span>
<span id="cb67-11"><a href="numerical-tax.html#cb67-11" aria-hidden="true" tabindex="-1"></a>h.single <span class="ot">&lt;-</span> <span class="fu">agnes</span>(d, <span class="at">method=</span><span class="st">&#39;single&#39;</span>)</span>
<span id="cb67-12"><a href="numerical-tax.html#cb67-12" aria-hidden="true" tabindex="-1"></a>h.complete <span class="ot">&lt;-</span> <span class="fu">agnes</span>(d, <span class="at">method=</span><span class="st">&#39;complete&#39;</span>)</span>
<span id="cb67-13"><a href="numerical-tax.html#cb67-13" aria-hidden="true" tabindex="-1"></a>h.ward <span class="ot">&lt;-</span> <span class="fu">agnes</span>(d, <span class="at">method=</span><span class="st">&#39;ward&#39;</span>)</span>
<span id="cb67-14"><a href="numerical-tax.html#cb67-14" aria-hidden="true" tabindex="-1"></a>h.flexible <span class="ot">&lt;-</span> <span class="fu">agnes</span>(d, <span class="at">method=</span><span class="st">&#39;gaverage&#39;</span>, <span class="at">par.method =</span> <span class="fl">0.01</span>)</span>
<span id="cb67-15"><a href="numerical-tax.html#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="numerical-tax.html#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co"># divisive</span></span>
<span id="cb67-17"><a href="numerical-tax.html#cb67-17" aria-hidden="true" tabindex="-1"></a>h.div <span class="ot">&lt;-</span> <span class="fu">diana</span>(d)</span></code></pre></div>
<p>The correlation between original distance matrix and <a href="https://en.wikipedia.org/wiki/Cophenetic">cophenetic distance matrix</a> is a reasonable index of how faithfully a dendrogram preserves the original pair-wise distances.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="numerical-tax.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># agglomerative hierarchical clustering with various linkage criteria</span></span>
<span id="cb68-2"><a href="numerical-tax.html#cb68-2" aria-hidden="true" tabindex="-1"></a>corr.avg <span class="ot">&lt;-</span> <span class="fu">cor</span>(d, <span class="fu">cophenetic</span>(h.avg))</span>
<span id="cb68-3"><a href="numerical-tax.html#cb68-3" aria-hidden="true" tabindex="-1"></a>corr.single <span class="ot">&lt;-</span> <span class="fu">cor</span>(d, <span class="fu">cophenetic</span>(h.single))</span>
<span id="cb68-4"><a href="numerical-tax.html#cb68-4" aria-hidden="true" tabindex="-1"></a>corr.complete <span class="ot">&lt;-</span> <span class="fu">cor</span>(d, <span class="fu">cophenetic</span>(h.complete))</span>
<span id="cb68-5"><a href="numerical-tax.html#cb68-5" aria-hidden="true" tabindex="-1"></a>corr.ward <span class="ot">&lt;-</span> <span class="fu">cor</span>(d, <span class="fu">cophenetic</span>(h.ward))</span>
<span id="cb68-6"><a href="numerical-tax.html#cb68-6" aria-hidden="true" tabindex="-1"></a>corr.flexible <span class="ot">&lt;-</span> <span class="fu">cor</span>(d, <span class="fu">cophenetic</span>(h.flexible))</span>
<span id="cb68-7"><a href="numerical-tax.html#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="numerical-tax.html#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># divisive hierarchical clustering</span></span>
<span id="cb68-9"><a href="numerical-tax.html#cb68-9" aria-hidden="true" tabindex="-1"></a>corr.div <span class="ot">&lt;-</span> <span class="fu">cor</span>(d, <span class="fu">cophenetic</span>(h.div))</span></code></pre></div>
<p>Combine the results into a table for quick comparison. Note that the <a href="https://www.rdocumentation.org/packages/cluster/versions/2.0.7-1/topics/agnes.object"><code>agnes</code></a> and <a href="https://www.rdocumentation.org/packages/cluster/versions/2.0.7-1/topics/diana"><code>diana</code></a> functions provide an agglomerative / divisive coefficient that can be used to evaluate clustering efficiency (e.g. cluster size and “compactness”). Depending on the application, one metric may be more informative than the other.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="numerical-tax.html#cb69-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb69-2"><a href="numerical-tax.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="fu">c</span>(<span class="st">&#39;average&#39;</span>, <span class="st">&#39;single&#39;</span>, <span class="st">&#39;complete&#39;</span>, <span class="st">&#39;ward&#39;</span>, <span class="st">&#39;flexible UPGMA&#39;</span>, <span class="st">&#39;divisive&#39;</span>), </span>
<span id="cb69-3"><a href="numerical-tax.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cophenetic.correlation=</span><span class="fu">c</span>(corr.avg, corr.single, corr.complete, corr.ward, corr.flexible, corr.div),</span>
<span id="cb69-4"><a href="numerical-tax.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">agg_div.coefficient=</span><span class="fu">c</span>(h.avg<span class="sc">$</span>ac, h.single<span class="sc">$</span>ac, h.complete<span class="sc">$</span>ac, h.ward<span class="sc">$</span>ac, h.flexible<span class="sc">$</span>ac, h.div<span class="sc">$</span>dc)</span>
<span id="cb69-5"><a href="numerical-tax.html#cb69-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-6"><a href="numerical-tax.html#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="numerical-tax.html#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co"># re-order</span></span>
<span id="cb69-8"><a href="numerical-tax.html#cb69-8" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> res[<span class="fu">order</span>(res<span class="sc">$</span>cophenetic.correlation, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
method
</th>
<th style="text-align:right;">
cophenetic.correlation
</th>
<th style="text-align:right;">
agg_div.coefficient
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
average
</td>
<td style="text-align:right;">
0.840
</td>
<td style="text-align:right;">
0.787
</td>
</tr>
<tr>
<td style="text-align:left;">
flexible UPGMA
</td>
<td style="text-align:right;">
0.840
</td>
<td style="text-align:right;">
0.778
</td>
</tr>
<tr>
<td style="text-align:left;">
single
</td>
<td style="text-align:right;">
0.784
</td>
<td style="text-align:right;">
0.613
</td>
</tr>
<tr>
<td style="text-align:left;">
complete
</td>
<td style="text-align:right;">
0.759
</td>
<td style="text-align:right;">
0.879
</td>
</tr>
<tr>
<td style="text-align:left;">
ward
</td>
<td style="text-align:right;">
0.756
</td>
<td style="text-align:right;">
0.894
</td>
</tr>
<tr>
<td style="text-align:left;">
divisive
</td>
<td style="text-align:right;">
0.703
</td>
<td style="text-align:right;">
0.874
</td>
</tr>
</tbody>
</table>
<p>Investigate differences graphically: I’ve ranked according to the frequency withwhich I use the various methods.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="numerical-tax.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>,<span class="fl">1.5</span>,<span class="fl">0.25</span>), <span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb70-2"><a href="numerical-tax.html#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="numerical-tax.html#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.phylo</span>(<span class="fu">as.hclust</span>(h.div)), <span class="at">label.offset=</span><span class="fl">0.125</span>, <span class="at">direction=</span><span class="st">&#39;right&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.65</span>, <span class="at">main=</span><span class="st">&#39;1. Divisive&#39;</span>)</span>
<span id="cb70-4"><a href="numerical-tax.html#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>col.set[<span class="fu">cutree</span>(h.div, <span class="dv">4</span>)])</span>
<span id="cb70-5"><a href="numerical-tax.html#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="numerical-tax.html#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.phylo</span>(<span class="fu">as.hclust</span>(h.ward)), <span class="at">label.offset=</span><span class="fl">0.125</span>, <span class="at">direction=</span><span class="st">&#39;right&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.65</span>, <span class="at">main=</span><span class="st">&#39;2. Ward&#39;</span>)</span>
<span id="cb70-7"><a href="numerical-tax.html#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>col.set[<span class="fu">cutree</span>(h.ward, <span class="dv">4</span>)])</span>
<span id="cb70-8"><a href="numerical-tax.html#cb70-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-9"><a href="numerical-tax.html#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.phylo</span>(<span class="fu">as.hclust</span>(h.flexible)), <span class="at">label.offset=</span><span class="fl">0.125</span>, <span class="at">direction=</span><span class="st">&#39;right&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.65</span>, <span class="at">main=</span><span class="st">&#39;3. Flexible (0.01)&#39;</span>)</span>
<span id="cb70-10"><a href="numerical-tax.html#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>col.set[<span class="fu">cutree</span>(h.flexible, <span class="dv">4</span>)])</span>
<span id="cb70-11"><a href="numerical-tax.html#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="numerical-tax.html#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.phylo</span>(<span class="fu">as.hclust</span>(h.avg)), <span class="at">label.offset=</span><span class="fl">0.125</span>, <span class="at">direction=</span><span class="st">&#39;right&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.65</span>, <span class="at">main=</span><span class="st">&#39;4. Average&#39;</span>)</span>
<span id="cb70-13"><a href="numerical-tax.html#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>col.set[<span class="fu">cutree</span>(h.avg, <span class="dv">4</span>)])</span>
<span id="cb70-14"><a href="numerical-tax.html#cb70-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-15"><a href="numerical-tax.html#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.phylo</span>(<span class="fu">as.hclust</span>(h.single)), <span class="at">label.offset=</span><span class="fl">0.125</span>, <span class="at">direction=</span><span class="st">&#39;right&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.65</span>, <span class="at">main=</span><span class="st">&#39;(never) Single&#39;</span>)</span>
<span id="cb70-16"><a href="numerical-tax.html#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>col.set[<span class="fu">cutree</span>(h.single, <span class="dv">4</span>)])</span>
<span id="cb70-17"><a href="numerical-tax.html#cb70-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-18"><a href="numerical-tax.html#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">as.phylo</span>(<span class="fu">as.hclust</span>(h.complete)), <span class="at">label.offset=</span><span class="fl">0.125</span>, <span class="at">direction=</span><span class="st">&#39;right&#39;</span>, <span class="at">font=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">0.65</span>, <span class="at">main=</span><span class="st">&#39;(never) Complete&#39;</span>)</span>
<span id="cb70-19"><a href="numerical-tax.html#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">15</span>, <span class="at">col=</span>col.set[<span class="fu">cutree</span>(h.complete, <span class="dv">4</span>)])</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-30-1.svg" width="768" style="display: block; margin: auto;" /></p>
<div id="more-on-the-flexible-upgma-method" class="section level5" number="3.3.4.3.1">
<h5><span class="header-section-number">3.3.4.3.1</span> More on the Flexible UPGMA method</h5>
<p>Test the “flexible UPGMA” method <span class="citation">(<a href="#ref-belbin1992" role="doc-biblioref">Belbin, Faith, and Milligan 1992</a>)</span> by iterating over possible values for <span class="math inline">\(\beta\)</span>. Looks like a value near <code>0.01</code> would be ideal (e.g. highest cophenetic correlation). Interestingly, this is very close to the cophenetic correlation associated with the “average” linkage criteria.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="numerical-tax.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># init a sequence spanning -1 to 1</span></span>
<span id="cb71-2"><a href="numerical-tax.html#cb71-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">to=</span><span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb71-3"><a href="numerical-tax.html#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="numerical-tax.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># init an empty vector to store results</span></span>
<span id="cb71-5"><a href="numerical-tax.html#cb71-5" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">&#39;numeric&#39;</span>, <span class="at">length =</span> <span class="fu">length</span>(beta))</span>
<span id="cb71-6"><a href="numerical-tax.html#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="numerical-tax.html#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># iterate over values of beta and compute cophenetic correlation</span></span>
<span id="cb71-8"><a href="numerical-tax.html#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(r)) {</span>
<span id="cb71-9"><a href="numerical-tax.html#cb71-9" aria-hidden="true" tabindex="-1"></a>  r[i] <span class="ot">&lt;-</span> <span class="fu">cor</span>(d, <span class="fu">cophenetic</span>(<span class="fu">agnes</span>(d, <span class="at">method=</span><span class="st">&#39;gaverage&#39;</span>, <span class="at">par.method =</span> beta[i])))</span>
<span id="cb71-10"><a href="numerical-tax.html#cb71-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-11"><a href="numerical-tax.html#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="numerical-tax.html#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb71-13"><a href="numerical-tax.html#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb71-14"><a href="numerical-tax.html#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(beta, r, <span class="at">type=</span><span class="st">&#39;l&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;beta parameter&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;cophenetic correlation&#39;</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb71-15"><a href="numerical-tax.html#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="co"># locate the max coph. corr.</span></span>
<span id="cb71-16"><a href="numerical-tax.html#cb71-16" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(r)</span>
<span id="cb71-17"><a href="numerical-tax.html#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="co"># mark this point and label</span></span>
<span id="cb71-18"><a href="numerical-tax.html#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(beta[idx], r[idx], <span class="at">col=</span><span class="st">&#39;red&#39;</span>, <span class="at">cex=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb71-19"><a href="numerical-tax.html#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(beta[idx], r[idx], <span class="at">labels =</span> <span class="fu">round</span>(beta[idx], <span class="dv">3</span>), <span class="at">pos=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-31-1.svg" width="624" style="display: block; margin: auto;" /></p>
<!-- 

#### Comparison of Dendrograms

The following example is rather basic. Many more possibilities are available in the [`dendextend` package](https://cran.r-project.org/web/packages/dendextend/index.html).

```r
# load sample dataset from aqp package
data(sp3)

# promote to SoilProfileCollection
depths(sp3) <- id ~ top + bottom

# compute dissimilarity using different sets of variables
# note that these are rescaled to the interval [0,1]
d.1 <- profile_compare(sp3, vars=c('clay', 'L'), k=0, max_d=100, rescale.result=TRUE)

# cluster via divisive hierarchical algorithm
# convert to 'phylo' class
p.1 <- as.phylo(as.hclust(diana(d.1)))

# graphically compare diana() to agnes() using d.2
dueling.dendrograms(as.phylo(as.hclust(diana(d.1))), 
as.phylo(as.hclust(agnes(d.1, method='average'))), lab.1='divisive', lab.2='agglomerative: average linkage')
```

<img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-32-1.svg" width="672" style="display: block; margin: auto;" />

-->
</div>
</div>
</div>
<div id="centroid-and-medoid-partitioning-clustering-1" class="section level3" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Centroid and Medoid (Partitioning) Clustering</h3>
<p>The following creates simulated data for demonstration purposes, representing two populations:</p>
<ol style="list-style-type: decimal">
<li>mean = 0, sd = 0.3</li>
<li>mean = 1, sd = 0.3</li>
</ol>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="numerical-tax.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nice colors for later</span></span>
<span id="cb72-2"><a href="numerical-tax.html#cb72-2" aria-hidden="true" tabindex="-1"></a>col.set <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Set1&#39;</span>)</span>
<span id="cb72-3"><a href="numerical-tax.html#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="numerical-tax.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2D example</span></span>
<span id="cb72-5"><a href="numerical-tax.html#cb72-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb72-6"><a href="numerical-tax.html#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.3</span>), <span class="at">ncol =</span> <span class="dv">2</span>),</span>
<span id="cb72-7"><a href="numerical-tax.html#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.3</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb72-8"><a href="numerical-tax.html#cb72-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-9"><a href="numerical-tax.html#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<div id="hard-classes" class="section level4" number="3.3.5.1">
<h4><span class="header-section-number">3.3.5.1</span> Hard Classes</h4>
<div id="k-means" class="section level5" number="3.3.5.1.1">
<h5><span class="header-section-number">3.3.5.1.1</span> K-Means</h5>
<p>It is important to note that the k-means algorithm is sensitive to the initial selection of centroid locations (typically random). The default behavior of the <code>kmeans()</code> function does <strong>not</strong> attempt to correct for this limitation. Note that cluster assignment and centroid vary across runs (panels in the figure below).</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="numerical-tax.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb73-2"><a href="numerical-tax.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb73-3"><a href="numerical-tax.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  cl <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(x, <span class="at">centers=</span><span class="dv">3</span>)</span>
<span id="cb73-4"><a href="numerical-tax.html#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, <span class="at">col =</span> col.set[cl<span class="sc">$</span>cluster], <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb73-5"><a href="numerical-tax.html#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grid</span>()</span>
<span id="cb73-6"><a href="numerical-tax.html#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(cl<span class="sc">$</span>centers, <span class="at">col =</span> col.set, <span class="at">pch =</span> <span class="dv">8</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb73-7"><a href="numerical-tax.html#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box</span>()</span>
<span id="cb73-8"><a href="numerical-tax.html#cb73-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-34-1.svg" width="768" style="display: block; margin: auto;" /></p>
<p>Setting the <code>nstart</code> argument (“number of random starts”) to a value great than 1 (10 is ideal) will ensure that the final clustering configuration will remain stable between runs. Note that the cluster ID (color) will vary between runs, however, with <code>nstart=10</code> the overall configuration remains the same.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="numerical-tax.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb74-2"><a href="numerical-tax.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) {</span>
<span id="cb74-3"><a href="numerical-tax.html#cb74-3" aria-hidden="true" tabindex="-1"></a>  cl <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(x, <span class="at">centers=</span><span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">10</span>, <span class="at">iter.max =</span> <span class="dv">100</span>)</span>
<span id="cb74-4"><a href="numerical-tax.html#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, <span class="at">col =</span> col.set[cl<span class="sc">$</span>cluster], <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb74-5"><a href="numerical-tax.html#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grid</span>()</span>
<span id="cb74-6"><a href="numerical-tax.html#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(cl<span class="sc">$</span>centers, <span class="at">col =</span> col.set, <span class="at">pch =</span> <span class="dv">8</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb74-7"><a href="numerical-tax.html#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box</span>()</span>
<span id="cb74-8"><a href="numerical-tax.html#cb74-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-35-1.svg" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="k-medoids" class="section level5" number="3.3.5.1.2">
<h5><span class="header-section-number">3.3.5.1.2</span> K-Medoids</h5>
<p>The <code>cluster</code> package provides two interfaces to the k-medoids algorithm:</p>
<ul>
<li><code>pam()</code>: small to medium sized data sets</li>
<li><code>clara()</code>: optmized for larger data sets</li>
</ul>
<p>A quick example of using <code>pam()</code> to identify an increasing number of clusters.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="numerical-tax.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb75-2"><a href="numerical-tax.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) {</span>
<span id="cb75-3"><a href="numerical-tax.html#cb75-3" aria-hidden="true" tabindex="-1"></a>  cl <span class="ot">&lt;-</span> <span class="fu">pam</span>(x, <span class="at">k =</span> i, <span class="at">stand =</span> <span class="cn">TRUE</span>)</span>
<span id="cb75-4"><a href="numerical-tax.html#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x, <span class="at">col =</span> col.set[cl<span class="sc">$</span>clustering], <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb75-5"><a href="numerical-tax.html#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">grid</span>()</span>
<span id="cb75-6"><a href="numerical-tax.html#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(cl<span class="sc">$</span>medoids, <span class="at">col =</span> col.set, <span class="at">pch =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb75-7"><a href="numerical-tax.html#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">box</span>()</span>
<span id="cb75-8"><a href="numerical-tax.html#cb75-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-36-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="fuzzy-clusters" class="section level4" number="3.3.5.2">
<h4><span class="header-section-number">3.3.5.2</span> Fuzzy Clusters</h4>
<p>Clustering results are in the form of class membership; values ranging between 0 and 1. This means that group membership is a continuum vs. the “hard” classes assigned by k-means or k-medoids. The “mixture” of class membership in the example below is conveniently expressed using proportions of red, green, and blue.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="numerical-tax.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-make data, this time with all profiles</span></span>
<span id="cb76-2"><a href="numerical-tax.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;sp4&#39;</span>, <span class="at">package =</span> <span class="st">&#39;aqp&#39;</span>)</span>
<span id="cb76-3"><a href="numerical-tax.html#cb76-3" aria-hidden="true" tabindex="-1"></a>sp4.std <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(sp4[, <span class="fu">c</span>(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;name&#39;</span>, <span class="st">&#39;top&#39;</span>, <span class="st">&#39;bottom&#39;</span>)], <span class="fu">scale</span>( sp4[, <span class="fu">c</span>(<span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>)]))</span>
<span id="cb76-4"><a href="numerical-tax.html#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="numerical-tax.html#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># perform fuzzy clustering</span></span>
<span id="cb76-6"><a href="numerical-tax.html#cb76-6" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">fanny</span>(sp4.std[, <span class="fu">c</span>(<span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>)], <span class="at">k =</span> <span class="dv">3</span>, <span class="at">stand =</span> <span class="cn">FALSE</span>)</span>
<span id="cb76-7"><a href="numerical-tax.html#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="numerical-tax.html#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get membership matrix</span></span>
<span id="cb76-9"><a href="numerical-tax.html#cb76-9" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> cl<span class="sc">$</span>membership</span>
<span id="cb76-10"><a href="numerical-tax.html#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="numerical-tax.html#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to colors by interpreting membership as R,G,B proportions</span></span>
<span id="cb76-12"><a href="numerical-tax.html#cb76-12" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">rgb</span>(m)</span>
<span id="cb76-13"><a href="numerical-tax.html#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="numerical-tax.html#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co"># use Shannon H to set symbol size</span></span>
<span id="cb76-15"><a href="numerical-tax.html#cb76-15" aria-hidden="true" tabindex="-1"></a>H <span class="ot">&lt;-</span> <span class="fu">apply</span>(m, <span class="dv">1</span>, shannonEntropy)</span>
<span id="cb76-16"><a href="numerical-tax.html#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="co"># larger H -&gt; smaller symbols</span></span>
<span id="cb76-17"><a href="numerical-tax.html#cb76-17" aria-hidden="true" tabindex="-1"></a>pt.cex <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">/</span>H) <span class="sc">*</span> <span class="fl">2.5</span> </span>
<span id="cb76-18"><a href="numerical-tax.html#cb76-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-19"><a href="numerical-tax.html#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="co"># setup plot</span></span>
<span id="cb76-20"><a href="numerical-tax.html#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb76-21"><a href="numerical-tax.html#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sp4.std<span class="sc">$</span>Mg, sp4.std<span class="sc">$</span>Ca, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ylab=</span><span class="st">&#39;Exchangeable Mg (cmol/kg), Standardized&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;Exchangeable Ca (cmol/kg), Standardized&#39;</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb76-22"><a href="numerical-tax.html#cb76-22" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">v=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb76-23"><a href="numerical-tax.html#cb76-23" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb76-24"><a href="numerical-tax.html#cb76-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-25"><a href="numerical-tax.html#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="co"># add original obs</span></span>
<span id="cb76-26"><a href="numerical-tax.html#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(sp4.std<span class="sc">$</span>Mg, sp4.std<span class="sc">$</span>Ca, <span class="at">bg=</span>cols, <span class="at">col=</span><span class="st">&#39;black&#39;</span>, <span class="at">cex =</span> pt.cex, <span class="at">pch =</span> <span class="dv">21</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-37-1.svg" width="576" style="display: block; margin: auto;" /></p>
<p>Save the RGB color representation of cluster membership to the source <code>data.frame</code> and convert to <code>SoilProfileCollection</code>.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="numerical-tax.html#cb77-1" aria-hidden="true" tabindex="-1"></a>sp4.std<span class="sc">$</span>colors <span class="ot">&lt;-</span> cols</span>
<span id="cb77-2"><a href="numerical-tax.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">depths</span>(sp4.std) <span class="ot">&lt;-</span> id <span class="sc">~</span> top <span class="sc">+</span> bottom</span>
<span id="cb77-3"><a href="numerical-tax.html#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="numerical-tax.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb77-5"><a href="numerical-tax.html#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sp4.std, <span class="at">color=</span><span class="st">&#39;colors&#39;</span>, <span class="at">cex.names=</span><span class="fl">0.75</span>)</span>
<span id="cb77-6"><a href="numerical-tax.html#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Fuzzy Clustering Results in Context&#39;</span>, <span class="at">line=</span><span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-38-1.svg" width="960" style="display: block; margin: auto;" /></p>
From the source:
<div style="font-size:95%; font-style: italic; width: 90%; margin: auto;">
Of the 11 parent materials, 9 were serpentinites. The parent materials in Napa and Tehama Counties were quite different from each other and from those of the nine other sites. Neither had parent rock that contained serpentine minerals. They were, therefore, not serpentinites. The Napa County parent material contained dominantly vermiculite and albite and had minor amounts of Ca-bearing clino-pyroxene. The Tehama County parent material was dominated by grossularite, which is a calcsilicate ugrandite garnet, and had subdominant amounts of the Ca-bearing sorosilicate, pumpellyite, and Ca-bearing clinopyroxene. The rocks from the Shasta and Kings County sites were serpentinite, dominated by serpentine minerals. They had minor amounts of Ca-bearing accessory minerals (calcic clinoamphibole [tremolite] and calcsilicate ugrandite garnet [andradite]). The seven other parent materials were serpentinites and exhibited, at most, trace amounts of Ca-bearing minerals.
</div>
</div>
<div id="how-many-clusters" class="section level4" number="3.3.5.3">
<h4><span class="header-section-number">3.3.5.3</span> How Many Clusters?</h4>
<p>There is no simple answer to the question “How many clusters are in my data?” Some metrics, however, can be used to help estimate a “reasonable” number of clusters. The mean <a href="https://en.wikipedia.org/wiki/Silhouette_(clustering)">silhouette width</a> is a useful index of “cluster compactness” relative to neighbor clusters <span class="citation">(<a href="#ref-Rousseeuw1987" role="doc-biblioref">Rousseeuw 1987</a>)</span>. Larger silhouette widths suggest tighter grouping.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="numerical-tax.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-make data, this time with all profiles</span></span>
<span id="cb78-2"><a href="numerical-tax.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;sp4&#39;</span>, <span class="at">package =</span> <span class="st">&#39;aqp&#39;</span>)</span>
<span id="cb78-3"><a href="numerical-tax.html#cb78-3" aria-hidden="true" tabindex="-1"></a>sp4.std <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(sp4[, <span class="fu">c</span>(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;name&#39;</span>, <span class="st">&#39;top&#39;</span>, <span class="st">&#39;bottom&#39;</span>)], <span class="fu">scale</span>( sp4[, <span class="fu">c</span>(<span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>)]))</span>
<span id="cb78-4"><a href="numerical-tax.html#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="numerical-tax.html#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co"># perform hard clustering</span></span>
<span id="cb78-6"><a href="numerical-tax.html#cb78-6" aria-hidden="true" tabindex="-1"></a>sil.widths <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">&#39;numeric&#39;</span>)</span>
<span id="cb78-7"><a href="numerical-tax.html#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb78-8"><a href="numerical-tax.html#cb78-8" aria-hidden="true" tabindex="-1"></a>  cl <span class="ot">&lt;-</span> <span class="fu">pam</span>(sp4.std[, <span class="fu">c</span>(<span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>)], <span class="at">k =</span> i, <span class="at">stand =</span> <span class="cn">FALSE</span>)</span>
<span id="cb78-9"><a href="numerical-tax.html#cb78-9" aria-hidden="true" tabindex="-1"></a>  sil.widths[i] <span class="ot">&lt;-</span> cl<span class="sc">$</span>silinfo<span class="sc">$</span>avg.width</span>
<span id="cb78-10"><a href="numerical-tax.html#cb78-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-11"><a href="numerical-tax.html#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="numerical-tax.html#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb78-13"><a href="numerical-tax.html#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sil.widths, <span class="at">type=</span><span class="st">&#39;b&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;Number of Clusters&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;Average Silhouette Width&#39;</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&#39;RoyalBlue&#39;</span>, <span class="at">cex=</span><span class="fl">1.25</span>, <span class="at">main=</span><span class="st">&#39;Finding the &quot;Right&quot; Number of Clusters&#39;</span>)</span>
<span id="cb78-14"><a href="numerical-tax.html#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-39-1.svg" width="768" style="display: block; margin: auto;" />
According to <em>this metric</em>, it looks like 3 clusters is reasonable. Again, this is a judgement call–most decisions related to clustering algorithm selection and the “optimal number of clusters” are somewhat subjective.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="numerical-tax.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># perform fuzzy clustering</span></span>
<span id="cb79-2"><a href="numerical-tax.html#cb79-2" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">pam</span>(sp4.std[, <span class="fu">c</span>(<span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>)], <span class="at">k =</span> <span class="dv">3</span>, <span class="at">stand =</span> <span class="cn">FALSE</span>)</span>
<span id="cb79-3"><a href="numerical-tax.html#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="numerical-tax.html#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># setup plot</span></span>
<span id="cb79-5"><a href="numerical-tax.html#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb79-6"><a href="numerical-tax.html#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sp4.std<span class="sc">$</span>Mg, sp4.std<span class="sc">$</span>Ca, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ylab=</span><span class="st">&#39;Exchangeable Mg (cmol/kg), Standardized&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;Exchangeable Ca (cmol/kg), Standardized&#39;</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>)</span>
<span id="cb79-7"><a href="numerical-tax.html#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">v=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb79-8"><a href="numerical-tax.html#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb79-9"><a href="numerical-tax.html#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="numerical-tax.html#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="co"># add original obs</span></span>
<span id="cb79-11"><a href="numerical-tax.html#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(sp4.std<span class="sc">$</span>Mg, sp4.std<span class="sc">$</span>Ca, <span class="at">bg=</span>cl<span class="sc">$</span>clustering, <span class="at">col=</span><span class="st">&#39;black&#39;</span>, <span class="at">cex=</span><span class="fl">1.25</span>, <span class="at">pch=</span><span class="dv">21</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-40-1.svg" width="576" style="display: block; margin: auto;" /></p>
<p>TODO: other cluster metrics packages</p>
</div>
<div id="ordination" class="section level4" number="3.3.5.4">
<h4><span class="header-section-number">3.3.5.4</span> Ordination</h4>
<div id="principal-component-analysis" class="section level5" number="3.3.5.4.1">
<h5><span class="header-section-number">3.3.5.4.1</span> Principal Component Analysis</h5>
<p>A simple, constrained ordination based on variance. This method does not use the distance matrix, rather it seeks to find a new set of axes that describe maximum variance via linear combinations of characteristics. Standardization is essential.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="numerical-tax.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-make data, this time with all profiles</span></span>
<span id="cb80-2"><a href="numerical-tax.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;sp4&#39;</span>, <span class="at">package =</span> <span class="st">&#39;aqp&#39;</span>)</span>
<span id="cb80-3"><a href="numerical-tax.html#cb80-3" aria-hidden="true" tabindex="-1"></a>sp4 <span class="ot">&lt;-</span> sp4[, <span class="fu">c</span>(<span class="st">&#39;name&#39;</span>, <span class="st">&#39;clay&#39;</span>, <span class="st">&#39;sand&#39;</span>, <span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>, <span class="st">&#39;CEC_7&#39;</span>)]</span>
<span id="cb80-4"><a href="numerical-tax.html#cb80-4" aria-hidden="true" tabindex="-1"></a>sp4.scaled <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span>sp4[, <span class="dv">1</span>], <span class="fu">round</span>(<span class="fu">scale</span>( sp4[, <span class="sc">-</span><span class="dv">1</span>]), <span class="dv">2</span>))</span>
<span id="cb80-5"><a href="numerical-tax.html#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="numerical-tax.html#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA</span></span>
<span id="cb80-7"><a href="numerical-tax.html#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"># note that we are leaving out the first column: the horizon names</span></span>
<span id="cb80-8"><a href="numerical-tax.html#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># note the syntax used to extract the principal components</span></span>
<span id="cb80-9"><a href="numerical-tax.html#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co"># note that PCA doesn&#39;t use the distance matrix</span></span>
<span id="cb80-10"><a href="numerical-tax.html#cb80-10" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">princomp</span>(sp4.scaled[, <span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb80-11"><a href="numerical-tax.html#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="numerical-tax.html#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="do">## perform clustering to highlight structure in the PCA</span></span>
<span id="cb80-13"><a href="numerical-tax.html#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co"># distance matrix</span></span>
<span id="cb80-14"><a href="numerical-tax.html#cb80-14" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">dist</span>(sp4.scaled[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb80-15"><a href="numerical-tax.html#cb80-15" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(d)</span>
<span id="cb80-16"><a href="numerical-tax.html#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">list</span>(sp4.scaled<span class="sc">$</span>name, sp4.scaled<span class="sc">$</span>name)</span>
<span id="cb80-17"><a href="numerical-tax.html#cb80-17" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(m)</span>
<span id="cb80-18"><a href="numerical-tax.html#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co"># dendrogram from divisive clustering</span></span>
<span id="cb80-19"><a href="numerical-tax.html#cb80-19" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">diana</span>(d)</span>
<span id="cb80-20"><a href="numerical-tax.html#cb80-20" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">as.hclust</span>(dd)</span>
<span id="cb80-21"><a href="numerical-tax.html#cb80-21" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(h)</span>
<span id="cb80-22"><a href="numerical-tax.html#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="numerical-tax.html#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="co"># define colors based on cutting a divisive hierarchical clustering into 4 groups</span></span>
<span id="cb80-24"><a href="numerical-tax.html#cb80-24" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Set1&#39;</span>)[<span class="fu">cutree</span>(h, <span class="dv">4</span>)]</span>
<span id="cb80-25"><a href="numerical-tax.html#cb80-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-26"><a href="numerical-tax.html#cb80-26" aria-hidden="true" tabindex="-1"></a><span class="co"># plot first 2 PC</span></span>
<span id="cb80-27"><a href="numerical-tax.html#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pca[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">asp=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">&#39;&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>, <span class="at">main=</span><span class="st">&quot;Principal Components 1 and 2&quot;</span>)</span>
<span id="cb80-28"><a href="numerical-tax.html#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb80-29"><a href="numerical-tax.html#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(pca[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], sp4.scaled<span class="sc">$</span>name, <span class="at">cex=</span><span class="fl">0.75</span>, <span class="at">col=</span>cols, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb80-30"><a href="numerical-tax.html#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-41-1.svg" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="sammons-non-linear-mapping" class="section level4" number="3.3.5.5">
<h4><span class="header-section-number">3.3.5.5</span> Sammon’s Non-linear Mapping</h4>
<p>Simple interface to nMDS, input is a distance matrix. Note that this algorithm will fail if there are 0’s or ties within the distance matrix. See <code>?sammon</code> for details.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="numerical-tax.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-make data, this time with all profiles</span></span>
<span id="cb81-2"><a href="numerical-tax.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;sp4&#39;</span>, <span class="at">package =</span> <span class="st">&#39;aqp&#39;</span>)</span>
<span id="cb81-3"><a href="numerical-tax.html#cb81-3" aria-hidden="true" tabindex="-1"></a>sp4 <span class="ot">&lt;-</span> sp4[, <span class="fu">c</span>(<span class="st">&#39;name&#39;</span>, <span class="st">&#39;clay&#39;</span>, <span class="st">&#39;sand&#39;</span>, <span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>, <span class="st">&#39;CEC_7&#39;</span>)]</span>
<span id="cb81-4"><a href="numerical-tax.html#cb81-4" aria-hidden="true" tabindex="-1"></a>sp4.scaled <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span>sp4[, <span class="dv">1</span>], <span class="fu">round</span>(<span class="fu">scale</span>( sp4[, <span class="sc">-</span><span class="dv">1</span>]), <span class="dv">2</span>))</span>
<span id="cb81-5"><a href="numerical-tax.html#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="numerical-tax.html#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># distance matrix</span></span>
<span id="cb81-7"><a href="numerical-tax.html#cb81-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">dist</span>(sp4.scaled[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb81-8"><a href="numerical-tax.html#cb81-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(d)</span>
<span id="cb81-9"><a href="numerical-tax.html#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">list</span>(sp4.scaled<span class="sc">$</span>name, sp4.scaled<span class="sc">$</span>name)</span>
<span id="cb81-10"><a href="numerical-tax.html#cb81-10" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(m)</span>
<span id="cb81-11"><a href="numerical-tax.html#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="co"># dendrogram from divisive clustering</span></span>
<span id="cb81-12"><a href="numerical-tax.html#cb81-12" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">diana</span>(d)</span>
<span id="cb81-13"><a href="numerical-tax.html#cb81-13" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">as.hclust</span>(dd)</span>
<span id="cb81-14"><a href="numerical-tax.html#cb81-14" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(h)</span>
<span id="cb81-15"><a href="numerical-tax.html#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="numerical-tax.html#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co"># define colors based on cutting a divisive hierarchical clustering into 4 groups</span></span>
<span id="cb81-17"><a href="numerical-tax.html#cb81-17" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Set1&#39;</span>)[<span class="fu">cutree</span>(h, <span class="dv">4</span>)]</span>
<span id="cb81-18"><a href="numerical-tax.html#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="numerical-tax.html#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="co"># nMDS from distance matrix</span></span>
<span id="cb81-20"><a href="numerical-tax.html#cb81-20" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">sammon</span>(d)</span>
<span id="cb81-21"><a href="numerical-tax.html#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="numerical-tax.html#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb81-23"><a href="numerical-tax.html#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb81-24"><a href="numerical-tax.html#cb81-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s<span class="sc">$</span>points, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">&#39;&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>, <span class="at">main=</span><span class="st">&quot;nMDS by Sammon&#39;s Non-Linear Mapping&quot;</span>)</span>
<span id="cb81-25"><a href="numerical-tax.html#cb81-25" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(v=0, h=0, col=&#39;black&#39;)</span></span>
<span id="cb81-26"><a href="numerical-tax.html#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb81-27"><a href="numerical-tax.html#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(s<span class="sc">$</span>points, <span class="fu">rownames</span>(s<span class="sc">$</span>points), <span class="at">cex=</span><span class="fl">0.75</span>, <span class="at">col=</span>cols, <span class="at">font=</span><span class="dv">2</span>)</span>
<span id="cb81-28"><a href="numerical-tax.html#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-42-1.svg" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="nmds-with-the-vegan-package" class="section level4" number="3.3.5.6">
<h4><span class="header-section-number">3.3.5.6</span> nMDS with the <code>vegan</code> Package</h4>
<p>The following example is quite brief. See the <a href="https://cran.r-project.org/web/packages/vegan/vignettes/intro-vegan.pdf"><em>Introduction to ordination in vegan</em></a> vignette for some excellent worked examples and ecological interpretation. The <a href="https://cran.r-project.org/web/packages/vegan/vignettes/FAQ-vegan.html">vegan package FAQ</a> is another excellent resource. <a href="http://www.springer.com/us/book/9781441979759"><em>Numerical Ecology with R</em></a> can be used as both reference and learning resource.</p>
<p>The <code>metaMDS()</code> function from the <code>vegan</code> package provides a convenience function that automates most of the steps required to create an oridination.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="numerical-tax.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-make data, this time with all profiles</span></span>
<span id="cb82-2"><a href="numerical-tax.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;sp4&#39;</span>, <span class="at">package =</span> <span class="st">&#39;aqp&#39;</span>)</span>
<span id="cb82-3"><a href="numerical-tax.html#cb82-3" aria-hidden="true" tabindex="-1"></a>sp4 <span class="ot">&lt;-</span> sp4[, <span class="fu">c</span>(<span class="st">&#39;name&#39;</span>, <span class="st">&#39;clay&#39;</span>, <span class="st">&#39;sand&#39;</span>, <span class="st">&#39;Mg&#39;</span>, <span class="st">&#39;Ca&#39;</span>, <span class="st">&#39;CEC_7&#39;</span>)]</span>
<span id="cb82-4"><a href="numerical-tax.html#cb82-4" aria-hidden="true" tabindex="-1"></a>sp4.scaled <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name=</span>sp4[, <span class="dv">1</span>], <span class="fu">round</span>(<span class="fu">scale</span>( sp4[, <span class="sc">-</span><span class="dv">1</span>]), <span class="dv">2</span>))</span>
<span id="cb82-5"><a href="numerical-tax.html#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="numerical-tax.html#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># define colors based on natural groupings</span></span>
<span id="cb82-7"><a href="numerical-tax.html#cb82-7" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Set1&#39;</span>)</span>
<span id="cb82-8"><a href="numerical-tax.html#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="numerical-tax.html#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co"># distance calc + ordination</span></span>
<span id="cb82-10"><a href="numerical-tax.html#cb82-10" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">metaMDS</span>(sp4.scaled[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">distance =</span> <span class="st">&#39;gower&#39;</span>, <span class="at">autotransform =</span> <span class="cn">FALSE</span>, <span class="at">wascores=</span><span class="cn">FALSE</span>)</span>
<span id="cb82-11"><a href="numerical-tax.html#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="numerical-tax.html#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="do">## this is used to generate 4 classes from a divisive hierarchical clustering</span></span>
<span id="cb82-13"><a href="numerical-tax.html#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co"># manually compute distance matrix</span></span>
<span id="cb82-14"><a href="numerical-tax.html#cb82-14" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">dist</span>(sp4.scaled[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb82-15"><a href="numerical-tax.html#cb82-15" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(d)</span>
<span id="cb82-16"><a href="numerical-tax.html#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">list</span>(sp4.scaled<span class="sc">$</span>name, sp4.scaled<span class="sc">$</span>name)</span>
<span id="cb82-17"><a href="numerical-tax.html#cb82-17" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(m)</span>
<span id="cb82-18"><a href="numerical-tax.html#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="co"># dendrogram from divisive clustering</span></span>
<span id="cb82-19"><a href="numerical-tax.html#cb82-19" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">diana</span>(d)</span>
<span id="cb82-20"><a href="numerical-tax.html#cb82-20" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">as.hclust</span>(dd)</span>
<span id="cb82-21"><a href="numerical-tax.html#cb82-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-22"><a href="numerical-tax.html#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="co"># define colors based on cutting a divisive hierarchical clustering into 4 groups</span></span>
<span id="cb82-23"><a href="numerical-tax.html#cb82-23" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Set1&#39;</span>)[<span class="fu">cutree</span>(h, <span class="dv">4</span>)]</span>
<span id="cb82-24"><a href="numerical-tax.html#cb82-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-25"><a href="numerical-tax.html#cb82-25" aria-hidden="true" tabindex="-1"></a><span class="co"># plot ordination</span></span>
<span id="cb82-26"><a href="numerical-tax.html#cb82-26" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb82-27"><a href="numerical-tax.html#cb82-27" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">ordiplot</span>(s, <span class="at">type=</span><span class="st">&#39;none&#39;</span>, <span class="at">cex.axis=</span><span class="fl">0.75</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">&#39;&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>, <span class="at">main=</span><span class="st">&#39;nMDS by metaMDS()&#39;</span>)</span>
<span id="cb82-28"><a href="numerical-tax.html#cb82-28" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">v=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&#39;grey&#39;</span>)</span>
<span id="cb82-29"><a href="numerical-tax.html#cb82-29" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(fig<span class="sc">$</span>sites, sp4<span class="sc">$</span>name, <span class="at">cex=</span><span class="fl">0.75</span>, <span class="at">font=</span><span class="dv">2</span>, <span class="at">col=</span>cols)</span>
<span id="cb82-30"><a href="numerical-tax.html#cb82-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ordicluster(fig, agnes(daisy(sp4.scaled[, -1]), method=&#39;ward&#39;), prune=3, col = &quot;orange&quot;)</span></span>
<span id="cb82-31"><a href="numerical-tax.html#cb82-31" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-43-1.svg" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="rotations" class="section level4" number="3.3.5.7">
<h4><span class="header-section-number">3.3.5.7</span> Rotations</h4>
<p>procrustes, etc.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="numerical-tax.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://ncss-tech.github.io/AQP/aqp/color-contrast.html</span></span></code></pre></div>
</div>
</div>
</div>
<div id="practical-applications" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Practical Applications</h2>
<p>Before you work through the following examples, you should review the <a href="http://ncss-tech.github.io/AQP/aqp/aqp-intro.html">SoilProfileCollection object tutorial</a>.</p>
<div id="pair-wise-distances-between-soil-profiles-1" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Pair-Wise Distances Between Soil Profiles</h3>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="numerical-tax.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># init example data</span></span>
<span id="cb84-2"><a href="numerical-tax.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(sp4)</span>
<span id="cb84-3"><a href="numerical-tax.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">depths</span>(sp4) <span class="ot">&lt;-</span> id <span class="sc">~</span> top <span class="sc">+</span> bottom</span>
<span id="cb84-4"><a href="numerical-tax.html#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="numerical-tax.html#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># eval dissimilarity:</span></span>
<span id="cb84-6"><a href="numerical-tax.html#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># using Ex-Ca:Mg and CEC at pH 7</span></span>
<span id="cb84-7"><a href="numerical-tax.html#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co"># with no depth-weighting (k=0)</span></span>
<span id="cb84-8"><a href="numerical-tax.html#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co"># to a maximum depth of 40 cm</span></span>
<span id="cb84-9"><a href="numerical-tax.html#cb84-9" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">profile_compare</span>(sp4, <span class="at">vars=</span><span class="fu">c</span>(<span class="st">&#39;ex_Ca_to_Mg&#39;</span>, <span class="st">&#39;CEC_7&#39;</span>), <span class="at">k=</span><span class="dv">0</span>, <span class="at">max_d=</span><span class="dv">40</span>)</span>
<span id="cb84-10"><a href="numerical-tax.html#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="numerical-tax.html#cb84-11" aria-hidden="true" tabindex="-1"></a><span class="co"># check distance matrix:</span></span>
<span id="cb84-12"><a href="numerical-tax.html#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(d, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Dissimilarities :
##                colusa glenn kings mariposa mendocino napa san benito shasta
## glenn            13.5                                                      
## kings            16.0  12.7                                                
## mariposa          8.4  11.3  16.5                                          
## mendocino        11.5   8.0  16.4     15.0                                 
## napa             30.4  24.1  29.4     29.2      21.6                       
## san benito       25.7  20.6  26.3     28.2      15.8 18.0                  
## shasta           17.2  13.3   8.7     17.6      17.1 33.7       22.2       
## shasta-trinity    6.4  16.6  22.3      9.6      16.5 29.8       27.2   23.3
## tehama           28.7  22.9  27.9     27.3      20.0  8.8       15.1   31.4
##                shasta-trinity
## glenn                        
## kings                        
## mariposa                     
## mendocino                    
## napa                         
## san benito                   
## shasta                       
## shasta-trinity               
## tehama                   27.9
## 
## Metric :  mixed ;  Types = I, I 
## Number of objects : 10</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="numerical-tax.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cluster via divisive method</span></span>
<span id="cb86-2"><a href="numerical-tax.html#cb86-2" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">diana</span>(d)</span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="numerical-tax.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize dissimilarity matrix via hierarchical clustering</span></span>
<span id="cb87-2"><a href="numerical-tax.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb87-3"><a href="numerical-tax.html#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfileDendrogram</span>(sp4, clust, <span class="at">dend.y.scale =</span> <span class="dv">50</span>, <span class="at">scaling.factor =</span> <span class="fl">0.66</span>, <span class="at">y.offset =</span> <span class="fl">3.5</span>, <span class="at">width=</span><span class="fl">0.3</span>, <span class="at">cex.names =</span> <span class="fl">0.7</span>, <span class="at">color=</span><span class="st">&#39;ex_Ca_to_Mg&#39;</span>, <span class="at">col.label=</span><span class="st">&#39;Exchageable Ca to Mg Ratio&#39;</span>, <span class="at">name.style =</span> <span class="st">&#39;center-center&#39;</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-46-1.svg" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="pair-wise-distances-between-soil-series" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Pair-Wise Distances Between Soil Series</h3>
<p>The following figures are related to some of the graphical summaries <a href="http://casoilresource.lawr.ucdavis.edu/sde/?series=drummer">provided by SoilWeb/SDE</a>. These related tutorials cover similar material in greater detail:</p>
<ul>
<li><a href="https://ncss-tech.github.io/AQP/soilDB/competing-series.html">Competing Soil Series</a></li>
<li><a href="https://ncss-tech.github.io/AQP/soilDB/soil-series-query-functions.html">Querying Soil Series Data</a></li>
</ul>
<p>The <code>fetchOSD</code> function can return <a href="https://ncss-tech.github.io/AQP/soilDB/soil-series-query-functions.html">additional summaries</a> tabulated from climate data, MLRA boundaries, SSURGO, and much more with the <code>extended=TRUE</code> argument. Lets experiment with distances computed from annual climate data and hillslope position.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="numerical-tax.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># soil series from around CONUS</span></span>
<span id="cb88-2"><a href="numerical-tax.html#cb88-2" aria-hidden="true" tabindex="-1"></a>soils <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;redding&#39;</span>, <span class="st">&#39;pentz&#39;</span>, <span class="st">&#39;willows&#39;</span>, <span class="st">&#39;yolo&#39;</span>, <span class="st">&#39;hanford&#39;</span>, <span class="st">&#39;cecil&#39;</span>, <span class="st">&#39;sycamore&#39;</span>, <span class="st">&#39;KLAMATH&#39;</span>, <span class="st">&#39;drummer&#39;</span>, <span class="st">&#39;musick&#39;</span>, <span class="st">&#39;zook&#39;</span>)</span>
<span id="cb88-3"><a href="numerical-tax.html#cb88-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">fetchOSD</span>(soils, <span class="at">extended =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-4"><a href="numerical-tax.html#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="numerical-tax.html#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="co"># note additional data, packed into a list</span></span>
<span id="cb88-6"><a href="numerical-tax.html#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(s, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## List of 17
##  $ SPC             :Formal class &#39;SoilProfileCollection&#39; [package &quot;aqp&quot;] with 9 slots
##  $ competing       :&#39;data.frame&#39;:    57 obs. of  3 variables:
##  $ geog_assoc_soils:&#39;data.frame&#39;:    83 obs. of  2 variables:
##  $ geomcomp        :&#39;data.frame&#39;:    9 obs. of  9 variables:
##  $ hillpos         :&#39;data.frame&#39;:    10 obs. of  8 variables:
##  $ mtnpos          :&#39;data.frame&#39;:    2 obs. of  9 variables:
##  $ terrace         :&#39;data.frame&#39;:    8 obs. of  5 variables:
##  $ flats           :&#39;data.frame&#39;:    7 obs. of  7 variables:
##  $ shape_across    :&#39;data.frame&#39;:    11 obs. of  8 variables:
##  $ shape_down      :&#39;data.frame&#39;:    11 obs. of  8 variables:
##  $ pmkind          :&#39;data.frame&#39;:    19 obs. of  5 variables:
##  $ pmorigin        :&#39;data.frame&#39;:    44 obs. of  5 variables:
##  $ mlra            :&#39;data.frame&#39;:    75 obs. of  4 variables:
##  $ climate.annual  :&#39;data.frame&#39;:    88 obs. of  12 variables:
##  $ climate.monthly :&#39;data.frame&#39;:    264 obs. of  14 variables:
##  $ NCCPI           :&#39;data.frame&#39;:    11 obs. of  16 variables:
##  $ soilweb.metadata:&#39;data.frame&#39;:    20 obs. of  2 variables:</code></pre>
<div id="annual-climate-data" class="section level4" number="3.4.2.1">
<h4><span class="header-section-number">3.4.2.1</span> Annual Climate Data</h4>
<p>The <a href="http://ncss-tech.github.io/sharpshootR/docs/reference/vizAnnualClimate.html"><code>vizAnnualClimate</code> function (sharpshootR package)</a> arranges percentiles of annual climate summaries according to divisive hierarchical clustering applied to median values. Climate summaries were derived from 800m, daily PRISM data spanning 1981-2010.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="numerical-tax.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># control color like this</span></span>
<span id="cb90-2"><a href="numerical-tax.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">trellis.par.set</span>(<span class="at">plot.line=</span><span class="fu">list</span>(<span class="at">col=</span><span class="st">&#39;RoyalBlue&#39;</span>))</span>
<span id="cb90-3"><a href="numerical-tax.html#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="numerical-tax.html#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># control centers symbol and size here</span></span>
<span id="cb90-5"><a href="numerical-tax.html#cb90-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">vizAnnualClimate</span>(s<span class="sc">$</span>climate.annual, <span class="at">IQR.cex =</span> <span class="fl">1.25</span>, <span class="at">cex=</span><span class="fl">1.1</span>, <span class="at">pch=</span><span class="dv">18</span>)</span>
<span id="cb90-6"><a href="numerical-tax.html#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="numerical-tax.html#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot figure, this is Lattice graphics</span></span>
<span id="cb90-8"><a href="numerical-tax.html#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(res<span class="sc">$</span>fig)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-48-1.svg" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="numerical-tax.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do something with clustering</span></span>
<span id="cb91-2"><a href="numerical-tax.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb91-3"><a href="numerical-tax.html#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># usually requires tinkering...</span></span>
<span id="cb91-4"><a href="numerical-tax.html#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfileDendrogram</span>(s<span class="sc">$</span>SPC, <span class="at">clust =</span> res<span class="sc">$</span>clust, <span class="at">scaling.factor =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">y.offset =</span> <span class="fl">1.3</span>, <span class="at">name.style =</span> <span class="st">&#39;center-center&#39;</span>)</span>
<span id="cb91-5"><a href="numerical-tax.html#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&#39;sorted by annual climate summaries&#39;</span>, <span class="at">side =</span> <span class="dv">3</span>, <span class="at">at =</span> <span class="fl">0.5</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">line =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">font=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-49-1.svg" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="hillslope-position" class="section level4" number="3.4.2.2">
<h4><span class="header-section-number">3.4.2.2</span> Hillslope Position</h4>
<p>The <a href="http://ncss-tech.github.io/sharpshootR/docs/reference/vizHillslopePosition.html"><code>vizHillslopePosition</code> function (sharpshootR package)</a> arranges hillslope position proportions (SSURGO) according to divisive hierarchical clustering. Proportions are used as characteristics for each soil series. The branches of the dendrogram are rotated so that ordering within the figure approximates the hydrologic gradient as closely as possible. Rotation is performed by the <code>dendextend::rotate</code> function.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="numerical-tax.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># result is a lattice graphics object</span></span>
<span id="cb92-2"><a href="numerical-tax.html#cb92-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">vizHillslopePosition</span>(s<span class="sc">$</span>hillpos)</span>
<span id="cb92-3"><a href="numerical-tax.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(res<span class="sc">$</span>fig)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-50-1.svg" width="960" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="pair-wise-distances-between-subgroup-level-taxa" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Pair-Wise Distances Between Subgroup-Level Taxa</h3>
<p>The following are demonstrations of pair-wise distances computed from categorical data and the use of a dendrogram to organize groups from Soil Taxonomy. <a href="http://ncss-tech.github.io/AQP/sharpshootR/OSD-dendrogram.html">Click here</a> for details.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="numerical-tax.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a vector of series</span></span>
<span id="cb93-2"><a href="numerical-tax.html#cb93-2" aria-hidden="true" tabindex="-1"></a>s.list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;amador&#39;</span>, <span class="st">&#39;redding&#39;</span>, <span class="st">&#39;pentz&#39;</span>, <span class="st">&#39;willows&#39;</span>, <span class="st">&#39;pardee&#39;</span>, <span class="st">&#39;yolo&#39;</span>, <span class="st">&#39;hanford&#39;</span>, <span class="st">&#39;cecil&#39;</span>, <span class="st">&#39;sycamore&#39;</span>, <span class="st">&#39;KLAMATH&#39;</span>, <span class="st">&#39;MOGLIA&#39;</span>, <span class="st">&#39;drummer&#39;</span>, <span class="st">&#39;musick&#39;</span>, <span class="st">&#39;zook&#39;</span>, <span class="st">&#39;argonaut&#39;</span>, <span class="st">&#39;PALAU&#39;</span>)</span>
<span id="cb93-3"><a href="numerical-tax.html#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="numerical-tax.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get and SPC object with basic data on these series</span></span>
<span id="cb93-5"><a href="numerical-tax.html#cb93-5" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">fetchOSD</span>(s.list)</span>
<span id="cb93-6"><a href="numerical-tax.html#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="numerical-tax.html#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="co"># graphical check</span></span>
<span id="cb93-8"><a href="numerical-tax.html#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb93-9"><a href="numerical-tax.html#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s) ; <span class="fu">title</span>(<span class="st">&#39;Selected Pedons from Official Series Descriptions&#39;</span>, <span class="at">line=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-51-1.svg" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="numerical-tax.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check structure of some site-level attributes</span></span>
<span id="cb94-2"><a href="numerical-tax.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co"># head(site(s))[, c(&#39;id&#39;, &#39;soilorder&#39;, &#39;suborder&#39;, &#39;greatgroup&#39;, &#39;subgroup&#39;)])</span></span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
id
</th>
<th style="text-align:left;">
soilorder
</th>
<th style="text-align:left;">
suborder
</th>
<th style="text-align:left;">
greatgroup
</th>
<th style="text-align:left;">
subgroup
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AMADOR
</td>
<td style="text-align:left;">
inceptisols
</td>
<td style="text-align:left;">
xerepts
</td>
<td style="text-align:left;">
haploxerepts
</td>
<td style="text-align:left;">
typic haploxerepts
</td>
</tr>
<tr>
<td style="text-align:left;">
ARGONAUT
</td>
<td style="text-align:left;">
alfisols
</td>
<td style="text-align:left;">
xeralfs
</td>
<td style="text-align:left;">
haploxeralfs
</td>
<td style="text-align:left;">
mollic haploxeralfs
</td>
</tr>
<tr>
<td style="text-align:left;">
CECIL
</td>
<td style="text-align:left;">
ultisols
</td>
<td style="text-align:left;">
udults
</td>
<td style="text-align:left;">
kanhapludults
</td>
<td style="text-align:left;">
typic kanhapludults
</td>
</tr>
<tr>
<td style="text-align:left;">
DRUMMER
</td>
<td style="text-align:left;">
mollisols
</td>
<td style="text-align:left;">
aquolls
</td>
<td style="text-align:left;">
endoaquolls
</td>
<td style="text-align:left;">
typic endoaquolls
</td>
</tr>
<tr>
<td style="text-align:left;">
HANFORD
</td>
<td style="text-align:left;">
entisols
</td>
<td style="text-align:left;">
orthents
</td>
<td style="text-align:left;">
xerorthents
</td>
<td style="text-align:left;">
typic xerorthents
</td>
</tr>
<tr>
<td style="text-align:left;">
KLAMATH
</td>
<td style="text-align:left;">
mollisols
</td>
<td style="text-align:left;">
aquolls
</td>
<td style="text-align:left;">
cryaquolls
</td>
<td style="text-align:left;">
cumulic cryaquolls
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="numerical-tax.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb95-2"><a href="numerical-tax.html#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot dendrogram + profiles</span></span>
<span id="cb95-3"><a href="numerical-tax.html#cb95-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">SoilTaxonomyDendrogram</span>(s, <span class="at">scaling.factor =</span> <span class="fl">0.01</span>, <span class="at">width=</span><span class="fl">0.2</span>, <span class="at">cex.names=</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-53-1.svg" width="1152" style="display: block; margin: auto;" /></p>
<p>Check the resulting distance matrix.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="numerical-tax.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(d)</span></code></pre></div>
</div>
<div id="soil-color-signatures" class="section level3" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> Soil Color Signatures</h3>
<p>See this <a href="http://ncss-tech.github.io/AQP/aqp/soil-color-signatures.html">related tutorial</a> for additional examples.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="numerical-tax.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># manually convert Munsell -&gt; sRGB</span></span>
<span id="cb97-2"><a href="numerical-tax.html#cb97-2" aria-hidden="true" tabindex="-1"></a>rgb.data <span class="ot">&lt;-</span> <span class="fu">munsell2rgb</span>(s<span class="sc">$</span>hue, s<span class="sc">$</span>value, s<span class="sc">$</span>chroma, <span class="at">return_triplets =</span> <span class="cn">TRUE</span>)</span>
<span id="cb97-3"><a href="numerical-tax.html#cb97-3" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>r <span class="ot">&lt;-</span> rgb.data<span class="sc">$</span>r</span>
<span id="cb97-4"><a href="numerical-tax.html#cb97-4" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>g <span class="ot">&lt;-</span> rgb.data<span class="sc">$</span>g</span>
<span id="cb97-5"><a href="numerical-tax.html#cb97-5" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>b <span class="ot">&lt;-</span> rgb.data<span class="sc">$</span>b</span>
<span id="cb97-6"><a href="numerical-tax.html#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="numerical-tax.html#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co"># eval color signature</span></span>
<span id="cb97-8"><a href="numerical-tax.html#cb97-8" aria-hidden="true" tabindex="-1"></a>pig <span class="ot">&lt;-</span> <span class="fu">soilColorSignature</span>(s, <span class="at">RescaleLightnessBy =</span> <span class="dv">5</span>, <span class="at">method=</span><span class="st">&#39;depthSlices&#39;</span>)</span>
<span id="cb97-9"><a href="numerical-tax.html#cb97-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-10"><a href="numerical-tax.html#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="co"># display results as table</span></span>
<span id="cb97-11"><a href="numerical-tax.html#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable_styling</span>(knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(pig), <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>), <span class="at">font_size =</span> <span class="dv">10</span>)</span></code></pre></div>
<table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
id
</th>
<th style="text-align:right;">
A.0.1
</th>
<th style="text-align:right;">
A.0.5
</th>
<th style="text-align:right;">
A.0.9
</th>
<th style="text-align:right;">
B.0.1
</th>
<th style="text-align:right;">
B.0.5
</th>
<th style="text-align:right;">
B.0.9
</th>
<th style="text-align:right;">
L.0.1
</th>
<th style="text-align:right;">
L.0.5
</th>
<th style="text-align:right;">
L.0.9
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AMADOR
</td>
<td style="text-align:right;">
3.68
</td>
<td style="text-align:right;">
4.87
</td>
<td style="text-align:right;">
1.92
</td>
<td style="text-align:right;">
13.30
</td>
<td style="text-align:right;">
18.96
</td>
<td style="text-align:right;">
27.83
</td>
<td style="text-align:right;">
8.25
</td>
<td style="text-align:right;">
10.32
</td>
<td style="text-align:right;">
14.33
</td>
</tr>
<tr>
<td style="text-align:left;">
ARGONAUT
</td>
<td style="text-align:right;">
13.55
</td>
<td style="text-align:right;">
19.31
</td>
<td style="text-align:right;">
15.88
</td>
<td style="text-align:right;">
19.55
</td>
<td style="text-align:right;">
30.22
</td>
<td style="text-align:right;">
17.61
</td>
<td style="text-align:right;">
6.16
</td>
<td style="text-align:right;">
6.16
</td>
<td style="text-align:right;">
8.25
</td>
</tr>
<tr>
<td style="text-align:left;">
CECIL
</td>
<td style="text-align:right;">
7.38
</td>
<td style="text-align:right;">
32.90
</td>
<td style="text-align:right;">
28.72
</td>
<td style="text-align:right;">
26.00
</td>
<td style="text-align:right;">
29.50
</td>
<td style="text-align:right;">
35.81
</td>
<td style="text-align:right;">
8.25
</td>
<td style="text-align:right;">
8.25
</td>
<td style="text-align:right;">
8.25
</td>
</tr>
<tr>
<td style="text-align:left;">
DRUMMER
</td>
<td style="text-align:right;">
2.19
</td>
<td style="text-align:right;">
1.48
</td>
<td style="text-align:right;">
1.48
</td>
<td style="text-align:right;">
5.37
</td>
<td style="text-align:right;">
6.18
</td>
<td style="text-align:right;">
6.18
</td>
<td style="text-align:right;">
4.11
</td>
<td style="text-align:right;">
8.25
</td>
<td style="text-align:right;">
8.25
</td>
</tr>
<tr>
<td style="text-align:left;">
HANFORD
</td>
<td style="text-align:right;">
5.63
</td>
<td style="text-align:right;">
5.63
</td>
<td style="text-align:right;">
6.61
</td>
<td style="text-align:right;">
19.85
</td>
<td style="text-align:right;">
19.85
</td>
<td style="text-align:right;">
25.48
</td>
<td style="text-align:right;">
8.25
</td>
<td style="text-align:right;">
8.25
</td>
<td style="text-align:right;">
10.33
</td>
</tr>
<tr>
<td style="text-align:left;">
KLAMATH
</td>
<td style="text-align:right;">
2.19
</td>
<td style="text-align:right;">
2.19
</td>
<td style="text-align:right;">
10.37
</td>
<td style="text-align:right;">
5.37
</td>
<td style="text-align:right;">
5.37
</td>
<td style="text-align:right;">
37.72
</td>
<td style="text-align:right;">
4.11
</td>
<td style="text-align:right;">
4.11
</td>
<td style="text-align:right;">
8.26
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="numerical-tax.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># move row names over for distance matrix</span></span>
<span id="cb98-2"><a href="numerical-tax.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(pig) <span class="ot">&lt;-</span> pig[, <span class="dv">1</span>]</span>
<span id="cb98-3"><a href="numerical-tax.html#cb98-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">daisy</span>(pig[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb98-4"><a href="numerical-tax.html#cb98-4" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">diana</span>(d)</span>
<span id="cb98-5"><a href="numerical-tax.html#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="numerical-tax.html#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb98-7"><a href="numerical-tax.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.25</span>,<span class="dv">1</span>))</span>
<span id="cb98-8"><a href="numerical-tax.html#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfileDendrogram</span>(s, dd, <span class="at">dend.y.scale =</span> <span class="fu">max</span>(d) <span class="sc">*</span> <span class="dv">2</span>, <span class="at">scaling.factor =</span> <span class="fl">0.3</span>, <span class="at">y.offset =</span> <span class="dv">6</span>, <span class="at">width=</span><span class="fl">0.2</span>, <span class="at">cex.names=</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-55-1.svg" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="clustering-of-soil-colors" class="section level3" number="3.4.5">
<h3><span class="header-section-number">3.4.5</span> Clustering of Soil Colors</h3>
<p>Just for fun, use hierarchical clustering and nMDS on soil color data from the OSDs that were used in the previous example.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="numerical-tax.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract horizon data from select OSDs in above example</span></span>
<span id="cb99-2"><a href="numerical-tax.html#cb99-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="fu">horizons</span>(s)</span>
<span id="cb99-3"><a href="numerical-tax.html#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="numerical-tax.html#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert Munsell color notation to sRGB</span></span>
<span id="cb99-5"><a href="numerical-tax.html#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co"># these are moist colors</span></span>
<span id="cb99-6"><a href="numerical-tax.html#cb99-6" aria-hidden="true" tabindex="-1"></a>rgb.data <span class="ot">&lt;-</span> <span class="fu">munsell2rgb</span>(h<span class="sc">$</span>hue, h<span class="sc">$</span>value, h<span class="sc">$</span>chroma, <span class="at">return_triplets =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-7"><a href="numerical-tax.html#cb99-7" aria-hidden="true" tabindex="-1"></a>lab.data <span class="ot">&lt;-</span> <span class="fu">munsell2rgb</span>(h<span class="sc">$</span>hue, h<span class="sc">$</span>value, h<span class="sc">$</span>chroma, <span class="at">returnLAB =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-8"><a href="numerical-tax.html#cb99-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-9"><a href="numerical-tax.html#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb99-10"><a href="numerical-tax.html#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rgb.data)</span></code></pre></div>
<pre><code>##           r         g          b
## 1 0.4360624 0.3706674 0.29697452
## 2 0.5589675 0.4673350 0.35663875
## 3 0.5589675 0.4673350 0.35663875
## 4 0.7719679 0.6774631 0.48997537
## 5 0.3940324 0.2499977 0.16682669
## 6 0.4309729 0.2327690 0.09771028</code></pre>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="numerical-tax.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lab.data)</span></code></pre></div>
<pre><code>##          L         A        B
## 1 41.24855  3.681301 13.29762
## 2 51.62124  4.870262 18.95563
## 3 51.62124  4.870262 18.95563
## 4 71.66388  1.919454 27.82850
## 5 30.79580 13.548688 19.54789
## 6 30.80674 19.311423 30.21539</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="numerical-tax.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove NA</span></span>
<span id="cb103-2"><a href="numerical-tax.html#cb103-2" aria-hidden="true" tabindex="-1"></a>rgb.data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(rgb.data)</span>
<span id="cb103-3"><a href="numerical-tax.html#cb103-3" aria-hidden="true" tabindex="-1"></a>lab.data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(lab.data)</span>
<span id="cb103-4"><a href="numerical-tax.html#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="numerical-tax.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co"># retain unique colors</span></span>
<span id="cb103-6"><a href="numerical-tax.html#cb103-6" aria-hidden="true" tabindex="-1"></a>rgb.data <span class="ot">&lt;-</span> <span class="fu">unique</span>(rgb.data)</span>
<span id="cb103-7"><a href="numerical-tax.html#cb103-7" aria-hidden="true" tabindex="-1"></a>lab.data <span class="ot">&lt;-</span> <span class="fu">unique</span>(lab.data)</span>
<span id="cb103-8"><a href="numerical-tax.html#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="numerical-tax.html#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize colors in LAB coordinates</span></span>
<span id="cb103-10"><a href="numerical-tax.html#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(lab.data, <span class="at">col=</span><span class="st">&#39;white&#39;</span>, <span class="at">bg=</span><span class="fu">rgb</span>(rgb.data), <span class="at">pch=</span><span class="dv">21</span>, <span class="at">cex=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-56-1.svg" width="576" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="numerical-tax.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create distance matrix from LAB coordinates</span></span>
<span id="cb104-2"><a href="numerical-tax.html#cb104-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">daisy</span>(lab.data, <span class="at">stand=</span><span class="cn">FALSE</span>)</span>
<span id="cb104-3"><a href="numerical-tax.html#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="numerical-tax.html#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># divisive heirarcical clustering</span></span>
<span id="cb104-5"><a href="numerical-tax.html#cb104-5" aria-hidden="true" tabindex="-1"></a>d.hclust <span class="ot">&lt;-</span> <span class="fu">as.hclust</span>(<span class="fu">diana</span>(d))</span>
<span id="cb104-6"><a href="numerical-tax.html#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="numerical-tax.html#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to phylo class for nicer plotting</span></span>
<span id="cb104-8"><a href="numerical-tax.html#cb104-8" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">as.phylo</span>(d.hclust)</span>
<span id="cb104-9"><a href="numerical-tax.html#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="numerical-tax.html#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="co"># perform nMDS on distance matrix</span></span>
<span id="cb104-11"><a href="numerical-tax.html#cb104-11" aria-hidden="true" tabindex="-1"></a>d.sammon <span class="ot">&lt;-</span> <span class="fu">sammon</span>(d)</span>
<span id="cb104-12"><a href="numerical-tax.html#cb104-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-13"><a href="numerical-tax.html#cb104-13" aria-hidden="true" tabindex="-1"></a><span class="co"># setup multi-figure page</span></span>
<span id="cb104-14"><a href="numerical-tax.html#cb104-14" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>), <span class="at">bg=</span><span class="fu">grey</span>(<span class="fl">0.95</span>))</span>
<span id="cb104-15"><a href="numerical-tax.html#cb104-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-16"><a href="numerical-tax.html#cb104-16" aria-hidden="true" tabindex="-1"></a><span class="co"># plot fan-style dendrogram</span></span>
<span id="cb104-17"><a href="numerical-tax.html#cb104-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="at">font=</span><span class="dv">2</span>, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">type=</span><span class="st">&#39;fan&#39;</span>, <span class="at">show.tip.label=</span><span class="cn">FALSE</span>, <span class="at">main=</span><span class="st">&#39;Dendrogram Representation&#39;</span>)</span>
<span id="cb104-18"><a href="numerical-tax.html#cb104-18" aria-hidden="true" tabindex="-1"></a><span class="co"># add colors at dendrogram tips</span></span>
<span id="cb104-19"><a href="numerical-tax.html#cb104-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tiplabels</span>(<span class="at">pch=</span><span class="dv">21</span>, <span class="at">cex=</span><span class="dv">4</span>, <span class="at">col=</span><span class="st">&#39;white&#39;</span>, <span class="at">bg=</span><span class="fu">rgb</span>(rgb.data))</span>
<span id="cb104-20"><a href="numerical-tax.html#cb104-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-21"><a href="numerical-tax.html#cb104-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plot nMDS ordination</span></span>
<span id="cb104-22"><a href="numerical-tax.html#cb104-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d.sammon<span class="sc">$</span>points, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">&#39;&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">main=</span><span class="st">&#39;nMDS Ordination&#39;</span>)</span>
<span id="cb104-23"><a href="numerical-tax.html#cb104-23" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">v=</span><span class="dv">0</span>, <span class="at">col=</span><span class="st">&#39;black&#39;</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb104-24"><a href="numerical-tax.html#cb104-24" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(d.sammon<span class="sc">$</span>points, <span class="at">bg=</span><span class="fu">rgb</span>(rgb.data), <span class="at">pch=</span><span class="dv">21</span>, <span class="at">cex=</span><span class="fl">3.5</span>, <span class="at">col=</span><span class="st">&#39;white&#39;</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-57-1.svg" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="how-do-the-interpretations-compare" class="section level3" number="3.4.6">
<h3><span class="header-section-number">3.4.6</span> “How Do the Interpretations Compare?”</h3>
<p>Example borrowed from <a href="http://ncss-tech.github.io/AQP/soilDB/SDA-cointerp-tutorial.html">this tutorial</a>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="numerical-tax.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb105-2"><a href="numerical-tax.html#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co"># set list of component names, same as soil color example</span></span>
<span id="cb105-3"><a href="numerical-tax.html#cb105-3" aria-hidden="true" tabindex="-1"></a>s.list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;amador&#39;</span>, <span class="st">&#39;redding&#39;</span>, <span class="st">&#39;pentz&#39;</span>, <span class="st">&#39;willows&#39;</span>, <span class="st">&#39;pardee&#39;</span>, <span class="st">&#39;yolo&#39;</span>, </span>
<span id="cb105-4"><a href="numerical-tax.html#cb105-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&#39;hanford&#39;</span>, <span class="st">&#39;cecil&#39;</span>, <span class="st">&#39;sycamore&#39;</span>, <span class="st">&#39;zook&#39;</span>)</span>
<span id="cb105-5"><a href="numerical-tax.html#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="numerical-tax.html#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co"># get OSD details</span></span>
<span id="cb105-7"><a href="numerical-tax.html#cb105-7" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">fetchOSD</span>(<span class="at">soils =</span> s.list)</span>
<span id="cb105-8"><a href="numerical-tax.html#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="numerical-tax.html#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co"># set list of relevant interpretations</span></span>
<span id="cb105-10"><a href="numerical-tax.html#cb105-10" aria-hidden="true" tabindex="-1"></a>interp.list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;ENG - Construction Materials; Topsoil&#39;</span>, </span>
<span id="cb105-11"><a href="numerical-tax.html#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;ENG - Sewage Lagoons&#39;</span>, <span class="st">&#39;ENG - Septic Tank Absorption Fields&#39;</span>, </span>
<span id="cb105-12"><a href="numerical-tax.html#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;ENG - Unpaved Local Roads and Streets&#39;</span>)</span>
<span id="cb105-13"><a href="numerical-tax.html#cb105-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-14"><a href="numerical-tax.html#cb105-14" aria-hidden="true" tabindex="-1"></a><span class="co"># compose query</span></span>
<span id="cb105-15"><a href="numerical-tax.html#cb105-15" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;SELECT UPPER(compname) as compname, mrulename, AVG(interplr) as interplr_mean</span></span>
<span id="cb105-16"><a href="numerical-tax.html#cb105-16" aria-hidden="true" tabindex="-1"></a><span class="st">FROM component INNER JOIN cointerp ON component.cokey = cointerp.cokey</span></span>
<span id="cb105-17"><a href="numerical-tax.html#cb105-17" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE compname IN &quot;</span>, <span class="fu">format_SQL_in_statement</span>(s.list), <span class="st">&quot;</span></span>
<span id="cb105-18"><a href="numerical-tax.html#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="st">AND seqnum = 0</span></span>
<span id="cb105-19"><a href="numerical-tax.html#cb105-19" aria-hidden="true" tabindex="-1"></a><span class="st">AND mrulename IN &quot;</span>, <span class="fu">format_SQL_in_statement</span>(interp.list), <span class="st">&quot;</span></span>
<span id="cb105-20"><a href="numerical-tax.html#cb105-20" aria-hidden="true" tabindex="-1"></a><span class="st">AND interplr IS NOT NULL</span></span>
<span id="cb105-21"><a href="numerical-tax.html#cb105-21" aria-hidden="true" tabindex="-1"></a><span class="st">GROUP BY compname, mrulename;&quot;</span>)</span>
<span id="cb105-22"><a href="numerical-tax.html#cb105-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-23"><a href="numerical-tax.html#cb105-23" aria-hidden="true" tabindex="-1"></a><span class="co"># send query</span></span>
<span id="cb105-24"><a href="numerical-tax.html#cb105-24" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">SDA_query</span>(q)</span>
<span id="cb105-25"><a href="numerical-tax.html#cb105-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-26"><a href="numerical-tax.html#cb105-26" aria-hidden="true" tabindex="-1"></a><span class="co"># reshape long -&gt; wide</span></span>
<span id="cb105-27"><a href="numerical-tax.html#cb105-27" aria-hidden="true" tabindex="-1"></a>x.wide <span class="ot">&lt;-</span> <span class="fu">dcast</span>(x, compname <span class="sc">~</span> mrulename, <span class="at">value.var =</span> <span class="st">&#39;interplr_mean&#39;</span>)</span>
<span id="cb105-28"><a href="numerical-tax.html#cb105-28" aria-hidden="true" tabindex="-1"></a><span class="fu">kable_styling</span>(knitr<span class="sc">::</span><span class="fu">kable</span>(x.wide, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">caption=</span><span class="st">&quot;Mean Fuzzy Ratings for Select Soil Series&quot;</span>), <span class="at">font_size =</span> <span class="dv">10</span>)</span></code></pre></div>
<table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-58">Table 3.1: </span>Mean Fuzzy Ratings for Select Soil Series
</caption>
<thead>
<tr>
<th style="text-align:left;">
compname
</th>
<th style="text-align:right;">
ENG - Construction Materials; Topsoil
</th>
<th style="text-align:right;">
ENG - Septic Tank Absorption Fields
</th>
<th style="text-align:right;">
ENG - Sewage Lagoons
</th>
<th style="text-align:right;">
ENG - Unpaved Local Roads and Streets
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AMADOR
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.69
</td>
</tr>
<tr>
<td style="text-align:left;">
CECIL
</td>
<td style="text-align:right;">
0.41
</td>
<td style="text-align:right;">
0.66
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
0.30
</td>
</tr>
<tr>
<td style="text-align:left;">
HANFORD
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.20
</td>
</tr>
<tr>
<td style="text-align:left;">
PARDEE
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
PENTZ
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.71
</td>
</tr>
<tr>
<td style="text-align:left;">
REDDING
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.80
</td>
</tr>
<tr>
<td style="text-align:left;">
SYCAMORE
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
0.78
</td>
</tr>
<tr>
<td style="text-align:left;">
WILLOWS
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
YOLO
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;">
0.91
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;">
0.61
</td>
</tr>
<tr>
<td style="text-align:left;">
ZOOK
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="numerical-tax.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note: component name and series name have been converted to upper case</span></span>
<span id="cb106-2"><a href="numerical-tax.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sort rows of fuzzy ratings based on profiles from OSDs</span></span>
<span id="cb106-3"><a href="numerical-tax.html#cb106-3" aria-hidden="true" tabindex="-1"></a>new.order <span class="ot">&lt;-</span> <span class="fu">match</span>(x.wide<span class="sc">$</span>compname, <span class="fu">profile_id</span>(s))</span>
<span id="cb106-4"><a href="numerical-tax.html#cb106-4" aria-hidden="true" tabindex="-1"></a>x.wide <span class="ot">&lt;-</span> x.wide[new.order, ]</span>
<span id="cb106-5"><a href="numerical-tax.html#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="numerical-tax.html#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="co"># copy ids to row.names so that they are preserved in distance matrix</span></span>
<span id="cb106-7"><a href="numerical-tax.html#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(x.wide) <span class="ot">&lt;-</span> x.wide<span class="sc">$</span>compname</span>
<span id="cb106-8"><a href="numerical-tax.html#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="numerical-tax.html#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create distance matrix</span></span>
<span id="cb106-10"><a href="numerical-tax.html#cb106-10" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">daisy</span>(x.wide[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb106-11"><a href="numerical-tax.html#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="numerical-tax.html#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="co"># divisive hierarchical clustering</span></span>
<span id="cb106-13"><a href="numerical-tax.html#cb106-13" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">diana</span>(d)</span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="numerical-tax.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb107-2"><a href="numerical-tax.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotProfileDendrogram</span>(s, clust, <span class="at">dend.y.scale =</span> <span class="dv">2</span>, <span class="at">scaling.factor =</span> <span class="fl">0.007</span>, <span class="at">y.offset =</span> <span class="fl">0.1</span>, <span class="at">width=</span><span class="fl">0.3</span>, <span class="at">cex.names=</span><span class="fl">0.45</span>)</span>
<span id="cb107-3"><a href="numerical-tax.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;Component Similarity via Select Fuzzy Ratings&#39;</span>)</span>
<span id="cb107-4"><a href="numerical-tax.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&#39;Profile Sketches are from OSDs&#39;</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-60-1.svg" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="mlra-concepts-via-climate-and-elevation-samples" class="section level3" number="3.4.7">
<h3><span class="header-section-number">3.4.7</span> MLRA Concepts via Climate and Elevation Samples</h3>
<p>Get and process example data, originally sampled from PRISM raster and DEM within MLRA 15, 18, 22A, and 22B. Variables include:</p>
<ul>
<li>elevation</li>
<li>mean annual air temperature</li>
<li>mean annuap precipitation</li>
<li>fraction of annual precipitation as rain</li>
<li>effective precipitation</li>
<li>frost-free days</li>
<li>growing degree days</li>
</ul>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="numerical-tax.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb108-2"><a href="numerical-tax.html#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb108-3"><a href="numerical-tax.html#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb108-4"><a href="numerical-tax.html#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb108-5"><a href="numerical-tax.html#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="numerical-tax.html#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co"># get example data</span></span>
<span id="cb108-7"><a href="numerical-tax.html#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co"># init a temp file</span></span>
<span id="cb108-8"><a href="numerical-tax.html#cb108-8" aria-hidden="true" tabindex="-1"></a>tf <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb108-9"><a href="numerical-tax.html#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="numerical-tax.html#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="co"># download compressed CSV to temp file</span></span>
<span id="cb108-11"><a href="numerical-tax.html#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&#39;https://github.com/ncss-tech/stats_for_soil_survey/raw/master/data/clustering_and_ordination/MLRA-raster-data-example.csv.gz&#39;</span>, <span class="at">destfile =</span> tf, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb108-12"><a href="numerical-tax.html#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="co"># read-in from compressed CSV to data.frame object</span></span>
<span id="cb108-13"><a href="numerical-tax.html#cb108-13" aria-hidden="true" tabindex="-1"></a>d.sub <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">gzfile</span>(tf), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb108-14"><a href="numerical-tax.html#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="numerical-tax.html#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="co"># check: note that the column names are quite strange</span></span>
<span id="cb108-16"><a href="numerical-tax.html#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d.sub)</span>
<span id="cb108-17"><a href="numerical-tax.html#cb108-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-18"><a href="numerical-tax.html#cb108-18" aria-hidden="true" tabindex="-1"></a><span class="co"># set factor levels</span></span>
<span id="cb108-19"><a href="numerical-tax.html#cb108-19" aria-hidden="true" tabindex="-1"></a>mu.set <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;15&#39;</span>, <span class="st">&#39;18&#39;</span>, <span class="st">&#39;22A&#39;</span>, <span class="st">&#39;22B&#39;</span>)</span>
<span id="cb108-20"><a href="numerical-tax.html#cb108-20" aria-hidden="true" tabindex="-1"></a>d.sub<span class="sc">$</span>.id <span class="ot">&lt;-</span> <span class="fu">factor</span>(d.sub<span class="sc">$</span>.id, <span class="at">levels =</span> mu.set)</span>
<span id="cb108-21"><a href="numerical-tax.html#cb108-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-22"><a href="numerical-tax.html#cb108-22" aria-hidden="true" tabindex="-1"></a><span class="co"># define some nice colors</span></span>
<span id="cb108-23"><a href="numerical-tax.html#cb108-23" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="dv">9</span>, <span class="st">&#39;Set1&#39;</span>) </span>
<span id="cb108-24"><a href="numerical-tax.html#cb108-24" aria-hidden="true" tabindex="-1"></a><span class="co"># remove light colors</span></span>
<span id="cb108-25"><a href="numerical-tax.html#cb108-25" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> cols[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>)]</span></code></pre></div>
<div id="nonmetric-multidimensional-scaling" class="section level4" number="3.4.7.1">
<h4><span class="header-section-number">3.4.7.1</span> Nonmetric Multidimensional Scaling</h4>
<p>A smooh surface fit to mean annual air temperature highlights structure within a nMDS ordination.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="numerical-tax.html#cb109-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">metaMDS</span>(d.sub[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)], <span class="at">distance =</span> <span class="st">&#39;gower&#39;</span>)</span>
<span id="cb109-2"><a href="numerical-tax.html#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="numerical-tax.html#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="co"># margins</span></span>
<span id="cb109-4"><a href="numerical-tax.html#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb109-5"><a href="numerical-tax.html#cb109-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-6"><a href="numerical-tax.html#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="co"># setup plot</span></span>
<span id="cb109-7"><a href="numerical-tax.html#cb109-7" aria-hidden="true" tabindex="-1"></a>o <span class="ot">&lt;-</span> <span class="fu">ordiplot</span>(m, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb109-8"><a href="numerical-tax.html#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="co"># add points, colored accoring to MLRA</span></span>
<span id="cb109-9"><a href="numerical-tax.html#cb109-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(o, <span class="st">&#39;sites&#39;</span>, <span class="at">cex=</span><span class="dv">1</span>, <span class="at">col=</span>cols[<span class="fu">as.numeric</span>(d.sub<span class="sc">$</span>.id)], <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb109-10"><a href="numerical-tax.html#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="numerical-tax.html#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="co"># overlay smooth surface of variable used in ordination</span></span>
<span id="cb109-12"><a href="numerical-tax.html#cb109-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ordisurf</span>(m, d.sub<span class="sc">$</span>Mean.Annual.Air.Temperature..degrees.C., <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">&#39;black&#39;</span>, <span class="at">labcex=</span><span class="dv">1</span>)</span>
<span id="cb109-13"><a href="numerical-tax.html#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topleft&#39;</span>, <span class="at">legend=</span>mu.set, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span>cols, <span class="at">bty=</span><span class="st">&#39;n&#39;</span>, <span class="at">cex=</span><span class="fl">1.25</span>)</span>
<span id="cb109-14"><a href="numerical-tax.html#cb109-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-15"><a href="numerical-tax.html#cb109-15" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&#39;nMDS with mean annual air temperature (deg C) surface&#39;</span>)</span>
<span id="cb109-16"><a href="numerical-tax.html#cb109-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-17"><a href="numerical-tax.html#cb109-17" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-62-1.svg" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="principle-coordinates" class="section level4" number="3.4.7.2">
<h4><span class="header-section-number">3.4.7.2</span> Principle Coordinates</h4>
<p>This example generates an ordination (via principal coordinates) of environmental variables (PRSIM and elevation) associated with MLRAs 15, 18, 22A, and 22B. Ellipses represent 50% probability contours via <em>multivariate homogeneity of group dispersions</em>. See comments in the code for details. Note that this example was <a href="https://github.com/ncss-tech/soilReports/tree/master/inst/reports/region2/mu-comparison">extracted from the Region 2 Map Unit Comparison Report</a>.</p>
<p><strong>Thoughts on interpretation:</strong></p>
<ul>
<li>The relative position of points and ellipses are meaningful; absolute position will vary each time the figure is generated.</li>
<li>Look for “diffuse” vs. “concentrated” clusters: these suggest relatively broadly vs. narrowly defined concepts.</li>
<li>Nesting of clusters (e.g. smaller cluster contained by larger cluster) suggests super-set/subset relationships.</li>
<li>Overlap is proportional to similarity.</li>
</ul>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="numerical-tax.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="do">## </span><span class="al">NOTE</span><span class="do">: data with very low variability will cause warnings</span></span>
<span id="cb110-2"><a href="numerical-tax.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># eval numerical distance, removing first 3 columns of IDs</span></span>
<span id="cb110-3"><a href="numerical-tax.html#cb110-3" aria-hidden="true" tabindex="-1"></a>d.dist <span class="ot">&lt;-</span> <span class="fu">daisy</span>(d.sub[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)], <span class="at">stand=</span><span class="cn">TRUE</span>)</span>
<span id="cb110-4"><a href="numerical-tax.html#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="numerical-tax.html#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="do">## map distance matrix to 2D space via principal coordinates</span></span>
<span id="cb110-6"><a href="numerical-tax.html#cb110-6" aria-hidden="true" tabindex="-1"></a>d.betadisper <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(d.dist, <span class="at">group=</span>d.sub<span class="sc">$</span>.id, <span class="at">bias.adjust =</span> <span class="cn">TRUE</span>, <span class="at">sqrt.dist =</span> <span class="cn">FALSE</span>, <span class="at">type=</span><span class="st">&#39;median&#39;</span>)</span>
<span id="cb110-7"><a href="numerical-tax.html#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="numerical-tax.html#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="do">## fancy plot</span></span>
<span id="cb110-9"><a href="numerical-tax.html#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(</span>
<span id="cb110-10"><a href="numerical-tax.html#cb110-10" aria-hidden="true" tabindex="-1"></a>  d.betadisper, <span class="at">hull=</span><span class="cn">FALSE</span>, <span class="at">ellipse=</span><span class="cn">TRUE</span>, <span class="at">conf=</span><span class="fl">0.5</span>,</span>
<span id="cb110-11"><a href="numerical-tax.html#cb110-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span>cols, <span class="at">main=</span><span class="st">&#39;Ordination of Raster Samples</span><span class="sc">\n</span><span class="st">50% Probability Ellipse&#39;</span>, <span class="at">sub=</span><span class="st">&#39;MLRA 15, 18, 22A, 22B&#39;</span></span>
<span id="cb110-12"><a href="numerical-tax.html#cb110-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-63-1.svg" width="768" style="display: block; margin: auto;" /></p>
<p>Pair-wise comparisons at the 90% level of confidence.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="numerical-tax.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="do">## pair-wise comparisons of variance</span></span>
<span id="cb111-2"><a href="numerical-tax.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">5.5</span>, <span class="fl">4.5</span>, <span class="dv">1</span>))</span>
<span id="cb111-3"><a href="numerical-tax.html#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">TukeyHSD</span>(d.betadisper, <span class="at">conf.level =</span> <span class="fl">0.9</span>), <span class="at">las=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="003-numerical-taxonomy_files/figure-html/unnamed-chunk-64-1.svg" width="672" style="display: block; margin: auto;" /></p>
<!-- TODO: consider this kind of information in the front matter -->
<div style="font-size: 80%;">
<p>This document is based on <code>aqp</code> version 1.41 and <code>soilDB</code> version 2.6.14 and <code>sharpshootR</code> version 1.9.</p>
</div>
<!-- references automatically added here  -->

</div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Arkley1976" class="csl-entry">
Arkley, Rodney J. 1976. <span>“Statistical <span>Methods</span> in <span>Soil</span> <span>Classification</span> <span>Research</span>.”</span> <em>Advances in Agronomy</em> 28: 37–70. <a href="https://doi.org/10.1016/S0065-2113(08)60552-0">https://doi.org/10.1016/S0065-2113(08)60552-0</a>.
</div>
<div id="ref-belbin1992" class="csl-entry">
Belbin, Lee, Daniel P. Faith, and Glenn W. Milligan. 1992. <span>“A Comparison of Two Approaches to Beta-Flexible Clustering.”</span> <em>Multivariate Behavioral Research</em> 27 (3): 417–33. <a href="https://doi.org/10.1207/s15327906mbr2703\_6">https://doi.org/10.1207/s15327906mbr2703\_6</a>.
</div>
<div id="ref-Gower1971" class="csl-entry">
Gower, J. C. 1971. <span>“A General Coefficient of Similarity and Some of Its Properties.”</span> <em>Biometrics</em> 27 (4): 857–71. <a href="http://www.jstor.org/stable/2528823">http://www.jstor.org/stable/2528823</a>.
</div>
<div id="ref-Hole1960" class="csl-entry">
Hole, F. D., and M. Hironaka. 1960. <span>“An Experiment in Ordination of Some Soil Profiles.”</span> <em>Proceedings of the Soil Science Society of America 24</em> 24: 309–12.
</div>
<div id="ref-Kaufman2005" class="csl-entry">
Kaufman, Leonard, and Peter J. Rousseeuw, eds. 2005. <em>Finding <span>Groups</span> in <span>Data</span></em>. Wiley <span>Series</span> in <span>Probability</span> and <span>Statistics</span>. Hoboken, NJ, USA: John Wiley &amp; Sons, Inc. <a href="https://doi.org/10.1002/9780470316801">https://doi.org/10.1002/9780470316801</a>.
</div>
<div id="ref-Legendre1998" class="csl-entry">
Legendre, Pierre, and Louis Legendre. 2012. <em>Numerical <span>Ecology</span></em>. Third English edition. Developments in Environmental Modelling 24. Amsterdam: Elsevier. <a href="https://www.sciencedirect.com/book/9780444538680">https://www.sciencedirect.com/book/9780444538680</a>.
</div>
<div id="ref-Rousseeuw1987" class="csl-entry">
Rousseeuw, P. J. 1987. <span>“Silhouettes: A Grapical Aid to the Interpretation and Validation of Cluster Analysis.”</span> <em>Journal of Computational and Applied Mathmatics</em> 20: 53–65.
</div>
<div id="ref-Sneath1973" class="csl-entry">
Sneath, Peter H. A., and Robert R. Sokal. 1973. <em>Numerical Taxonomy</em>. W.H. Freeman; Company.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="uncertainty.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["s4ssbook.pdf", "s4ssbook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
