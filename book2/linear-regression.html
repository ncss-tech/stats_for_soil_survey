<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Linear Regression | Statistics for Soil Survey - Part 2</title>
  <meta name="description" content="Web-based course content for Statistics for Soil Survey - Part 2 made with bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Linear Regression | Statistics for Soil Survey - Part 2" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Web-based course content for Statistics for Soil Survey - Part 2 made with bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Linear Regression | Statistics for Soil Survey - Part 2" />
  
  <meta name="twitter:description" content="Web-based course content for Statistics for Soil Survey - Part 2 made with bookdown::gitbook." />
  

<meta name="author" content="Soil Survey Staff" />


<meta name="date" content="2023-02-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="numerical-tax.html"/>
<link rel="next" href="glm.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="../book/index.html">Statistics for Soil Survey - Part 1</a></li>
<li><a href="index.html">Statistics for Soil Survey - Part 2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Pre-course Assignment</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i><b>0.1</b> Setup</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#additional-reading"><i class="fa fa-check"></i><b>0.2</b> Additional Reading</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#outline"><i class="fa fa-check"></i><b>1.1</b> Outline</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>2</b> Uncertainty</a>
<ul>
<li class="chapter" data-level="2.1" data-path="uncertainty.html"><a href="uncertainty.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="uncertainty.html"><a href="uncertainty.html#examples---dispersion"><i class="fa fa-check"></i><b>2.1.1</b> Examples - Dispersion</a></li>
<li class="chapter" data-level="2.1.2" data-path="uncertainty.html"><a href="uncertainty.html#examples---variation-and-certainty"><i class="fa fa-check"></i><b>2.1.2</b> Examples - Variation and Certainty</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="uncertainty.html"><a href="uncertainty.html#theory-of-uncertainty"><i class="fa fa-check"></i><b>2.2</b> Theory of Uncertainty</a></li>
<li class="chapter" data-level="2.3" data-path="uncertainty.html"><a href="uncertainty.html#resampling-to-estimate-uncertainty"><i class="fa fa-check"></i><b>2.3</b> Resampling to Estimate Uncertainty</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="uncertainty.html"><a href="uncertainty.html#exercise-1"><i class="fa fa-check"></i><b>2.3.1</b> Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="uncertainty.html"><a href="uncertainty.html#performance-metrics"><i class="fa fa-check"></i><b>2.4</b> Performance Metrics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="uncertainty.html"><a href="uncertainty.html#numerical"><i class="fa fa-check"></i><b>2.4.1</b> Numerical</a></li>
<li class="chapter" data-level="2.4.2" data-path="uncertainty.html"><a href="uncertainty.html#exercise-2"><i class="fa fa-check"></i><b>2.4.2</b> Exercise 2</a></li>
<li class="chapter" data-level="2.4.3" data-path="uncertainty.html"><a href="uncertainty.html#categorical"><i class="fa fa-check"></i><b>2.4.3</b> Categorical</a></li>
<li class="chapter" data-level="2.4.4" data-path="uncertainty.html"><a href="uncertainty.html#exercise-3"><i class="fa fa-check"></i><b>2.4.4</b> Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="uncertainty.html"><a href="uncertainty.html#stratified-randomareal-adjustment"><i class="fa fa-check"></i><b>2.5</b> Stratified-random/areal-adjustment</a></li>
<li class="chapter" data-level="2.6" data-path="uncertainty.html"><a href="uncertainty.html#validation"><i class="fa fa-check"></i><b>2.6</b> Validation</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="uncertainty.html"><a href="uncertainty.html#internal-validation"><i class="fa fa-check"></i><b>2.6.1</b> Internal Validation</a></li>
<li class="chapter" data-level="2.6.2" data-path="uncertainty.html"><a href="uncertainty.html#external-validation"><i class="fa fa-check"></i><b>2.6.2</b> External Validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="numerical-tax.html"><a href="numerical-tax.html"><i class="fa fa-check"></i><b>3</b> Numerical Taxonomy and Ordination</a>
<ul>
<li class="chapter" data-level="3.1" data-path="numerical-tax.html"><a href="numerical-tax.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="numerical-tax.html"><a href="numerical-tax.html#objectives"><i class="fa fa-check"></i><b>3.1.1</b> Objectives</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="numerical-tax.html"><a href="numerical-tax.html#whirlwind-tour"><i class="fa fa-check"></i><b>3.2</b> Whirlwind Tour</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="numerical-tax.html"><a href="numerical-tax.html#similarity-disimilarty-and-distance"><i class="fa fa-check"></i><b>3.2.1</b> Similarity, Disimilarty, and Distance</a></li>
<li class="chapter" data-level="3.2.2" data-path="numerical-tax.html"><a href="numerical-tax.html#standardization-of-characteristics"><i class="fa fa-check"></i><b>3.2.2</b> Standardization of Characteristics</a></li>
<li class="chapter" data-level="3.2.3" data-path="numerical-tax.html"><a href="numerical-tax.html#missing-data"><i class="fa fa-check"></i><b>3.2.3</b> Missing Data</a></li>
<li class="chapter" data-level="3.2.4" data-path="numerical-tax.html"><a href="numerical-tax.html#visualizing-pair-wise-distances-the-dendrogram"><i class="fa fa-check"></i><b>3.2.4</b> Visualizing Pair-Wise Distances: The Dendrogram</a></li>
<li class="chapter" data-level="3.2.5" data-path="numerical-tax.html"><a href="numerical-tax.html#cluster-analysis-finding-groups-in-data"><i class="fa fa-check"></i><b>3.2.5</b> Cluster Analysis: Finding Groups in Data</a></li>
<li class="chapter" data-level="3.2.6" data-path="numerical-tax.html"><a href="numerical-tax.html#ordination-visualization-in-a-reduced-space"><i class="fa fa-check"></i><b>3.2.6</b> Ordination: Visualization in a Reduced Space</a></li>
<li class="chapter" data-level="3.2.7" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-soil-profiles"><i class="fa fa-check"></i><b>3.2.7</b> Pair-Wise Distances Between Soil Profiles</a></li>
<li class="chapter" data-level="3.2.8" data-path="numerical-tax.html"><a href="numerical-tax.html#final-discussion"><i class="fa fa-check"></i><b>3.2.8</b> Final Discussion</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="numerical-tax.html"><a href="numerical-tax.html#excercises"><i class="fa fa-check"></i><b>3.3</b> Excercises</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="numerical-tax.html"><a href="numerical-tax.html#set-up-the-r-session"><i class="fa fa-check"></i><b>3.3.1</b> Set Up the R Session</a></li>
<li class="chapter" data-level="3.3.2" data-path="numerical-tax.html"><a href="numerical-tax.html#data-sources"><i class="fa fa-check"></i><b>3.3.2</b> Data Sources</a></li>
<li class="chapter" data-level="3.3.3" data-path="numerical-tax.html"><a href="numerical-tax.html#try-it"><i class="fa fa-check"></i><b>3.3.3</b> Try it!</a></li>
<li class="chapter" data-level="3.3.4" data-path="numerical-tax.html"><a href="numerical-tax.html#evaluating-missing-data"><i class="fa fa-check"></i><b>3.3.4</b> Evaluating Missing Data</a></li>
<li class="chapter" data-level="3.3.5" data-path="numerical-tax.html"><a href="numerical-tax.html#more-on-the-distance-matrix-and-how-to-make-one"><i class="fa fa-check"></i><b>3.3.5</b> More on the Distance Matrix and How to Make One</a></li>
<li class="chapter" data-level="3.3.6" data-path="numerical-tax.html"><a href="numerical-tax.html#thematic-distance-matrix-plots"><i class="fa fa-check"></i><b>3.3.6</b> Thematic Distance Matrix Plots</a></li>
<li class="chapter" data-level="3.3.7" data-path="numerical-tax.html"><a href="numerical-tax.html#hierachrical-clustering"><i class="fa fa-check"></i><b>3.3.7</b> Hierachrical Clustering</a></li>
<li class="chapter" data-level="3.3.8" data-path="numerical-tax.html"><a href="numerical-tax.html#centroid-and-medoid-partitioning-clustering-1"><i class="fa fa-check"></i><b>3.3.8</b> Centroid and Medoid (Partitioning) Clustering</a></li>
<li class="chapter" data-level="3.3.9" data-path="numerical-tax.html"><a href="numerical-tax.html#ordination"><i class="fa fa-check"></i><b>3.3.9</b> Ordination</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="numerical-tax.html"><a href="numerical-tax.html#practical-applications"><i class="fa fa-check"></i><b>3.4</b> Practical Applications</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-soil-profiles-1"><i class="fa fa-check"></i><b>3.4.1</b> Pair-Wise Distances Between Soil Profiles</a></li>
<li class="chapter" data-level="3.4.2" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-soil-series"><i class="fa fa-check"></i><b>3.4.2</b> Pair-Wise Distances Between Soil Series</a></li>
<li class="chapter" data-level="3.4.3" data-path="numerical-tax.html"><a href="numerical-tax.html#pair-wise-distances-between-subgroup-level-taxa"><i class="fa fa-check"></i><b>3.4.3</b> Pair-Wise Distances Between Subgroup-Level Taxa</a></li>
<li class="chapter" data-level="3.4.4" data-path="numerical-tax.html"><a href="numerical-tax.html#soil-color-signatures"><i class="fa fa-check"></i><b>3.4.4</b> Soil Color Signatures</a></li>
<li class="chapter" data-level="3.4.5" data-path="numerical-tax.html"><a href="numerical-tax.html#clustering-of-soil-colors"><i class="fa fa-check"></i><b>3.4.5</b> Clustering of Soil Colors</a></li>
<li class="chapter" data-level="3.4.6" data-path="numerical-tax.html"><a href="numerical-tax.html#how-do-the-interpretations-compare"><i class="fa fa-check"></i><b>3.4.6</b> “How Do the Interpretations Compare?”</a></li>
<li class="chapter" data-level="3.4.7" data-path="numerical-tax.html"><a href="numerical-tax.html#mlra-concepts-via-climate-and-elevation-samples"><i class="fa fa-check"></i><b>3.4.7</b> MLRA Concepts via Climate and Elevation Samples</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>4</b> Linear Regression</a>
<ul>
<li class="chapter" data-level="4.1" data-path="linear-regression.html"><a href="linear-regression.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="linear-regression.html"><a href="linear-regression.html#linear-regression-example"><i class="fa fa-check"></i><b>4.2</b> Linear Regression Example</a></li>
<li class="chapter" data-level="4.3" data-path="linear-regression.html"><a href="linear-regression.html#data"><i class="fa fa-check"></i><b>4.3</b> Data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="linear-regression.html"><a href="linear-regression.html#henry-mount-database"><i class="fa fa-check"></i><b>4.3.1</b> Henry Mount Database</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-regression.html"><a href="linear-regression.html#aggregate-time-series"><i class="fa fa-check"></i><b>4.3.2</b> Aggregate Time Series</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-regression.html"><a href="linear-regression.html#final-dataset"><i class="fa fa-check"></i><b>4.3.3</b> Final Dataset</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="linear-regression.html"><a href="linear-regression.html#spatial-data"><i class="fa fa-check"></i><b>4.4</b> Spatial data</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="linear-regression.html"><a href="linear-regression.html#plot-coordinates"><i class="fa fa-check"></i><b>4.4.1</b> Plot Coordinates</a></li>
<li class="chapter" data-level="4.4.2" data-path="linear-regression.html"><a href="linear-regression.html#extracting-spatial-data"><i class="fa fa-check"></i><b>4.4.2</b> Extracting Spatial Data</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="linear-regression.html"><a href="linear-regression.html#exploratory-data-analysis-eda"><i class="fa fa-check"></i><b>4.5</b> Exploratory Data Analysis (EDA)</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="linear-regression.html"><a href="linear-regression.html#compare-samples-vs-population"><i class="fa fa-check"></i><b>4.5.1</b> Compare Samples vs Population</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="linear-regression.html"><a href="linear-regression.html#linear-modeling"><i class="fa fa-check"></i><b>4.6</b> Linear modeling</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="linear-regression.html"><a href="linear-regression.html#diagnostics"><i class="fa fa-check"></i><b>4.6.1</b> Diagnostics</a></li>
<li class="chapter" data-level="4.6.2" data-path="linear-regression.html"><a href="linear-regression.html#variable-selection-model-validation"><i class="fa fa-check"></i><b>4.6.2</b> Variable selection &amp; model validation</a></li>
<li class="chapter" data-level="4.6.3" data-path="linear-regression.html"><a href="linear-regression.html#final-model-accuracy-assessment"><i class="fa fa-check"></i><b>4.6.3</b> Final model &amp; accuracy assessment</a></li>
<li class="chapter" data-level="4.6.4" data-path="linear-regression.html"><a href="linear-regression.html#model-interpretation"><i class="fa fa-check"></i><b>4.6.4</b> Model Interpretation</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="linear-regression.html"><a href="linear-regression.html#generate-spatial-predictions"><i class="fa fa-check"></i><b>4.7</b> Generate spatial predictions</a></li>
<li class="chapter" data-level="4.8" data-path="linear-regression.html"><a href="linear-regression.html#create-map"><i class="fa fa-check"></i><b>4.8</b> Create Map</a></li>
<li class="chapter" data-level="4.9" data-path="linear-regression.html"><a href="linear-regression.html#exercise"><i class="fa fa-check"></i><b>4.9</b> Exercise</a></li>
<li class="chapter" data-level="4.10" data-path="linear-regression.html"><a href="linear-regression.html#additional-reading-1"><i class="fa fa-check"></i><b>4.10</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>5</b> Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="glm.html"><a href="glm.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="glm.html"><a href="glm.html#logistic-regression"><i class="fa fa-check"></i><b>5.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="5.3" data-path="glm.html"><a href="glm.html#examples"><i class="fa fa-check"></i><b>5.3</b> Examples</a></li>
<li class="chapter" data-level="5.4" data-path="glm.html"><a href="glm.html#exercise-4"><i class="fa fa-check"></i><b>5.4</b> Exercise</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="glm.html"><a href="glm.html#load-packages"><i class="fa fa-check"></i><b>5.4.1</b> Load packages</a></li>
<li class="chapter" data-level="5.4.2" data-path="glm.html"><a href="glm.html#read-in-data"><i class="fa fa-check"></i><b>5.4.2</b> Read in data</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="glm.html"><a href="glm.html#exploratory-analysis-eda"><i class="fa fa-check"></i><b>5.5</b> Exploratory analysis (EDA)</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="glm.html"><a href="glm.html#data-wrangling"><i class="fa fa-check"></i><b>5.5.1</b> Data wrangling</a></li>
<li class="chapter" data-level="5.5.2" data-path="glm.html"><a href="glm.html#geomorphic-data"><i class="fa fa-check"></i><b>5.5.2</b> Geomorphic data</a></li>
<li class="chapter" data-level="5.5.3" data-path="glm.html"><a href="glm.html#soil-scientist-bias"><i class="fa fa-check"></i><b>5.5.3</b> Soil Scientist Bias</a></li>
<li class="chapter" data-level="5.5.4" data-path="glm.html"><a href="glm.html#plot-coordinates-1"><i class="fa fa-check"></i><b>5.5.4</b> Plot coordinates</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="glm.html"><a href="glm.html#exercise-1-view-the-data"><i class="fa fa-check"></i><b>5.6</b> Exercise 1: View the data</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="glm.html"><a href="glm.html#extracting-spatial-data-1"><i class="fa fa-check"></i><b>5.6.1</b> Extracting spatial data</a></li>
<li class="chapter" data-level="5.6.2" data-path="glm.html"><a href="glm.html#examine-spatial-data"><i class="fa fa-check"></i><b>5.6.2</b> Examine spatial data</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="glm.html"><a href="glm.html#constructing-the-model"><i class="fa fa-check"></i><b>5.7</b> Constructing the model</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="glm.html"><a href="glm.html#diagnostic"><i class="fa fa-check"></i><b>5.7.1</b> Diagnostic</a></li>
<li class="chapter" data-level="5.7.2" data-path="glm.html"><a href="glm.html#variable-selection-model-validation-1"><i class="fa fa-check"></i><b>5.7.2</b> Variable Selection &amp; model validation</a></li>
<li class="chapter" data-level="5.7.3" data-path="glm.html"><a href="glm.html#final-model-accuracy"><i class="fa fa-check"></i><b>5.7.3</b> Final model &amp; accuracy</a></li>
<li class="chapter" data-level="5.7.4" data-path="glm.html"><a href="glm.html#model-effects"><i class="fa fa-check"></i><b>5.7.4</b> Model effects</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="glm.html"><a href="glm.html#generate-spatial-predictions-1"><i class="fa fa-check"></i><b>5.8</b> Generate spatial predictions</a></li>
<li class="chapter" data-level="5.9" data-path="glm.html"><a href="glm.html#exercise-5"><i class="fa fa-check"></i><b>5.9</b> Exercise</a></li>
<li class="chapter" data-level="5.10" data-path="glm.html"><a href="glm.html#additional-reading-2"><i class="fa fa-check"></i><b>5.10</b> Additional reading</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tree-based-models.html"><a href="tree-based-models.html"><i class="fa fa-check"></i><b>6</b> Tree-based Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="tree-based-models.html"><a href="tree-based-models.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="tree-based-models.html"><a href="tree-based-models.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>6.2</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="tree-based-models.html"><a href="tree-based-models.html#getting-data-into-r-and-exporting-to-shapefile"><i class="fa fa-check"></i><b>6.2.1</b> Getting Data Into R and Exporting to Shapefile</a></li>
<li class="chapter" data-level="6.2.2" data-path="tree-based-models.html"><a href="tree-based-models.html#examining-data-in-r"><i class="fa fa-check"></i><b>6.2.2</b> Examining Data in R</a></li>
<li class="chapter" data-level="6.2.3" data-path="tree-based-models.html"><a href="tree-based-models.html#exercise-1-1"><i class="fa fa-check"></i><b>6.2.3</b> Exercise 1</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="tree-based-models.html"><a href="tree-based-models.html#classification-and-regression-trees-cart"><i class="fa fa-check"></i><b>6.3</b> Classification and Regression Trees (CART)</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="tree-based-models.html"><a href="tree-based-models.html#exercise-2-rpart"><i class="fa fa-check"></i><b>6.3.1</b> Exercise 2: rpart</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="tree-based-models.html"><a href="tree-based-models.html#random-forest"><i class="fa fa-check"></i><b>6.4</b> Random Forest</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="tree-based-models.html"><a href="tree-based-models.html#exercise-3-randomforest"><i class="fa fa-check"></i><b>6.4.1</b> Exercise 3: randomForest</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="tree-based-models.html"><a href="tree-based-models.html#prediction-using-tree-based-models"><i class="fa fa-check"></i><b>6.5</b> Prediction using Tree-based Models</a></li>
<li class="chapter" data-level="6.6" data-path="tree-based-models.html"><a href="tree-based-models.html#summary"><i class="fa fa-check"></i><b>6.6</b> Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html"><i class="fa fa-check"></i><b>A</b> Accuracy and Uncertainty for Categorical Predictions</a>
<ul>
<li class="chapter" data-level="A.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#status-quo"><i class="fa fa-check"></i><b>A.1</b> Status Quo</a></li>
<li class="chapter" data-level="A.2" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#theses"><i class="fa fa-check"></i><b>A.2</b> Theses</a></li>
<li class="chapter" data-level="A.3" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#soap-box-time"><i class="fa fa-check"></i><b>A.3</b> Soap Box Time</a></li>
<li class="chapter" data-level="A.4" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#concept-demonstration-via-simulated-data"><i class="fa fa-check"></i><b>A.4</b> Concept Demonstration via Simulated Data</a></li>
<li class="chapter" data-level="A.5" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#accuracy"><i class="fa fa-check"></i><b>A.5</b> Accuracy</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#confusion-matrix-area-under-roc"><i class="fa fa-check"></i><b>A.5.1</b> Confusion Matrix / Area Under ROC</a></li>
<li class="chapter" data-level="A.5.2" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#brier-scores"><i class="fa fa-check"></i><b>A.5.2</b> Brier Scores</a></li>
<li class="chapter" data-level="A.5.3" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#tau-and-weighted-tau-class-similarity"><i class="fa fa-check"></i><b>A.5.3</b> Tau and Weighted Tau (class-similarity)</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#uncertainty-1"><i class="fa fa-check"></i><b>A.6</b> Uncertainty</a>
<ul>
<li class="chapter" data-level="A.6.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#shanon-entropy"><i class="fa fa-check"></i><b>A.6.1</b> Shanon Entropy</a></li>
</ul></li>
<li class="chapter" data-level="A.7" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#review"><i class="fa fa-check"></i><b>A.7</b> Review</a></li>
<li class="chapter" data-level="A.8" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#example-implementation"><i class="fa fa-check"></i><b>A.8</b> Example Implementation</a></li>
<li class="chapter" data-level="A.9" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#resources"><i class="fa fa-check"></i><b>A.9</b> Resources</a>
<ul>
<li class="chapter" data-level="A.9.1" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#evaluating-accuracy-of-categorical-probabilistic-predictions"><i class="fa fa-check"></i><b>A.9.1</b> Evaluating Accuracy of Categorical / Probabilistic Predictions</a></li>
<li class="chapter" data-level="A.9.2" data-path="acc-unc-categorical-data.html"><a href="acc-unc-categorical-data.html#sampling-and-stability-of-estimates"><i class="fa fa-check"></i><b>A.9.2</b> Sampling and Stability of Estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="commentary-selecting-a-modeling-framework.html"><a href="commentary-selecting-a-modeling-framework.html"><i class="fa fa-check"></i><b>B</b> Commentary: Selecting a Modeling Framework</a>
<ul>
<li class="chapter" data-level="B.1" data-path="commentary-selecting-a-modeling-framework.html"><a href="commentary-selecting-a-modeling-framework.html#soil-temperature-regime-modeling-in-ca792"><i class="fa fa-check"></i><b>B.1</b> Soil Temperature Regime Modeling in CA792</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistics for Soil Survey - Part 2</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-regression" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Linear Regression<a href="linear-regression.html#linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="figure">
<img src="static-figures/logo.jpg" alt="" />
<p class="caption">Statistics for Soil Survey course banner image</p>
</div>
<div id="introduction-2" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Introduction<a href="linear-regression.html#introduction-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Linear regression models the linear relationship between a response variable (y) and an predictor variable (x).</p>
<p><span class="math inline">\(y = \alpha + \beta x + e\)</span></p>
<p>Where:</p>
<ul>
<li><p><span class="math inline">\(y\)</span> = the dependent variable</p></li>
<li><p><span class="math inline">\(\alpha\)</span> = the intercept of the fitted line</p></li>
<li><p><span class="math inline">\(\beta\)</span> = the Regression coefficient, i.e. slope of the fitted line. Strong relationships will have high values.</p></li>
<li><p><span class="math inline">\(x\)</span> = the independent variable (aka explanatory or predictor variable(s) )</p></li>
<li><p><span class="math inline">\(e\)</span> = the error term</p></li>
</ul>
<p>Linear regression has been used for soil survey applications since the early 1900s when <span class="citation">Briggs, McLane, and United States. Bureau of Soils (<a href="#ref-briggs1907" role="doc-biblioref">1907</a>)</span> developed a pedotransfer function to estimate the wilting coefficient as a function of soil particle size.</p>
<p>Wilting coefficient = 0.01(sand) + 0.12(silt) + 0.57(clay)</p>
<p>When more than one independent variable is used in the regression, it is referred to as multiple linear regression. In regression models, the response (or dependent) variable must always be continuous. The predictor (or independent) variable(s) can be continuous or categorical. In order to use linear regression or any linear model, the errors (i.e. residuals) must be normally distributed. Most environmental data are skewed and require transformations to the response variable (such as square root or log) for use in linear models. Normality can be assessed using a QQ plot or histogram of the residuals.</p>
</div>
<div id="linear-regression-example" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Linear Regression Example<a href="linear-regression.html#linear-regression-example" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we’ve got some of the basic theory out of the way we’ll move on to a real example, and address any additional theory where it relates to specific steps in the modeling process. The example selected for this chapter comes from the Mojave desert. The landscape is composed primarily of closed basins ringed by granitic hills and mountains (Peterson, 1981). The problem tackled here is modeling mean annual air temperature as a function of PRISM, digital elevation model (DEM) and Landsat derivatives.</p>
<p>This climate study began in 1998 as part of a national study run by the National Lab and led by Henry Mount <span class="citation">(<a href="#ref-mount2002" role="doc-biblioref">Mount and Paetzold 2002</a>)</span>. The objective was to determine if the hyperthermic line was consistent across the southern US, which at the time was thought to be ~3000 in elevation. Up until 2015 their were 77 active MAST sites, and 12 SCAN sites throughout MLRA 30 and 31.</p>
<p>For more details see the “MLRA 30 - Soil Climate Study - Soil Temperature” project in NASIS, on <a href="https://github.com/smroecker/mast-mojave">GitHub</a>, or by <span class="citation">(<a href="#ref-roecker2012" role="doc-biblioref">Roecker and Carrie-Ann Haydu-Houdeshell 2012</a>)</span>.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="linear-regression.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb113-2"><a href="linear-regression.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="linear-regression.html#cb113-3" aria-hidden="true" tabindex="-1"></a>prj <span class="ot">&lt;-</span> <span class="fu">get_project_from_NASISWebReport</span>(<span class="at">mlrassoarea =</span> <span class="st">&quot;8-VIC&quot;</span>, <span class="at">fiscalyear =</span> <span class="dv">2015</span>)</span></code></pre></div>
<pre><code>## Loading required namespace: rvest</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="linear-regression.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(prj, projectname <span class="sc">==</span> <span class="st">&quot;MLRA 30 - Soil Climate Study - Soil Temperature&quot;</span>)</span></code></pre></div>
<pre><code>##   mlrassoarea nonmlrassaarea mlraarea projecttypename projectsubtypename
## 4       8-VIC           &lt;NA&gt;       30            MLRA               &lt;NA&gt;
##   fiscalyear fiscalyear_goaled projectiid                        uprojectid
## 4       2015              2015      95689 0000-VIC-Soil Climate Studies-001
##                                       projectname projectapprovedflag
## 4 MLRA 30 - Soil Climate Study - Soil Temperature                TRUE
##   projectconcerntypename
## 4                   &lt;NA&gt;
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               projectdesc
## 4 8-VIC, Victorville, CA MLRA Soil Survey Office\r\nSoil Climate Study Plan \r\nProject Outline Worksheet \r\n\r\nProject Name:  MLRA 30 and 31 - Soil Climate Study Plan\r\n\r\nIdentification \r\nState/s: CA and NV (proposed to add in AZ as well)\r\nMLRAs: 30 and 31\r\nPlan Author: Carrie-Ann Houdeshell, MLRA SSPL and Stephen Roecker Soil Scientist\r\nRegional Office Staff: \r\nDavis, CA: Ed Tallyn, Senior Regional Soil Scientist; Jennifer Wood, Soil Data Quality Specialist\r\nPhoenix, AZ:  Nathan Starman, Soil Data Quality Specialist\r\nArea Office Staff: Peter Fahnestock, Area Resource Soil Scientist\r\n\r\nProject Contact Person(s) \r\nName: Carrie-Ann Houdeshell or Stephen Roecker\r\naddress: 15415 W. Sand St. #103, Victorville, CA 92392\r\nphone: (760) 843-6882\r\nemail: Carrie-Ann.Houdeshell@ca.usda.gov or Stephen.Roecker@ca.usda.gov\r\n\r\nProject Objective(s)  \r\nThe original objective of this study was to determine the thermic/hyperthermic boundary across MLRA 30. Currently the primary objective is to estimate soil tempe...
##   n_projectdesc n_areasymbol n_nationalmusym n_spatial date_start date_complete
## 4         13724           NA              NA        NA       &lt;NA&gt;          &lt;NA&gt;
##   date_qc date_qa_start date_qa_complete date_qc_spatial date_qa_spatial
## 4    &lt;NA&gt;          &lt;NA&gt;             &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;
##        pl_username qa_username muacres acre_landcat acre_goal acre_progress
## 4 Ballmer, Matthew        &lt;NA&gt;      NA           NA         0             0
##   pct_progress muacres_water acre_water acre_prog_water acre_federal
## 4           NA            NA         NA              NA           NA
##   acre_prog_federal acre_private acre_prog_private acre_native acre_prog_native
## 4                NA           NA                NA          NA               NA</code></pre>
<p>In addition to the 11-IND MAST modeling efforts there has also been two published studies on the Mojave. The first was by <span class="citation">Schmidlin, Peterson, and Gifford (<a href="#ref-schmidlin1983" role="doc-biblioref">1983</a>)</span> who examined both the Great Basin and Mojave Deserts in Nevada. The second was by <span class="citation">Bai et al. (<a href="#ref-bai2010" role="doc-biblioref">2010</a>)</span> who examined the Mojave Desert in California. Both studies developed regression models using elevation, but <span class="citation">Schmidlin, Peterson, and Gifford (<a href="#ref-schmidlin1983" role="doc-biblioref">1983</a>)</span> also incorporated latitude. The results from <span class="citation">Bai et al. (<a href="#ref-bai2010" role="doc-biblioref">2010</a>)</span> displayed considerably larger areas of hyperthermic soils than <span class="citation">Schmidlin, Peterson, and Gifford (<a href="#ref-schmidlin1983" role="doc-biblioref">1983</a>)</span>. This made be due to the unconventional method used by <span class="citation">Bai et al. (<a href="#ref-bai2010" role="doc-biblioref">2010</a>)</span> to measure MAST.</p>
</div>
<div id="data" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Data<a href="linear-regression.html#data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="henry-mount-database" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Henry Mount Database<a href="linear-regression.html#henry-mount-database" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Henry Mount Database already has 79 of the sites from the Mojave. However only 8 have temperature records.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="linear-regression.html#cb117-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">fetchHenry</span>(<span class="at">sso =</span> <span class="st">&quot;8-VIC&quot;</span>)</span>
<span id="cb117-2"><a href="linear-regression.html#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="linear-regression.html#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(f<span class="sc">$</span>sensors<span class="sc">$</span>user_site_id))</span></code></pre></div>
<pre><code>## computing un-biased soil temperature summaries</code></pre>
<pre><code>## 79 sensors loaded (1.89 Mb transferred)</code></pre>
</div>
<div id="aggregate-time-series" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Aggregate Time Series<a href="linear-regression.html#aggregate-time-series" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For our purposes the daily soil temperature measurements need to be aggregated to the mean annual soil temperature (MAST). However, depending data you query using, <code>fetchHenry()</code> maybe able to return pre-aggregated results using the <code>gran</code> function argument.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="linear-regression.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb120-2"><a href="linear-regression.html#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb120-3"><a href="linear-regression.html#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="linear-regression.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the site and sensor data frames from the list</span></span>
<span id="cb121-2"><a href="linear-regression.html#cb121-2" aria-hidden="true" tabindex="-1"></a>ms_df <span class="ot">&lt;-</span> f<span class="sc">$</span>soiltemp</span>
<span id="cb121-3"><a href="linear-regression.html#cb121-3" aria-hidden="true" tabindex="-1"></a>s     <span class="ot">&lt;-</span> f<span class="sc">$</span>sensors</span>
<span id="cb121-4"><a href="linear-regression.html#cb121-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-5"><a href="linear-regression.html#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="linear-regression.html#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rename 2 columns</span></span>
<span id="cb121-7"><a href="linear-regression.html#cb121-7" aria-hidden="true" tabindex="-1"></a>ms_df <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb121-8"><a href="linear-regression.html#cb121-8" aria-hidden="true" tabindex="-1"></a>  ms_df,</span>
<span id="cb121-9"><a href="linear-regression.html#cb121-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">day  =</span> date_time,</span>
<span id="cb121-10"><a href="linear-regression.html#cb121-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Jday =</span> doy</span>
<span id="cb121-11"><a href="linear-regression.html#cb121-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-12"><a href="linear-regression.html#cb121-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-13"><a href="linear-regression.html#cb121-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-14"><a href="linear-regression.html#cb121-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot sites visually inspect for flat lines and spikes</span></span>
<span id="cb121-15"><a href="linear-regression.html#cb121-15" aria-hidden="true" tabindex="-1"></a>ms_df <span class="sc">%&gt;%</span></span>
<span id="cb121-16"><a href="linear-regression.html#cb121-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;JVOHV2-50&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-17"><a href="linear-regression.html#cb121-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> sensor_value)) <span class="sc">+</span></span>
<span id="cb121-18"><a href="linear-regression.html#cb121-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 649 rows containing missing values (`geom_line()`).</code></pre>
<p><img src="004-linear-models_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="linear-regression.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate by Year, Month, and Julian day (i.e. 1-365, 366 for leap years)</span></span>
<span id="cb123-2"><a href="linear-regression.html#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="co"># compute number of days per site</span></span>
<span id="cb123-3"><a href="linear-regression.html#cb123-3" aria-hidden="true" tabindex="-1"></a>ms_n_df <span class="ot">&lt;-</span> ms_df <span class="sc">%&gt;%</span></span>
<span id="cb123-4"><a href="linear-regression.html#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sid, day) <span class="sc">%&gt;%</span></span>
<span id="cb123-5"><a href="linear-regression.html#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mast =</span> <span class="fu">mean</span>(sensor_value, <span class="at">na.exclude =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb123-6"><a href="linear-regression.html#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sid) <span class="sc">%&gt;%</span></span>
<span id="cb123-7"><a href="linear-regression.html#cb123-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">numDays =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(mast)), ) <span class="sc">%&gt;%</span></span>
<span id="cb123-8"><a href="linear-regression.html#cb123-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;sid&#39;. You can override using the `.groups`
## argument.</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="linear-regression.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute mast per year</span></span>
<span id="cb125-2"><a href="linear-regression.html#cb125-2" aria-hidden="true" tabindex="-1"></a>ms_site_df <span class="ot">&lt;-</span> ms_df <span class="sc">%&gt;%</span></span>
<span id="cb125-3"><a href="linear-regression.html#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sid, Jday) <span class="sc">%&gt;%</span></span>
<span id="cb125-4"><a href="linear-regression.html#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mast =</span> <span class="fu">mean</span>(sensor_value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb125-5"><a href="linear-regression.html#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sid) <span class="sc">%&gt;%</span></span>
<span id="cb125-6"><a href="linear-regression.html#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mast =</span> <span class="fu">mean</span>(mast, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb125-7"><a href="linear-regression.html#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;sid&#39;. You can override using the `.groups`
## argument.</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="linear-regression.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge mast &amp; numDays</span></span>
<span id="cb127-2"><a href="linear-regression.html#cb127-2" aria-hidden="true" tabindex="-1"></a>mast_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(s) <span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="linear-regression.html#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, sid, sensor_depth, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb127-4"><a href="linear-regression.html#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ms_site_df, <span class="at">by =</span> <span class="st">&quot;sid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-5"><a href="linear-regression.html#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ms_n_df,    <span class="at">by =</span> <span class="st">&quot;sid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb127-6"><a href="linear-regression.html#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sensor_depth <span class="sc">==</span> <span class="dv">50</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(mast))</span>
<span id="cb127-7"><a href="linear-regression.html#cb127-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-8"><a href="linear-regression.html#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mast_df)</span></code></pre></div>
<pre><code>##        name sid sensor_depth              geometry     mast numDays
## 1    JTNP15 923           50 POINT (-116.01 34.02) 19.97123     321
## 2 JAWBONE01 903           50  POINT (-117.99 35.5) 19.40847    3742
## 3 JAWBONE02 972           50  POINT (-118.14 35.5) 19.27930    3063
## 4    JVOHV1 924           50 POINT (-116.47 34.52) 21.89822    4461
## 5    JVOHV2 925           50 POINT (-116.64 34.52) 21.13497    4091
## 6    DEVA01 971           50   POINT (-116.9 36.3) 28.20590     253</code></pre>
<p>Note that we have a column in result data.frame called <code>"geometry"</code> since we created it from an sf object.</p>
</div>
<div id="final-dataset" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Final Dataset<a href="linear-regression.html#final-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since the Henry Mount database is partially incomplete we will proceed with the aggregation from the original txt files.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="linear-regression.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read mast data</span></span>
<span id="cb129-2"><a href="linear-regression.html#cb129-2" aria-hidden="true" tabindex="-1"></a>githubURL <span class="ot">&lt;-</span> <span class="fu">url</span>(<span class="st">&quot;https://raw.githubusercontent.com/ncss-tech/stats_for_soil_survey/master/data/mast_mojave.Rdata&quot;</span>)</span>
<span id="cb129-3"><a href="linear-regression.html#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="linear-regression.html#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(githubURL)</span></code></pre></div>
</div>
</div>
<div id="spatial-data" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Spatial data<a href="linear-regression.html#spatial-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="plot-coordinates" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Plot Coordinates<a href="linear-regression.html#plot-coordinates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Where do our points plot? To start we need to convert them to a spatial object first. Then we can create an interactive we map using <code>mapview</code>. Also, if we wish we can also export the locations as a Shapefile.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="linear-regression.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb130-2"><a href="linear-regression.html#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(mlra, <span class="at">alpha.region =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb130-3"><a href="linear-regression.html#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapview</span>(mast_sf)</span></code></pre></div>
</div>
<div id="extracting-spatial-data" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Extracting Spatial Data<a href="linear-regression.html#extracting-spatial-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Prior to any spatial analysis or modeling, you will need to develop a suite of geodata files that can be intersected with your field data locations. This is, in and of itself a difficult task and should be facilitated by your Regional GIS Specialist. The geodata files typically used would consist of derivatives from a DEM or satellite imagery, and a ‘good’ geology map. Prior to any prediction it is also necessary to ensure the geodata files have the same projection, extent, and cell size. Once we have the necessary files we can construct a list in R of the file names and paths, read the geodata into R, and then extract the geodata values where they intersect with field data.</p>
<p>As you can see below their are numerous variables we could inspect.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="linear-regression.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span></code></pre></div>
<pre><code>## Warning: package &#39;raster&#39; was built under R version 4.2.2</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Warning: package &#39;sp&#39; was built under R version 4.2.2</code></pre>
<pre><code>## 
## Attaching package: &#39;raster&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="linear-regression.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb137-2"><a href="linear-regression.html#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="linear-regression.html#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load raster stack from GitHub</span></span>
<span id="cb137-4"><a href="linear-regression.html#cb137-4" aria-hidden="true" tabindex="-1"></a>githubURL <span class="ot">&lt;-</span> <span class="fu">url</span>(<span class="st">&quot;https://raw.githubusercontent.com/ncss-tech/stats_for_soil_survey/master/data/mast_mojave_rs.rds&quot;</span>)</span>
<span id="cb137-5"><a href="linear-regression.html#cb137-5" aria-hidden="true" tabindex="-1"></a>geodata_r <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(githubURL)</span>
<span id="cb137-6"><a href="linear-regression.html#cb137-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-7"><a href="linear-regression.html#cb137-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-8"><a href="linear-regression.html#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the geodata and add to a data frame</span></span>
<span id="cb137-9"><a href="linear-regression.html#cb137-9" aria-hidden="true" tabindex="-1"></a>mast_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(mast_sf, <span class="at">crs =</span> <span class="dv">5070</span>)</span>
<span id="cb137-10"><a href="linear-regression.html#cb137-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(geodata_r, <span class="fu">st_coordinates</span>(mast_sf))</span>
<span id="cb137-11"><a href="linear-regression.html#cb137-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">st_drop_geometry</span>(mast_sf), data)</span>
<span id="cb137-12"><a href="linear-regression.html#cb137-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-13"><a href="linear-regression.html#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="co"># convert aspect</span></span>
<span id="cb137-14"><a href="linear-regression.html#cb137-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>northness <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="dv">180</span> <span class="sc">-</span> data<span class="sc">$</span>aspect)</span>
<span id="cb137-15"><a href="linear-regression.html#cb137-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-16"><a href="linear-regression.html#cb137-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-17"><a href="linear-regression.html#cb137-17" aria-hidden="true" tabindex="-1"></a><span class="co"># random sample</span></span>
<span id="cb137-18"><a href="linear-regression.html#cb137-18" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;elev&quot;</span>, <span class="st">&quot;temp&quot;</span>, <span class="st">&quot;precip&quot;</span>, <span class="st">&quot;solar&quot;</span>, <span class="st">&quot;tc_1&quot;</span>, <span class="st">&quot;twi&quot;</span>)</span>
<span id="cb137-19"><a href="linear-regression.html#cb137-19" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(geodata_r) <span class="sc">%in%</span> vars)</span>
<span id="cb137-20"><a href="linear-regression.html#cb137-20" aria-hidden="true" tabindex="-1"></a>geodata_s <span class="ot">&lt;-</span> <span class="fu">sampleRegular</span>(geodata_r[[idx]], <span class="at">size =</span> <span class="dv">1000</span>)</span></code></pre></div>
</div>
</div>
<div id="exploratory-data-analysis-eda" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Exploratory Data Analysis (EDA)<a href="linear-regression.html#exploratory-data-analysis-eda" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Generally before we begin modeling it is good to explore the data. By examining a simple summary we can quickly see the breakdown of our data. It is important to look out for missing or improbable values. Probably the easiest way to identify peculiarities in the data is to plot it.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="linear-regression.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code></pre></div>
<pre><code>##        siteid        mast          numDays          elev            slope      
##  Cheme01  : 1   Min.   : 3.10   Min.   : 363   Min.   :   0.0   Min.   : 0.00  
##  Clark01  : 1   1st Qu.:18.50   1st Qu.:1831   1st Qu.: 699.2   1st Qu.: 2.00  
##  DEVA01   : 1   Median :20.57   Median :2918   Median : 947.5   Median : 5.00  
##  DEVA02   : 1   Mean   :19.93   Mean   :2465   Mean   :1082.0   Mean   :11.85  
##  DEVA03   : 1   3rd Qu.:23.72   3rd Qu.:3397   3rd Qu.:1480.2   3rd Qu.:21.00  
##  Jawbone01: 1   Max.   :28.77   Max.   :4159   Max.   :3021.0   Max.   :42.00  
##  (Other)  :62                                                                  
##      aspect            twi            solar         solarcv     
##  Min.   :  6.00   Min.   : 8.00   Min.   :1758   Min.   :21.00  
##  1st Qu.: 90.25   1st Qu.: 9.25   1st Qu.:2028   1st Qu.:31.00  
##  Median :140.00   Median :12.00   Median :2091   Median :32.50  
##  Mean   :143.62   Mean   :12.00   Mean   :2084   Mean   :32.66  
##  3rd Qu.:196.00   3rd Qu.:14.00   3rd Qu.:2136   3rd Qu.:33.25  
##  Max.   :333.00   Max.   :21.00   Max.   :2443   Max.   :44.00  
##                   NA&#39;s   :2                                     
##       tc_1             tc_2             tc_3            precip      
##  Min.   : 58.00   Min.   : 26.00   Min.   :  2.00   Min.   : 3.000  
##  1st Qu.: 97.75   1st Qu.: 47.75   1st Qu.: 31.50   1st Qu.: 6.000  
##  Median :120.00   Median : 57.50   Median : 50.50   Median : 7.000  
##  Mean   :122.22   Mean   : 56.85   Mean   : 51.87   Mean   : 9.824  
##  3rd Qu.:143.50   3rd Qu.: 64.00   3rd Qu.: 74.00   3rd Qu.:10.000  
##  Max.   :191.00   Max.   :100.00   Max.   :121.00   Max.   :44.000  
##                                                                     
##       temp         northness     
##  Min.   :10.00   Min.   :  0.00  
##  1st Qu.:20.75   1st Qu.: 23.75  
##  Median :23.50   Median : 68.00  
##  Mean   :23.10   Mean   : 64.59  
##  3rd Qu.:26.00   3rd Qu.: 93.50  
##  Max.   :31.00   Max.   :174.00  
## </code></pre>
<p>You may recall from discussion of EDA that QQ plots are a visual way to inspect the normality of a variable. If the variable is normally distributed, the points (e.g. soil observations) should line up along the straight line.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="linear-regression.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># QQ plot</span></span>
<span id="cb140-2"><a href="linear-regression.html#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="linear-regression.html#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">sample =</span> mast)) <span class="sc">+</span></span>
<span id="cb140-4"><a href="linear-regression.html#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>() <span class="sc">+</span></span>
<span id="cb140-5"><a href="linear-regression.html#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>()</span></code></pre></div>
<p><img src="004-linear-models_files/figure-html/qq-plot-1.png" width="672" /></p>
<p>By examining the correlations between some of the predictors we can also determine whether they are <em>collinear</em> (e.g. &gt; 0.6). This is common for similar variables such as Landsat bands, terrain derivatives, and climatic variables. Variables that are colinear are redundant and contain no additional information. In addition, collinearity will make it difficult to estimate our regression coefficients.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="linear-regression.html#cb141-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mast&quot;</span>, <span class="st">&quot;elev&quot;</span>, <span class="st">&quot;temp&quot;</span>, <span class="st">&quot;precip&quot;</span>, <span class="st">&quot;tc_2&quot;</span>, <span class="st">&quot;tc_1&quot;</span>, <span class="st">&quot;tc_3&quot;</span>)</span>
<span id="cb141-2"><a href="linear-regression.html#cb141-2" aria-hidden="true" tabindex="-1"></a>GGally<span class="sc">::</span><span class="fu">ggpairs</span>(data[vars])</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;GGally&#39;:
##   method from   
##   +.gg   ggplot2</code></pre>
<p><img src="004-linear-models_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="linear-regression.html#cb143-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mast&quot;</span>, <span class="st">&quot;slope&quot;</span>, <span class="st">&quot;twi&quot;</span>, <span class="st">&quot;northness&quot;</span>, <span class="st">&quot;solar&quot;</span>, <span class="st">&quot;solarcv&quot;</span>)</span>
<span id="cb143-2"><a href="linear-regression.html#cb143-2" aria-hidden="true" tabindex="-1"></a>GGally<span class="sc">::</span><span class="fu">ggpairs</span>(data[vars])</span></code></pre></div>
<p><img src="004-linear-models_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<p>The correlation matrices and scatter plots above show that that MAST has moderate correlations with some of the variables, particularly the elevation and the climatic variables.</p>
<p>Examining the density plots on the diagonal axis of the scatter plots we can also see that some variables are skewed.</p>
<div id="compare-samples-vs-population" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Compare Samples vs Population<a href="linear-regression.html#compare-samples-vs-population" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since our data was not randomly sampled, we had better check the distribution of our samples vs the population. We can accomplish this by overlaying the sample distribution of predictor variables vs a large random sample.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="linear-regression.html#cb144-1" aria-hidden="true" tabindex="-1"></a>geodata_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(geodata_s)</span>
<span id="cb144-2"><a href="linear-regression.html#cb144-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-3"><a href="linear-regression.html#cb144-3" aria-hidden="true" tabindex="-1"></a>geodata_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb144-4"><a href="linear-regression.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">source =</span> <span class="st">&quot;sample&quot;</span>,     data[<span class="fu">names</span>(geodata_df)]),</span>
<span id="cb144-5"><a href="linear-regression.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">source =</span> <span class="st">&quot;population&quot;</span>, geodata_df)</span>
<span id="cb144-6"><a href="linear-regression.html#cb144-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb144-7"><a href="linear-regression.html#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-8"><a href="linear-regression.html#cb144-8" aria-hidden="true" tabindex="-1"></a>geodata_l <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(geodata_df,</span>
<span id="cb144-9"><a href="linear-regression.html#cb144-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cols =</span> <span class="sc">-</span>source)</span>
<span id="cb144-10"><a href="linear-regression.html#cb144-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-11"><a href="linear-regression.html#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(geodata_l, <span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> source)) <span class="sc">+</span></span>
<span id="cb144-12"><a href="linear-regression.html#cb144-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb144-13"><a href="linear-regression.html#cb144-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb144-14"><a href="linear-regression.html#cb144-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Evaluation of Sample Representativeness&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 1266 rows containing non-finite values (`stat_density()`).</code></pre>
<p><img src="004-linear-models_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>The overlap between our sample and the population appear satisfactory.</p>
</div>
</div>
<div id="linear-modeling" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Linear modeling<a href="linear-regression.html#linear-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R has several functions for fitting linear models. The most common is arguably the <code>lm()</code> function from the stats R package, which is loaded by default. The <code>lm()</code> function is also extended through the use of several additional packages such as the car and caret R packages. Another noteworthy R package for linear modeling is rms, which offers the <code>ols()</code> function for linear modeling. The rms R package <span class="citation">(<a href="#ref-harrell2015" role="doc-biblioref">Harrell 2015</a>)</span> offers an ‘almost’ comprehensive alternative to `lm()’ and it’s accessory function. Each function offers useful features, therefore for the we will demonstrate elements of both. Look for comments (i.e. #) below referring to rms or stats.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="linear-regression.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># stats</span></span>
<span id="cb146-2"><a href="linear-regression.html#cb146-2" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(mast <span class="sc">~</span> elev <span class="sc">+</span> aspect <span class="sc">+</span> twi <span class="sc">+</span> solar <span class="sc">+</span> solarcv <span class="sc">+</span> tc_1 <span class="sc">+</span> tc_2 <span class="sc">+</span> tc_3 <span class="sc">+</span> precip <span class="sc">+</span> temp, <span class="at">data =</span> data, <span class="at">weights =</span> data<span class="sc">$</span>numDays)</span>
<span id="cb146-3"><a href="linear-regression.html#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="linear-regression.html#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="linear-regression.html#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rms R package</span></span>
<span id="cb146-6"><a href="linear-regression.html#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="linear-regression.html#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb146-8"><a href="linear-regression.html#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="linear-regression.html#cb146-9" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(data)</span>
<span id="cb146-10"><a href="linear-regression.html#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">&quot;dd&quot;</span>)</span>
<span id="cb146-11"><a href="linear-regression.html#cb146-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-12"><a href="linear-regression.html#cb146-12" aria-hidden="true" tabindex="-1"></a>fit_ols <span class="ot">&lt;-</span> <span class="fu">ols</span>(mast <span class="sc">~</span> elev <span class="sc">+</span> aspect <span class="sc">+</span> twi <span class="sc">+</span> solar <span class="sc">+</span> solarcv <span class="sc">+</span> tc_1 <span class="sc">+</span> tc_2 <span class="sc">+</span> tc_3 <span class="sc">+</span> precip <span class="sc">+</span> temp, <span class="at">data =</span> data, <span class="at">x =</span> <span class="cn">TRUE</span>, <span class="at">y =</span> <span class="cn">TRUE</span>, <span class="at">weights =</span> data<span class="sc">$</span>numDays)</span></code></pre></div>
<div id="diagnostics" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Diagnostics<a href="linear-regression.html#diagnostics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="residual-plots" class="section level4 hasAnchor" number="4.6.1.1">
<h4><span class="header-section-number">4.6.1.1</span> Residual plots<a href="linear-regression.html#residual-plots" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Once we have a model we need to assess residuals for linearity, normality, and homoscedastivity (or constant variance). Oddly this is one area were the rms R package does not offer convient functions for plotting residuals, therefore we’ll simply access the results of <code>lm()</code>.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="linear-regression.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfcol =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span></code></pre></div>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="linear-regression.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># residual</span></span>
<span id="cb148-2"><a href="linear-regression.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit_lm)</span></code></pre></div>
<p><img src="004-linear-models_files/figure-html/unnamed-chunk-10-1.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-2.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-3.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-4.png" width="672" /></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="linear-regression.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># partial residuals</span></span>
<span id="cb149-2"><a href="linear-regression.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">termplot</span>(fit_lm, <span class="at">partial.resid =</span> <span class="cn">TRUE</span>, <span class="at">col.res =</span> <span class="st">&quot;black&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="004-linear-models_files/figure-html/unnamed-chunk-10-5.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-6.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-7.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-8.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-9.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-10.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-11.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-12.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-13.png" width="672" /><img src="004-linear-models_files/figure-html/unnamed-chunk-10-14.png" width="672" /></p>
<p>Remember the residuals are simply just the observed values minus the predicted values, which are easy enough to calculate. Alternatively we can simply extract them from the fitted model object.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="linear-regression.html#cb150-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_lm, data)</span>
<span id="cb150-2"><a href="linear-regression.html#cb150-2" aria-hidden="true" tabindex="-1"></a>res  <span class="ot">&lt;-</span> data<span class="sc">$</span>mast <span class="sc">-</span> pred</span>
<span id="cb150-3"><a href="linear-regression.html#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code></pre></div>
<pre><code>##          1          2          3          4          5          6 
## -1.3182498 -0.4111067  0.1231537  1.4750626 -0.1719747 -0.1036808</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="linear-regression.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or </span></span>
<span id="cb152-2"><a href="linear-regression.html#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="linear-regression.html#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">residuals</span>(fit_lm))</span></code></pre></div>
<pre><code>##          1          2          3          4          5          6 
## -1.3182498 -0.4111067  0.1231537  1.4750626 -0.1719747 -0.1036808</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="linear-regression.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually plot the residuals</span></span>
<span id="cb154-2"><a href="linear-regression.html#cb154-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(res, pred)</span>
<span id="cb154-3"><a href="linear-regression.html#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="linear-regression.html#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(res, <span class="fu">aes</span>(<span class="at">x =</span> pred, <span class="at">y =</span> res)) <span class="sc">+</span> </span>
<span id="cb154-5"><a href="linear-regression.html#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb154-6"><a href="linear-regression.html#cb154-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)</span></code></pre></div>
</div>
<div id="multicolinearity" class="section level4 hasAnchor" number="4.6.1.2">
<h4><span class="header-section-number">4.6.1.2</span> Multicolinearity<a href="linear-regression.html#multicolinearity" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As we mentioned earlier multicolinearity should be avoided. To assess a model for multicolinearity we can compute the <strong>variance inflation factor</strong> (VIF). Its square root indicates the amount of increase in the predictor coefficients standard error. A value greater than 3 indicates a doubling the standard error. Rules of thumb vary, but a square root of vif greater than 2 or 3 indicates an unacceptable value <span class="citation">(<a href="#ref-faraway2004" role="doc-biblioref">Faraway 2004</a>)</span>.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="linear-regression.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vif() function from the rms or car packages</span></span>
<span id="cb155-2"><a href="linear-regression.html#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">vif</span>(fit_ols))</span></code></pre></div>
<pre><code>##     elev   aspect      twi    solar  solarcv     tc_1     tc_2     tc_3 
## 8.851106 1.103580 2.056235 6.068831 5.787921 4.114079 3.009392 3.311669 
##   precip     temp 
## 2.274489 7.860236</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="linear-regression.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or </span></span>
<span id="cb157-2"><a href="linear-regression.html#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="linear-regression.html#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">vif</span>(fit_ols)) <span class="sc">&gt;</span> <span class="dv">3</span></span></code></pre></div>
<pre><code>##    elev  aspect     twi   solar solarcv    tc_1    tc_2    tc_3  precip    temp 
##    TRUE   FALSE   FALSE    TRUE    TRUE    TRUE    TRUE    TRUE   FALSE    TRUE</code></pre>
<p>The values above indicate we have several colinear variables in the model, which you might have noticed already from the scatter plot matrix.</p>
</div>
</div>
<div id="variable-selection-model-validation" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Variable selection &amp; model validation<a href="linear-regression.html#variable-selection-model-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Modeling is an iterative process that cycles between fitting and evaluating alternative models. Compared to tree and forest models, linear and generalized models typically less automated. Automated model selection procedures are available, but should not be taken at face value because they may result in complex and unstable models. This is in part due to correlation amongist the predictive variables that can confuse the model. Also, the order in which the variables are included or excluded from the model effects the significance of the other variables, and thus several weak predictors might mask the effect of one strong predictor. Regardless of the approach used, variable selection is probably the most controversial aspect of linear modeling.</p>
<p>Both the rms and caret packages offer methods for variable selection and cross-validation. In this instance the rms approach is a bit more convenient, with the one line call to <code>validate()</code>.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="linear-regression.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb159-2"><a href="linear-regression.html#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb159-3"><a href="linear-regression.html#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="linear-regression.html#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="linear-regression.html#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rms</span></span>
<span id="cb159-6"><a href="linear-regression.html#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="do">## stepwise selection</span></span>
<span id="cb159-7"><a href="linear-regression.html#cb159-7" aria-hidden="true" tabindex="-1"></a><span class="fu">validate</span>(fit_ols, <span class="at">bw =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##      Backwards Step-down - Original Model
## 
##  Deleted Chi-Sq d.f. P      Residual d.f. P      AIC   R2   
##  temp    0.19   1    0.6593 0.19     1    0.6593 -1.81 34676
##  aspect  0.45   1    0.5020 0.65     2    0.7243 -3.35 34674
##  solarcv 0.97   1    0.3248 1.61     3    0.6561 -4.39 34672
##  twi     0.51   1    0.4762 2.12     4    0.7133 -5.88 34670
##  tc_3    1.25   1    0.2642 3.37     5    0.6434 -6.63 34667
##  precip  0.85   1    0.3558 4.22     6    0.6468 -7.78 34665
## 
## Approximate Estimates after Deleting Factors
## 
##                Coef     S.E.  Wald Z         P
## Intercept 24.486899 4.044131   6.055 1.405e-09
## elev      -0.007142 0.000550 -12.985 0.000e+00
## solar      0.009497 0.002012   4.721 2.346e-06
## tc_1      -0.062146 0.012006  -5.176 2.264e-07
## tc_2      -0.157832 0.036778  -4.291 1.775e-05
## 
## Factors in Final Model
## 
## [1] elev  solar tc_1  tc_2</code></pre>
<pre><code>##           index.orig training   test optimism index.corrected  n
## R-square      0.9286   0.9319 0.9154   0.0165          0.9120 40
## MSE           2.1473   1.8643 2.5430  -0.6787          2.8261 40
## g             5.6666   5.6236 5.6643  -0.0407          5.7074 40
## Intercept     0.0000   0.0000 0.1430  -0.1430          0.1430 40
## Slope         1.0000   1.0000 0.9917   0.0083          0.9917 40
## 
## Factors Retained in Backwards Elimination
## 
##  elev aspect twi solar solarcv tc_1 tc_2 tc_3 precip temp
##  *               *             *    *                    
##  *                     *       *    *                    
##  *               *             *    *                    
##                  *             *    *                *   
##  *               *             *              *          
##  *               *             *    *                    
##  *               *             *    *                    
##                        *       *    *                *   
##  *               *             *    *                    
##  *               *             *    *                    
##  *                     *       *    *                    
##                        *       *    *                *   
##  *               *             *    *                    
##  *               *             *    *                    
##  *               *             *    *                    
##  *                     *       *    *                    
##  *                     *       *    *         *          
##              *   *                  *                *   
##  *                     *       *    *                    
##                        *       *    *                *   
##  *               *             *    *    *               
##              *   *                  *    *           *   
##                        *       *    *                *   
##  *               *                       *               
##  *               *             *    *         *          
##                  *             *    *                *   
##  *                     *                                 
##  *                     *       *    *                    
##  *               *             *    *    *           *   
##                  *             *    *                *   
##              *         *            *                *   
##  *                     *                                 
##  *                     *       *    *                    
##                        *       *    *                *   
##  *               *             *                         
##                  *             *    *                *   
##                        *       *    *                *   
##  *               *             *    *                    
##  *                             *         *    *          
##  *                     *       *    *                    
## 
## Frequencies of Numbers of Factors Retained
## 
##  2  3  4  5  6 
##  2  2 31  4  1</code></pre>
<p>The results for <code>validate()</code> above show which variables were retained and deleted. Above we can see a dot matrix of which variables were retained during each of the 10 iterations of from cross validation. In addition, we can see the difference between the training and test accuracy and error metrics. Remember that it is the test accuracy we should pay attention too.</p>
</div>
<div id="final-model-accuracy-assessment" class="section level3 hasAnchor" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Final model &amp; accuracy assessment<a href="linear-regression.html#final-model-accuracy-assessment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once we have a model we are ‘happy’ with we can fit the final model, and call <code>validate()</code> again which gives performace metrics such as <code>R$2</code> and the mean square error (MSE). If we want the root mean square error (RMSE), which is in the original units of our measurements we can take the square root of MSE using <code>sqrt()</code>.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="linear-regression.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rms</span></span>
<span id="cb162-2"><a href="linear-regression.html#cb162-2" aria-hidden="true" tabindex="-1"></a>final_ols <span class="ot">&lt;-</span> <span class="fu">ols</span>(mast <span class="sc">~</span> elev <span class="sc">+</span> solarcv <span class="sc">+</span> tc_1 <span class="sc">+</span> tc_2, <span class="at">data =</span> data, <span class="at">weights =</span> data<span class="sc">$</span>numDays, <span class="at">x =</span> <span class="cn">TRUE</span>, <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb162-3"><a href="linear-regression.html#cb162-3" aria-hidden="true" tabindex="-1"></a>final_ols</span></code></pre></div>
<pre><code>## Linear Regression Model
## 
## ols(formula = mast ~ elev + solarcv + tc_1 + tc_2, data = data, 
##     weights = data$numDays, x = TRUE, y = TRUE)
## 
##                  Model Likelihood    Discrimination    
##                        Ratio Test           Indexes    
## Obs       68    LR chi2    177.01    R2       0.926    
## sigma73.3628    d.f.            4    R2 adj   0.921    
## d.f.      63    Pr(&gt; chi2) 0.0000    g        5.720    
## 
## Residuals
## 
##     Min      1Q  Median      3Q     Max 
## -3.7912 -0.8006 -0.1218  0.7401  4.0016 
## 
## 
##           Coef    S.E.   t      Pr(&gt;|t|)
## Intercept 49.9906 3.7439  13.35 &lt;0.0001 
## elev      -0.0066 0.0006 -11.82 &lt;0.0001 
## solarcv   -0.2421 0.0526  -4.60 &lt;0.0001 
## tc_1      -0.0535 0.0113  -4.75 &lt;0.0001 
## tc_2      -0.1469 0.0362  -4.06 0.0001</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="linear-regression.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb164-2"><a href="linear-regression.html#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">validate</span>(final_ols, <span class="at">method =</span> <span class="st">&quot;crossvalidation&quot;</span>, <span class="at">B =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##           index.orig training   test optimism index.corrected  n
## R-square      0.9209   0.9227 0.7896   0.1331          0.7878 10
## MSE           2.3332   2.2652 2.7234  -0.4582          2.7914 10
## g             5.7197   5.6658 5.4657   0.2001          5.5196 10
## Intercept     0.0000   0.0000 0.8853  -0.8853          0.8853 10
## Slope         1.0000   1.0000 0.9571   0.0429          0.9571 10</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="linear-regression.html#cb166-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_ols)</span>
<span id="cb166-2"><a href="linear-regression.html#cb166-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-3"><a href="linear-regression.html#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="linear-regression.html#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE</span></span>
<span id="cb166-5"><a href="linear-regression.html#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>((<span class="at">MSE =</span> <span class="fl">1.7218</span>))</span></code></pre></div>
<pre><code>## [1] 1.312174</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="linear-regression.html#cb168-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">RMSE</span>(<span class="at">pred =</span> data<span class="sc">$</span>pred, <span class="at">obs =</span> data<span class="sc">$</span>mast)</span></code></pre></div>
<pre><code>## [1] 1.527477</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="linear-regression.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R2</span></span>
<span id="cb170-2"><a href="linear-regression.html#cb170-2" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">R2</span>(<span class="at">pred =</span> data<span class="sc">$</span>pred, <span class="at">obs =</span> data<span class="sc">$</span>mast, <span class="at">formula =</span> <span class="st">&quot;traditional&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0.9208941</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="linear-regression.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot model fit</span></span>
<span id="cb172-2"><a href="linear-regression.html#cb172-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-3"><a href="linear-regression.html#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> mast, <span class="at">y =</span> pred)) <span class="sc">+</span></span>
<span id="cb172-4"><a href="linear-regression.html#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb172-5"><a href="linear-regression.html#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span> </span>
<span id="cb172-6"><a href="linear-regression.html#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb172-7"><a href="linear-regression.html#cb172-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Model Fit&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="004-linear-models_files/figure-html/final-model-1.png" width="672" /></p>
</div>
<div id="model-interpretation" class="section level3 hasAnchor" number="4.6.4">
<h3><span class="header-section-number">4.6.4</span> Model Interpretation<a href="linear-regression.html#model-interpretation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="linear-regression.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model accuracy, residuals, and slopes (e.g. coefficents)</span></span>
<span id="cb174-2"><a href="linear-regression.html#cb174-2" aria-hidden="true" tabindex="-1"></a>final_ols</span></code></pre></div>
<pre><code>## Linear Regression Model
## 
## ols(formula = mast ~ elev + solarcv + tc_1 + tc_2, data = data, 
##     weights = data$numDays, x = TRUE, y = TRUE)
## 
##                  Model Likelihood    Discrimination    
##                        Ratio Test           Indexes    
## Obs       68    LR chi2    177.01    R2       0.926    
## sigma73.3628    d.f.            4    R2 adj   0.921    
## d.f.      63    Pr(&gt; chi2) 0.0000    g        5.720    
## 
## Residuals
## 
##     Min      1Q  Median      3Q     Max 
## -3.7912 -0.8006 -0.1218  0.7401  4.0016 
## 
## 
##           Coef    S.E.   t      Pr(&gt;|t|)
## Intercept 49.9906 3.7439  13.35 &lt;0.0001 
## elev      -0.0066 0.0006 -11.82 &lt;0.0001 
## solarcv   -0.2421 0.0526  -4.60 &lt;0.0001 
## tc_1      -0.0535 0.0113  -4.75 &lt;0.0001 
## tc_2      -0.1469 0.0362  -4.06 0.0001</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="linear-regression.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Anova</span></span>
<span id="cb176-2"><a href="linear-regression.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(final_ols)</span></code></pre></div>
<pre><code>##                 Analysis of Variance          Response: mast 
## 
##  Factor     d.f. Partial SS MS          F      P     
##  elev        1    751577.78  751577.776 139.64 &lt;.0001
##  solarcv     1    114017.66  114017.655  21.18 &lt;.0001
##  tc_1        1    121686.11  121686.110  22.61 &lt;.0001
##  tc_2        1     88784.39   88784.388  16.50 1e-04 
##  REGRESSION  4   4240328.96 1060082.241 196.96 &lt;.0001
##  ERROR      63    339072.21    5382.099</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="linear-regression.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model Effects</span></span>
<span id="cb178-2"><a href="linear-regression.html#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">summary</span>(final_ols))</span></code></pre></div>
<p><img src="004-linear-models_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="linear-regression.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Effects</span></span>
<span id="cb179-2"><a href="linear-regression.html#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(final_ols),</span>
<span id="cb179-3"><a href="linear-regression.html#cb179-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">addlayer =</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">22</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-4"><a href="linear-regression.html#cb179-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">22</span>))</span>
<span id="cb179-5"><a href="linear-regression.html#cb179-5" aria-hidden="true" tabindex="-1"></a>       )</span></code></pre></div>
<p><img src="004-linear-models_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="linear-regression.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vary solarcv (North = 23; Flat = 33; South = 55)</span></span>
<span id="cb180-2"><a href="linear-regression.html#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(final_ols, <span class="at">elev =</span> <span class="cn">NA</span>, <span class="at">solarcv =</span> <span class="fu">c</span>(<span class="dv">23</span>, <span class="dv">33</span>, <span class="dv">51</span>))) <span class="sc">+</span></span>
<span id="cb180-3"><a href="linear-regression.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">22</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb180-4"><a href="linear-regression.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">22</span>))</span></code></pre></div>
<p><img src="004-linear-models_files/figure-html/unnamed-chunk-14-3.png" width="672" /></p>
</div>
</div>
<div id="generate-spatial-predictions" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Generate spatial predictions<a href="linear-regression.html#generate-spatial-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="linear-regression.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict mast model</span></span>
<span id="cb181-2"><a href="linear-regression.html#cb181-2" aria-hidden="true" tabindex="-1"></a>predfun <span class="ot">&lt;-</span> <span class="cf">function</span>(model, data) {</span>
<span id="cb181-3"><a href="linear-regression.html#cb181-3" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, data, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb181-4"><a href="linear-regression.html#cb181-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb181-5"><a href="linear-regression.html#cb181-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-6"><a href="linear-regression.html#cb181-6" aria-hidden="true" tabindex="-1"></a>mast_r <span class="ot">&lt;-</span> <span class="fu">predict</span>(geodata_r, final_ols, <span class="at">fun =</span> predfun, <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">progress =</span> <span class="st">&#39;text&#39;</span>)</span>
<span id="cb181-7"><a href="linear-regression.html#cb181-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-8"><a href="linear-regression.html#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(mast_r) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;MAST&quot;</span>, <span class="st">&quot;SE&quot;</span>)</span></code></pre></div>
</div>
<div id="create-map" class="section level2 hasAnchor" number="4.8">
<h2><span class="header-section-number">4.8</span> Create Map<a href="linear-regression.html#create-map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="linear-regression.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mast</span></span>
<span id="cb182-2"><a href="linear-regression.html#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mast_r)</span></code></pre></div>
</div>
<div id="exercise" class="section level2 hasAnchor" number="4.9">
<h2><span class="header-section-number">4.9</span> Exercise<a href="linear-regression.html#exercise" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Load the CA790 MAST dataset.</li>
</ol>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="linear-regression.html#cb183-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://raw.githubusercontent.com/ncss-tech/stats_for_soil_survey/master/exercises/yosemite-example/henry_CA790_data.csv&quot;</span></span>
<span id="cb183-2"><a href="linear-regression.html#cb183-2" aria-hidden="true" tabindex="-1"></a>mast2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>Fit a linear model.</p></li>
<li><p>Examine the residuals and check for multi-collinearity.</p>
<ul>
<li>Are their any outliers?</li>
</ul></li>
<li><p>Perform a variable selection.</p>
<ul>
<li>Does the automatic selection make sense?</li>
</ul></li>
<li><p>Assess the model accuracy and plot the fit.</p>
<ul>
<li>How do the train vs test accuracies compare?</li>
</ul></li>
<li><p>Summarize and plot the model effects.</p>
<ul>
<li>Which variable has the steepest slope?</li>
<li>Which variable has the greatest effect?</li>
<li>Which variable explains the most variance?</li>
</ul></li>
</ol>
</div>
<div id="additional-reading-1" class="section level2 hasAnchor" number="4.10">
<h2><span class="header-section-number">4.10</span> Additional reading<a href="linear-regression.html#additional-reading-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The proper use and misuse of regression in soil science has been described by <span class="citation">(<a href="#ref-webster1997" role="doc-biblioref">Webster 1997</a>)</span>. <span class="citation">James et al. (<a href="#ref-james2021" role="doc-biblioref">2021</a>)</span> provide a useful introduction to linear regression. For more discussion of extending regression to incorporate spatial trends in the residuals see <span class="citation">Hengl (<a href="#ref-hengl2009" role="doc-biblioref">2009</a>)</span>.</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bai2010" class="csl-entry">
Bai, Yanying, Thomas A. Scott, Weiping Chen, Robert C. Graham, Laosheng Wu, Andrew C. Chang, and Lanny J. Lund. 2010. <span>“Soil <span>Temperature</span> <span>Regimes</span> of the <span>Mojave</span> <span>Desert</span>.”</span> <em>Soil Science</em> 175 (8): 398–404. <a href="https://doi.org/10.1097/SS.0b013e3181eb66ee">https://doi.org/10.1097/SS.0b013e3181eb66ee</a>.
</div>
<div id="ref-briggs1907" class="csl-entry">
Briggs, Lyman J. (Lyman James), John Wallace McLane, and United States. Bureau of Soils. 1907. <em>The Moisture Equivalents of Soils</em>. Washington, Govt. Print. Off. <a href="http://archive.org/details/moistureequivale45brig">http://archive.org/details/moistureequivale45brig</a>.
</div>
<div id="ref-faraway2004" class="csl-entry">
Faraway, Julian J. 2004. <em>Linear <span>Models</span> with <span>R</span></em>. 1st ed. New York: Chapman; Hall/CRC. <a href="https://cran.r-project.org/doc/contrib/Faraway-PRA.pdf">https://cran.r-project.org/doc/contrib/Faraway-PRA.pdf</a>.
</div>
<div id="ref-harrell2015" class="csl-entry">
Harrell, Frank E. 2015. <em>Regression <span>Modeling</span> <span>Strategies</span>: <span>With</span> <span>Applications</span> to <span>Linear</span> <span>Models</span>, <span>Logistic</span> and <span>Ordinal</span> <span>Regression</span>, and <span>Survival</span> <span>Analysis</span></em>. Springer <span>Series</span> in <span>Statistics</span>. Cham: Springer International Publishing. <a href="https://doi.org/10.1007/978-3-319-19425-7">https://doi.org/10.1007/978-3-319-19425-7</a>.
</div>
<div id="ref-hengl2009" class="csl-entry">
Hengl, Tomislav. 2009. <em>A Practical Guide to Geostatistical Mapping</em>. 2nd extended ed. Amsterdam: Hengl. <a href="http://spatial-analyst.net/book/">http://spatial-analyst.net/book/</a>.
</div>
<div id="ref-james2021" class="csl-entry">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2021. <em>An <span>Introduction</span> to <span>Statistical</span> <span>Learning</span>: With <span>Applications</span> in <span>R</span></em>. Springer <span>Texts</span> in <span>Statistics</span>. New York, NY: Springer US. <a href="https://doi.org/10.1007/978-1-0716-1418-1">https://doi.org/10.1007/978-1-0716-1418-1</a>.
</div>
<div id="ref-mount2002" class="csl-entry">
Mount, H. R., and R. F. Paetzold. 2002. <span>“The Temperature Regime for Selected Soils in the <span>United</span> <span>States</span>.”</span> Lincoln, Nebraska. <a href="https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/nrcs142p2_051004.pdf">https://www.nrcs.usda.gov/Internet/FSE_DOCUMENTS/nrcs142p2_051004.pdf</a>.
</div>
<div id="ref-roecker2012" class="csl-entry">
Roecker, Stephen, and Carrie-Ann Haydu-Houdeshell. 2012. <span>“Modeling and <span>Application</span> of <span>Soil</span> <span>Temperature</span> in the <span>Mojave</span> and <span>Lower</span> <span>Colorado</span> <span>Deserts</span> of <span>California</span>.”</span> In. Davis, CA. <a href="https://doi.org/10.13140/RG.2.2.19782.32329">https://doi.org/10.13140/RG.2.2.19782.32329</a>.
</div>
<div id="ref-schmidlin1983" class="csl-entry">
Schmidlin, T. W., F. F. Peterson, and R. O. Gifford. 1983. <span>“Soil <span>Temperature</span> <span>Regimes</span> in <span>Nevada</span>.”</span> <em>Soil Science Society of America Journal</em> 47 (5): 977–77. <a href="https://doi.org/10.2136/sssaj1983.03615995004700050027x">https://doi.org/10.2136/sssaj1983.03615995004700050027x</a>.
</div>
<div id="ref-webster1997" class="csl-entry">
Webster, R. 1997. <span>“Regression and Functional Relations.”</span> <em>European Journal of Soil Science</em> 48 (3): 557–66. <a href="https://doi.org/10.1111/j.1365-2389.1997.tb00222.x">https://doi.org/10.1111/j.1365-2389.1997.tb00222.x</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="numerical-tax.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="glm.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["s4ssbook.pdf", "s4ssbook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
